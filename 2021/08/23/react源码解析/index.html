<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="React,">










<meta name="description" content="ä¸€ã€å‰è¨€æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨reactï¼Œä½†æ˜¯å¯¹äºreactçš„å®ç°åŸç†å´ä¸ä¸€å®šçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚  äºæ˜¯æˆ‘ä»¬æ‰“å¼€reactåŒ…ï¼ˆ17.0.2ï¼‰ï¼Œå‘ç°ï¼Œå’¦ï¼Œä¸ºä»€ä¹ˆåªæœ‰3000å¤šè¡Œä»£ç â“  å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±ä¼šæ„è¯†åˆ°ï¼ŒåŸæ¥æ˜¯åˆ†åŒ…äº†ï¼ˆ2015-10ï¼‰ï¼Œè¿˜æœ‰react-domï¼ˆ17.0.2ï¼‰ï¼Œä¸€æ‰“å¼€ï¼Œ26000å¤šè¡Œï¼Œå“¦å“¦ï¼Œå¯¹çš„ã€‚  å› ä¸ºreactä¸æ­¢é’ˆå¯¹webäº†ï¼Œè¿˜æœ‰ç§»åŠ¨ç«¯ï¼ˆreact-nativeï¼‰ï¼Œæ‰€ä»¥å°±åˆ†åŒ…äº†ã€‚reac">
<meta name="keywords" content="React">
<meta property="og:type" content="article">
<meta property="og:title" content="reactæºç è§£æ">
<meta property="og:url" content="http://yoursite.com/2021/08/23/reactæºç è§£æ/index.html">
<meta property="og:site_name" content="å°å¯’">
<meta property="og:description" content="ä¸€ã€å‰è¨€æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨reactï¼Œä½†æ˜¯å¯¹äºreactçš„å®ç°åŸç†å´ä¸ä¸€å®šçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚  äºæ˜¯æˆ‘ä»¬æ‰“å¼€reactåŒ…ï¼ˆ17.0.2ï¼‰ï¼Œå‘ç°ï¼Œå’¦ï¼Œä¸ºä»€ä¹ˆåªæœ‰3000å¤šè¡Œä»£ç â“  å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±ä¼šæ„è¯†åˆ°ï¼ŒåŸæ¥æ˜¯åˆ†åŒ…äº†ï¼ˆ2015-10ï¼‰ï¼Œè¿˜æœ‰react-domï¼ˆ17.0.2ï¼‰ï¼Œä¸€æ‰“å¼€ï¼Œ26000å¤šè¡Œï¼Œå“¦å“¦ï¼Œå¯¹çš„ã€‚  å› ä¸ºreactä¸æ­¢é’ˆå¯¹webäº†ï¼Œè¿˜æœ‰ç§»åŠ¨ç«¯ï¼ˆreact-nativeï¼‰ï¼Œæ‰€ä»¥å°±åˆ†åŒ…äº†ã€‚reac">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/f81d27cf172e1ea3718b9d54cdf8e307.png">
<meta property="og:updated_time" content="2021-12-09T11:54:43.928Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="reactæºç è§£æ">
<meta name="twitter:description" content="ä¸€ã€å‰è¨€æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨reactï¼Œä½†æ˜¯å¯¹äºreactçš„å®ç°åŸç†å´ä¸ä¸€å®šçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚  äºæ˜¯æˆ‘ä»¬æ‰“å¼€reactåŒ…ï¼ˆ17.0.2ï¼‰ï¼Œå‘ç°ï¼Œå’¦ï¼Œä¸ºä»€ä¹ˆåªæœ‰3000å¤šè¡Œä»£ç â“  å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±ä¼šæ„è¯†åˆ°ï¼ŒåŸæ¥æ˜¯åˆ†åŒ…äº†ï¼ˆ2015-10ï¼‰ï¼Œè¿˜æœ‰react-domï¼ˆ17.0.2ï¼‰ï¼Œä¸€æ‰“å¼€ï¼Œ26000å¤šè¡Œï¼Œå“¦å“¦ï¼Œå¯¹çš„ã€‚  å› ä¸ºreactä¸æ­¢é’ˆå¯¹webäº†ï¼Œè¿˜æœ‰ç§»åŠ¨ç«¯ï¼ˆreact-nativeï¼‰ï¼Œæ‰€ä»¥å°±åˆ†åŒ…äº†ã€‚reac">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/img_convert/f81d27cf172e1ea3718b9d54cdf8e307.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/08/23/reactæºç è§£æ/">





  <title>reactæºç è§£æ | å°å¯’</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å°å¯’</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-çª">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            çª
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ç±»">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-æ¡£">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-äº">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/23/reactæºç è§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">reactæºç è§£æ</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-08-23T15:00:59+08:00">
                2021-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ¡†æ¶/" itemprop="url" rel="index">
                    <span itemprop="name">æ¡†æ¶</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h1><pre><code>æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨reactï¼Œä½†æ˜¯å¯¹äºreactçš„å®ç°åŸç†å´ä¸ä¸€å®šçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚

äºæ˜¯æˆ‘ä»¬æ‰“å¼€reactåŒ…ï¼ˆ17.0.2ï¼‰ï¼Œå‘ç°ï¼Œå’¦ï¼Œä¸ºä»€ä¹ˆåªæœ‰3000å¤šè¡Œä»£ç â“

å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±ä¼šæ„è¯†åˆ°ï¼ŒåŸæ¥æ˜¯åˆ†åŒ…äº†ï¼ˆ2015-10ï¼‰ï¼Œè¿˜æœ‰react-domï¼ˆ17.0.2ï¼‰ï¼Œä¸€æ‰“å¼€ï¼Œ26000å¤šè¡Œï¼Œå“¦å“¦ï¼Œå¯¹çš„ã€‚

å› ä¸ºreactä¸æ­¢é’ˆå¯¹webäº†ï¼Œè¿˜æœ‰ç§»åŠ¨ç«¯ï¼ˆreact-nativeï¼‰ï¼Œæ‰€ä»¥å°±åˆ†åŒ…äº†ã€‚reactå®ç°ä¸»å¹²é€»è¾‘ï¼Œreact-domé’ˆå¯¹ dom çš„å¹³å°å®ç°ï¼Œä¸»è¦ç”¨äºåœ¨ web ç«¯è¿›è¡Œæ¸²æŸ“ã€‚

3000+26000å¤šè¡Œä»£ç ï¼Œä»¤äººå¤´å¤§ï¼Œä¸ç®¡äº†ï¼ŒğŸ”¥ çƒ­æƒ…æ¥äº†ï¼Œè¯´å¹²å°±å¹²ã€‚å°±ä»æœ€çœ¼ç†Ÿçš„å¼€å§‹ï¼ˆReactDOM.renderï¼‰ä¸‹æ‰‹ï¼Œæ€ç†Ÿ ğŸ˜ã€‚å°±é—®ä½ è¿™ ğŸ‰ ä¿ç†Ÿå—ï¼Ÿã€‚
</code></pre><h2 id="ç›´æ¥çœ‹æºç "><a href="#ç›´æ¥çœ‹æºç " class="headerlink" title="ç›´æ¥çœ‹æºç "></a>ç›´æ¥çœ‹æºç </h2><h3 id="ReactDOM-render"><a href="#ReactDOM-render" class="headerlink" title="ReactDOM.render"></a>ReactDOM.render</h3><pre><code>å°½é‡ä¹±ä¸­æœ‰åºã€‚
æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çœ‹ï¼Œé¦–å…ˆï¼Œæ•´ä½“æ¥çœ‹ReactDOMï¼Œæœ€å¤–å±‚æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°iifeï¼Œå†™æºç æˆ–è€…å†™jqueryçš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨iifeçš„æ¨¡å—åŒ–æ–¹å¼ã€‚ï¼ˆå½“æ—¶çš„æƒ³æ³•ï¼‰
</code></pre><p>  <code>(function (a, b) {â€¦â€¦}(c, d))</code></p>
<pre><code>å€Ÿç€ç»†çœ‹ï¼Œè¿™ä¸ªç«‹å³å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå‡½æ•°ã€‚ç«‹å³å‡½æ•°çš„å†…å®¹æ˜¯åˆ¤æ–­å¤šç§æ¡ä»¶ä¸‹ï¼Œç»™å‚æ•°å‡½æ•°ä¼ å‚åæ‰§è¡Œã€‚
</code></pre>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> ? factory(exports, <span class="built_in">require</span>(<span class="string">'react'</span>)) :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define([<span class="string">'exports'</span>, <span class="string">'react'</span>], factory) :</span><br><span class="line">  (global = global || self, factory(global.ReactDOM = &#123;&#125;, global.React));</span><br><span class="line">&#125;(<span class="keyword">this</span>, (<span class="function"><span class="keyword">function</span> (<span class="params">exports, React</span>) </span>&#123; </span><br><span class="line">  ...</span><br><span class="line">  exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED = Internals;</span><br><span class="line">  exports.createPortal = createPortal$<span class="number">1</span>;</span><br><span class="line">  exports.findDOMNode = findDOMNode;</span><br><span class="line">  exports.flushSync = flushSync;</span><br><span class="line">  exports.hydrate = hydrate;</span><br><span class="line">  exports.render = render;</span><br><span class="line">  exports.unmountComponentAtNode = unmountComponentAtNode;</span><br><span class="line">  exports.unstable_batchedUpdates = batchedUpdates$<span class="number">1</span>;</span><br><span class="line">  exports.unstable_createPortal = unstable_createPortal;</span><br><span class="line">  exports.unstable_renderSubtreeIntoContainer = renderSubtreeIntoContainer;</span><br><span class="line">  exports.version = ReactVersion;</span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure>
<pre><code>çœ‹åˆ°è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¥½åƒçŸ¥é“ç‚¹å•¥ï¼Œä½†æ˜¯åˆè¯´ä¸æ¸…ã€‚ä¸ç®¡å¯ï¼Œå…ˆå…³å¿ƒä¸»è¦é—®é¢˜ï¼Œçœ‹çœ‹ ReactDOM.render åˆ°åº•åšäº†ä»€ä¹ˆã€‚äºæ˜¯æ¢³ç†äº†ä¸¤éï¼Œå†™äº†3é¡µç¬”è®°ã€‚ã€‚ã€‚

åªæ˜¯å¤§æŠµçœ‹äº†è°ƒç”¨å…³ç³»ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ææ¸…æ¥šæ¯ä¸€è¡Œä»£ç ï¼Œå› ä¸ºçœŸçš„æ˜¯å¤ªå¤šäº†ï¼ˆçœ‹æˆ‘çš„3é¡µç¬”è®°ï¼‰ï¼ŒçœŸè¦é å…‰çœ‹æºç å»çœ‹æ‡‚æ¡†æ¶ï¼ŒçœŸçš„æ˜¯éœ€è¦æŠ•å…¥å¤§é‡çš„æ—¶é—´ã€‚ç”šè‡³ä»…é€šè¿‡æŸ¥çœ‹ä»£ç çš„æ–¹æ³•å¾ˆéš¾çœŸæ­£ç†è§£reactã€‚

ä¸è¿‡ä¹Ÿä¸è¦å¤ªç°å¿ƒï¼Œçœ‹äº†ä¸€éï¼Œå¤šå¤šå°‘å°‘è¿˜æ˜¯æœ‰ç‚¹æ”¶è·çš„ï¼Œå…ˆè®°å½•ä¸€ä¸‹è¿™ç‚¹å¯æ€œçš„æ”¶è·ï¼š
</code></pre><h4 id="1ã€ReactDOM-render"><a href="#1ã€ReactDOM-render" class="headerlink" title="1ã€ReactDOM.render"></a>1ã€ReactDOM.render</h4><pre><code>æ•´ä½“æ¥çœ‹ï¼Œå…ˆè¿”å›äº†ä¸€ä¸ªFiberRootNodeï¼ŒFiberRootNodeä¸Šç»‘å®šäº†æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶ï¼Œä¹‹åæ‰§è¡Œäº†updateContainerã€‚

updateContaineré‡Œï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ°createUpdateåˆ›å»ºæ›´æ–°ï¼ŒenqueueUpdateæ’åºæ ‡è®°æ›´æ–°ä¼˜å…ˆçº§ï¼ŒscheduleUpdateOnFiberè°ƒåº¦æ›´æ–°åˆ°Fiberä¸Šï¼Œä»¥åŠcommité˜¶æ®µæäº¤ä¼˜å…ˆçº§ï¼Œè¿™é‡Œè¿˜èƒ½çœ‹åˆ°ä¸€äº›æ—¶é—´ï¼ˆexpirationTimeï¼‰çš„è®¡ç®—ã€‚

å…·ä½“æ¥çœ‹ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM = &#123;</span><br><span class="line">  render(</span><br><span class="line">    element: React$Element&lt;any&gt;,</span><br><span class="line">    container: DOMContainer,</span><br><span class="line">    callback: ?Function,</span><br><span class="line">  ) &#123;</span><br><span class="line">    return legacyRenderSubtreeIntoContainer(</span><br><span class="line">      null,</span><br><span class="line">      element,</span><br><span class="line">      container,</span><br><span class="line">      false,</span><br><span class="line">      callback,</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># é¦–å…ˆä¼šåˆ›å»ºReactRootå¯¹è±¡ï¼Œç„¶åè°ƒç”¨ä»–çš„renderæ–¹æ³•</span><br><span class="line"># åˆ›å»ºReactRootçš„æ—¶å€™ä¼šè°ƒç”¨DOMRenderer.createContaineråˆ›å»ºFiberRootï¼Œåœ¨åæœŸè°ƒåº¦æ›´æ–°çš„è¿‡ç¨‹ä¸­è¿™ä¸ªèŠ‚ç‚¹éå¸¸é‡è¦</span><br><span class="line"></span><br><span class="line">function legacyRenderSubtreeIntoContainer(</span><br><span class="line">  parentComponent: ?React$Component&lt;any, any&gt;,</span><br><span class="line">  children: ReactNodeList,</span><br><span class="line">  container: DOMContainer,</span><br><span class="line">  forceHydrate: boolean,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">) &#123;</span><br><span class="line">  var root = container._reactRootContainer;</span><br><span class="line">  var fiberRoot;</span><br><span class="line"></span><br><span class="line">  if (!root) &#123;</span><br><span class="line">    // Initial mount</span><br><span class="line">    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);</span><br><span class="line">    fiberRoot = root._internalRoot;</span><br><span class="line"></span><br><span class="line">    if (typeof callback === &apos;function&apos;) &#123;</span><br><span class="line">      var originalCallback = callback;</span><br><span class="line"></span><br><span class="line">      callback = function () &#123;</span><br><span class="line">        var instance = getPublicRootInstance(fiberRoot);</span><br><span class="line">        originalCallback.call(instance);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; // Initial mount should not be batched.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    unbatchedUpdates(function () &#123;</span><br><span class="line">      updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    fiberRoot = root._internalRoot;</span><br><span class="line"></span><br><span class="line">    if (typeof callback === &apos;function&apos;) &#123;</span><br><span class="line">      var _originalCallback = callback;</span><br><span class="line"></span><br><span class="line">      callback = function () &#123;</span><br><span class="line">        var instance = getPublicRootInstance(fiberRoot);</span><br><span class="line"></span><br><span class="line">        _originalCallback.call(instance);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; // Update</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return getPublicRootInstance(fiberRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function legacyCreateRootFromDOMContainer(</span><br><span class="line">  container: DOMContainer,</span><br><span class="line">  forceHydrate: boolean,</span><br><span class="line">): Root &#123;</span><br><span class="line">  var shouldHydrate = forceHydrate || shouldHydrateDueToLegacyHeuristic(container); // First clear any existing content.</span><br><span class="line"></span><br><span class="line">  if (!shouldHydrate) &#123;</span><br><span class="line">    var warned = false;</span><br><span class="line">    var rootSibling;</span><br><span class="line"></span><br><span class="line">    while (rootSibling = container.lastChild) &#123;</span><br><span class="line">      &#123;</span><br><span class="line">        if (!warned &amp;&amp; rootSibling.nodeType === ELEMENT_NODE &amp;&amp; rootSibling.hasAttribute(ROOT_ATTRIBUTE_NAME)) &#123;</span><br><span class="line">          warned = true;</span><br><span class="line"></span><br><span class="line">          error(&apos;render(): Target node has markup rendered by React, but there &apos; + &apos;are unrelated nodes as well. This is most commonly caused by &apos; + &apos;white-space inserted around server-rendered markup.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      container.removeChild(rootSibling);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    if (shouldHydrate &amp;&amp; !forceHydrate &amp;&amp; !warnedAboutHydrateAPI) &#123;</span><br><span class="line">      warnedAboutHydrateAPI = true;</span><br><span class="line"></span><br><span class="line">      warn(&apos;render(): Calling ReactDOM.render() to hydrate server-rendered markup &apos; + &apos;will stop working in React v18. Replace the ReactDOM.render() call &apos; + &apos;with ReactDOM.hydrate() if you want React to attach to the server HTML.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return new ReactDOMBlockingRoot(container, LegacyRoot, options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ReactDOMBlockingRoot(container, tag, options) &#123;</span><br><span class="line">  this._internalRoot = createRootImpl(container, tag, options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOMRoot.prototype.render = ReactDOMBlockingRoot.prototype.render = function (children) &#123;</span><br><span class="line">  var root = this._internalRoot;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    if (typeof arguments[1] === &apos;function&apos;) &#123;</span><br><span class="line">      error(&apos;render(...): does not support the second callback argument. &apos; + &apos;To execute a side effect after rendering, declare it in a component body with useEffect().&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var container = root.containerInfo;</span><br><span class="line"></span><br><span class="line">    if (container.nodeType !== COMMENT_NODE) &#123;</span><br><span class="line">      var hostInstance = findHostInstanceWithNoPortals(root.current);</span><br><span class="line"></span><br><span class="line">      if (hostInstance) &#123;</span><br><span class="line">        if (hostInstance.parentNode !== container) &#123;</span><br><span class="line">          error(&apos;render(...): It looks like the React-rendered content of the &apos; + &apos;root container was removed without using React. This is not &apos; + &apos;supported and will cause errors. Instead, call &apos; + &quot;root.unmount() to empty a root&apos;s container.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  updateContainer(children, root, null, null);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOMRoot.prototype.unmount = ReactDOMBlockingRoot.prototype.unmount = function () &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    if (typeof arguments[0] === &apos;function&apos;) &#123;</span><br><span class="line">      error(&apos;unmount(...): does not support a callback argument. &apos; + &apos;To execute a side effect after rendering, declare it in a component body with useEffect().&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var root = this._internalRoot;</span><br><span class="line">  var container = root.containerInfo;</span><br><span class="line">  updateContainer(null, root, null, function () &#123;</span><br><span class="line">    unmarkContainerAsRoot(container);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function createRootImpl(container, tag, options) &#123;</span><br><span class="line">  // Tag is either LegacyRoot or Concurrent Root</span><br><span class="line">  var hydrate = options != null &amp;&amp; options.hydrate === true;</span><br><span class="line">  var hydrationCallbacks = options != null &amp;&amp; options.hydrationOptions || null;</span><br><span class="line">  var mutableSources = options != null &amp;&amp; options.hydrationOptions != null &amp;&amp; options.hydrationOptions.mutableSources || null;</span><br><span class="line">  var root = createContainer(container, tag, hydrate);</span><br><span class="line">  markContainerAsRoot(root.current, container);</span><br><span class="line">  var containerNodeType = container.nodeType;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    var rootContainerElement = container.nodeType === COMMENT_NODE ? container.parentNode : container;</span><br><span class="line">    listenToAllSupportedEvents(rootContainerElement);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (mutableSources) &#123;</span><br><span class="line">    for (var i = 0; i &lt; mutableSources.length; i++) &#123;</span><br><span class="line">      var mutableSource = mutableSources[i];</span><br><span class="line">      registerMutableSourceForHydration(root, mutableSource);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createContainer(containerInfo, tag, hydrate, hydrationCallbacks) &#123;</span><br><span class="line">  return createFiberRoot(containerInfo, tag, hydrate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createFiberRoot(containerInfo, tag, hydrate, hydrationCallbacks) &#123;</span><br><span class="line">  var root = new FiberRootNode(containerInfo, tag, hydrate);</span><br><span class="line">  // stateNode is any.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  var uninitializedFiber = createHostRootFiber(tag);</span><br><span class="line">  root.current = uninitializedFiber;</span><br><span class="line">  uninitializedFiber.stateNode = root;</span><br><span class="line">  initializeUpdateQueue(uninitializedFiber);</span><br><span class="line">  return root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function FiberRootNode(containerInfo, tag, hydrate) &#123;</span><br><span class="line">  this.tag = tag;</span><br><span class="line">  this.containerInfo = containerInfo;</span><br><span class="line">  this.pendingChildren = null;</span><br><span class="line">  this.current = null;</span><br><span class="line">  this.pingCache = null;</span><br><span class="line">  this.finishedWork = null;</span><br><span class="line">  this.timeoutHandle = noTimeout;</span><br><span class="line">  this.context = null;</span><br><span class="line">  this.pendingContext = null;</span><br><span class="line">  this.hydrate = hydrate;</span><br><span class="line">  this.callbackNode = null;</span><br><span class="line">  this.callbackPriority = NoLanePriority;</span><br><span class="line">  this.eventTimes = createLaneMap(NoLanes);</span><br><span class="line">  this.expirationTimes = createLaneMap(NoTimestamp);</span><br><span class="line">  this.pendingLanes = NoLanes;</span><br><span class="line">  this.suspendedLanes = NoLanes;</span><br><span class="line">  this.pingedLanes = NoLanes;</span><br><span class="line">  this.expiredLanes = NoLanes;</span><br><span class="line">  this.mutableReadLanes = NoLanes;</span><br><span class="line">  this.finishedLanes = NoLanes;</span><br><span class="line">  this.entangledLanes = NoLanes;</span><br><span class="line">  this.entanglements = createLaneMap(NoLanes);</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    this.mutableSourceEagerHydrationData = null;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    this.interactionThreadID = unstable_getThreadID();</span><br><span class="line">    this.memoizedInteractions = new Set();</span><br><span class="line">    this.pendingInteractionMap = new Map();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    switch (tag) &#123;</span><br><span class="line">      case BlockingRoot:</span><br><span class="line">        this._debugRootType = &apos;createBlockingRoot()&apos;;</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">      case ConcurrentRoot:</span><br><span class="line">        this._debugRootType = &apos;createRoot()&apos;;</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">      case LegacyRoot:</span><br><span class="line">        this._debugRootType = &apos;createLegacyRoot()&apos;;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function listenToAllSupportedEvents(rootContainerElement) &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    if (rootContainerElement[listeningMarker]) &#123;</span><br><span class="line">      // Performance optimization: don&apos;t iterate through events</span><br><span class="line">      // for the same portal container or root node more than once.</span><br><span class="line">      // TODO: once we remove the flag, we may be able to also</span><br><span class="line">      // remove some of the bookkeeping maps used for laziness.</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rootContainerElement[listeningMarker] = true;</span><br><span class="line">    allNativeEvents.forEach(function (domEventName) &#123;</span><br><span class="line">      if (!nonDelegatedEvents.has(domEventName)) &#123;</span><br><span class="line">        listenToNativeEvent(domEventName, false, rootContainerElement, null);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      listenToNativeEvent(domEventName, true, rootContainerElement, null);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å…¶ä¸­DOMRendereræ˜¯react-reconciler/src/ReactFiberReconcilerï¼Œä»–çš„updateContainerå¦‚ä¸‹åœ¨è¿™é‡Œè®¡ç®—äº†ä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å«åšexpirationTimeï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¿™æ¬¡æ›´æ–°çš„ è¶…æ—¶æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line"># ç„¶åè°ƒç”¨äº†updateContainerAtExpirationTimeï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨äº†scheduleRootUpdateå°±éå¸¸é‡è¦äº†</span><br><span class="line"></span><br><span class="line">export function updateContainer(</span><br><span class="line">  element: ReactNodeList,</span><br><span class="line">  container: OpaqueRoot,</span><br><span class="line">  parentComponent: ?React$Component&lt;any, any&gt;,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">): ExpirationTime &#123;</span><br><span class="line">  const current = container.current</span><br><span class="line">  const currentTime = requestCurrentTime()</span><br><span class="line">  const expirationTime = computeExpirationForFiber(currentTime, current)</span><br><span class="line">  return updateContainerAtExpirationTime(</span><br><span class="line">    element,</span><br><span class="line">    container,</span><br><span class="line">    parentComponent,</span><br><span class="line">    expirationTime,</span><br><span class="line">    callback,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function updateContainerAtExpirationTime(</span><br><span class="line">  element: ReactNodeList,</span><br><span class="line">  container: OpaqueRoot,</span><br><span class="line">  parentComponent: ?React$Component&lt;any, any&gt;,</span><br><span class="line">  expirationTime: ExpirationTime,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">) &#123;</span><br><span class="line">  // TODO: If this is a nested container, this won&apos;t be the root.</span><br><span class="line">  const current = container.current</span><br><span class="line">  const context = getContextForSubtree(parentComponent)</span><br><span class="line">  if (container.context === null) &#123;</span><br><span class="line">    container.context = context</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    container.pendingContext = context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return scheduleRootUpdate(current, element, expirationTime, callback)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å¼€å§‹è°ƒåº¦</span><br><span class="line"># é¦–å…ˆè¦ç”Ÿæˆä¸€ä¸ªupdateï¼Œä¸ç®¡ä½ æ˜¯setStateè¿˜æ˜¯ReactDOM.renderé€ æˆçš„ React æ›´æ–°ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå«updateçš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šèµ‹å€¼ç»™Fiber.updateQueue</span><br><span class="line"># ç„¶åå°±æ˜¯è°ƒç”¨scheduleWorkã€‚æ³¨æ„åˆ°è¿™é‡Œä¹‹å‰setStateå’ŒReactDOM.renderæ˜¯ä¸ä¸€æ ·ï¼Œä½†è¿›å…¥schedulerWorkä¹‹åï¼Œå°±æ˜¯ä»»åŠ¡è°ƒåº¦çš„äº‹æƒ…äº†ï¼Œè·Ÿä¹‹å‰ä½ æ˜¯æ€ä¹ˆè°ƒç”¨çš„æ²¡æœ‰ä»»ä½•å…³ç³»</span><br><span class="line"></span><br><span class="line">function scheduleRootUpdate(</span><br><span class="line">  current: Fiber,</span><br><span class="line">  element: ReactNodeList,</span><br><span class="line">  expirationTime: ExpirationTime,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">) &#123;</span><br><span class="line">  const update = createUpdate(expirationTime)</span><br><span class="line"></span><br><span class="line">  update.payload = &#123; element &#125;</span><br><span class="line"></span><br><span class="line">  callback = callback === undefined ? null : callback</span><br><span class="line">  if (callback !== null) &#123;</span><br><span class="line">    warningWithoutStack(</span><br><span class="line">      typeof callback === &apos;function&apos;,</span><br><span class="line">      &apos;render(...): Expected the last optional `callback` argument to be a &apos; +</span><br><span class="line">        &apos;function. Instead received: %s.&apos;,</span><br><span class="line">      callback,</span><br><span class="line">    )</span><br><span class="line">    update.callback = callback</span><br><span class="line">  &#125;</span><br><span class="line">  enqueueUpdate(current, update)</span><br><span class="line"></span><br><span class="line">  scheduleWork(current, expirationTime)</span><br><span class="line">  return expirationTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="2ã€cjsã€amdã€umdå’Œesm"><a href="#2ã€cjsã€amdã€umdå’Œesm" class="headerlink" title="2ã€cjsã€amdã€umdå’Œesm"></a>2ã€cjsã€amdã€umdå’Œesm</h4><pre><code>JavaScriptæœ€åˆä»…ç”¨äºäº¤äº’å¼æµè§ˆå™¨ã€‚ä¸Nodeä¸€èµ·ï¼Œå¯åœ¨éæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚ç”±äºè¿™ä¸ªå› ç´ å’Œå…¶ä»–å› ç´ ï¼Œæ¨¡å—çš„æ ¼å¼ä¸å…¼å®¹ã€‚CJSã€AMDã€UMD å’Œ ESMéƒ½æ˜¯ç»™ Javascript æ·»åŠ æ¨¡å—åŒ–çš„æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œä½†è¿™äº›æ˜¯æ¯”è¾ƒé€šç”¨çš„ã€‚
</code></pre><p>  <strong>CJS</strong> ï¼ŒCommonJSï¼Œæ˜¯åŒæ­¥å¯¼å…¥æ¨¡å—ï¼Œæè¿°äº† exports å¯¹è±¡çš„ä½¿ç”¨ã€‚ NodeJSæ˜¯CommonJSæ ¼å¼çš„æœ€æµè¡Œå®ç°ã€‚ä¸å…è®¸åœ¨äº¤äº’å¼æµè§ˆå™¨ä¸­åŠ è½½CommonJSæ¨¡å—ï¼Œå®ƒå¿…é¡»ç»è¿‡è½¬æ¢å’Œæ‰“åŒ…ã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ï¼šéƒ½å¯ä»¥èµ·ä½œç”¨,å½“ CJS å¯¼å…¥æ—¶ï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå¯¼å…¥å¯¹è±¡çš„å‰¯æœ¬ã€‚</span></span><br><span class="line"><span class="keyword">const</span> doSomething = <span class="built_in">require</span>(<span class="string">'./doSomething.js'</span>); æˆ– <span class="keyword">const</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºï¼š</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;...&#125;;</span><br></pre></td></tr></table></figure></p>
<pre><code>æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚
CommonJSè§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„ï¼Œç”±äºNode.jsä¸»è¦ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ï¼Œæ¨¡å—æ–‡ä»¶ä¸€èˆ¬éƒ½å·²ç»å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ï¼Œæ‰€ä»¥åŠ è½½èµ·æ¥æ¯”è¾ƒå¿«ï¼Œä¸ç”¨è€ƒè™‘éåŒæ­¥åŠ è½½çš„æ–¹å¼ï¼Œæ‰€ä»¥CommonJSè§„èŒƒæ¯”è¾ƒé€‚ç”¨
</code></pre><blockquote>
<p>ä¸»è¦ç‰¹ç‚¹ï¼š<br>æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ<br>æ¨¡å—å¯ä»¥å¤šæ¬¡åŠ è½½ï¼Œä½†æ˜¯åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™æ‰§è¡Œï¼Œç„¶åä¼šç¼“å­˜ä¸€ä»½ï¼Œåé¢å†å¼•ç”¨è¿”å›çš„éƒ½æ˜¯ç¼“å­˜<br>æ¨¡å—åŠ è½½çš„é¡ºåºæ˜¯æŒ‰ç…§å‡ºç°çš„ä½ç½®æ¥å®š<br>å› ä¸ºè¢«è¾“å‡ºçš„æ˜¯æ‹·è´å€¼ï¼Œåˆ™å¦‚æœåœ¨å¤–éƒ¨å¯¹æ¨¡å—ä»£ç å°±è¡Œä¿®æ”¹åˆ™ä¸ä¼šç”Ÿæ•ˆ<br>ä¸€èˆ¬ç”¨äºæœåŠ¡ç«¯çš„è§„èŒƒ</p>
</blockquote>
<p>  <strong>AMD</strong>ï¼ŒAsynchronously  Module Definitionï¼Œå¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œæè¿°äº†å¦‚ä½•åœ¨å‡å®šå°†JavaScriptæ¨¡å—åŠ è½½åˆ°äº¤äº’å¼æµè§ˆå™¨ä¸­çš„æƒ…å†µä¸‹æ†ç»‘JavaScriptæ¨¡å—ã€‚</p>
<p>  è·ŸCJSå¹¶ç§°é‡å¤§é€šç”¨æ¨¡å—è§„èŒƒï¼Œä¸»è¦ç”¨äºå®¢æˆ·ç«¯ï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ¨åŠ è½½çš„æ—¶å€™ä¸»è¦çœ‹ä¸­åŠ è½½é€Ÿåº¦ï¼Œå¦‚æœåƒæ˜¯CJSé‚£æ ·åŒæ­¥æ‰§è¡Œçš„è¯ï¼Œåœ¨åŠ è½½ä¸€ä¸ªå¾ˆå¤§çš„ç»„ä»¶çš„æƒ…å†µä¸‹ä¼šç›¸å½“çš„è€½è¯¯æ—¶é—´ï¼Œæ‰€ä»¥å‚¬ç”Ÿäº†AMDå®¢æˆ·ç«¯çš„å¼‚æ­¥è§„èŒƒã€‚<br>  ç¬¬ä¸€ä¸ªå‚æ•°[module]ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„æˆå‘˜å°±æ˜¯è¦åŠ è½½çš„æ¨¡å—ï¼›ç¬¬äºŒä¸ªå‚æ•°callbackï¼Œåˆ™æ˜¯åŠ è½½æˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°ã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'lodash'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">lh</span>) </span>&#123;</span><br><span class="line">  lo.isArray([]);</span><br><span class="line">  <span class="comment">// Define the module value by returning a value.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>  <strong>UMD</strong>ï¼ŒUniversal Module Definitionï¼Œé€šç”¨æ¨¡å—å®šä¹‰ï¼Œæ˜¯ä¸€ç§å°è¯•åˆ¶ä½œå¯è¢«ä½¿ç”¨çš„æ¨¡å—çš„æ¨¡å¼ã€‚ä¸ºäº†åŒæ—¶æ”¯æŒCJSå’ŒAMDçš„è§„èŒƒï¼Œåˆ¤æ–­è°çš„è§„èŒƒæ”¯æŒå°±ä½¿ç”¨è°çš„è§„èŒƒï¼Œä»–çš„æœ€å¤–å±‚æ˜¯ä¸€ä¸ªiifeã€‚<br>    åœ¨å‰ç«¯å’Œåç«¯éƒ½é€‚ç”¨ï¼ˆâ€œé€šç”¨â€å› æ­¤å¾—åï¼‰<br>    ä¸ CJS æˆ– AMD ä¸åŒï¼ŒUMD æ›´åƒæ˜¯ä¸€ç§é…ç½®å¤šä¸ªæ¨¡å—ç³»ç»Ÿçš„æ¨¡å¼ã€‚è¿™é‡Œå¯ä»¥æ‰¾åˆ°æ›´å¤šçš„æ¨¡å¼<br>    å½“ä½¿ç”¨ Rollup/Webpack ä¹‹ç±»çš„æ‰“åŒ…å™¨æ—¶ï¼ŒUMD é€šå¸¸ç”¨ä½œå¤‡ç”¨æ¨¡å—<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define([<span class="string">"jquery"</span>, <span class="string">"underscore"</span>], factory);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">"object"</span>) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">"jquery"</span>), <span class="built_in">require</span>(<span class="string">"underscore"</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    root.Requester = factory(root.$, root._);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this is where I defined my module implementation</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Requester = &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Requester;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<pre><code>æç„¶ï¼Œå› ä¸ºæˆ‘æ‰“å¼€çš„æ˜¯umd/react-dom.development.jsï¼Œæ‰€ä»¥ä¸Šé¢é‚£ä¹ˆå†™ï¼Œå…¶å®å«umdè§„èŒƒå†™æ³•ã€‚å“ˆå“ˆå“ˆã€‚
</code></pre><p>  <strong>ESM</strong>ï¼ŒECMAScript Moduleï¼Œ2015å®šä¹‰äº† export å’Œ import è¯­æ³•ï¼ˆä¸åŒäºä¸Šè¿°æ‰€æœ‰å†…å®¹ï¼‰ä»¥æ”¯æŒæ¨¡å—ã€‚<br>    å®ƒå…¼å…·ä¸¤æ–¹é¢çš„ä¼˜ç‚¹ï¼šå…·æœ‰ CJS çš„ç®€å•è¯­æ³•å’Œ AMD çš„å¼‚æ­¥<br>    å¾—ç›Šäº ES6 çš„é™æ€æ¨¡å—ç»“æ„ï¼Œå¯ä»¥è¿›è¡Œ Tree Shaking<br>    ESM å…è®¸åƒ Rollup è¿™æ ·çš„æ‰“åŒ…å™¨ï¼Œåˆ é™¤ä¸å¿…è¦çš„ä»£ç ï¼Œå‡å°‘ä»£ç åŒ…å¯ä»¥è·å¾—æ›´å¿«çš„åŠ è½½<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;foo, bar&#125; <span class="keyword">from</span> <span class="string">'./myLib'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// your Function</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> function1() &#123;...&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> function2() &#123;...&#125;;</span><br></pre></td></tr></table></figure></p>
<p>  ESMç”±äºå…·æœ‰ç®€å•çš„è¯­æ³•ï¼Œå¼‚æ­¥åŠ è½½çš„ç‰¹æ€§ï¼Œä»¥åŠTree-shakeableçš„ç‰¹æ€§ï¼Œå› æ­¤è¢«å¹¿æ³›ä½¿ç”¨ã€‚<br>  UMDå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ESMä¸èƒ½ä½¿ç”¨çš„æƒ…å†µä¸‹é€‰æ‹©UMDã€‚<br>  CJSæ˜¯åŒæ­¥çš„ï¼Œé€‚ç”¨äºåç«¯ç¯å¢ƒã€‚<br>  AMDæ˜¯å¼‚æ­¥çš„ï¼Œé€‚ç”¨äºå‰ç«¯ç¯å¢ƒã€‚</p>
<p>  åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†çœ‹ç›´æ¥çœ‹æºç çš„ç¬¬ä¸€æ­¥ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å†™ï¼Œè¿™å°±æ˜¯umdè§„èŒƒå–ã€‚å› ä¸ºæˆ‘æ‰“å¼€çš„æ˜¯umd/react-dom.development.jsï¼Œè™½ç„¶ä¹‹å‰ä¹Ÿä¸æ˜¯ååˆ†äº†è§£umdåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å°±æ˜¯è§‰å¾—åº”è¯¥çœ‹umdçš„ã€‚å“ˆå“ˆå“ˆã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> ? factory(exports, <span class="built_in">require</span>(<span class="string">'react'</span>)) :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define([<span class="string">'exports'</span>, <span class="string">'react'</span>], factory) :</span><br><span class="line">  (global = global || self, factory(global.ReactDOM = &#123;&#125;, global.React));</span><br><span class="line">&#125;(<span class="keyword">this</span>, (<span class="function"><span class="keyword">function</span> (<span class="params">exports, React</span>) </span>&#123; </span><br><span class="line">  ...</span><br><span class="line">  exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED = Internals;</span><br><span class="line">  exports.createPortal = createPortal$<span class="number">1</span>;</span><br><span class="line">  exports.findDOMNode = findDOMNode;</span><br><span class="line">  exports.flushSync = flushSync;</span><br><span class="line">  exports.hydrate = hydrate;</span><br><span class="line">  exports.render = render;</span><br><span class="line">  exports.unmountComponentAtNode = unmountComponentAtNode;</span><br><span class="line">  exports.unstable_batchedUpdates = batchedUpdates$<span class="number">1</span>;</span><br><span class="line">  exports.unstable_createPortal = unstable_createPortal;</span><br><span class="line">  exports.unstable_renderSubtreeIntoContainer = renderSubtreeIntoContainer;</span><br><span class="line">  exports.version = ReactVersion;</span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure></p>
<p>  å…¶å®å¯¹äºè¿™ä¸ªæ¨¡å—åŒ–è¯é¢˜ï¼Œè¿˜å¯ä»¥æ¢ç´¢åœ°æ›´æ·±ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä¸»é¢˜æ˜¯reactæºç ï¼Œå°±å…ˆåˆ°è¿™äº†ã€‚</p>
<h4 id="3ã€å…¶ä»–å°ç‚¹"><a href="#3ã€å…¶ä»–å°ç‚¹" class="headerlink" title="3ã€å…¶ä»–å°ç‚¹"></a>3ã€å…¶ä»–å°ç‚¹</h4><p>  <code>èŠ‚ç‚¹ç±»å‹ nodeType</code></p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹ç±»å‹</th>
<th>æè¿°</th>
<th>å­èŠ‚ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 Element</td>
<td>ä»£è¡¨å…ƒç´ </td>
<td>Element, Text, Comment, ProcessingInstruction, CDATASection, EntityReference</td>
</tr>
<tr>
<td>2 Attr</td>
<td>ä»£è¡¨å±æ€§</td>
<td>Text, EntityReference</td>
</tr>
<tr>
<td>3 Text</td>
<td>ä»£è¡¨å…ƒç´ æˆ–å±æ€§ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚</td>
<td>None</td>
</tr>
<tr>
<td>4 CDATASection</td>
<td>ä»£è¡¨æ–‡æ¡£ä¸­çš„ CDATA éƒ¨åˆ†ï¼ˆä¸ä¼šç”±è§£æå™¨è§£æçš„æ–‡æœ¬ï¼‰ã€‚</td>
<td>None</td>
</tr>
<tr>
<td>5 EntityReference</td>
<td>ä»£è¡¨å®ä½“å¼•ç”¨ã€‚</td>
<td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td>
</tr>
<tr>
<td>6 Entity</td>
<td>ä»£è¡¨å®ä½“ã€‚</td>
<td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td>
</tr>
<tr>
<td>7 ProcessingInstruction</td>
<td>ä»£è¡¨å¤„ç†æŒ‡ä»¤ã€‚</td>
<td>None</td>
</tr>
<tr>
<td>8 Comment</td>
<td>ä»£è¡¨æ³¨é‡Šã€‚</td>
<td>None</td>
</tr>
<tr>
<td>9 Document</td>
<td>ä»£è¡¨æ•´ä¸ªæ–‡æ¡£ï¼ˆDOM æ ‘çš„æ ¹èŠ‚ç‚¹ï¼‰ã€‚</td>
<td>Element, ProcessingInstruction, Comment, DocumentType</td>
</tr>
<tr>
<td>10 DocumentType</td>
<td>å‘ä¸ºæ–‡æ¡£å®šä¹‰çš„å®ä½“æä¾›æ¥å£</td>
<td>None</td>
</tr>
<tr>
<td>11 DocumentFragment</td>
<td>ä»£è¡¨è½»é‡çº§çš„ Document å¯¹è±¡ï¼Œèƒ½å¤Ÿå®¹çº³æ–‡æ¡£çš„æŸä¸ªéƒ¨åˆ†</td>
<td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td>
</tr>
<tr>
<td>12 Notation</td>
<td>ä»£è¡¨ DTD ä¸­å£°æ˜çš„ç¬¦å·ã€‚</td>
<td>None</td>
</tr>
</tbody>
</table>
<p>  <code>{ } å°é—­ä½œç”¨åŸŸ</code><br>  <code>!! çœŸå‡</code><br>  <code>â€˜â€™ + â€˜â€™ æ‹¼æ¥é•¿å­—ç¬¦ä¸²</code><br>  <code>â€˜xxxâ€™ + Math.random.toString(36).slice(2) æ‰“æ ‡è¯†</code></p>
<p>  å¼€å•ƒä¹‹åå°±ä¼šå‘ç°ï¼Œå°ä¸‘ ğŸ¤¡ æœç„¶è¿˜æ˜¯è‡ªå·±ï¼Œç›´æ¥ä¸Šå£çœŸæ˜¯åƒä¸æ¶ˆï¼Œè¿˜æ˜¯è¦æœ‰æ–¹æ³•å»çœ‹è¿™ç§å¤§æ¡†æ¶æºç ã€‚<br>  ä¸æ˜¯ä¸€æœä¸€å¤•çš„äº‹æƒ…ï¼Œè¦æœ‰è¶³å¤Ÿçš„è€å¿ƒå’Œæ—¶é—´æ‰è¡Œã€‚</p>
<h2 id="æ€ä¹ˆå­¦reactæºç "><a href="#æ€ä¹ˆå­¦reactæºç " class="headerlink" title="æ€ä¹ˆå­¦reactæºç "></a>æ€ä¹ˆå­¦reactæºç </h2><pre><code>ç›´æ¥çœ‹æºç ï¼Œå°±åƒæ˜¯ç›²äººæ‘¸è±¡ï¼Œä¸ï¼Œåº”è¯¥æ˜¯ç›²èš‚èš ğŸœ æ‘¸è±¡ ğŸ˜ï¼Œ è¿™ä¸æ˜¯ä¸€æœä¸€å¤•å°±èƒ½å®Œæˆçš„äº‹æƒ…ã€‚
ç—›å®šæ€ç—›ï¼šä¸€å®šè¦å…ˆæ‰¾å‡ºæˆ‘ä»¬çš„å¤§æ–¹å‘ï¼Œå¾ªåºæ¸è¿›ã€‚
è¾¹çœ‹æˆç†Ÿçš„ç»“è®ºï¼Œè¾¹çœ‹æºç å®ç°ï¼Œç›¸è¾…ç›¸æˆï¼Œåå¤éªŒè¯ã€‚
</code></pre>  <!-- - å‰äººçš„è‚©è†€æ¨èï¼š
    [React æºç è§£æ](https://react.jokcy.me/) ï¼Œä»APIçš„è§’åº¦è§£æreactã€‚
    [å…¨æ ˆæ½‡æ™¨-reactæºç è§£æ](https://xiaochen1024.com/courseware/60b1b2f6cf10a4003b634718/60b1b311cf10a4003b634719)ï¼Œä»APIå’ŒæŠ½è±¡è§’åº¦è§£æreactã€‚
    [Reactå®˜æ–¹-å®ç°è¯´æ˜](https://zh-hans.reactjs.org/docs/implementation-notes.html)
  - æºç å¯ä»¥ç›´æ¥ download react æºç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹åŒ…ä¸­çš„umdçš„development.jsã€‚ -->
<p>  çœ‹æˆ‘ä»¬å¸¦ç€ä»€ä¹ˆæ ·çš„ç›®çš„å»çœ‹reactæºç </p>
<p><br><br><br><br><br><br><br></p>
<h1 id="äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ"><a href="#äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ" class="headerlink" title="äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ"></a>äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ</h1><p>  æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ·±å…¥äº†è§£ï¼Œç„¶ååˆ¶å®šå‡ºç›¸å¯¹æ»¡æ„çš„é•¿æœŸå­¦ä¹ è®¡åˆ’ã€‚ä»ä¸Šå¸è§†è§’ï¼Œä¿¯å†²å‘ä¸‹ï¼Œç›´è‡³ä¸€ä¸ªä¸ªå¹³æ°‘ã€‚<br>  <div class="post-desc">reactçš„æ ¸å¿ƒå¯ä»¥ç”¨ui = fn(state)æ¥è¡¨ç¤ºï¼Œæ›´è¯¦ç»†å¯ä»¥ç”¨ï¼š<br>    const state = reconcile (update);<br>    const UI = commit (state);<br>  </div></p>
<p>  çŠ¶æ€æ›´æ–°è§†å›¾ï¼Œè°ƒåº¦å™¨ï¼Œåè°ƒå™¨ï¼Œæ¸²æŸ“å™¨ã€‚<br>  <canvas id="react-zong" width="500" height="390"></canvas></p>
  <script>const oReactZong = document.getElementById('react-zong');const oReactZongPen = oReactZong.getContext('2d');oReactZongPen.fillText('jsx', 28, 220);oReactZongPen.fillText('task2', 155, 133);oReactZongPen.fillText('ä¸­ä¼˜å…ˆçº§', 150, 146);oReactZongPen.fillText('task3', 155, 165);oReactZongPen.fillText('ä½ä¼˜å…ˆçº§', 150, 175);oReactZongPen.fillText('task1', 268, 133);oReactZongPen.fillText('é«˜ä¼˜å…ˆçº§', 260, 146);oReactZongPen.fillStyle='blue';oReactZongPen.fillText('mount/update', 2, 190);oReactZongPen.fillText('renderé˜¶æ®µ', 250, 100);oReactZongPen.fillText('åœ¨å†…å­˜ä¸­è¿›è¡Œ', 180, 350);oReactZongPen.fillText('commité˜¶æ®µ', 410, 100);oReactZongPen.font = '14px sans-serif';oReactZongPen.fillText('Scheduler', 135, 210);oReactZongPen.fillText('ï¼ˆè°ƒåº¦å™¨ï¼‰', 130, 225);oReactZongPen.fillText('Reconciler', 245, 210);oReactZongPen.fillText('ï¼ˆåè°ƒå™¨ï¼‰', 239, 225);oReactZongPen.fillText('Renderer', 409, 210);oReactZongPen.fillText('ï¼ˆæ¸²æŸ“å™¨ï¼‰', 405, 225);oReactZongPen.lineWidth = 0.5;oReactZongPen.strokeStyle = 'black';oReactZongPen.beginPath();oReactZongPen.setLineDash([2]);oReactZongPen.strokeRect( 5 , 203 , 60, 30 );oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.arc(305, 90, 20, -Math.PI/2 , Math.PI, true);oReactZongPen.arc(265, 90, 20, 0, -Math.PI/2, true);oReactZongPen.font = '10px sans-serif';oReactZongPen.fillStyle='black';oReactZongPen.fillText('æ ¹æ®updateè®¡ç®—state', 240, 40);oReactZongPen.fillText('diffç®—æ³•', 270, 52);oReactZongPen.fillText('ç»™Fiberæ‰“ä¸ŠFlags', 250, 64);oReactZongPen.lineTo(233, 70);oReactZongPen.lineTo(233, 25);oReactZongPen.lineTo(343, 25);oReactZongPen.lineTo(343, 70);oReactZongPen.closePath();oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.arc(460, 90, 20, -Math.PI/2 , Math.PI, true);oReactZongPen.arc(420, 90, 20, 0, -Math.PI/2, true);oReactZongPen.fillText('react-dom', 415, 28);oReactZongPen.fillText('react-art', 415, 40);oReactZongPen.fillText('......', 420, 52);oReactZongPen.fillText('æ“ä½œDOM', 415, 64);oReactZongPen.lineTo(400, 70);oReactZongPen.lineTo(400, 15);oReactZongPen.lineTo(480, 15);oReactZongPen.lineTo(480, 70);oReactZongPen.closePath();oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.arc(150, 90, 20, -Math.PI/2 , Math.PI, true);oReactZongPen.arc(110, 90, 20, 0, -Math.PI/2, true);oReactZongPen.font = '10px sans-serif';oReactZongPen.fillStyle='black';oReactZongPen.fillText('å¦‚æœä½ä¼˜å…ˆçº§taskè¢«æ‰“æ–­ï¼Œ', 75, 40);oReactZongPen.fillText('ä¹Ÿåªæ˜¯å‘ç”Ÿåœ¨å†…å­˜ä¸­ï¼Œ', 85, 52);oReactZongPen.fillText('ä¸å½±å“çœŸå®èŠ‚ç‚¹', 95, 64);oReactZongPen.lineTo(64, 70);oReactZongPen.lineTo(64, 25);oReactZongPen.lineTo(200, 25);oReactZongPen.lineTo(200, 70);oReactZongPen.closePath();oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.strokeRect( 98 , 85 , 260 , 280 );oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.setLineDash([]);oReactZongPen.lineTo(65, 220);oReactZongPen.lineTo(123, 220);oReactZongPen.fillStyle='black';oReactZongPen.fillText('â†’' , 119, 223);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.strokeRect( 130 , 120 , 80 , 200 );oReactZongPen.setLineDash([2]);oReactZongPen.lineTo(130, 150);oReactZongPen.lineTo(210, 150);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.lineTo(130, 180);oReactZongPen.lineTo(210, 180);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.setLineDash([]);oReactZongPen.strokeRect( 240 , 120 , 80 , 200 );oReactZongPen.setLineDash([2]);oReactZongPen.lineTo(240, 150);oReactZongPen.lineTo(320, 150);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.setLineDash([]);oReactZongPen.strokeRect( 400 , 120 , 80 , 200 );</script>


<p>  <img src="https://img-blog.csdnimg.cn/img_convert/f81d27cf172e1ea3718b9d54cdf8e307.png" alt="tusods"></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºæ›´æ–°</span><br><span class="line">    ReactDOM.render</span><br><span class="line">    setState &amp; forceUpdate</span><br><span class="line">    expirationTime è®¡ç®—</span><br><span class="line">ä»»åŠ¡è°ƒåº¦</span><br><span class="line">    å…¨å±€å˜é‡</span><br><span class="line">    scheduleWork</span><br><span class="line">    react-scheduler</span><br><span class="line">    performWork</span><br><span class="line">    performUnitOfWork</span><br><span class="line">    renderRoot</span><br><span class="line">    beginWork</span><br><span class="line">    reconcileChildren</span><br><span class="line">commit é˜¶æ®µ</span><br><span class="line">    commitRoot</span><br><span class="line">    invokeGuardedCallback</span><br><span class="line">    commitBeforeMutationLifecycles</span><br><span class="line">    commitAllHostEffects</span><br><span class="line">    commitPlacement</span><br><span class="line">åŠŸèƒ½</span><br><span class="line">    context</span><br><span class="line">    hydrate</span><br><span class="line">    ref</span><br><span class="line">    äº‹ä»¶ç³»ç»Ÿåˆå§‹åŒ–</span><br><span class="line">    äº‹ä»¶ç»‘å®š</span><br><span class="line">    äº‹ä»¶è§¦å‘</span><br><span class="line">    äº‹ä»¶å¯¹è±¡ç”Ÿæˆ</span><br><span class="line">    Suspense</span><br><span class="line">    æŒ‚èµ·ä»»åŠ¡çš„å«ä¹‰</span><br><span class="line">    lazy ç»„ä»¶</span><br></pre></td></tr></table></figure>
<p>  fiberRootæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ï¼Œåªå­˜åœ¨ä¸€ä¸ªï¼ŒrootFiberæ˜¯åº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªï¼Œä¾‹å¦‚å¤šä¸ªReactDOM.render(&lt; App /&gt;, document.getElementById(â€œrootâ€));åˆ›å»ºå¤šä¸ªåº”ç”¨èŠ‚ç‚¹</p>
<h2 id="jsx"><a href="#jsx" class="headerlink" title="jsx"></a>jsx</h2><p>  <code>jsx</code> å£°æ˜å¼åœ°ç¼–å†™æˆ‘ä»¬æƒ³è¦çš„UIæ•ˆæœï¼Œæœ¬è´¨ä¸Šæ˜¯React.createElementçš„è¯­æ³•ç³–ã€‚è¯­æ³•ç³–çš„æ„æ€å°±æ˜¯äºŒè€…æœ¬è´¨æ˜¯ç­‰ä»·çš„ï¼Œåªæ˜¯è£¹äº†ä¸€å±‚ç³–è¡£ï¼ˆå†™èµ·æ¥æ›´ç”œæ›´ç®€å•ç›´æ¥ï¼‰ã€‚è¿™å±‚ç³–è¡£å°±æ˜¯babelæ¥åšçš„ï¼Œreacté€šè¿‡babelè¯æ³•è§£æï¼Œå°†jsxè½¬æ¢æˆReact.createElementã€‚</p>
<p>  React.createElementæ–¹æ³•è¿”å›virtual domå¯¹è±¡ï¼ˆå†…å­˜ä¸­ç”¨æ¥æè¿°domé˜¶æ®µçš„å¯¹è±¡ï¼‰ã€‚</p>
<h2 id="FiberåŒç¼“å­˜"><a href="#FiberåŒç¼“å­˜" class="headerlink" title="FiberåŒç¼“å­˜"></a>FiberåŒç¼“å­˜</h2><pre><code>Fiberå¯¹è±¡æ˜ å°„èŠ‚ç‚¹ä¿¡æ¯ã€‚Fiberå¯¹è±¡ï¼ˆFiberRootNodeã€FiberNodeï¼‰ä¸Šä¿å­˜äº†è¿™ä¸ªèŠ‚ç‚¹çš„å±æ€§ã€ç±»å‹ã€domï¼ˆchildã€siblingï¼‰ç­‰ï¼ŒFiberé€šè¿‡childã€siblingã€returnï¼ˆæŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼‰æ¥å½¢æˆFiberæ ‘ã€‚è¿˜ä¿å­˜äº†æ›´æ–°çŠ¶æ€æ—¶ç”¨äºè®¡ç®—stateçš„updateQueueï¼ŒupdateQueueæ˜¯ä¸€ç§é“¾è¡¨ç»“æ„ï¼Œä¸Šé¢å¯èƒ½å­˜åœ¨å¤šä¸ªæœªè®¡ç®—çš„updateï¼Œupdateä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸Šé¢åŒ…å«äº†æ›´æ–°çš„æ•°æ®ã€ä¼˜å…ˆçº§ç­‰ï¼Œé™¤äº†è¿™äº›ä¹‹å¤–ï¼Œä¸Šé¢è¿˜æœ‰å’Œå‰¯ä½œç”¨æœ‰å…³çš„ä¿¡æ¯ã€‚

åŒç¼“å­˜æ˜¯æŒ‡æœ‰ä¸¤æ£µFiberæ ‘ï¼Œcurrent Fiberæ ‘æè¿°äº†å½“å‰å·²ç»å‘ˆç°çš„domæ ‘ï¼ŒworkInProgress Fiberæ ‘æ˜¯æ­£åœ¨æ›´æ–°çš„Fiberæ ‘ã€‚å½“workInProgress Fiberæ ‘æ„å»ºå®Œæˆåï¼Œä¼šå°†å…¶ä½œä¸ºcurrent Fiberæ ‘æ›´æ–°åˆ°çœŸå®Domæ ‘ä¸Šã€‚

åœ¨mountï¼ˆè£…è½½ï¼Œé¦–æ¬¡æ¸²æŸ“ï¼‰æ—¶ï¼Œä¼šæ ¹æ®jsxå¯¹è±¡ï¼ˆclass componentçš„renderå‡½æ•°æˆ–è€…Function Componentçš„è¿”å›å€¼ï¼‰ç”ŸæˆworkInProgress Fiberæ ‘ï¼ŒæŠŠworkInProgress Fiberåˆ‡æ¢æˆcurrent Fiberï¼ŒCurrent Fiberæ ‘åº”ç”¨åˆ°çœŸå®çš„domä¸Šã€‚åœ¨updateï¼ˆçŠ¶æ€æ›´æ–°ï¼Œå¦‚setStateï¼‰æ—¶ï¼Œä¼šæ ¹æ®çŠ¶æ€æ›´æ–°åçš„jsxå¯¹è±¡å’ŒCurrent fiberæ ‘ä½œå¯¹æ¯”é€æ¸å½¢æˆæ–°çš„workInProgress Fiberæ ‘ï¼ŒworkInProgress Fiberæ„å»ºå®Œæˆåä¼šæ›¿æ¢æˆCurrent Fiberï¼Œæ›´æ–°åˆ°çœŸå®çš„domä¸Šã€‚è€Œè¿™ä¸€åˆ‡éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå‡å°‘çœŸå®domæ¸²æŸ“è€—æ€§èƒ½ã€‚

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1</span><br><span class="line">      onClick=&#123;() =&gt; &#123;</span><br><span class="line">        setCount(() =&gt; count + 1);</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">        &lt;p title=&#123;count&#125;&gt;&#123;count&#125;&lt;/p&gt; jyy</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;root&quot;));</span><br></pre></td></tr></table></figure>
</code></pre>  <canvas id="react-fiber" width="600" height="500"></canvas>

  <script>const oReactFiber = document.getElementById('react-fiber');const oReactFiberPen = oReactFiber.getContext('2d');oReactFiberPen.font = '14px sans-serif';oReactFiberPen.fillStyle='black';oReactFiberPen.strokeRect(245, 10, 110, 40);oReactFiberPen.strokeRect(160, 120, 90, 40);oReactFiberPen.strokeRect(160, 210, 90, 40);oReactFiberPen.strokeRect(160, 300, 90, 40);oReactFiberPen.strokeRect(160, 390, 90, 40);oReactFiberPen.strokeRect(30, 391, 50, 38);oReactFiberPen.strokeRect(348, 120, 90, 40);oReactFiberPen.strokeRect(348, 210, 90, 40);oReactFiberPen.strokeRect(348, 300, 90, 40);oReactFiberPen.strokeRect(348, 390, 90, 40);oReactFiberPen.strokeRect(520, 391, 50, 38);oReactFiberPen.beginPath();oReactFiberPen.lineTo(245, 50);oReactFiberPen.lineTo(180, 120);oReactFiberPen.lineTo(181, 111);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(180, 120);oReactFiberPen.lineTo(190, 117);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 120);oReactFiberPen.lineTo(285, 50);oReactFiberPen.lineTo(284, 59);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(285, 50);oReactFiberPen.lineTo(275, 54);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 160);oReactFiberPen.lineTo(200, 210);oReactFiberPen.lineTo(196, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 210);oReactFiberPen.lineTo(204, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 250);oReactFiberPen.lineTo(200, 300);oReactFiberPen.lineTo(196, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 300);oReactFiberPen.lineTo(204, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 340);oReactFiberPen.lineTo(200, 391);oReactFiberPen.lineTo(196, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 391);oReactFiberPen.lineTo(204, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 210);oReactFiberPen.lineTo(220, 160);oReactFiberPen.lineTo(216, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 160);oReactFiberPen.lineTo(224, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 300);oReactFiberPen.lineTo(220, 250);oReactFiberPen.lineTo(216, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 250);oReactFiberPen.lineTo(224, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 391);oReactFiberPen.lineTo(220, 340);oReactFiberPen.lineTo(216, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 340);oReactFiberPen.lineTo(224, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 160);oReactFiberPen.lineTo(388, 210);oReactFiberPen.lineTo(384, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 210);oReactFiberPen.lineTo(392, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 250);oReactFiberPen.lineTo(388, 300);oReactFiberPen.lineTo(384, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 300);oReactFiberPen.lineTo(392, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 340);oReactFiberPen.lineTo(388, 391);oReactFiberPen.lineTo(384, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 391);oReactFiberPen.lineTo(392, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 210);oReactFiberPen.lineTo(408, 160);oReactFiberPen.lineTo(404, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 160);oReactFiberPen.lineTo(412, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 300);oReactFiberPen.lineTo(408, 250);oReactFiberPen.lineTo(404, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 250);oReactFiberPen.lineTo(412, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 391);oReactFiberPen.lineTo(408, 340);oReactFiberPen.lineTo(404, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 340);oReactFiberPen.lineTo(412, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(160, 410);oReactFiberPen.lineTo(80, 410);oReactFiberPen.lineTo(85, 406);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(80, 410);oReactFiberPen.lineTo(85, 414);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(60, 391);oReactFiberPen.lineTo(160, 320);oReactFiberPen.lineTo(150, 324);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(160, 320);oReactFiberPen.lineTo(153, 329);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(438, 410);oReactFiberPen.lineTo(520, 410);oReactFiberPen.lineTo(515, 406);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(520, 410);oReactFiberPen.lineTo(515, 414);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(540, 391);oReactFiberPen.lineTo(438, 320);oReactFiberPen.lineTo(443, 328);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(438, 320);oReactFiberPen.lineTo(448, 322);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 140);oReactFiberPen.lineTo(348, 140);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 230);oReactFiberPen.lineTo(348, 230);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 320);oReactFiberPen.lineTo(348, 320);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 410);oReactFiberPen.lineTo(348, 410);oReactFiberPen.stroke();oReactFiberPen.setLineDash([2]);oReactFiberPen.strokeRect(20, 76, 250, 400);oReactFiberPen.strokeRect(330, 76, 250, 400);oReactFiberPen.fillStyle='#4F2F64';oReactFiberPen.fillText('fiberRootNode', 253, 35);oReactFiberPen.fillText('rootFiber', 175, 144);oReactFiberPen.fillText('App', 192, 234);oReactFiberPen.fillText('h1', 198, 325);oReactFiberPen.fillText('p', 202, 414);oReactFiberPen.fillText('jyy', 45, 415);oReactFiberPen.fillText('rootFiber', 365, 144);oReactFiberPen.fillText('App', 378, 234);oReactFiberPen.fillText('h1', 384, 325);oReactFiberPen.fillText('p', 390, 414);oReactFiberPen.fillText('jyy', 536, 415);oReactFiberPen.fillStyle='#E22312';oReactFiberPen.fillText('Current Fiber', 60, 58);oReactFiberPen.fillText('WorkInProgress Fiber', 400, 58);oReactFiberPen.fillStyle='#21AFF2';oReactFiberPen.fillText('current', 150, 100);oReactFiberPen.fillText('stateNode', 249, 100);oReactFiberPen.fillText('child', 166, 190);oReactFiberPen.fillText('return ', 225, 190);oReactFiberPen.fillText('child', 166, 281);oReactFiberPen.fillText('return', 225, 281);oReactFiberPen.fillText('child', 166, 368);oReactFiberPen.fillText('return', 225, 368);oReactFiberPen.fillText('sibling', 104, 405);oReactFiberPen.fillText('return', 63, 355);oReactFiberPen.fillText('child', 353, 190);oReactFiberPen.fillText('return ', 412, 190);oReactFiberPen.fillText('child', 353, 281);oReactFiberPen.fillText('return', 412, 281);oReactFiberPen.fillText('child', 353, 368);oReactFiberPen.fillText('return', 412, 368);oReactFiberPen.fillText('sibling', 462, 405);oReactFiberPen.fillText('return', 495, 355);oReactFiberPen.fillText('alternate', 272, 136);oReactFiberPen.fillText('alternate', 272, 226);oReactFiberPen.fillText('alternate', 272, 316);oReactFiberPen.fillText('alternate', 272, 406);</script>


<h2 id="scheduler"><a href="#scheduler" class="headerlink" title="scheduler"></a>scheduler</h2><pre><code>Schedulerçš„ä½œç”¨æ˜¯è°ƒåº¦ä»»åŠ¡ï¼Œreact15æ²¡æœ‰Schedulerè¿™éƒ¨åˆ†ï¼Œæ‰€ä»¥æ‰€æœ‰ä»»åŠ¡æ²¡æœ‰ä¼˜å…ˆçº§ï¼Œä¹Ÿä¸èƒ½ä¸­æ–­ï¼Œåªèƒ½åŒæ­¥æ‰§è¡Œã€‚

æˆ‘ä»¬çŸ¥é“äº†è¦å®ç°å¼‚æ­¥å¯ä¸­æ–­çš„æ›´æ–°ï¼Œéœ€è¦æµè§ˆå™¨æŒ‡å®šä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´å‰©ä½™äº†å°±éœ€è¦æš‚åœä»»åŠ¡ï¼ŒrequestIdleCallbackè²Œä¼¼æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯å®ƒå­˜åœ¨å…¼å®¹å’Œè§¦å‘ä¸ç¨³å®šçš„åŸå› ï¼Œreact17ä¸­é‡‡ç”¨MessageChannelæ¥å®ç°ã€‚

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoopConcurrent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Perform work until Scheduler asks us to yield</span></span><br><span class="line">  <span class="keyword">while</span> (workInProgress !== <span class="literal">null</span> &amp;&amp; !shouldYield()) &#123;</span><br><span class="line">    performUnitOfWork(workInProgress);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

åœ¨Schedulerä¸­çš„æ¯çš„æ¯ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ä½¿ç”¨è¿‡æœŸæ—¶é—´è¡¨ç¤ºçš„ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡çš„è¿‡æœŸæ—¶é—´ç¦»ç°åœ¨å¾ˆè¿‘ï¼Œè¯´æ˜å®ƒé©¬ä¸Šå°±è¦è¿‡æœŸäº†ï¼Œä¼˜å…ˆçº§å¾ˆé«˜ï¼Œå¦‚æœè¿‡æœŸæ—¶é—´å¾ˆé•¿ï¼Œé‚£å®ƒçš„ä¼˜å…ˆçº§å°±ä½ï¼Œæ²¡æœ‰è¿‡æœŸçš„ä»»åŠ¡å­˜æ”¾åœ¨timerQueueä¸­ï¼Œè¿‡æœŸçš„ä»»åŠ¡å­˜æ”¾åœ¨taskQueueä¸­ï¼ŒtimerQueueå’ŒtimerQueueéƒ½æ˜¯å°é¡¶å †ï¼Œæ‰€ä»¥peekå–å‡ºæ¥çš„éƒ½æ˜¯ç¦»ç°åœ¨æ—¶é—´æœ€è¿‘ä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åä¼˜å…ˆæ‰§è¡Œå®ƒã€‚
</code></pre>  <!-- ## Laneæ¨¡å‹ -->
<h2 id="reconcilerï¼ˆrender-é˜¶æ®µï¼‰"><a href="#reconcilerï¼ˆrender-é˜¶æ®µï¼‰" class="headerlink" title="reconcilerï¼ˆrender é˜¶æ®µï¼‰"></a>reconcilerï¼ˆrender é˜¶æ®µï¼‰</h2><pre><code>åè°ƒå™¨æ˜¯åœ¨renderé˜¶æ®µå·¥ä½œçš„ï¼Œç®€å•ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯Reconcilerä¼šåˆ›å»ºæˆ–è€…æ›´æ–°FiberèŠ‚ç‚¹ã€‚åœ¨mountçš„æ—¶å€™ä¼šæ ¹æ®jsxç”ŸæˆFiberå¯¹è±¡ï¼Œåœ¨updateçš„æ—¶å€™ä¼šæ ¹æ®æœ€æ–°çš„stateå½¢æˆçš„jsxå¯¹è±¡å’Œcurrent Fiberæ ‘å¯¹æ¯”æ„å»ºworkInProgress Fiberæ ‘ï¼Œè¿™ä¸ªå¯¹æ¯”çš„è¿‡ç¨‹å°±æ˜¯diffç®—æ³•ã€‚

diffç®—æ³•å‘ç”Ÿåœ¨renderé˜¶æ®µçš„reconcileChildFiberså‡½æ•°ä¸­ï¼Œdiffç®—æ³•åˆ†ä¸ºå•èŠ‚ç‚¹çš„diffå’Œå¤šèŠ‚ç‚¹çš„diffï¼ˆä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹å°±å±äºå¤šèŠ‚ç‚¹çš„diffï¼‰ï¼Œå•èŠ‚ç‚¹ä¼šæ ¹æ®èŠ‚ç‚¹çš„keyå’Œtypeï¼Œpropsç­‰æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¤ç”¨è¿˜æ˜¯ç›´æ¥æ–°åˆ›å»ºèŠ‚ç‚¹ï¼Œå¤šèŠ‚ç‚¹diffä¼šæ¶‰åŠèŠ‚ç‚¹çš„å¢åˆ å’ŒèŠ‚ç‚¹ä½ç½®çš„å˜åŒ–ã€‚

reconcileæ—¶ä¼šåœ¨è¿™äº›Fiberä¸Šæ‰“ä¸ŠFlagsæ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾ä»£è¡¨èŠ‚ç‚¹çš„å¢åˆ æ”¹ï¼Œåœ¨commité˜¶æ®µæŠŠè¿™äº›æ ‡ç­¾åº”ç”¨åˆ°çœŸå®domä¸Šã€‚

renderé˜¶æ®µéå†Fiberæ ‘ç±»ä¼¼dfsçš„è¿‡ç¨‹ï¼Œâ€˜æ•è·â€™é˜¶æ®µå‘ç”Ÿåœ¨beginWorkå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°åšçš„ä¸»è¦å·¥ä½œæ˜¯åˆ›å»ºFiberèŠ‚ç‚¹ï¼Œè®¡ç®—stateå’Œdiffç®—æ³•ï¼Œâ€˜å†’æ³¡â€™é˜¶æ®µå‘ç”Ÿåœ¨completeWorkä¸­ï¼Œè¯¥å‡½æ•°ä¸»è¦æ˜¯åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚å¤„ç†èŠ‚ç‚¹çš„propsã€å’Œå½¢æˆä¸€æ¡effectListçš„é“¾è¡¨ï¼Œè¯¥é“¾è¡¨æ˜¯è¢«æ ‡è®°äº†æ›´æ–°çš„èŠ‚ç‚¹å½¢æˆçš„é“¾è¡¨ã€‚ï¼ˆå¯ä»¥çœ‹ä¸Šé¢ FiberåŒç¼“å­˜ é‚£å¼ å›¾ï¼Œè‡ªä¸Šè€Œä¸‹çš„æ˜¯beginWorkï¼Œè‡ªä¸‹è€Œä¸Šæ˜¯completeWorkï¼‰
</code></pre><h2 id="rendererï¼ˆcommit-é˜¶æ®µï¼‰"><a href="#rendererï¼ˆcommit-é˜¶æ®µï¼‰" class="headerlink" title="rendererï¼ˆcommit é˜¶æ®µï¼‰"></a>rendererï¼ˆcommit é˜¶æ®µï¼‰</h2><pre><code>Rendereræ˜¯åœ¨commité˜¶æ®µå·¥ä½œçš„ï¼Œcommité˜¶æ®µä¼šéå†renderé˜¶æ®µå½¢æˆçš„effectListï¼Œå¹¶æ‰§è¡ŒçœŸå®domèŠ‚ç‚¹çš„æ“ä½œå’Œä¸€äº›ç”Ÿå‘½å‘¨æœŸï¼Œä¸åŒå¹³å°å¯¹åº”çš„Rendererä¸åŒï¼Œä¾‹å¦‚æµè§ˆå™¨å¯¹åº”çš„å°±æ˜¯react-domã€‚

commité˜¶æ®µå‘ç”Ÿåœ¨commitRootå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ä¸»è¦éå†effectListï¼Œåˆ†åˆ«ç”¨ä¸‰ä¸ªå‡½æ•°æ¥å¤„ç†effectListä¸Šçš„èŠ‚ç‚¹ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°æ˜¯commitBeforeMutationEffectsã€commitMutationEffectsã€commitLayoutEffectsï¼Œä»–ä»¬ä¸»è¦åšçš„äº‹æƒ…å¦‚ä¸‹ï¼Œåé¢ä¼šè¯¦ç»†ç ”ç©¶ï¼Œç°åœ¨åœ¨å¤§è„‘é‡Œæœ‰ä¸€ä¸ªç»“æ„å°±è¡Œã€‚
</code></pre><h2 id="concurrent"><a href="#concurrent" class="headerlink" title="concurrent"></a>concurrent</h2><pre><code>å®ƒæ˜¯ä¸€ç±»åŠŸèƒ½çš„åˆé›†ï¼ˆå¦‚fiberã€schdulerã€laneã€suspenseï¼‰ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦ï¼Œä½¿åº”ç”¨cpuå¯†é›†å‹çš„æ›´æ–°ä¸å†é‚£ä¹ˆå¡é¡¿ï¼Œå…¶æ ¸å¿ƒæ˜¯å®ç°äº†ä¸€å¥—å¼‚æ­¥å¯ä¸­æ–­ã€å¸¦ä¼˜å…ˆçº§çš„æ›´æ–°ã€‚

ä¸€èˆ¬æµè§ˆå™¨çš„fpsæ˜¯60Hzï¼Œä¹Ÿå°±æ˜¯æ¯16.6msä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œè€Œjsæ‰§è¡Œçº¿ç¨‹å’ŒGUIï¼ˆä¹Ÿå°±æ˜¯æµè§ˆå™¨çš„ç»˜åˆ¶ï¼‰æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºjså¯ä»¥æ“ä½œdomï¼Œå½±å“æœ€åå‘ˆç°çš„ç»“æœï¼Œæ‰€ä»¥å¦‚æœjsæ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨æ²¡æ—¶é—´ç»˜åˆ¶domï¼Œé€ æˆå¡é¡¿ã€‚react17ä¼šåœ¨æ¯ä¸€å¸§åˆ†é…ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶é—´ç‰‡ï¼‰ç»™jsæ‰§è¡Œï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…jsè¿˜æ²¡æ‰§è¡Œå®Œï¼Œé‚£å°±è¦æš‚åœå®ƒçš„æ‰§è¡Œï¼Œç­‰ä¸‹ä¸€å¸§ç»§ç»­æ‰§è¡Œï¼ŒæŠŠæ‰§è¡Œæƒäº¤å›ç»™æµè§ˆå™¨å»ç»˜åˆ¶ã€‚
</code></pre>  <div class="post-warning">FPS ï¼ˆFrames Per Second, æ¯ç§’ä¼ è¾“å¸§æ•°ï¼‰ï¼Œ FPSæ˜¯å›¾åƒé¢†åŸŸä¸­çš„å®šä¹‰ï¼Œæ˜¯æŒ‡ç”»é¢æ¯ç§’ä¼ è¾“å¸§æ•°ï¼Œé€šä¿—æ¥è®²å°±æ˜¯æŒ‡åŠ¨ç”»æˆ–è§†é¢‘çš„ç”»é¢æ•°ã€‚FPSæ˜¯æµ‹é‡ç”¨äºä¿å­˜ã€æ˜¾ç¤ºåŠ¨æ€è§†é¢‘çš„ä¿¡æ¯æ•°é‡ã€‚æ¯ç§’é’Ÿå¸§æ•°è¶Šå¤šï¼Œæ‰€æ˜¾ç¤ºçš„åŠ¨ä½œå°±ä¼šè¶Šæµç•…ã€‚60Hzçš„åˆ·æ–°ç‡åˆ·ä¹Ÿå°±æ˜¯æŒ‡å±å¹•ä¸€ç§’å†…åªæ‰«æ60æ¬¡ï¼Œå³60å¸§/ç§’ã€‚è€Œå½“åˆ·æ–°ç‡å¤ªä½æ—¶æˆ‘ä»¬è‚‰çœ¼éƒ½èƒ½æ„Ÿè§‰åˆ°å±å¹•çš„é—ªçƒï¼Œä¸è¿è´¯ï¼Œå¯¹å›¾åƒæ˜¾ç¤ºæ•ˆæœå’Œè§†è§‰æ„Ÿè§‚äº§ç”Ÿä¸å¥½çš„å½±å“ã€‚</div>

  <canvas id="concurrent-browser" width="600" height="300"></canvas>

  <script>const oConcurrent = document.getElementById('concurrent-browser');const oConcurrentPen = oConcurrent.getContext('2d');oConcurrentPen.font = '14px sans-serif';oConcurrentPen.fillStyle='black';oConcurrentPen.fillText('jsæ‰§è¡Œ', 16, 245);oConcurrentPen.fillText('é‡æ’', 70, 245);oConcurrentPen.fillText('é‡ç»˜', 122, 245);oConcurrentPen.fillText('jsæ‰§è¡Œ', 68, 125);oConcurrentPen.fillText('jsæ‰§è¡Œ', 218, 125);oConcurrentPen.fillText('é‡æ’', 422, 125);oConcurrentPen.fillText('é‡ç»˜', 471, 125);oConcurrentPen.fillText('16.6ms', 65, 93);oConcurrentPen.fillText('16.6ms', 218, 93);oConcurrentPen.fillText('16.6ms', 65, 213);oConcurrentPen.font = '10px sans-serif';oConcurrentPen.fillText('......å¾ˆé•¿ä¸€æ®µæ—¶é—´', 320, 93);oConcurrentPen.fillText('æ²¡æ—¶é—´æ‰§è¡Œ', 435, 93);oConcurrentPen.strokeRect(10, 220, 50, 40);oConcurrentPen.strokeRect(60, 220, 50, 40);oConcurrentPen.strokeRect(110, 220, 50, 40);oConcurrentPen.strokeRect(10, 100, 150, 40);oConcurrentPen.strokeRect(160, 100, 150, 40);oConcurrentPen.strokeRect(410, 100, 50, 40);oConcurrentPen.strokeRect(460, 100, 50, 40);oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 82);oConcurrentPen.lineTo(10, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(160, 82);oConcurrentPen.lineTo(160, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 88);oConcurrentPen.lineTo(55, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(115, 88);oConcurrentPen.lineTo(160, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(310, 82);oConcurrentPen.lineTo(310, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(160, 88);oConcurrentPen.lineTo(205, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(265, 88);oConcurrentPen.lineTo(310, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(410, 82);oConcurrentPen.lineTo(410, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(510, 82);oConcurrentPen.lineTo(510, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(410, 88);oConcurrentPen.lineTo(430, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(490, 88);oConcurrentPen.lineTo(510, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 202);oConcurrentPen.lineTo(10, 214);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(160, 202);oConcurrentPen.lineTo(160, 214);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 208);oConcurrentPen.lineTo(55, 208);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(115, 208);oConcurrentPen.lineTo(160, 208);oConcurrentPen.stroke();</script>


<h1 id="ä¸‰ã€reactæºç æ·±å…¥è§£æ"><a href="#ä¸‰ã€reactæºç æ·±å…¥è§£æ" class="headerlink" title="ä¸‰ã€reactæºç æ·±å…¥è§£æ"></a>ä¸‰ã€reactæºç æ·±å…¥è§£æ</h1><p>  ç›´æ¥çœ‹reactæºç ï¼Œå°±åƒæ˜¯ä¸€ä¸ªäººç«™åœ¨ä½ é¢å‰ï¼Œä»–å°±åœ¨ä½ é¢å‰ï¼Œé¢é¢ç›¸è§‘ï¼Œä½ ä¸äº†è§£ä»–ã€‚<br>  æ¥ä¸‹æ¥ï¼Œè¿™ä¸€partæˆ‘ä»¬å¬åˆ«äººå»è®²ä»–ï¼Œæˆ‘ä»¬å»ç†è§£ï¼Œå†äº²è‡ªå»éªŒè¯ï¼Œæ·±å…¥ç†è§£ä»–ã€‚</p>
<h2 id="æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•"><a href="#æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•" class="headerlink" title="æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•"></a>æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•</h2><ol>
<li>æºç ä¸­ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹éƒ¨åˆ†<br> fixturesï¼šä¸ºä»£ç è´¡çŒ®è€…æä¾›çš„æµ‹è¯•React<br> packagesï¼šä¸»è¦éƒ¨åˆ†ï¼ŒåŒ…å«Schedulerï¼Œreconcilerç­‰<br> scriptsï¼šreactæ„å»ºç›¸å…³</li>
<li>packagesä¸»è¦åŒ…å«çš„æ¨¡å—</li>
</ol>
<pre><code>- reactï¼šæ ¸å¿ƒApiï¼Œå¦‚ï¼šReact.createElementã€React.Componentéƒ½åœ¨è¿™

- å’Œå¹³å°ç›¸å…³renderç›¸å…³çš„æ–‡ä»¶å¤¹ï¼š 
  react-artï¼šå¦‚canvas svgçš„æ¸²æŸ“ 
  react-domï¼šæµè§ˆå™¨ç¯å¢ƒ 
  react-native-rendererï¼šåŸç”Ÿç›¸å…³ react-noop-rendererï¼šè°ƒè¯•æˆ–è€…fiberç”¨

- è¯•éªŒæ€§çš„åŒ…
  react-server: ssrç›¸å…³
  react-fetch: è¯·æ±‚ç›¸å…³
  react-interactions: å’Œäº‹ä»¶å¦‚ç‚¹å‡»äº‹ä»¶ç›¸å…³
  react-reconciler: æ„å»ºèŠ‚ç‚¹

- sharedï¼šåŒ…å«å…¬å…±æ–¹æ³•å’Œå˜é‡

- è¾…åŠ©åŒ…ï¼š
  react-is : åˆ¤æ–­ç±»å‹
  react-client: æµç›¸å…³
  react-fetch: æ•°æ®è¯·æ±‚ç›¸å…³
  react-refresh: çƒ­åŠ è½½ç›¸å…³
  schedulerï¼šè°ƒåº¦å™¨ç›¸å…³
  React-reconcilerï¼šåœ¨renderé˜¶æ®µç”¨å®ƒæ¥æ„å»ºfiberèŠ‚ç‚¹
</code></pre><ul>
<li>è°ƒè¯•æ–¹æ³•</li>
</ul>
<p>  æ–¹æ³•ä¸€ï¼šè¿™ç§æ–¹æ³•æˆ‘æ²¡èµ°é€šï¼Œç›´æ¥èµ°çš„é‡è·¯å­æ–¹æ³•äºŒã€‚</p>
<ol>
<li>cloneæºç ï¼šgit clone <a href="https://github.com/facebook/react.git" target="_blank" rel="noopener">https://github.com/facebook/react.git</a></li>
<li>ä¾èµ–å®‰è£…ï¼šnpm install or yarn</li>
<li>buildæºç ï¼šnpm run build react/index,react/jsx,react-dom/index,scheduler â€“type=NODE<br>ä¸ºæºç å»ºç«‹è½¯é“¾ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> build/node_modules/react</span><br><span class="line">npm link</span><br><span class="line"><span class="built_in">cd</span> build/node_modules/react-dom</span><br><span class="line">npm link</span><br><span class="line">create-react-appåˆ›å»ºé¡¹ç›®</span><br><span class="line"></span><br><span class="line">npx create-react-app demo</span><br><span class="line">npm link react react-dom</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>æ–¹æ³•äºŒï¼šé‡è·¯å­ï¼Œç›´æ£é»„é¾™</p>
<ol>
<li>npm i react react-dom</li>
<li><p>åŒç›®å½•åˆ›å»ºhtmlæ–‡ä»¶ï¼Œscriptæ–¹å¼ä½¿ç”¨reactå’Œreact-dom</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">'./node_modules/react/umd/react.development.js'</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">'./node_modules/react-dom/umd/react-dom.development.js'</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=<span class="string">'root'</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    <span class="string">'app'</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> a = <span class="string">'abc'</span>;</span><br><span class="line">  <span class="comment">// ReactDOM.render(null, document.getElementById('root'));</span></span><br><span class="line">  ReactDOM.render(React.createElement(<span class="string">'h1'</span>, &#123;<span class="attr">className</span>: <span class="string">'name'</span>, <span class="attr">onClick</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="string">'ç‚¹æˆ‘å¹²å˜›'</span>);&#125;&#125;, [<span class="string">'abc'</span>, React.createElement(<span class="string">'div'</span>, &#123;<span class="attr">key</span>: <span class="string">'num'</span>&#125;, <span class="string">'123456'</span>)]), <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥äº›jsxä¸å¯ä»¥ï¼Œæ²¡æœ‰æ¢ç´¢babelæœ‰æ²¡æœ‰cdnçš„ä½¿ç”¨æ–¹å¼ï¼Œç›´æ¥React.createElememtç²—æš´ä»£æ›¿ã€‚</p>
</li>
</ol>
<h2 id="jsx-1"><a href="#jsx-1" class="headerlink" title="jsx"></a>jsx</h2><h3 id="virtual-Dom-æ˜¯ä»€ä¹ˆ"><a href="#virtual-Dom-æ˜¯ä»€ä¹ˆ" class="headerlink" title="virtual Dom æ˜¯ä»€ä¹ˆ"></a>virtual Dom æ˜¯ä»€ä¹ˆ</h3><p>  virtual Domæ˜¯ä¸€ä¸ªjså¯¹è±¡ï¼Œæè¿°äº†domä¿¡æ¯ã€‚æ›´æ–°å°±æ˜¯æ¸²æŸ“æ›´æ–°åçš„jså¯¹è±¡åˆ°çœŸå®domï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯React.createElement()è¿”å›çš„ç»“æœã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆç”¨virtual-Dom"><a href="#ä¸ºä»€ä¹ˆç”¨virtual-Dom" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨virtual Dom"></a>ä¸ºä»€ä¹ˆç”¨virtual Dom</h3><p>  çœŸå®DOMæ›´æ–°æ¸²æŸ“ï¼Œå¾ˆå°çš„æ›´æ–°å°±å¯èƒ½å¼•èµ·é¡µé¢çš„é‡ç»˜é‡æ’ï¼Œè€—æ—¶è€—æ€§èƒ½ã€‚<br>  jså¯¹è±¡æ˜¯åœ¨å†…å­˜ä¸­å¤„ç†çš„ï¼Œå¾ˆå¿«ï¼Œå¹¶é€šè¿‡diffç®—æ³•æ¯”è¾ƒvirtual domçš„å˜åŒ–ï¼Œèƒ½åšåˆ°æ‰¹é‡ï¼Œå¼‚æ­¥ï¼Œæœ€å°åŒ–çš„domå˜æ›´ï¼Œæœ‰æ•ˆæå‡æ€§èƒ½ã€‚</p>
<h3 id="jsx-amp-createElement"><a href="#jsx-amp-createElement" class="headerlink" title="jsx&amp;createElement"></a>jsx&amp;createElement</h3><p>  jsxæ˜¯Class componentçš„renderå‡½æ•°çš„è¿”å›å€¼æˆ–Function componentçš„è¿”å›å€¼ï¼Œç”¨æ¥è¡¨ç¤ºç»„ä»¶ï¼Œå£°æ˜å¼åœ°æè¿°è§†å›¾ã€‚ç»è¿‡babelè½¬ä¹‰æˆReact.createElementã€‚</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jsxç»“æ„:</span><br><span class="line">&lt;h1 class=&quot;name&quot; onClick=&#123;() =&gt; &#123;console.log(&apos;ç‚¹æˆ‘å¹²å˜›&apos;)&#125;&#125;&gt;</span><br><span class="line">  abc</span><br><span class="line">  &lt;div&gt;123456&lt;/div&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">ç»è¿‡babelè½¬ç§»æˆReact.createElement</span><br><span class="line">React.createElement(</span><br><span class="line">  &apos;h1&apos;, &#123;className: &apos;name&apos;, onClick: () =&gt; &#123;console.log(&apos;ç‚¹æˆ‘å¹²å˜›&apos;);&#125;&#125;, </span><br><span class="line">    [&apos;abc&apos;, React.createElement(&apos;div&apos;, &#123;key: &apos;num&apos;&#125;, &apos;123456&apos;)])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>  PSï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆjsxæ–‡ä»¶è¦å£°æ˜import React from â€˜reactâ€™çš„åŸå› ï¼ˆç°åœ¨æˆ‘è¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆreact17ä¹‹åä¸ç”¨å¯¼å…¥ï¼Ÿï¼‰</p>
<p>  React.createElement(810):</p>
<ul>
<li>å¤„ç†configï¼ŒæŠŠé™¤äº†ä¿ç•™å±æ€§å¤–çš„å…¶ä»–configèµ‹å€¼ç»™props</li>
<li>æŠŠchildrenå¤„ç†åèµ‹å€¼ç»™props.children</li>
<li>å¤„ç†defaultProps</li>
<li>è°ƒç”¨ReactElement(724)è¿”å›ä¸€ä¸ªjsxå¯¹è±¡(virtual-dom)</li>
</ul>
<p>  æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹jsxå¯¹è±¡ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $$typeof: Symbol(react.element),</span><br><span class="line">  key: null,</span><br><span class="line">  props: &#123;</span><br><span class="line">    children: [</span><br><span class="line">      &quot;abc&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        $$typeof: Symbol(react.element),</span><br><span class="line">        key: &quot;num&quot;,</span><br><span class="line">        props: &#123;</span><br><span class="line">          children: &quot;123456&quot;,</span><br><span class="line">          key: undefined,</span><br><span class="line">          get key: Æ’ (),</span><br><span class="line">          ref: null,</span><br><span class="line">          type: &quot;div&quot;,</span><br><span class="line">          _owner: null,</span><br><span class="line">          _store: &#123;validated: false&#125;,</span><br><span class="line">          _self: null,</span><br><span class="line">          _source: null,</span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;,</span><br><span class="line">      length: 2,</span><br><span class="line">    ],</span><br><span class="line">    className: &quot;name&quot;,</span><br><span class="line">    onClick: () =&gt; &#123;console.log(&apos;ç‚¹æˆ‘å¹²å˜›&apos;);&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  ref: null,</span><br><span class="line">  type: &quot;h1&quot;,</span><br><span class="line">  _owner: null,</span><br><span class="line">  _store: &#123;validated: false&#125;,</span><br><span class="line">  _self: null,</span><br><span class="line">  _source: null,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  $$typeofè¡¨ç¤ºçš„æ˜¯ç»„ä»¶çš„ç±»å‹ï¼Œä¾‹å¦‚åœ¨æºç ä¸­æœ‰ä¸€ä¸ªæ£€æŸ¥æ˜¯å¦æ˜¯åˆæ³•Elementçš„å‡½æ•°(isValidElement902)ï¼Œå°±æ˜¯æ ¹object.$$typeof === REACT_ELEMENT_TYPEæ¥åˆ¤æ–­çš„</p>
<p>  çœ‹åˆ°è¿™é‡Œï¼Œå¯¹jsxè±ç„¶å¼€æœ—ï¼Œè‡³äºbabelæ˜¯æ€ä¹ˆè½¬è¯‘çš„ï¼Œä»¥åæœ‰æœºä¼šå†åšå­¦ä¹ ã€‚<br>  <code>jsx -&gt; Virtual Dom(jsxå¯¹è±¡ï¼ŒFiber) -&gt; Dom</code><br>  è¿˜æœ‰ä¸ªç–‘é—®ï¼Œjsxå¯¹è±¡å’ŒFiberå¯¹è±¡çš„å…³ç³»ï¼Ÿæ¥ç€æ¥å¤§è‡´çœ‹ä¸€ä¸‹Fiber</p>
<blockquote>
<p>jsxå¯¹è±¡ä¸Šæ²¡æœ‰ä¼˜å…ˆçº§ã€çŠ¶æ€ã€effectTagç­‰æ ‡è®°ï¼Œè¿™äº›æ ‡è®°åœ¨Fiberå¯¹è±¡ä¸Šï¼Œåœ¨mountæ—¶Fiberæ ¹æ®jsxå¯¹è±¡æ¥æ„å»ºï¼Œåœ¨updateæ—¶æ ¹æ®æœ€æ–°çŠ¶æ€çš„jsxå’Œcurrent Fiberå¯¹æ¯”ï¼Œå½¢æˆæ–°çš„workInProgress Fiberï¼Œæœ€åworkInProgress Fiberåˆ‡æ¢æˆcurrent Fiberã€‚</p>
</blockquote>
<p>  å°ç»“ï¼šjsxæ˜¯React.createElementçš„è¯­æ³•ç³–ï¼Œjsxé€šè¿‡babelè½¬åŒ–æˆReact.createElementå‡½æ•°ï¼ŒReact.createElementæ‰§è¡Œä¹‹åè¿”å›jsxå¯¹è±¡ï¼Œä¹Ÿå«virtual-domï¼ŒFiberä¼šæ ¹æ®jsxå¯¹è±¡å’Œcurrent Fiberè¿›è¡Œå¯¹æ¯”å½¢æˆworkInProgress Fiber<br>  <!-- ## legacyå’Œconcurrentæ¨¡å¼å…¥å£å‡½æ•° --></p>
<h2 id="Fiberæ¶æ„"><a href="#Fiberæ¶æ„" class="headerlink" title="Fiberæ¶æ„"></a>Fiberæ¶æ„</h2><p>  react 15 åœ¨renderé˜¶æ®µçš„reconcileè¿‡ç¨‹æ˜¯åŒæ­¥ä¸å¯ä¸­æ–­çš„ï¼Œå½“è¿›è¡Œå¤§é‡èŠ‚ç‚¹çš„reconcileæ—¶å°±å¯èƒ½äº§ç”Ÿå¡é¡¿ç­‰ï¼Œå› ä¸ºjsæ‰§è¡Œæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸€ç›´åœ¨æ‰§è¡Œjsï¼Œä¸æ”¾å‡ºæ‰§è¡Œæƒï¼Œæµè§ˆå™¨è¦ç­‰åˆ°jsæ‰§è¡Œå®Œæˆåæ‰èƒ½è¿›è¡Œç»˜åˆ¶å’Œé‡æ’ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒä¸€å®šæ˜¯ä¸å¥½çš„ã€‚</p>
<p>  react 16 å¢åŠ äº†schedulerå¯¹æ—¶é—´ç‰‡è¿›è¡Œç®¡ç†ï¼Œåˆ†å‰²taskï¼Œç»™æ¯ä¸ªtaskï¼ˆå·¥ä½œå•å…ƒï¼‰ä¸€å®šçš„æ—¶é—´æ‰§è¡Œï¼Œæ—¶é—´åˆ°äº†æ²¡æ‰§è¡Œå®Œä¹Ÿè¦äº¤å‡ºæ‰§è¡Œæƒç»™åˆ°æµè§ˆå™¨è¿›è¡Œé‡ç»˜é‡æ’ã€‚è¿™ç§å¼‚æ­¥å¯ä¸­æ–­çš„æ•°æ®ç»“æ„å°±æ˜¯Fiberã€‚</p>
<p>  Fiberï¼š</p>
<ul>
<li><strong>å·¥ä½œå•å…ƒ ä»»åŠ¡åˆ†è§£</strong>ï¼šè¿™æ˜¯Fiberæœ€é‡è¦çš„å·¥ä½œï¼Œä¿å­˜èŠ‚ç‚¹å¯¹åº”çš„ä¿¡æ¯ï¼Œä»¥æŒ‡é’ˆçš„å½¢å¼å½¢æˆFiberæ ‘ã€‚</li>
<li><strong>å¢é‡æ¸²æŸ“</strong>ï¼šé€šè¿‡jsxå¯¹è±¡å’ŒCurrent Fiberè¿›è¡Œå¯¹æ¯”ï¼Œç”Ÿæˆæœ€å°çš„å·®å¼‚è¡¥ä¸ï¼Œåº”ç”¨åˆ°çœŸå®èŠ‚ç‚¹ä¸Šã€‚</li>
<li><strong>ä¿å­˜çŠ¶æ€</strong>ï¼šå› ä¸ºFiberèƒ½ä¿å­˜çŠ¶æ€å’Œæ›´æ–°çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å°±èƒ½å®ç°å‡½æ•°ç»„ä»¶çš„çŠ¶æ€æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯hooks</li>
<li><strong>æ ¹æ®ä¼˜å…ˆçº§æš‚åœã€ç»§ç»­ã€æ’åˆ—ä¼˜å…ˆçº§</strong>ï¼šFiberèŠ‚ç‚¹ä¸Šä¿å­˜äº†ä¼˜å…ˆçº§ï¼Œèƒ½é€šè¿‡ä¸åŒèŠ‚ç‚¹ä¼˜å…ˆçº§çš„å¯¹æ¯”è¾¾åˆ°æ­¤ç›®çš„ï¼Œä¹Ÿä¸ºä¸Šå±‚æ‰¹é‡æ›´æ–°ã€Suspenseæä¾›äº†åŸºç¡€ã€‚</li>
</ul>
<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FiberNode</span>(<span class="params">tag, pendingProps, key, mode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„ ä¿å­˜èŠ‚ç‚¹çš„ä¿¡æ¯ </span></span><br><span class="line">  <span class="keyword">this</span>.tag = tag; <span class="comment">// å¯¹åº”ç»„ä»¶çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">this</span>.key = key;</span><br><span class="line">  <span class="keyword">this</span>.elementType = <span class="literal">null</span>; <span class="comment">// å…ƒç´ ç±»å‹</span></span><br><span class="line">  <span class="keyword">this</span>.type = <span class="literal">null</span>; <span class="comment">// classæˆ–Function</span></span><br><span class="line">  <span class="keyword">this</span>.stateNode = <span class="literal">null</span>; <span class="comment">// Fiberï¼ŒçœŸå®DOMèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½œä¸ºfiberæ ‘æ¶æ„ è¿æ¥æˆfiberæ ‘</span></span><br><span class="line">  <span class="keyword">this</span>.return = <span class="literal">null</span>; <span class="comment">// æŒ‡å‘çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">this</span>.child = <span class="literal">null</span>; <span class="comment">// æŒ‡å‘å­©å­</span></span><br><span class="line">  <span class="keyword">this</span>.sibling = <span class="literal">null</span>; <span class="comment">// æŒ‡å‘å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">this</span>.index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">this</span>.ref = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½œä¸ºå·¥ä½œå•å…ƒ æ¥è®¡ç®—state</span></span><br><span class="line">  <span class="keyword">this</span>.pendingProps = pendingProps;</span><br><span class="line">  <span class="keyword">this</span>.memoizedProps = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.updateQueue = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.memoizedState = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.dependencies = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.mode = mode; <span class="comment">// Effects</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// effectç›¸å…³</span></span><br><span class="line">  <span class="keyword">this</span>.flags = NoFlags;</span><br><span class="line">  <span class="keyword">this</span>.nextEffect = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.firstEffect = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.lastEffect = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼˜å…ˆçº§ç›¸å…³</span></span><br><span class="line">  <span class="keyword">this</span>.lanes = NoLanes;</span><br><span class="line">  <span class="keyword">this</span>.childLanes = NoLanes;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// currentå’ŒworkInProgressçš„æŒ‡é’ˆ</span></span><br><span class="line">  <span class="keyword">this</span>.alternate = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>  <canvas id="fiber" width="600" height="460"></canvas>

<script>const oFiber = document.getElementById('fiber');const oFiberPen = oFiber.getContext('2d');oFiberPen.font = '14px sans-serif';oFiberPen.fillStyle='black';oFiberPen.strokeRect(150, 10, 100, 50);oFiberPen.strokeRect(150, 140, 100, 50);oFiberPen.strokeRect(150, 260, 100, 50);oFiberPen.strokeRect(150, 380, 100, 50);oFiberPen.strokeRect(460, 380, 100, 50);oFiberPen.beginPath();oFiberPen.lineTo(185, 60);oFiberPen.lineTo(185, 140);oFiberPen.lineTo(180, 135);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 140);oFiberPen.lineTo(190, 135);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 190);oFiberPen.lineTo(185, 260);oFiberPen.lineTo(180, 255);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 260);oFiberPen.lineTo(190, 255);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 310);oFiberPen.lineTo(185, 380);oFiberPen.lineTo(180, 375);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 380);oFiberPen.lineTo(190, 375);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 140);oFiberPen.lineTo(215, 60);oFiberPen.lineTo(210, 65);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 60);oFiberPen.lineTo(220, 65);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 260);oFiberPen.lineTo(215, 190);oFiberPen.lineTo(210, 195);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 190);oFiberPen.lineTo(220, 195);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 380);oFiberPen.lineTo(215, 310);oFiberPen.lineTo(210, 315);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 310);oFiberPen.lineTo(220, 315);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(250, 405);oFiberPen.lineTo(460, 405);oFiberPen.lineTo(455, 400);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(460, 405);oFiberPen.lineTo(455, 410);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(510, 380);oFiberPen.lineTo(250, 295);oFiberPen.lineTo(257, 302);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(250, 295);oFiberPen.lineTo(260, 296);oFiberPen.stroke();oFiberPen.fillText('rootFiber', 170, 40);oFiberPen.fillText('App', 188, 168);oFiberPen.fillText('h1', 193, 290);oFiberPen.fillText('p', 198, 408);oFiberPen.fillText('jyy', 503, 408);oFiberPen.fillText('child', 153, 105);oFiberPen.fillText('return ', 218, 105);oFiberPen.fillText('child', 153, 227);oFiberPen.fillText('return', 218, 227);oFiberPen.fillText('child', 153, 348);oFiberPen.fillText('return', 218, 348);oFiberPen.fillText('sibling', 340, 399);oFiberPen.fillText('return', 365, 330);</script>

<blockquote>
<p>åœ¨mountæ—¶ï¼šåˆ›å»ºfiberRootå’ŒrootFiberï¼Œç„¶åæ ¹æ®jsxåˆ›å»ºworkInProgress Fiberï¼ŒæŠŠworkInProgress Fiberåˆ‡æ¢æˆcurrent Fiberã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨updateæ—¶ï¼šä¼šæ ¹æ®æ–°çš„çŠ¶æ€å½¢æˆçš„jsxï¼ˆClassComponentçš„renderæˆ–è€…FuncComponentçš„è¿”å›å€¼ï¼‰å’Œcurrent Fiberå¯¹æ¯”å½¢ï¼ˆdiffç®—æ³•ï¼‰æˆä¸€æ£µworkInProgress Fiberæ ‘ï¼Œç„¶åå°†fiberRootçš„currentæŒ‡å‘workInProgressæ ‘ï¼Œæ­¤æ—¶workInProgresså°±å˜æˆäº†current Fiberã€‚</p>
</blockquote>
<pre><code>fiberRootï¼šæŒ‡æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œåªå­˜åœ¨ä¸€ä¸ª

rootFiberï¼šReactDOM.renderæˆ–è€…ReactDOM.unstable_createRootåˆ›å»ºå‡ºæ¥çš„åº”ç”¨çš„èŠ‚ç‚¹ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªã€‚
</code></pre><h2 id="renderé˜¶æ®µ"><a href="#renderé˜¶æ®µ" class="headerlink" title="renderé˜¶æ®µ"></a>renderé˜¶æ®µ</h2><pre><code>renderé˜¶æ®µçš„ä¸»è¦å·¥ä½œæ˜¯æ„å»ºFiberæ ‘å’Œç”ŸæˆeffectListé“¾è¡¨ã€‚
</code></pre><h3 id="reactå¯åŠ¨æ¨¡å¼"><a href="#reactå¯åŠ¨æ¨¡å¼" class="headerlink" title="reactå¯åŠ¨æ¨¡å¼"></a>reactå¯åŠ¨æ¨¡å¼</h3><pre><code>å‡ ä¸ªæœˆä¹‹å‰ï¼Œåˆšå¼€å§‹çœ‹reactæºç çš„æ—¶å€™ï¼Œæœ€æ–°ç‰ˆæœ¬è¿˜æ˜¯17.0.2ï¼Œç°åœ¨ï¼ˆ2021-11-04ï¼‰React 18ç‰ˆæœ¬å°±å·²ç»å‘å¸ƒäº† Alpha ç‰ˆæœ¬ã€‚

React 18 å¸¦æ¥äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å‚çœ‹å®˜ç½‘çš„[å‘å¸ƒè®¡åˆ’](https://zh-hans.reactjs.org/blog/2021/06/08/the-plan-for-react-18.html)ã€‚

è¿™é‡Œå¯¹18æ¯”è¾ƒæ„Ÿå…´è¶£çš„æ˜¯å¹¶å‘æ¸²æŸ“ï¼ˆconcurrent renderingï¼‰æœºåˆ¶ï¼Œåªæœ‰ç”±æ–°ç‰¹æ€§è§¦å‘çš„æ›´æ–°ä¼šå¯ç”¨å¹¶å‘æ¸²æŸ“ã€‚å¦‚æœæ²¡ç”¨åˆ°æ–°å±æ€§ï¼Œå³ä½¿ç”¨äº†ReactDOM.createRoot(rootNode).render(...)ï¼Œä¹Ÿä¼šèµ°åŸè·¯ã€‚

è¯•ç€ç”¨äº†ä¸€ä¸‹react 18ç‰ˆæœ¬ï¼ŒreactDom.renderä¼šæŠ¥Warningï¼šReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it&apos;s running React 17ã€‚

è¿™å°±æ˜¯reactæ–°çš„å¯åŠ¨æ¨¡å¼ï¼š
1ï¼‰legacy æ¨¡å¼ï¼š ReactDOM.render(&lt;App /&gt;, rootNode)ã€‚åœ¨react18ä¸­ä½¿ç”¨è¿™ç§æ¨¡å¼ä¸react17å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ä¼šæœ‰ä¸€æ¡è­¦å‘Šï¼Œè¡¨æ˜å®ƒå·²è¢«å¼ƒç”¨å¹¶åˆ‡æ¢åˆ°æ–°çš„ Root APIã€‚
2ï¼‰concurrent æ¨¡å¼ï¼š ReactDOM.createRoot(rootNode).render(&lt;App /&gt;)ã€‚å¹¶å‘æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å¼€å¯äº†æ‰€æœ‰çš„æ–°åŠŸèƒ½ã€‚




è¿˜å‘ç°ä¸€ä¸ªhydrateRootï¼Œä¸çŸ¥é“æ˜¯åšä»€ä¹ˆçš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥å’ŒcreateRootå¾ˆåƒï¼Œä¹Ÿå¯ä»¥è¿™æ ·ç”¨ï¼Œæ¸²æŸ“é¡µé¢ï¼š
ReactDOM.hydrateRoot(rootNode).render(&lt;App /&gt;);æš‚ç•™
</code></pre><h4 id="ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹"><a href="#ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹"></a>ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹</h4>  <canvas id="primary-progress" width="500" height="400"></canvas>

  <script>
    const oMain = document.getElementById('primary-progress');
    const oMainPen = oMain.getContext('2d');oMainPen.font = '14px sans-serif';oMainPen.strokeRect(92, 10, 320, 30);oMainPen.strokeRect(30, 80, 450, 30);oMainPen.strokeRect(93, 150, 316, 30);oMainPen.strokeRect(10, 220, 480, 30);oMainPen.strokeRect(160, 290, 180, 30);oMainPen.fillText('createContainerï¼ˆåˆ›å»ºfiberRootNodeã€rootFiberï¼‰', 96, 30);oMainPen.fillText('updateContainerï¼ˆåˆ›å»ºupdateå¯¹è±¡ï¼Œä¿å­˜åœ¨updateQueueç¯çŠ¶é“¾è¡¨ä¸­ï¼‰', 34, 100);oMainPen.fillText('scheduleUpdateOnFiberï¼ˆåœ¨Fiberä¸Šè°ƒåº¦updateï¼‰', 95, 163);oMainPen.fillText('ensureRootIsScheduledï¼ˆè°ƒåº¦æ ¹èŠ‚ç‚¹ï¼‰', 125, 177);oMainPen.fillText('commitRootï¼ˆcommité˜¶æ®µï¼‰', 164, 310);oMainPen.fillStyle='blue';oMainPen.fillText('performSyncWorkOnRoot | performConcurrentWorkOnRootï¼ˆrenderé˜¶æ®µï¼‰', 12, 240);oMainPen.fillStyle='black';oMainPen.beginPath();oMainPen.lineTo(252, 40);oMainPen.lineTo(252, 75);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 75);oMainPen.lineTo(256, 75);oMainPen.lineTo(252, 80);oMainPen.closePath();oMainPen.fill();oMainPen.beginPath();oMainPen.lineTo(252, 110);oMainPen.lineTo(252, 145);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 145);oMainPen.lineTo(256, 145);oMainPen.lineTo(252, 150);oMainPen.closePath();oMainPen.fill();oMainPen.beginPath();oMainPen.lineTo(252, 180);oMainPen.lineTo(252, 215);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 215);oMainPen.lineTo(256, 215);oMainPen.lineTo(252, 220);oMainPen.closePath();oMainPen.fill();oMainPen.beginPath();oMainPen.lineTo(252, 250);oMainPen.lineTo(252, 285);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 285);oMainPen.lineTo(256, 285);oMainPen.lineTo(252, 290);oMainPen.closePath();oMainPen.fill();
  </script>

<h4 id="legacyæ¨¡å¼"><a href="#legacyæ¨¡å¼" class="headerlink" title="legacyæ¨¡å¼"></a>legacyæ¨¡å¼</h4><p>  renderè°ƒç”¨legacyRenderSubtreeIntoContainerï¼ŒcreateContainerè°ƒç”¨createFiberRootåˆ›å»ºfiberRootNodeï¼Œè°ƒç”¨createHostRootFiberåˆ›å»ºrootFiberã€‚å…¶ä¸­fiberRootNodeæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ï¼ŒrootFiberæ˜¯å½“å‰åº”ç”¨æŒ‚è½½çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ReactDom.renderè°ƒç”¨åçš„æ ¹èŠ‚ç‚¹ã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€ä¸Šå±‚çš„èŠ‚ç‚¹æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹fiberRootNode</span></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.getElementById("root")); // rootFiber</span><br><span class="line"></span><br><span class="line">fiberRootNode.current = rootFiber;</span><br><span class="line">rootFiber.stateNode = fiberRootNode;</span><br></pre></td></tr></table></figure></p>
<p>  åˆ›å»ºå®ŒfiberèŠ‚ç‚¹åï¼ŒlegacyRenderSubtreeIntoContainerè°ƒç”¨updateContaineråˆ›å»ºUpdateå¯¹è±¡æŒ‚è½½åˆ°updateQueueç¯çŠ¶é“¾è¡¨ä¸Šï¼Œç„¶åæ‰§è¡ŒscheduleUpdateOnFiberè°ƒç”¨performSyncWorkOnRootè¿›å…¥renderé˜¶æ®µå’Œcommité˜¶æ®µã€‚</p>
<h4 id="concurrentæ¨¡å¼"><a href="#concurrentæ¨¡å¼" class="headerlink" title="concurrentæ¨¡å¼"></a>concurrentæ¨¡å¼</h4><p>  createRootè°ƒç”¨createContaineråˆ›å»ºfiberRootNodeå’ŒrootFiberã€‚åˆ›å»ºå®ŒfiberèŠ‚ç‚¹åï¼Œreturn new ReactDOMRoot(root); è°ƒç”¨ReactDOMRoot.propertype.renderæ‰§è¡ŒupdateContainerï¼Œç„¶åå¼‚æ­¥è°ƒåº¦scheduleUpdateOnFiberï¼ŒperformConcurrentWorkOnRootè¿›å…¥renderé˜¶æ®µå’Œcommité˜¶æ®µã€‚</p>
<h4 id="ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹"><a href="#ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹" class="headerlink" title="ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹"></a>ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹</h4><p>  1ï¼‰createContainerä¸­ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°tagä¸ä¸€æ · ä¸€ä¸ªæ˜¯LegacyRoot 0ï¼Œä¸€ä¸ªæ˜¯ConcurrentRoot 1ã€‚<br>  2ï¼‰requestUpdateLaneä¸­è·å–çš„laneçš„ä¼˜å…ˆçº§ä¸åŒã€‚<br>  3) åœ¨å‡½æ•°scheduleUpdateOnFiberä¸­æ ¹æ®ä¸åŒä¼˜å…ˆçº§è¿›å…¥ä¸åŒåˆ†æ”¯ï¼Œlegacyæ¨¡å¼è¿›å…¥performSyncWorkOnRootï¼Œconcurrentæ¨¡å¼ <strong>å¼‚æ­¥è°ƒåº¦</strong> performConcurrentWorkOnRootã€‚</p>
<h3 id="ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹"><a href="#ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹"></a>ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹</h3>  <canvas id="renderTransfer" width="650" height="600"></canvas>

  <script>const oRenderTransfer = document.getElementById('renderTransfer');const oRenderTransferPen = oRenderTransfer.getContext('2d');oRenderTransferPen.font = '12px sans-serif';oRenderTransferPen.fillStyle='black';oRenderTransferPen.fillText('Lagacy', 205, 15);oRenderTransferPen.fillText('Concurrent', 412, 15);oRenderTransferPen.fillText('render', 210, 50);oRenderTransferPen.fillText('createRoot', 408, 50);oRenderTransferPen.fillText('ReactDOMRoot.prototype.render', 360, 191);oRenderTransferPen.fillText('createUpdate', 50, 270);oRenderTransferPen.fillText('enqueueUpdate', 160, 270);oRenderTransferPen.fillText('ensureRootIsScheduled', 270, 270);oRenderTransferPen.fillText('root.tag === LegacyRoot', 146, 315);oRenderTransferPen.fillText('performSyncWorkOnRoot', 142, 385);oRenderTransferPen.fillText('performConcurrentWorkOnRoot', 380, 385);oRenderTransferPen.fillText('rederRootSync', 165, 425);oRenderTransferPen.fillText('renderRootConcurrent', 400, 425);oRenderTransferPen.fillText('workLoopSync', 170, 460);oRenderTransferPen.fillText('workLoopConcurrent', 430, 460);oRenderTransferPen.fillText('performUnitWork', 286, 492);oRenderTransferPen.fillText('beginWork', 198, 535);oRenderTransferPen.fillText('completeWork', 402, 535);oRenderTransferPen.fillText('.', 333, 555);oRenderTransferPen.fillText('.', 333, 558);oRenderTransferPen.fillText('.', 333, 561);oRenderTransferPen.fillText('.', 333, 564);oRenderTransferPen.fillText('.', 333, 567);oRenderTransferPen.fillText('.', 333, 570);oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 20);oRenderTransferPen.lineTo(225, 35);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(221, 35);oRenderTransferPen.lineTo(229, 35);oRenderTransferPen.lineTo(225, 40);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 20);oRenderTransferPen.lineTo(442, 35);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(438, 35);oRenderTransferPen.lineTo(446, 35);oRenderTransferPen.lineTo(442, 40);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 55);oRenderTransferPen.lineTo(225, 80);oRenderTransferPen.lineTo(270, 80);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(270, 76);oRenderTransferPen.lineTo(270, 84);oRenderTransferPen.lineTo(275, 80);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 55);oRenderTransferPen.lineTo(442, 80);oRenderTransferPen.lineTo(392, 80);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(392, 76);oRenderTransferPen.lineTo(392, 84);oRenderTransferPen.lineTo(387, 80);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(334, 86);oRenderTransferPen.lineTo(334, 93);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(331, 93);oRenderTransferPen.lineTo(337, 93);oRenderTransferPen.lineTo(334, 97);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(334, 108);oRenderTransferPen.lineTo(334, 115);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(331, 115);oRenderTransferPen.lineTo(337, 115);oRenderTransferPen.lineTo(334, 120);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 80);oRenderTransferPen.lineTo(225, 156);oRenderTransferPen.lineTo(278, 156);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(278, 153);oRenderTransferPen.lineTo(278, 159);oRenderTransferPen.lineTo(281, 156);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 80);oRenderTransferPen.lineTo(442, 156);oRenderTransferPen.lineTo(389, 156);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(389, 153);oRenderTransferPen.lineTo(389, 159);oRenderTransferPen.lineTo(386, 156);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 156);oRenderTransferPen.lineTo(225, 217);oRenderTransferPen.lineTo(270, 217);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(270, 212);oRenderTransferPen.lineTo(270, 222);oRenderTransferPen.lineTo(275, 217);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 156);oRenderTransferPen.lineTo(442, 178);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(438, 178);oRenderTransferPen.lineTo(446, 178);oRenderTransferPen.lineTo(442, 182);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 192);oRenderTransferPen.lineTo(442, 217);oRenderTransferPen.lineTo(400, 217);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(400, 212);oRenderTransferPen.lineTo(400, 222);oRenderTransferPen.lineTo(395, 217);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 222);oRenderTransferPen.lineTo(335, 240);oRenderTransferPen.lineTo(90, 240);oRenderTransferPen.lineTo(90, 253);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(87, 253);oRenderTransferPen.lineTo(93, 253);oRenderTransferPen.lineTo(90, 258);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(205, 240);oRenderTransferPen.lineTo(205, 253);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(202, 253);oRenderTransferPen.lineTo(208, 253);oRenderTransferPen.lineTo(205, 258);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 240);oRenderTransferPen.lineTo(335, 253);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(332, 253);oRenderTransferPen.lineTo(338, 253);oRenderTransferPen.lineTo(335, 258);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 272);oRenderTransferPen.lineTo(335, 290);oRenderTransferPen.lineTo(205, 290);oRenderTransferPen.lineTo(205, 300);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(202, 300);oRenderTransferPen.lineTo(208, 300);oRenderTransferPen.lineTo(205, 305);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 290);oRenderTransferPen.lineTo(465, 290);oRenderTransferPen.lineTo(465, 370);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(462, 370);oRenderTransferPen.lineTo(468, 370);oRenderTransferPen.lineTo(465, 375);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(200, 320);oRenderTransferPen.lineTo(180, 340);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(210, 320);oRenderTransferPen.lineTo(230, 340);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(180, 355);oRenderTransferPen.lineTo(200, 372);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(230, 355);oRenderTransferPen.lineTo(210, 372);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(206, 388);oRenderTransferPen.lineTo(206, 408);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(203, 408);oRenderTransferPen.lineTo(209, 408);oRenderTransferPen.lineTo(206, 412);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 388);oRenderTransferPen.lineTo(465, 408);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(462, 408);oRenderTransferPen.lineTo(468, 408);oRenderTransferPen.lineTo(465, 412);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 398);oRenderTransferPen.lineTo(256, 421);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(256, 418);oRenderTransferPen.lineTo(258, 424);oRenderTransferPen.lineTo(250, 422);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(206, 428);oRenderTransferPen.lineTo(206, 448);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(203, 448);oRenderTransferPen.lineTo(209, 448);oRenderTransferPen.lineTo(206, 452);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 428);oRenderTransferPen.lineTo(465, 448);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(462, 448);oRenderTransferPen.lineTo(468, 448);oRenderTransferPen.lineTo(465, 452);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(206, 463);oRenderTransferPen.lineTo(206, 488);oRenderTransferPen.lineTo(275, 488);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(275, 484);oRenderTransferPen.lineTo(275, 492);oRenderTransferPen.lineTo(279, 488);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 463);oRenderTransferPen.lineTo(465, 488);oRenderTransferPen.lineTo(391, 488);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(391, 484);oRenderTransferPen.lineTo(391, 492);oRenderTransferPen.lineTo(387, 488);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 494);oRenderTransferPen.lineTo(335, 510);oRenderTransferPen.lineTo(225, 510);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 510);oRenderTransferPen.lineTo(442, 510);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 510);oRenderTransferPen.lineTo(225, 520);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(221, 520);oRenderTransferPen.lineTo(229, 520);oRenderTransferPen.lineTo(225, 525);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 510);oRenderTransferPen.lineTo(442, 520);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(438, 520);oRenderTransferPen.lineTo(446, 520);oRenderTransferPen.lineTo(442, 525);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.font = '8px sans-serif';oRenderTransferPen.fillText('ä¼ å‚ä¸åŒ', 235, 214);oRenderTransferPen.fillText('ä¼ å‚ä¸åŒ', 403, 214);oRenderTransferPen.fillText('createFiberRoot', 302, 106);oRenderTransferPen.fillText('createHostFoorFiber', 298, 126);oRenderTransferPen.fillText('listenToAllSupportedEvents', 283, 158);oRenderTransferPen.fillText('åˆ›å»ºupdateå¯¹è±¡', 57, 280);oRenderTransferPen.fillText('ä¿å­˜åœ¨updateQueueç¯çŠ¶é“¾è¡¨ä¸Š', 145, 280);oRenderTransferPen.fillText('æ˜¯', 180, 330);oRenderTransferPen.fillText('å¦', 223, 330);oRenderTransferPen.fillText('åŒæ­¥è°ƒç”¨', 160, 350);oRenderTransferPen.fillText('å¼‚æ­¥è°ƒç”¨', 220, 350);oRenderTransferPen.fillText('å¼‚æ­¥è°ƒç”¨', 470, 350);oRenderTransferPen.fillText('æ˜¯å¦ä½¿ç”¨äº†æ–°åŠŸèƒ½', 470, 394);oRenderTransferPen.fillText('æ˜¯', 470, 412);oRenderTransferPen.fillText('å¦', 420, 399);oRenderTransferPen.fillText('workOnProgress !== null', 110, 480);oRenderTransferPen.fillText('workOnProgress !== null && !shouldYield()', 470, 480);oRenderTransferPen.font = '14px sans-serif';oRenderTransferPen.fillStyle='red';oRenderTransferPen.fillText('createContainer', 278, 85);oRenderTransferPen.fillText('updateContainer', 281, 221);</script>


<pre><code>ä¸¤ç§å¯åŠ¨æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸€èµ·å›é¡¾ä¸€ä¸‹ã€‚é«˜è§’åº¦åœ°æ¥çœ‹å°±æ˜¯createContainerå’ŒupdateContainerã€‚
1ï¼‰åˆšå¼€å§‹æ˜¯è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼ŒcreateContaineråˆ›å»ºfiberRootå’ŒrootFiberï¼ˆæœ‰æ—¶é—´ä»”ç»†çœ‹ä¸€ä¸‹è¿™é‡Œï¼‰ï¼Œç»‘å®šä¸Šæ‰€æœ‰æ”¯æŒçš„å‡½æ•°ï¼Œè¿™ä¸€æ­¥ä¸¤ç§æ¨¡å¼æ˜¯ç›¸åŒçš„ï¼ŒLegacyæ˜¯è°ƒç”¨æš´éœ²å‡ºçš„renderå‡½æ•°ï¼ŒConcurrentæ˜¯è°ƒç”¨æš´éœ²å‡ºçš„createRootå‡½æ•°ã€‚
2ï¼‰ä¸‹ä¸€æ­¥å°±æ˜¯updateContainerï¼Œä¹‹åçš„renderé˜¶æ®µä»¥åŠcommité˜¶æ®µéƒ½æ˜¯åœ¨å…¶ä¸­è°ƒç”¨æˆ–è¿æ¥ã€‚æˆ‘ä»¬å…ˆçœ‹renderé˜¶æ®µï¼Œè¿™æ—¶ä¸¤ç§æ¨¡å¼éƒ½è°ƒç”¨äº†updateContainerï¼ŒLegacyæ˜¯ä¹‹å‰renderå‡½æ•°è°ƒç”¨ï¼ŒConcurrentæ˜¯å†æ¬¡è°ƒç”¨createRootå‡½æ•°è¿”å›çš„new ReactDOMRootçš„åŸå‹ä¸Šçš„renderæ–¹æ³•è°ƒç”¨ï¼ŒäºŒè€…ä¼ å‚ä¸åŒã€‚updateContaineré¦–å…ˆè°ƒç”¨createUpdateåˆ›å»ºupdateå¯¹è±¡ï¼Œå†è°ƒç”¨enqueueUpdateå°†å…¶ä¿å­˜åœ¨updateQueueç¯çŠ¶é“¾è¡¨ä¸Šï¼Œæœ€åè°ƒç”¨ensureRootIsScheduledï¼ŒensureRootIsScheduledä¼šæ ¹æ®ä¹‹å‰Legacyå’ŒConcurrentä¼ å‚çš„ä¸åŒï¼Œæœ‰ä¸åŒçš„å¤„ç†ã€‚Legacyè¿™è¾¹ä¼šåˆ¤æ–­root.tagæ˜¯å¦ç­‰äºLegacyRootï¼Œå¦‚æœç›¸ç­‰åˆ™åŒæ­¥è°ƒç”¨performSyncWorkOnRootï¼Œå¦åˆ™å¼‚æ­¥è°ƒç”¨performSyncWorkOnRootï¼Œè€ŒConcurrentè¿™è¾¹æ˜¯ç›´æ¥å¼‚æ­¥è°ƒç”¨performConcurrentWorkOnRootã€‚æ¥ä¸‹æ¥performSyncWorkOnRootä¼šè°ƒç”¨renderRootSync,è€ŒperformConcurrentWorkOnRootè¿™æ—¶ä¼šåˆ¤æ–­ï¼Œæ˜¯å¦è°ƒç”¨äº†æ–°çš„åŠŸèƒ½ç‰¹æ€§ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šè°ƒç”¨renderRootSyncï¼Œèµ°å›Legacyçš„æ¨¡å¼ã€‚å¦‚æœä½¿ç”¨äº†æ–°çš„åŠŸèƒ½ç‰¹æ€§æ‰ä¼šè°ƒç”¨renderRootConcurrentã€‚renderRootSyncå’ŒrenderRootConcurrentéƒ½å›è°ƒç”¨prepareFreshStackï¼Œè¿™é‡Œå¾ˆé‡è¦ï¼ŒprepareFreshStackä¼šç”Ÿæˆæ–°çš„workInProgressçš„Fiberå¯¹è±¡ï¼Œç„¶årenderRootSyncä¼šè°ƒç”¨workLoopSyncï¼ŒrenderRootConcurrentä¼šè°ƒç”¨workLoopConcurrentï¼ŒworkLoopSyncå’ŒworkLoopConcurrentäºŒè€…éƒ½ä¼šLoopè°ƒç”¨performUnitOfWorkï¼Œåªæ˜¯è°ƒç”¨çš„æ¡ä»¶æœ‰ä¸€ç‚¹ä¸åŒï¼ŒworkLoopSyncçš„åœæ­¢æ¡ä»¶åªæœ‰workInProgress===nullï¼Œè€Œï¼ŒworkLoopConcurrentçš„åœæ­¢æ¡ä»¶æ˜¯workInProgress === nullæˆ–shouldYield()ï¼Œä¹Ÿå°±æ˜¯ä¸ä»…workInProgressä¸ºnullæ—¶ä¼šåœä¸‹æ¥ï¼Œå½“æµè§ˆå™¨æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´çš„æ—¶å€™ä¹Ÿä¼šåœä¸‹æ¥ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¼‚æ­¥å¯ä¸­æ–­æœºåˆ¶ä¸­çš„å¯ä¸­æ–­å®ç°ã€‚ä¹‹åperformUnitOfWorkä¼šè°ƒç”¨beginWorkå’ŒcompleteWorkå®Œæˆåè°ƒå’Œè°ƒåº¦çš„è¿‡ç¨‹ï¼Œç„¶åå°†è°ƒåº¦ç»“æœä¼ ç»™commitRootå‡½æ•°ï¼Œè¿›å…¥commité˜¶æ®µã€‚renderé˜¶æ®µçš„ä»beginWorkå’ŒcompleteWorkåˆ°commitRootçš„è¯¦ç»†å­¦ä¹ ï¼Œæ”¾åœ¨ä¸‹é¢ã€‚
</code></pre><h3 id="renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹"><a href="#renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹"></a>renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹</h3><ul>
<li>workInProgressï¼šæ–°åˆ›å»ºçš„workInProgress Fiber</li>
<li>performUnitOfWorkï¼šworkInprogress å’Œ å·²ç»åˆ›å»ºçš„Fiberè¿æ¥å½¢æˆfiberæ ‘ï¼Œè¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºæ·±åº¦ä¼˜åŒ–éå†ã€‚</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  React.createElement(</span><br><span class="line">    &apos;div&apos;, </span><br><span class="line">    &#123;key: &apos;name&apos;&#125;, </span><br><span class="line">    [React.createElement(&apos;h1&apos;, &#123;key: &apos;num&apos;&#125;, 123), &apos;jyy&apos;]), </span><br><span class="line">  document.getElementById(&quot;root&quot;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
  <canvas id="performUnitOfWork" width="600" height="460"></canvas>

<script>
  const oPerformUnitOfWork = document.getElementById('performUnitOfWork');
  const oPerformUnitOfWorkPen = oPerformUnitOfWork.getContext('2d');
  oPerformUnitOfWorkPen.font = '14px sans-serif';oPerformUnitOfWorkPen.fillStyle='black';oPerformUnitOfWorkPen.strokeRect(150, 10, 100, 50);oPerformUnitOfWorkPen.strokeRect(150, 140, 100, 50);oPerformUnitOfWorkPen.strokeRect(150, 260, 100, 50);oPerformUnitOfWorkPen.strokeRect(150, 380, 100, 50);oPerformUnitOfWorkPen.strokeRect(460, 260, 100, 50);oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 60);oPerformUnitOfWorkPen.lineTo(185, 140);oPerformUnitOfWorkPen.lineTo(180, 135);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 140);oPerformUnitOfWorkPen.lineTo(190, 135);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 190);oPerformUnitOfWorkPen.lineTo(185, 260);oPerformUnitOfWorkPen.lineTo(180, 255);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 260);oPerformUnitOfWorkPen.lineTo(190, 255);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 310);oPerformUnitOfWorkPen.lineTo(185, 380);oPerformUnitOfWorkPen.lineTo(180, 375);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 380);oPerformUnitOfWorkPen.lineTo(190, 375);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 140);oPerformUnitOfWorkPen.lineTo(215, 60);oPerformUnitOfWorkPen.lineTo(210, 65);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 60);oPerformUnitOfWorkPen.lineTo(220, 65);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 260);oPerformUnitOfWorkPen.lineTo(215, 190);oPerformUnitOfWorkPen.lineTo(210, 195);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 190);oPerformUnitOfWorkPen.lineTo(220, 195);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 380);oPerformUnitOfWorkPen.lineTo(215, 310);oPerformUnitOfWorkPen.lineTo(210, 315);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 310);oPerformUnitOfWorkPen.lineTo(220, 315);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(250, 295);oPerformUnitOfWorkPen.lineTo(460, 295);oPerformUnitOfWorkPen.lineTo(455, 290);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(460, 295);oPerformUnitOfWorkPen.lineTo(455, 300);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(510, 260);oPerformUnitOfWorkPen.lineTo(250, 175);oPerformUnitOfWorkPen.lineTo(257, 182);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(250, 175);oPerformUnitOfWorkPen.lineTo(260, 176);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.fillText('rootFiber', 170, 40);oPerformUnitOfWorkPen.fillText('div.name', 168, 168);oPerformUnitOfWorkPen.fillText('h1.num', 178, 290);oPerformUnitOfWorkPen.fillText('123', 189, 408);oPerformUnitOfWorkPen.fillText('jyy', 503, 288);oPerformUnitOfWorkPen.fillText('child', 153, 105);oPerformUnitOfWorkPen.fillText('return ', 218, 105);oPerformUnitOfWorkPen.fillText('child', 153, 227);oPerformUnitOfWorkPen.fillText('return', 218, 227);oPerformUnitOfWorkPen.fillText('sibling', 280, 310);oPerformUnitOfWorkPen.fillText('return', 365, 210);oPerformUnitOfWorkPen.fillStyle='#F612E3';oPerformUnitOfWorkPen.fillText('1.beginWork', 60, 40);oPerformUnitOfWorkPen.fillText('2.beginWork', 60, 168);oPerformUnitOfWorkPen.fillText('3-1.beginWork', 50, 290);oPerformUnitOfWorkPen.fillText('4-1.beginWork', 360, 270);oPerformUnitOfWorkPen.fillStyle='#3CF612';oPerformUnitOfWorkPen.fillText('3-2.completeWork', 255, 290);oPerformUnitOfWorkPen.fillText('4-2.completeWork', 470, 240);oPerformUnitOfWorkPen.fillText('4-3.completeWork', 255, 168);oPerformUnitOfWorkPen.fillText('4-4.completeWork', 255, 40);
</script>


<ol>
<li><p><code>beginWorké˜¶æ®µ</code> ä»æ ¹èŠ‚ç‚¹rootFiberå¼€å§‹ï¼Œéå†åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ¯æ¬¡éå†åˆ°çš„èŠ‚ç‚¹éƒ½ä¼šæ‰§è¡ŒbeginWorkï¼Œå¹¶ä¸”ä¼ å…¥å½“å‰FiberèŠ‚ç‚¹ï¼Œç„¶ååˆ›å»ºæˆ–å¤ç”¨å®ƒçš„å­FiberèŠ‚ç‚¹ï¼Œå¹¶èµ‹å€¼ç»™workInProgress.childã€‚</p>
</li>
<li><p><code>completeWorké˜¶æ®µ</code> åœ¨æ•è·é˜¶æ®µéå†åˆ°å­èŠ‚ç‚¹ä¹‹åï¼Œä¼šæ‰§è¡ŒcompleteWorkæ–¹æ³•ï¼Œæ‰§è¡Œå®Œæˆä¹‹åä¼šåˆ¤æ–­æ­¤èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ä¼šä¸ºå…„å¼ŸèŠ‚ç‚¹æ‰§è¡ŒcompleteWorkï¼Œå½“å…¨éƒ¨å…„å¼ŸèŠ‚ç‚¹æ‰§è¡Œå®Œä¹‹åï¼Œä¼šå‘ä¸Šâ€˜å†’æ³¡â€™åˆ°çˆ¶èŠ‚ç‚¹æ‰§è¡ŒcompleteWorkï¼Œç›´åˆ°rootFiberã€‚</p>
</li>
</ol>
  <div class="post-warning">æ³¨æ„ï¼šå½“éå†åˆ°åªæœ‰ä¸€ä¸ªå­æ–‡æœ¬èŠ‚ç‚¹çš„Fiberæ—¶ï¼Œè¯¥FiberèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ä¼šæ‰§è¡ŒbeginWorkå’ŒcompleteWorkï¼Œå¦‚å›¾ä¸­çš„â€˜countâ€™æ–‡æœ¬èŠ‚ç‚¹ã€‚è¿™æ˜¯reactçš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µ</div>

<ul>
<li>renderé˜¶æ®µæ•´ä½“è°ƒç”¨æµç¨‹ï¼š</li>
</ul>
  <canvas id="render" width="700" height="530"></canvas>


  <script>var oRender = document.getElementById('render');var oRenderPen = oRender.getContext('2d');oRenderPen.font = '10px sans-serif';oRenderPen.strokeRect(159, 10, 130, 30);oRenderPen.fillText('performSyncWorkOnRoot', 165, 28);oRenderPen.beginPath();oRenderPen.lineTo(224, 40);oRenderPen.lineTo(224, 54);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(220, 54);oRenderPen.lineTo(228, 54);oRenderPen.lineTo(224, 59);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(320, 10, 158, 30);oRenderPen.fillText('performConcurrentWorkOnRoot', 325, 28);oRenderPen.beginPath();oRenderPen.lineTo(398, 40);oRenderPen.lineTo(398, 54);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(394, 54);oRenderPen.lineTo(402, 54);oRenderPen.lineTo(398, 59);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(185, 60, 80, 30);oRenderPen.fillText('workLoopSync', 192, 78);oRenderPen.beginPath();oRenderPen.lineTo(265, 75);oRenderPen.lineTo(285, 75);oRenderPen.lineTo(285, 104);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(281, 104);oRenderPen.lineTo(289, 104);oRenderPen.lineTo(285, 109);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(340, 60, 110, 30);oRenderPen.fillText('workLoopConcurrent', 347, 78);oRenderPen.beginPath();oRenderPen.lineTo(340, 75);oRenderPen.lineTo(320, 75);oRenderPen.lineTo(320, 104);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(316, 104);oRenderPen.lineTo(324, 104);oRenderPen.lineTo(320, 109);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(253, 110, 100, 30);oRenderPen.fillText('performUnitOfWork', 257, 128);oRenderPen.beginPath();oRenderPen.lineTo(253, 125);oRenderPen.lineTo(224, 125);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(224, 121);oRenderPen.lineTo(224, 129);oRenderPen.lineTo(219, 125);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(160, 110, 58, 30);oRenderPen.fillText('beginWork', 164, 128);oRenderPen.beginPath();oRenderPen.lineTo(189, 140);oRenderPen.lineTo(189, 155);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(185, 155);oRenderPen.lineTo(193, 155);oRenderPen.lineTo(189, 160);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(189, 160);oRenderPen.lineTo(244, 185);oRenderPen.lineTo(189, 210);oRenderPen.lineTo(134, 185);oRenderPen.closePath();oRenderPen.fillText('current !== null', 152, 182);oRenderPen.fillText('update | mount', 154, 193);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(134, 185);oRenderPen.lineTo(70, 185);oRenderPen.lineTo(70, 220);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 220);oRenderPen.lineTo(74, 220);oRenderPen.lineTo(70, 225);oRenderPen.closePath();oRenderPen.fill();oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(244, 185);oRenderPen.lineTo(342, 185);oRenderPen.lineTo(342, 250);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(338, 250);oRenderPen.lineTo(346, 250);oRenderPen.lineTo(342, 255);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(70, 225);oRenderPen.lineTo(108, 240);oRenderPen.lineTo(70, 255);oRenderPen.lineTo(32, 240);oRenderPen.closePath();oRenderPen.stroke();oRenderPen.fillText('æ˜¯å¦èƒ½å¤ç”¨', 44, 243);oRenderPen.beginPath();oRenderPen.lineTo(108, 240);oRenderPen.lineTo(262, 240);oRenderPen.lineTo(262, 250);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(258, 250);oRenderPen.lineTo(266, 250);oRenderPen.lineTo(262, 255);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(70, 255);oRenderPen.lineTo(70, 275);oRenderPen.lineTo(70, 275);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 275);oRenderPen.lineTo(74, 275);oRenderPen.lineTo(70, 280);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(1, 280, 144, 30);oRenderPen.fillText('bailoutOnAlreadyFinishedWork', 2, 298);oRenderPen.beginPath();oRenderPen.lineTo(70, 310);oRenderPen.lineTo(70, 340);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 340);oRenderPen.lineTo(74, 340);oRenderPen.lineTo(70, 345);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(70, 345);oRenderPen.lineTo(128, 360);oRenderPen.lineTo(70, 375);oRenderPen.lineTo(12, 360);oRenderPen.closePath();oRenderPen.stroke();oRenderPen.fillText('èŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°', 31, 364);oRenderPen.beginPath();oRenderPen.lineTo(70, 375);oRenderPen.lineTo(70, 395);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 395);oRenderPen.lineTo(74, 395);oRenderPen.lineTo(70, 400);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(30, 400, 82, 30);oRenderPen.fillText('cloneChildFibers', 31, 418);oRenderPen.beginPath();oRenderPen.lineTo(128, 360);oRenderPen.lineTo(142, 360);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(142, 356);oRenderPen.lineTo(142, 364);oRenderPen.lineTo(147, 360);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(147, 344, 50, 30);oRenderPen.fillText('return null', 148, 362);oRenderPen.strokeRect(236, 255, 128, 30);oRenderPen.fillText('æ ¹æ®workInProgress.tagè¿›å…¥', 236, 268);oRenderPen.fillText('ä¸åŒçš„Fiberåˆ›å»ºå‡½æ•°', 254, 280);oRenderPen.beginPath();oRenderPen.lineTo(262, 285);oRenderPen.lineTo(262, 315);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(258, 315);oRenderPen.lineTo(266, 315);oRenderPen.lineTo(262, 320);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(342, 285);oRenderPen.lineTo(342, 315);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(338, 315);oRenderPen.lineTo(346, 315);oRenderPen.lineTo(342, 320);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(202, 320, 96, 30);oRenderPen.fillText('reconcileChildFibers', 203, 338);oRenderPen.strokeRect(310, 320, 82, 30);oRenderPen.fillText('mountchildFibers', 312, 338);oRenderPen.beginPath();oRenderPen.lineTo(262, 350);oRenderPen.lineTo(262, 375);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(258, 375);oRenderPen.lineTo(266, 375);oRenderPen.lineTo(262, 380);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(342, 350);oRenderPen.lineTo(342, 375);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(338, 375);oRenderPen.lineTo(346, 375);oRenderPen.lineTo(342, 380);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(258, 380, 90, 30);oRenderPen.fillText('childReconclier', 268, 398);oRenderPen.strokeRect(272, 430, 64, 30);oRenderPen.fillText('createFibers', 275, 448);oRenderPen.beginPath();oRenderPen.lineTo(302, 410);oRenderPen.lineTo(302, 425);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(298, 425);oRenderPen.lineTo(306, 425);oRenderPen.lineTo(302, 430);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(353, 125);oRenderPen.lineTo(365, 125);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(365, 121);oRenderPen.lineTo(365, 129);oRenderPen.lineTo(370, 125);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(370, 110, 108, 30);oRenderPen.fillText('completeUnitOfWork', 374, 128);oRenderPen.beginPath();oRenderPen.lineTo(478, 125);oRenderPen.lineTo(505, 125);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(505, 121);oRenderPen.lineTo(505, 129);oRenderPen.lineTo(510, 125);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(510, 110, 76, 30);oRenderPen.fillText('completeWork', 514, 128);oRenderPen.beginPath();oRenderPen.lineTo(548, 140);oRenderPen.lineTo(548, 155);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(544, 155);oRenderPen.lineTo(552, 155);oRenderPen.lineTo(548, 160);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(482, 160, 142, 30);oRenderPen.fillText('æ ¹æ®workInProgress.tagçš„ç±»å‹', 483, 172);oRenderPen.fillText('è¿›å…¥ä¸åŒçš„å‡½æ•°', 516, 184);oRenderPen.beginPath();oRenderPen.lineTo(550, 190);oRenderPen.lineTo(550, 200);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(546, 200);oRenderPen.lineTo(554, 200);oRenderPen.lineTo(550, 205);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(551, 205);oRenderPen.lineTo(599, 220);oRenderPen.lineTo(551, 235);oRenderPen.lineTo(503, 220);oRenderPen.closePath();oRenderPen.stroke();oRenderPen.fillText('update | mount', 516, 222);oRenderPen.beginPath();oRenderPen.lineTo(503, 220);oRenderPen.lineTo(458, 220);oRenderPen.lineTo(458, 265);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(454, 265);oRenderPen.lineTo(462, 265);oRenderPen.lineTo(458, 270);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(599, 220);oRenderPen.lineTo(644, 220);oRenderPen.lineTo(644, 265);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(640, 265);oRenderPen.lineTo(648, 265);oRenderPen.lineTo(644, 270);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(404, 270, 120, 30);oRenderPen.fillText('updateHostComponent$1', 405, 288);oRenderPen.beginPath();oRenderPen.lineTo(460, 300);oRenderPen.lineTo(460, 435);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(456, 435);oRenderPen.lineTo(464, 435);oRenderPen.lineTo(460, 440);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(404, 440, 192, 30);oRenderPen.fillText('æŠŠå¸¦æœ‰effectTagçš„èŠ‚ç‚¹åŠ å…¥åˆ°effectListä¸­', 405, 453);oRenderPen.fillText('è¿”å›ä¸‹ä¸€ä¸ªworkInProgressèŠ‚ç‚¹', 430, 465);oRenderPen.beginPath();oRenderPen.lineTo(530, 470);oRenderPen.lineTo(530, 485);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(526, 485);oRenderPen.lineTo(534, 485);oRenderPen.lineTo(530, 490);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(610, 270, 70, 30);oRenderPen.fillText('createInstance', 611, 288);oRenderPen.beginPath();oRenderPen.lineTo(644, 300);oRenderPen.lineTo(644, 315);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(640, 315);oRenderPen.lineTo(648, 315);oRenderPen.lineTo(644, 320);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(603, 320, 86, 30);oRenderPen.fillText('appendAllChildren', 604, 338);oRenderPen.beginPath();oRenderPen.lineTo(644, 350);oRenderPen.lineTo(644, 365);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(640, 365);oRenderPen.lineTo(648, 365);oRenderPen.lineTo(644, 370);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(598, 370, 96, 30);oRenderPen.fillText('finalizeInitialchildren', 599, 388);oRenderPen.beginPath();oRenderPen.lineTo(644, 400);oRenderPen.lineTo(644, 455);oRenderPen.lineTo(601, 455);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(601, 451);oRenderPen.lineTo(601, 459);oRenderPen.lineTo(596, 455);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(496, 490, 70, 30);oRenderPen.fillText('commitRoot', 503, 508);oRenderPen.fillStyle='blue';oRenderPen.fillText('update', 92, 180);oRenderPen.fillText('mount', 260, 180);oRenderPen.fillText('å¦', 120, 236);oRenderPen.fillText('èƒ½', 74, 270);oRenderPen.fillText('å¦', 130, 357);oRenderPen.fillText('æ˜¯', 74, 388);oRenderPen.fillText('cloneå­èŠ‚ç‚¹', 114, 418);oRenderPen.fillText('update',228, 305);oRenderPen.fillText('mount', 344, 305);oRenderPen.fillText('å¸¦ä¸ŠeffectTag',190, 315);oRenderPen.fillText('ä¸å¸¦ä¸ŠeffectTag', 350, 315);oRenderPen.fillText('diffç®—æ³•', 225, 370);oRenderPen.fillText('åˆ›å»ºå­èŠ‚ç‚¹', 214, 450);oRenderPen.fillText('å‡è®¾è¿›å…¥äº†', 430, 175);oRenderPen.fillText('HostComponent', 402, 187);oRenderPen.fillText('update', 467, 216);oRenderPen.fillText('mount', 603, 216);oRenderPen.fillText('å¤„ç†propså°†å˜åŒ–çš„éƒ¨åˆ†èµ‹å€¼ç»™', 462, 250);oRenderPen.fillText('workInprogress.updateQueue', 462, 262);oRenderPen.fillText('åˆ›å»ºdomèŠ‚ç‚¹èµ‹å€¼', 529, 282);oRenderPen.fillText('ç»™fiber.stateNode', 528, 294);oRenderPen.fillText('å°†åä»£èŠ‚ç‚¹æ’å…¥å½“å‰èŠ‚ç‚¹', 492, 338);oRenderPen.fillText('åˆå§‹åŒ–domå±æ€§', 525, 387);</script>


<h3 id="beginWork"><a href="#beginWork" class="headerlink" title="beginWork"></a>beginWork</h3><p>  beginWorkä¸»è¦çš„å·¥ä½œæ˜¯åˆ›å»ºæˆ–å¤ç”¨å­fiberèŠ‚ç‚¹ã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">beginWork</span>(<span class="params">current, workInProgress, renderLanes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> updateLanes = workInProgress.lanes;</span><br><span class="line">  <span class="comment">// 1.updateæ—¶æ»¡è¶³æ¡ä»¶å³å¯å¤ç”¨current fiberè¿›å…¥bailoutOnAlreadyFinishedWorkå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (current !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> oldProps = current.memoizedProps;</span><br><span class="line">    <span class="keyword">var</span> newProps = workInProgress.pendingProps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldProps !== newProps || hasContextChanged() || (workInProgress.type !== current.type )) &#123;</span><br><span class="line">      didReceiveUpdate = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!includesSomeLane(renderLanes, updateLanes)) &#123;</span><br><span class="line">      didReceiveUpdate = <span class="literal">false</span>; </span><br><span class="line">      <span class="keyword">switch</span> (workInProgress.tag) &#123;</span><br><span class="line">       <span class="comment">// ......</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> bailoutOnAlreadyFinishedWork(current, workInProgress, renderLanes);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((current.flags &amp; ForceUpdateForLegacySuspense) !== NoFlags) &#123;</span><br><span class="line">        didReceiveUpdate = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        didReceiveUpdate = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    didReceiveUpdate = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  workInProgress.lanes = NoLanes;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.æ ¹æ®tagæ¥åˆ›å»ºä¸åŒçš„fiber æœ€åè¿›å…¥reconcileChildrenå‡½æ•°</span></span><br><span class="line">  <span class="keyword">switch</span> (workInProgress.tag) &#123;</span><br><span class="line">    <span class="keyword">case</span> IndeterminateComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> LazyComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> FunctionComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ClassComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostRoot: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostText: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> SuspenseComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostPortal: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ForwardRef: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Fragment: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Mode: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Profiler: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ContextProvider: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ContextConsumer: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> MemoComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> SimpleMemoComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> IncompleteClassComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> SuspenseListComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> FundamentalComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ScopeComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Block:   <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> OffscreenComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> LegacyHiddenComponent: <span class="comment">// ......</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">Error</span>( <span class="string">"Unknown unit of work tag ("</span> + workInProgress.tag + <span class="string">"). This error is likely caused by a bug in React. Please file an issue."</span> );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å‚æ•°ä¸­æœ‰current Fiberï¼Œä¹Ÿå°±æ˜¯å½“å‰çœŸå®domå¯¹åº”çš„Fiberæ ‘ï¼Œåœ¨ä¹‹å‰ä»‹ç»FiberåŒç¼“å­˜æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶é™¤äº†rootFiberå¤–ï¼Œcurrent ç­‰äº nullï¼Œå› ä¸ºé¦–æ¬¡æ¸²æŸ“domè¿˜æ²¡æ„å»ºå‡ºæ¥ï¼Œåœ¨updateæ—¶currentä¸ç­‰äº nullï¼Œå› ä¸ºupdateæ—¶domæ ‘å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥beginWorkå‡½æ•°ä¸­ç”¨current === nullæ¥åˆ¤æ–­æ˜¯mountè¿˜æ˜¯updateè¿›å…¥ä¸åŒçš„é€»è¾‘ã€‚</p>
<blockquote>
<p>mountï¼šæ ¹æ®fiber.tagè¿›å…¥ä¸åŒfiberçš„åˆ›å»ºå‡½æ•°ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨åˆ°reconcileChildrenåˆ›å»ºå­Fiber<br>updateï¼šåœ¨æ„å»ºworkInProgressçš„æ—¶å€™ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¼šå¤ç”¨current Fiberæ¥è¿›è¡Œä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥bailoutOnAlreadyFinishedWorkçš„é€»è¾‘ï¼Œèƒ½å¤ç”¨didReceiveUpdateå˜é‡æ˜¯falseï¼Œå¤ç”¨çš„æ¡ä»¶æ˜¯<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oldProps === newProps &amp;&amp; workInProgress.type === current.type å±æ€§å’Œfiberçš„typeä¸å˜</span><br><span class="line">!includesSomeLane(renderLanes, updateLanes) æ›´æ–°çš„ä¼˜å…ˆçº§æ˜¯å¦è¶³å¤Ÿã€‚</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="bailoutOnAlreadyFinishedWork"><a href="#bailoutOnAlreadyFinishedWork" class="headerlink" title="bailoutOnAlreadyFinishedWork"></a>bailoutOnAlreadyFinishedWork</h4>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bailoutOnAlreadyFinishedWork</span>(<span class="params">current, workInProgress, renderLanes</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¼˜å…ˆçº§è¶³å¤Ÿåˆ™è¿›å…¥cloneChildFibersï¼Œå¦åˆ™è¿”å›nullï¼Œä¸éœ€è¦æ›´æ–°</span></span><br><span class="line">  <span class="keyword">if</span> (!includesSomeLane(renderLanes, workInProgress.childLanes)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cloneChildFibers(current, workInProgress);</span><br><span class="line">    <span class="keyword">return</span> workInProgress.child;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="reconcileChildren-mountChildFibers"><a href="#reconcileChildren-mountChildFibers" class="headerlink" title="reconcileChildren/mountChildFibers"></a>reconcileChildren/mountChildFibers</h4><p>  åˆ›å»ºå­fiberçš„è¿‡ç¨‹ä¼šè¿›å…¥reconcileChildrenï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹æºç ï¼‰ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯ä¸ºworkInProgress fiberèŠ‚ç‚¹ç”Ÿæˆå®ƒçš„child fiberå³ workInProgress.childã€‚<strong>ç„¶åç»§ç»­æ·±åº¦ä¼˜å…ˆéå†å®ƒçš„å­èŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</strong></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reconcileChildren</span>(<span class="params">current, workInProgress, nextChildren, renderLanes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (current === <span class="literal">null</span>) &#123;</span><br><span class="line">    workInProgress.child = mountChildFibers(workInProgress, <span class="literal">null</span>, nextChildren, renderLanes);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    workInProgress.child = reconcileChildFibers(workInProgress, current.child, nextChildren, renderLanes);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  reconcileChildrenä¼šåŒºåˆ†mountå’Œupdateä¸¤ç§æƒ…å†µï¼Œè¿›å…¥reconcileChildFibersæˆ–mountChildFibersï¼ŒreconcileChildFiberså’ŒmountChildFibersæœ€ç»ˆå…¶å®éƒ½æ˜¯è°ƒç”¨ChildReconcilerä¼ é€’ä¸åŒçš„å‚æ•°è¿”å›çš„å‡½æ•°ï¼Œè¿™ä¸ªå‚æ•°ï¼ˆshouldTrackSideEffectsï¼‰ç”¨æ¥è¡¨ç¤ºæ˜¯å¦è¿½è¸ªå‰¯ä½œç”¨ï¼Œåœ¨ChildReconcilerä¸­ç”¨shouldTrackSideEffectsæ¥åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹åº”çš„èŠ‚ç‚¹æ‰“ä¸ŠeffectTagã€‚</p>
<p>  ä¸ºFiberæ‰“ä¸ŠeffectTagä¹‹ååœ¨commité˜¶æ®µä¼šè¢«æ‰§è¡Œå¯¹åº”domçš„å¢åˆ æ”¹ï¼Œè€Œä¸”åœ¨reconcileChildrençš„æ—¶å€™ï¼ŒrootFiberæ˜¯å­˜åœ¨alternateçš„ï¼Œå³rootFiberå­˜åœ¨å¯¹åº”çš„current Fiberï¼Œæ‰€ä»¥rootFiberä¼šèµ°reconcileChildFibersçš„é€»è¾‘ï¼Œæ‰€ä»¥shouldTrackSideEffectsç­‰äºtrueä¼šè¿½è¸ªå‰¯ä½œç”¨ï¼Œæœ€åä¸ºrootFiberæ‰“ä¸ŠPlacementçš„effectTagï¼Œç„¶åå°†domä¸€æ¬¡æ€§æ’å…¥ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<h3 id="completeWork"><a href="#completeWork" class="headerlink" title="completeWork"></a>completeWork</h3><p>  completeWorkä¸»è¦å·¥ä½œæ˜¯å¤„ç†fiberçš„propsã€åˆ›å»ºdomã€åˆ›å»ºeffectListã€‚</p>
<p>  ä»å‡½æ•°è°ƒç”¨æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»performUnitOfWorkæ¥çœ‹ï¼Œåœ¨WorkLoopSyncæˆ–WorkLoopConcurrentä¸­éƒ½ä¼šdoâ€¦whileè°ƒç”¨performUnitOfWorkï¼Œåœæ­¢çš„æ¡ä»¶æ˜¯workInprogressç­‰äºnullã€‚</p>
<p>  performUnitOfWorké¦–å…ˆä¼šè°ƒç”¨beginWorkï¼Œåˆ›å»ºæˆ–å¤ç”¨å­fiberèŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹è¿˜æœ‰æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶èµ‹ä¸ºæ–°çš„workInprogressç»§ç»­æ‰§è¡ŒbeginWorkã€‚å¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹å¼€å§‹è°ƒç”¨completeUnitOfWorkã€‚</p>
<p>  completeUnitOfWorkä¼šdoâ€¦whileè°ƒç”¨completeWorkï¼Œå¦‚æœå½“å‰æœ‰å…„å¼ŸèŠ‚ç‚¹siblingFiberï¼Œåˆ™å¯¹å°†siblingFiberèµ‹å€¼ç»™workInProgressï¼Œå†èµ°beginWorkã€‚ã€‚ã€‚å¦‚æœå½“å‰å­èŠ‚ç‚¹æœ‰returnFiberåˆ™å°†returnFiberèµ‹ç»™workInProgressï¼Œç»§ç»­æ‰§è¡ŒcompleteWorkã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">completeWork</span>(<span class="params">current, workInProgress, renderLanes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newProps = workInProgress.pendingProps; </span><br><span class="line"></span><br><span class="line">  popTreeContext(workInProgress);</span><br><span class="line">  <span class="keyword">switch</span> (workInProgress.tag) &#123;</span><br><span class="line">    <span class="keyword">case</span> IndeterminateComponent:</span><br><span class="line">    <span class="keyword">case</span> LazyComponent:</span><br><span class="line">    <span class="keyword">case</span> SimpleMemoComponent:</span><br><span class="line">    <span class="keyword">case</span> FunctionComponent:</span><br><span class="line">    <span class="keyword">case</span> ForwardRef:</span><br><span class="line">    <span class="keyword">case</span> Fragment:</span><br><span class="line">    <span class="keyword">case</span> Mode:</span><br><span class="line">    <span class="keyword">case</span> Profiler:</span><br><span class="line">    <span class="keyword">case</span> ContextConsumer:</span><br><span class="line">    <span class="keyword">case</span> MemoComponent:</span><br><span class="line">      ...</span><br><span class="line">    <span class="keyword">case</span> ClassComponent:</span><br><span class="line">      ...</span><br><span class="line">    <span class="keyword">case</span> HostComponent:</span><br><span class="line">      &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (current !== <span class="literal">null</span> &amp;&amp; workInProgress.stateNode != <span class="literal">null</span>) &#123;</span><br><span class="line">          updateHostComponent(current, workInProgress, type, newProps, rootContainerInstance);</span><br><span class="line">          ...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ...</span><br><span class="line">          <span class="keyword">var</span> instance = createInstance(type, newProps, rootContainerInstance, currentHostContext, workInProgress);</span><br><span class="line"></span><br><span class="line">          appendAllChildren(instance, workInProgress, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">          workInProgress.stateNode = instance;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (finalizeInitialChildren(instance, type, newProps, rootContainerInstance)) &#123;</span><br><span class="line">            markUpdate(workInProgress);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        bubbleProperties(workInProgress);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>æ ¹æ®workInProgress.tagè¿›å…¥ä¸åŒå‡½æ•°ï¼Œæˆ‘ä»¬ä»¥HostComponentä¸¾ä¾‹</li>
<li>updateæ—¶ï¼ˆé™¤äº†åˆ¤æ–­current===nullå¤–è¿˜éœ€è¦åˆ¤æ–­workInProgress.stateNode===nullï¼‰ï¼Œè°ƒç”¨updateHostComponentå¤„ç†propsï¼ˆåŒ…æ‹¬onClickã€styleã€children â€¦ï¼‰ï¼Œå¹¶å°†å¤„ç†å¥½çš„propsèµ‹å€¼ç»™updatePayload,æœ€åä¼šä¿å­˜åœ¨workInProgress.updateQueueä¸Šã€‚<br>mountæ—¶ è°ƒç”¨createInstanceåˆ›å»ºdomï¼Œå°†åä»£domèŠ‚ç‚¹æ’å…¥åˆšåˆ›å»ºçš„domä¸­ï¼Œè°ƒç”¨finalizeInitialChildrenå¤„ç†propsï¼ˆå’ŒupdateHostComponentå¤„ç†çš„é€»è¾‘ç±»ä¼¼ï¼‰</li>
<li>åœ¨beginWorkçš„mountæ—¶ï¼ŒrootFiberå­˜åœ¨å¯¹åº”çš„currentï¼Œæ‰€ä»¥ä»–ä¼šæ‰§è¡ŒmountChildFibersæ‰“ä¸ŠPlacementçš„effectTagï¼Œåœ¨å†’æ³¡é˜¶æ®µä¹Ÿå°±æ˜¯æ‰§è¡ŒcompleteWorkæ—¶ï¼Œæˆ‘ä»¬å°†å­å­™èŠ‚ç‚¹é€šè¿‡appendAllChildrenæŒ‚è½½åˆ°æ–°åˆ›å»ºçš„domèŠ‚ç‚¹ä¸Šï¼Œæœ€åå°±å¯ä»¥ä¸€æ¬¡æ€§å°†å†…å­˜ä¸­çš„èŠ‚ç‚¹ç”¨domåŸç”Ÿæ–¹æ³•ååº”åˆ°çœŸå®domä¸­ã€‚</li>
<li>åœ¨beginWork ä¸­æˆ‘ä»¬çŸ¥é“æœ‰çš„èŠ‚ç‚¹è¢«æ‰“ä¸Šäº†effectTagçš„æ ‡è®°ï¼Œæœ‰çš„æ²¡æœ‰ï¼Œè€Œåœ¨commité˜¶æ®µæ—¶è¦éå†æ‰€æœ‰åŒ…å«effectTagçš„Fiberæ¥æ‰§è¡Œå¯¹åº”çš„å¢åˆ æ”¹ï¼Œé‚£æˆ‘ä»¬è¿˜éœ€è¦ä»Fiberæ ‘ä¸­æ‰¾åˆ°è¿™äº›å¸¦effectTagçš„èŠ‚ç‚¹å˜›ï¼Œç­”æ¡ˆæ˜¯ä¸éœ€è¦çš„ï¼Œè¿™é‡Œæ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œåœ¨æ‰§è¡ŒcompleteWorkçš„æ—¶å€™é‡åˆ°äº†å¸¦effectTagçš„èŠ‚ç‚¹ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªå«effectListä¸­,æ‰€ä»¥åœ¨commité˜¶æ®µåªè¦éå†effectListå°±å¯ä»¥äº†ï¼ˆrootFiber.firstEffect.nextEffectå°±å¯ä»¥è®¿é—®å¸¦effectTagçš„Fiberäº†ï¼‰</li>
</ol>
<p>  ç”»ä¸ªç®€å•çš„ç¤ºæ„å›¾ï¼š</p>
  <canvas id="pic" width="400" height="200"></canvas>


<script>
  const oPic = document.getElementById('pic');
  const oPicPen = oPic.getContext('2d');oPicPen.beginPath();oPicPen.lineTo(200, 20);oPicPen.lineTo(200, 60);oPicPen.lineTo(140, 100);oPicPen.lineTo(100, 140);oPicPen.lineTo(75, 170);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(200, 60);oPicPen.lineTo(260, 100);oPicPen.lineTo(220, 140);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(140, 100);oPicPen.lineTo(180, 140);oPicPen.lineTo(155, 170);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(260, 100);oPicPen.lineTo(300, 140);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(100, 140);oPicPen.lineTo(125, 170);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(180, 140);oPicPen.lineTo(205, 170);oPicPen.stroke();oPicPen.strokeStyle='blue';oPicPen.beginPath();oPicPen.lineTo(180, 10);oPicPen.lineTo(180, 60);oPicPen.lineTo(120, 100);oPicPen.lineTo(80, 140);oPicPen.lineTo(55, 180);oPicPen.lineTo(138, 180);oPicPen.lineTo(110, 140);oPicPen.lineTo(170, 140);oPicPen.lineTo(143, 180);oPicPen.lineTo(225, 180);oPicPen.lineTo(160, 100);oPicPen.lineTo(250, 100);oPicPen.lineTo(205, 150);oPicPen.lineTo(320, 150);oPicPen.lineTo(280, 100);oPicPen.lineTo(220, 60);oPicPen.lineTo(220, 10);oPicPen.stroke();oPicPen.fillStyle='red';oPicPen.fillText('1.begin', 142, 20);oPicPen.fillText('2.begin', 140, 60);oPicPen.fillText('3.begin', 82, 100);oPicPen.fillText('4.begin', 42, 140);oPicPen.fillText('5.begin', 25, 170);oPicPen.fillText('6.begin', 100, 190);oPicPen.fillText('7.b', 157, 140);oPicPen.fillText('8.begin', 150, 179);oPicPen.fillText('9.begin', 226, 190);oPicPen.fillText('10.begin', 213, 98);oPicPen.fillText('11.begin', 210, 148);oPicPen.fillText('12.begin', 320, 158);oPicPen.fillStyle='green';oPicPen.fillText('5.complete', 2, 180);oPicPen.fillText('6.complete', 83, 179);oPicPen.fillText('6.c', 110, 140);oPicPen.fillText('8.complete', 150, 190);oPicPen.fillText('9.complete', 226, 179);oPicPen.fillText('9.c', 180, 140);oPicPen.fillText('9.complete', 150, 98);oPicPen.fillText('11.complete', 210, 158);oPicPen.fillText('12.complete', 320, 148);oPicPen.fillText('12.complete', 280, 100);oPicPen.fillText('12.complete', 225, 60);oPicPen.fillText('12.complete', 225, 20);
</script>

<h2 id="commité˜¶æ®µ"><a href="#commité˜¶æ®µ" class="headerlink" title="commité˜¶æ®µ"></a>commité˜¶æ®µ</h2><h2 id="diffç®—æ³•"><a href="#diffç®—æ³•" class="headerlink" title="diffç®—æ³•"></a>diffç®—æ³•</h2><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><h2 id="çŠ¶æ€æ›´æ–°æµç¨‹"><a href="#çŠ¶æ€æ›´æ–°æµç¨‹" class="headerlink" title="çŠ¶æ€æ›´æ–°æµç¨‹"></a>çŠ¶æ€æ›´æ–°æµç¨‹</h2><h2 id="hooks"><a href="#hooks" class="headerlink" title="hooks"></a>hooks</h2><h2 id="scheduler-amp-Lane"><a href="#scheduler-amp-Lane" class="headerlink" title="scheduler&amp;Lane"></a>scheduler&amp;Lane</h2><h2 id="concurrentæ¨¡å¼-1"><a href="#concurrentæ¨¡å¼-1" class="headerlink" title="concurrentæ¨¡å¼"></a>concurrentæ¨¡å¼</h2><h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><h2 id="äº‹ä»¶ç³»ç»Ÿ"><a href="#äº‹ä»¶ç³»ç»Ÿ" class="headerlink" title="äº‹ä»¶ç³»ç»Ÿ"></a>äº‹ä»¶ç³»ç»Ÿ</h2><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>  ä¸æ­¢åœç•™åœ¨ç†è®ºï¼Œä¹Ÿä¸åªåœç•™åœ¨æºç ã€‚</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/React/" rel="tag"># React</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/07/13/interview/" rel="next" title="interview">
                <i class="fa fa-chevron-left"></i> interview
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/10/28/npm/" rel="prev" title="npm">
                npm <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/background22.jpg" alt="Lemon">
            
              <p class="site-author-name" itemprop="name">Lemon</p>
              <p class="site-description motion-element" itemprop="description">ä¹˜é£ç ´æµª</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸€ã€å‰è¨€"><span class="nav-number">1.</span> <span class="nav-text">ä¸€ã€å‰è¨€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ç›´æ¥çœ‹æºç "><span class="nav-number">1.1.</span> <span class="nav-text">ç›´æ¥çœ‹æºç </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ReactDOM-render"><span class="nav-number">1.1.1.</span> <span class="nav-text">ReactDOM.render</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1ã€ReactDOM-render"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">1ã€ReactDOM.render</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2ã€cjsã€amdã€umdå’Œesm"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">2ã€cjsã€amdã€umdå’Œesm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3ã€å…¶ä»–å°ç‚¹"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">3ã€å…¶ä»–å°ç‚¹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€ä¹ˆå­¦reactæºç "><span class="nav-number">1.2.</span> <span class="nav-text">æ€ä¹ˆå­¦reactæºç </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ"><span class="nav-number">2.</span> <span class="nav-text">äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jsx"><span class="nav-number">2.1.</span> <span class="nav-text">jsx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FiberåŒç¼“å­˜"><span class="nav-number">2.2.</span> <span class="nav-text">FiberåŒç¼“å­˜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scheduler"><span class="nav-number">2.3.</span> <span class="nav-text">scheduler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#reconcilerï¼ˆrender-é˜¶æ®µï¼‰"><span class="nav-number">2.4.</span> <span class="nav-text">reconcilerï¼ˆrender é˜¶æ®µï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rendererï¼ˆcommit-é˜¶æ®µï¼‰"><span class="nav-number">2.5.</span> <span class="nav-text">rendererï¼ˆcommit é˜¶æ®µï¼‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#concurrent"><span class="nav-number">2.6.</span> <span class="nav-text">concurrent</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ä¸‰ã€reactæºç æ·±å…¥è§£æ"><span class="nav-number">3.</span> <span class="nav-text">ä¸‰ã€reactæºç æ·±å…¥è§£æ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•"><span class="nav-number">3.1.</span> <span class="nav-text">æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jsx-1"><span class="nav-number">3.2.</span> <span class="nav-text">jsx</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#virtual-Dom-æ˜¯ä»€ä¹ˆ"><span class="nav-number">3.2.1.</span> <span class="nav-text">virtual Dom æ˜¯ä»€ä¹ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸ºä»€ä¹ˆç”¨virtual-Dom"><span class="nav-number">3.2.2.</span> <span class="nav-text">ä¸ºä»€ä¹ˆç”¨virtual Dom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jsx-amp-createElement"><span class="nav-number">3.2.3.</span> <span class="nav-text">jsx&amp;createElement</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fiberæ¶æ„"><span class="nav-number">3.3.</span> <span class="nav-text">Fiberæ¶æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#renderé˜¶æ®µ"><span class="nav-number">3.4.</span> <span class="nav-text">renderé˜¶æ®µ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reactå¯åŠ¨æ¨¡å¼"><span class="nav-number">3.4.1.</span> <span class="nav-text">reactå¯åŠ¨æ¨¡å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#legacyæ¨¡å¼"><span class="nav-number">3.4.1.2.</span> <span class="nav-text">legacyæ¨¡å¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#concurrentæ¨¡å¼"><span class="nav-number">3.4.1.3.</span> <span class="nav-text">concurrentæ¨¡å¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹"><span class="nav-number">3.4.1.4.</span> <span class="nav-text">ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹"><span class="nav-number">3.4.2.</span> <span class="nav-text">ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹"><span class="nav-number">3.4.3.</span> <span class="nav-text">renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#beginWork"><span class="nav-number">3.4.4.</span> <span class="nav-text">beginWork</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#bailoutOnAlreadyFinishedWork"><span class="nav-number">3.4.4.1.</span> <span class="nav-text">bailoutOnAlreadyFinishedWork</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reconcileChildren-mountChildFibers"><span class="nav-number">3.4.4.2.</span> <span class="nav-text">reconcileChildren/mountChildFibers</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#completeWork"><span class="nav-number">3.4.5.</span> <span class="nav-text">completeWork</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#commité˜¶æ®µ"><span class="nav-number">3.5.</span> <span class="nav-text">commité˜¶æ®µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#diffç®—æ³•"><span class="nav-number">3.6.</span> <span class="nav-text">diffç®—æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ç”Ÿå‘½å‘¨æœŸ"><span class="nav-number">3.7.</span> <span class="nav-text">ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çŠ¶æ€æ›´æ–°æµç¨‹"><span class="nav-number">3.8.</span> <span class="nav-text">çŠ¶æ€æ›´æ–°æµç¨‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hooks"><span class="nav-number">3.9.</span> <span class="nav-text">hooks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scheduler-amp-Lane"><span class="nav-number">3.10.</span> <span class="nav-text">scheduler&amp;Lane</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#concurrentæ¨¡å¼-1"><span class="nav-number">3.11.</span> <span class="nav-text">concurrentæ¨¡å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#context"><span class="nav-number">3.12.</span> <span class="nav-text">context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#äº‹ä»¶ç³»ç»Ÿ"><span class="nav-number">3.13.</span> <span class="nav-text">äº‹ä»¶ç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å®è·µ"><span class="nav-number">3.14.</span> <span class="nav-text">å®è·µ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">3.15.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lemon</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
