<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="ä¹˜é£ç ´æµª">
<meta property="og:type" content="website">
<meta property="og:title" content="å°å¯’">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="å°å¯’">
<meta property="og:description" content="ä¹˜é£ç ´æµª">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å°å¯’">
<meta name="twitter:description" content="ä¹˜é£ç ´æµª">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>å°å¯’</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">å°å¯’</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-çª">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            çª
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ç±»">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-æ¡£">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-äº">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/11/23/charles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/11/23/charles/" itemprop="url">charles</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-11-23T14:57:18+08:00">
                2021-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Httpsé…ç½®"><a href="#Httpsé…ç½®" class="headerlink" title="Httpsé…ç½®"></a>Httpsé…ç½®</h1><ol>
<li>ç”µè„‘ç«¯å®‰è£…è¯ä¹¦ï¼ŒHelpâ€“&gt;SSL proxyingâ€“&gt;Install Charles Root Certificateï¼Œå®‰è£…è¯ä¹¦ï¼Œç›´æ¥éƒ½ä¸‹ä¸€æ­¥å³å¯</li>
<li>æ‰‹æœºç«¯å®‰è£…è¯ä¹¦ï¼Œæ‰“å¼€Charles çš„helpèœå• â€“&gt; SSL Proxying â€“&gt; Install Charles Root Certificate on a Mobile Device or Remote Browser</li>
<li>ç”µè„‘ç«¯é…ç½®ï¼ŒProxyâ€“&gt;SSL Proxying Settings,æ·»åŠ Hostä¸ºâ€*.comâ€,Portä¸º443ï¼Œåä¿å­˜ã€‚</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/10/28/npm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/10/28/npm/" itemprop="url">npm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-10-28T17:59:21+08:00">
                2021-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ä¸“é¢˜/" itemprop="url" rel="index">
                    <span itemprop="name">ä¸“é¢˜</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h1><p>  npm get registry<br>  npm config set registry xxx<br>  npm adduser â€“registry xxx<br>  npm profile set password â€“registry xxx</p>
<p>  npm publish<br>  å‘å¸ƒğŸ“¢ï¼š</p>
<ul>
<li>å‘å¸ƒä¹‹å‰è®°å¾—buildç¼–è¯‘ï¼Œå°åŒ…ä½¿ç”¨rollupæ‰“åŒ…å¾ˆç®€å•</li>
<li><p>å‘å¸ƒåœ¨å…¬å¸å†…æºçš„è¯ï¼Œéœ€è¦æ”¹å˜é¡¹ç›®çš„npmæºã€‚.npmrc registry=â€™xxxâ€™</p>
<p>npm view npmåŒ… versions</p>
</li>
</ul>
<h1 id="npmåŒ…"><a href="#npmåŒ…" class="headerlink" title="npmåŒ…"></a>npmåŒ…</h1><p>  # </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/23/reactæºç è§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/23/reactæºç è§£æ/" itemprop="url">reactæºç è§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-08-23T15:00:59+08:00">
                2021-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ¡†æ¶/" itemprop="url" rel="index">
                    <span itemprop="name">æ¡†æ¶</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h1><pre><code>æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨reactï¼Œä½†æ˜¯å¯¹äºreactçš„å®ç°åŸç†å´ä¸ä¸€å®šçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚

äºæ˜¯æˆ‘ä»¬æ‰“å¼€reactåŒ…ï¼ˆ17.0.2ï¼‰ï¼Œå‘ç°ï¼Œå’¦ï¼Œä¸ºä»€ä¹ˆåªæœ‰3000å¤šè¡Œä»£ç â“

å¾ˆå¿«ï¼Œæˆ‘ä»¬å°±ä¼šæ„è¯†åˆ°ï¼ŒåŸæ¥æ˜¯åˆ†åŒ…äº†ï¼ˆ2015-10ï¼‰ï¼Œè¿˜æœ‰react-domï¼ˆ17.0.2ï¼‰ï¼Œä¸€æ‰“å¼€ï¼Œ26000å¤šè¡Œï¼Œå“¦å“¦ï¼Œå¯¹çš„ã€‚

å› ä¸ºreactä¸æ­¢é’ˆå¯¹webäº†ï¼Œè¿˜æœ‰ç§»åŠ¨ç«¯ï¼ˆreact-nativeï¼‰ï¼Œæ‰€ä»¥å°±åˆ†åŒ…äº†ã€‚reactå®ç°ä¸»å¹²é€»è¾‘ï¼Œreact-domé’ˆå¯¹ dom çš„å¹³å°å®ç°ï¼Œä¸»è¦ç”¨äºåœ¨ web ç«¯è¿›è¡Œæ¸²æŸ“ã€‚

3000+26000å¤šè¡Œä»£ç ï¼Œä»¤äººå¤´å¤§ï¼Œä¸ç®¡äº†ï¼ŒğŸ”¥ çƒ­æƒ…æ¥äº†ï¼Œè¯´å¹²å°±å¹²ã€‚å°±ä»æœ€çœ¼ç†Ÿçš„å¼€å§‹ï¼ˆReactDOM.renderï¼‰ä¸‹æ‰‹ï¼Œæ€ç†Ÿ ğŸ˜ã€‚å°±é—®ä½ è¿™ ğŸ‰ ä¿ç†Ÿå—ï¼Ÿã€‚
</code></pre><h2 id="ç›´æ¥çœ‹æºç "><a href="#ç›´æ¥çœ‹æºç " class="headerlink" title="ç›´æ¥çœ‹æºç "></a>ç›´æ¥çœ‹æºç </h2><h3 id="ReactDOM-render"><a href="#ReactDOM-render" class="headerlink" title="ReactDOM.render"></a>ReactDOM.render</h3><pre><code>å°½é‡ä¹±ä¸­æœ‰åºã€‚
æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çœ‹ï¼Œé¦–å…ˆï¼Œæ•´ä½“æ¥çœ‹ReactDOMï¼Œæœ€å¤–å±‚æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°iifeï¼Œå†™æºç æˆ–è€…å†™jqueryçš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨iifeçš„æ¨¡å—åŒ–æ–¹å¼ã€‚ï¼ˆå½“æ—¶çš„æƒ³æ³•ï¼‰
</code></pre><p>  <code>(function (a, b) {â€¦â€¦}(c, d))</code></p>
<pre><code>å€Ÿç€ç»†çœ‹ï¼Œè¿™ä¸ªç«‹å³å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå‡½æ•°ã€‚ç«‹å³å‡½æ•°çš„å†…å®¹æ˜¯åˆ¤æ–­å¤šç§æ¡ä»¶ä¸‹ï¼Œç»™å‚æ•°å‡½æ•°ä¼ å‚åæ‰§è¡Œã€‚
</code></pre>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> ? factory(exports, <span class="built_in">require</span>(<span class="string">'react'</span>)) :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define([<span class="string">'exports'</span>, <span class="string">'react'</span>], factory) :</span><br><span class="line">  (global = global || self, factory(global.ReactDOM = &#123;&#125;, global.React));</span><br><span class="line">&#125;(<span class="keyword">this</span>, (<span class="function"><span class="keyword">function</span> (<span class="params">exports, React</span>) </span>&#123; </span><br><span class="line">  ...</span><br><span class="line">  exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED = Internals;</span><br><span class="line">  exports.createPortal = createPortal$<span class="number">1</span>;</span><br><span class="line">  exports.findDOMNode = findDOMNode;</span><br><span class="line">  exports.flushSync = flushSync;</span><br><span class="line">  exports.hydrate = hydrate;</span><br><span class="line">  exports.render = render;</span><br><span class="line">  exports.unmountComponentAtNode = unmountComponentAtNode;</span><br><span class="line">  exports.unstable_batchedUpdates = batchedUpdates$<span class="number">1</span>;</span><br><span class="line">  exports.unstable_createPortal = unstable_createPortal;</span><br><span class="line">  exports.unstable_renderSubtreeIntoContainer = renderSubtreeIntoContainer;</span><br><span class="line">  exports.version = ReactVersion;</span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure>
<pre><code>çœ‹åˆ°è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¥½åƒçŸ¥é“ç‚¹å•¥ï¼Œä½†æ˜¯åˆè¯´ä¸æ¸…ã€‚ä¸ç®¡å¯ï¼Œå…ˆå…³å¿ƒä¸»è¦é—®é¢˜ï¼Œçœ‹çœ‹ ReactDOM.render åˆ°åº•åšäº†ä»€ä¹ˆã€‚äºæ˜¯æ¢³ç†äº†ä¸¤éï¼Œå†™äº†3é¡µç¬”è®°ã€‚ã€‚ã€‚

åªæ˜¯å¤§æŠµçœ‹äº†è°ƒç”¨å…³ç³»ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ææ¸…æ¥šæ¯ä¸€è¡Œä»£ç ï¼Œå› ä¸ºçœŸçš„æ˜¯å¤ªå¤šäº†ï¼ˆçœ‹æˆ‘çš„3é¡µç¬”è®°ï¼‰ï¼ŒçœŸè¦é å…‰çœ‹æºç å»çœ‹æ‡‚æ¡†æ¶ï¼ŒçœŸçš„æ˜¯éœ€è¦æŠ•å…¥å¤§é‡çš„æ—¶é—´ã€‚ç”šè‡³ä»…é€šè¿‡æŸ¥çœ‹ä»£ç çš„æ–¹æ³•å¾ˆéš¾çœŸæ­£ç†è§£reactã€‚

ä¸è¿‡ä¹Ÿä¸è¦å¤ªç°å¿ƒï¼Œçœ‹äº†ä¸€éï¼Œå¤šå¤šå°‘å°‘è¿˜æ˜¯æœ‰ç‚¹æ”¶è·çš„ï¼Œå…ˆè®°å½•ä¸€ä¸‹è¿™ç‚¹å¯æ€œçš„æ”¶è·ï¼š
</code></pre><h4 id="1ã€ReactDOM-render"><a href="#1ã€ReactDOM-render" class="headerlink" title="1ã€ReactDOM.render"></a>1ã€ReactDOM.render</h4><pre><code>æ•´ä½“æ¥çœ‹ï¼Œå…ˆè¿”å›äº†ä¸€ä¸ªFiberRootNodeï¼ŒFiberRootNodeä¸Šç»‘å®šäº†æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶ï¼Œä¹‹åæ‰§è¡Œäº†updateContainerã€‚

updateContaineré‡Œï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ°createUpdateåˆ›å»ºæ›´æ–°ï¼ŒenqueueUpdateæ’åºæ ‡è®°æ›´æ–°ä¼˜å…ˆçº§ï¼ŒscheduleUpdateOnFiberè°ƒåº¦æ›´æ–°åˆ°Fiberä¸Šï¼Œä»¥åŠcommité˜¶æ®µæäº¤ä¼˜å…ˆçº§ï¼Œè¿™é‡Œè¿˜èƒ½çœ‹åˆ°ä¸€äº›æ—¶é—´ï¼ˆexpirationTimeï¼‰çš„è®¡ç®—ã€‚

å…·ä½“æ¥çœ‹ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM = &#123;</span><br><span class="line">  render(</span><br><span class="line">    element: React$Element&lt;any&gt;,</span><br><span class="line">    container: DOMContainer,</span><br><span class="line">    callback: ?Function,</span><br><span class="line">  ) &#123;</span><br><span class="line">    return legacyRenderSubtreeIntoContainer(</span><br><span class="line">      null,</span><br><span class="line">      element,</span><br><span class="line">      container,</span><br><span class="line">      false,</span><br><span class="line">      callback,</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># é¦–å…ˆä¼šåˆ›å»ºReactRootå¯¹è±¡ï¼Œç„¶åè°ƒç”¨ä»–çš„renderæ–¹æ³•</span><br><span class="line"># åˆ›å»ºReactRootçš„æ—¶å€™ä¼šè°ƒç”¨DOMRenderer.createContaineråˆ›å»ºFiberRootï¼Œåœ¨åæœŸè°ƒåº¦æ›´æ–°çš„è¿‡ç¨‹ä¸­è¿™ä¸ªèŠ‚ç‚¹éå¸¸é‡è¦</span><br><span class="line"></span><br><span class="line">function legacyRenderSubtreeIntoContainer(</span><br><span class="line">  parentComponent: ?React$Component&lt;any, any&gt;,</span><br><span class="line">  children: ReactNodeList,</span><br><span class="line">  container: DOMContainer,</span><br><span class="line">  forceHydrate: boolean,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">) &#123;</span><br><span class="line">  var root = container._reactRootContainer;</span><br><span class="line">  var fiberRoot;</span><br><span class="line"></span><br><span class="line">  if (!root) &#123;</span><br><span class="line">    // Initial mount</span><br><span class="line">    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);</span><br><span class="line">    fiberRoot = root._internalRoot;</span><br><span class="line"></span><br><span class="line">    if (typeof callback === &apos;function&apos;) &#123;</span><br><span class="line">      var originalCallback = callback;</span><br><span class="line"></span><br><span class="line">      callback = function () &#123;</span><br><span class="line">        var instance = getPublicRootInstance(fiberRoot);</span><br><span class="line">        originalCallback.call(instance);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; // Initial mount should not be batched.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    unbatchedUpdates(function () &#123;</span><br><span class="line">      updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    fiberRoot = root._internalRoot;</span><br><span class="line"></span><br><span class="line">    if (typeof callback === &apos;function&apos;) &#123;</span><br><span class="line">      var _originalCallback = callback;</span><br><span class="line"></span><br><span class="line">      callback = function () &#123;</span><br><span class="line">        var instance = getPublicRootInstance(fiberRoot);</span><br><span class="line"></span><br><span class="line">        _originalCallback.call(instance);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; // Update</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return getPublicRootInstance(fiberRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function legacyCreateRootFromDOMContainer(</span><br><span class="line">  container: DOMContainer,</span><br><span class="line">  forceHydrate: boolean,</span><br><span class="line">): Root &#123;</span><br><span class="line">  var shouldHydrate = forceHydrate || shouldHydrateDueToLegacyHeuristic(container); // First clear any existing content.</span><br><span class="line"></span><br><span class="line">  if (!shouldHydrate) &#123;</span><br><span class="line">    var warned = false;</span><br><span class="line">    var rootSibling;</span><br><span class="line"></span><br><span class="line">    while (rootSibling = container.lastChild) &#123;</span><br><span class="line">      &#123;</span><br><span class="line">        if (!warned &amp;&amp; rootSibling.nodeType === ELEMENT_NODE &amp;&amp; rootSibling.hasAttribute(ROOT_ATTRIBUTE_NAME)) &#123;</span><br><span class="line">          warned = true;</span><br><span class="line"></span><br><span class="line">          error(&apos;render(): Target node has markup rendered by React, but there &apos; + &apos;are unrelated nodes as well. This is most commonly caused by &apos; + &apos;white-space inserted around server-rendered markup.&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      container.removeChild(rootSibling);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    if (shouldHydrate &amp;&amp; !forceHydrate &amp;&amp; !warnedAboutHydrateAPI) &#123;</span><br><span class="line">      warnedAboutHydrateAPI = true;</span><br><span class="line"></span><br><span class="line">      warn(&apos;render(): Calling ReactDOM.render() to hydrate server-rendered markup &apos; + &apos;will stop working in React v18. Replace the ReactDOM.render() call &apos; + &apos;with ReactDOM.hydrate() if you want React to attach to the server HTML.&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return new ReactDOMBlockingRoot(container, LegacyRoot, options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function ReactDOMBlockingRoot(container, tag, options) &#123;</span><br><span class="line">  this._internalRoot = createRootImpl(container, tag, options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOMRoot.prototype.render = ReactDOMBlockingRoot.prototype.render = function (children) &#123;</span><br><span class="line">  var root = this._internalRoot;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    if (typeof arguments[1] === &apos;function&apos;) &#123;</span><br><span class="line">      error(&apos;render(...): does not support the second callback argument. &apos; + &apos;To execute a side effect after rendering, declare it in a component body with useEffect().&apos;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var container = root.containerInfo;</span><br><span class="line"></span><br><span class="line">    if (container.nodeType !== COMMENT_NODE) &#123;</span><br><span class="line">      var hostInstance = findHostInstanceWithNoPortals(root.current);</span><br><span class="line"></span><br><span class="line">      if (hostInstance) &#123;</span><br><span class="line">        if (hostInstance.parentNode !== container) &#123;</span><br><span class="line">          error(&apos;render(...): It looks like the React-rendered content of the &apos; + &apos;root container was removed without using React. This is not &apos; + &apos;supported and will cause errors. Instead, call &apos; + &quot;root.unmount() to empty a root&apos;s container.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  updateContainer(children, root, null, null);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOMRoot.prototype.unmount = ReactDOMBlockingRoot.prototype.unmount = function () &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    if (typeof arguments[0] === &apos;function&apos;) &#123;</span><br><span class="line">      error(&apos;unmount(...): does not support a callback argument. &apos; + &apos;To execute a side effect after rendering, declare it in a component body with useEffect().&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  var root = this._internalRoot;</span><br><span class="line">  var container = root.containerInfo;</span><br><span class="line">  updateContainer(null, root, null, function () &#123;</span><br><span class="line">    unmarkContainerAsRoot(container);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function createRootImpl(container, tag, options) &#123;</span><br><span class="line">  // Tag is either LegacyRoot or Concurrent Root</span><br><span class="line">  var hydrate = options != null &amp;&amp; options.hydrate === true;</span><br><span class="line">  var hydrationCallbacks = options != null &amp;&amp; options.hydrationOptions || null;</span><br><span class="line">  var mutableSources = options != null &amp;&amp; options.hydrationOptions != null &amp;&amp; options.hydrationOptions.mutableSources || null;</span><br><span class="line">  var root = createContainer(container, tag, hydrate);</span><br><span class="line">  markContainerAsRoot(root.current, container);</span><br><span class="line">  var containerNodeType = container.nodeType;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    var rootContainerElement = container.nodeType === COMMENT_NODE ? container.parentNode : container;</span><br><span class="line">    listenToAllSupportedEvents(rootContainerElement);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (mutableSources) &#123;</span><br><span class="line">    for (var i = 0; i &lt; mutableSources.length; i++) &#123;</span><br><span class="line">      var mutableSource = mutableSources[i];</span><br><span class="line">      registerMutableSourceForHydration(root, mutableSource);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createContainer(containerInfo, tag, hydrate, hydrationCallbacks) &#123;</span><br><span class="line">  return createFiberRoot(containerInfo, tag, hydrate);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function createFiberRoot(containerInfo, tag, hydrate, hydrationCallbacks) &#123;</span><br><span class="line">  var root = new FiberRootNode(containerInfo, tag, hydrate);</span><br><span class="line">  // stateNode is any.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  var uninitializedFiber = createHostRootFiber(tag);</span><br><span class="line">  root.current = uninitializedFiber;</span><br><span class="line">  uninitializedFiber.stateNode = root;</span><br><span class="line">  initializeUpdateQueue(uninitializedFiber);</span><br><span class="line">  return root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function FiberRootNode(containerInfo, tag, hydrate) &#123;</span><br><span class="line">  this.tag = tag;</span><br><span class="line">  this.containerInfo = containerInfo;</span><br><span class="line">  this.pendingChildren = null;</span><br><span class="line">  this.current = null;</span><br><span class="line">  this.pingCache = null;</span><br><span class="line">  this.finishedWork = null;</span><br><span class="line">  this.timeoutHandle = noTimeout;</span><br><span class="line">  this.context = null;</span><br><span class="line">  this.pendingContext = null;</span><br><span class="line">  this.hydrate = hydrate;</span><br><span class="line">  this.callbackNode = null;</span><br><span class="line">  this.callbackPriority = NoLanePriority;</span><br><span class="line">  this.eventTimes = createLaneMap(NoLanes);</span><br><span class="line">  this.expirationTimes = createLaneMap(NoTimestamp);</span><br><span class="line">  this.pendingLanes = NoLanes;</span><br><span class="line">  this.suspendedLanes = NoLanes;</span><br><span class="line">  this.pingedLanes = NoLanes;</span><br><span class="line">  this.expiredLanes = NoLanes;</span><br><span class="line">  this.mutableReadLanes = NoLanes;</span><br><span class="line">  this.finishedLanes = NoLanes;</span><br><span class="line">  this.entangledLanes = NoLanes;</span><br><span class="line">  this.entanglements = createLaneMap(NoLanes);</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    this.mutableSourceEagerHydrationData = null;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    this.interactionThreadID = unstable_getThreadID();</span><br><span class="line">    this.memoizedInteractions = new Set();</span><br><span class="line">    this.pendingInteractionMap = new Map();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    switch (tag) &#123;</span><br><span class="line">      case BlockingRoot:</span><br><span class="line">        this._debugRootType = &apos;createBlockingRoot()&apos;;</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">      case ConcurrentRoot:</span><br><span class="line">        this._debugRootType = &apos;createRoot()&apos;;</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">      case LegacyRoot:</span><br><span class="line">        this._debugRootType = &apos;createLegacyRoot()&apos;;</span><br><span class="line">        break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function listenToAllSupportedEvents(rootContainerElement) &#123;</span><br><span class="line">  &#123;</span><br><span class="line">    if (rootContainerElement[listeningMarker]) &#123;</span><br><span class="line">      // Performance optimization: don&apos;t iterate through events</span><br><span class="line">      // for the same portal container or root node more than once.</span><br><span class="line">      // TODO: once we remove the flag, we may be able to also</span><br><span class="line">      // remove some of the bookkeeping maps used for laziness.</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rootContainerElement[listeningMarker] = true;</span><br><span class="line">    allNativeEvents.forEach(function (domEventName) &#123;</span><br><span class="line">      if (!nonDelegatedEvents.has(domEventName)) &#123;</span><br><span class="line">        listenToNativeEvent(domEventName, false, rootContainerElement, null);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      listenToNativeEvent(domEventName, true, rootContainerElement, null);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å…¶ä¸­DOMRendereræ˜¯react-reconciler/src/ReactFiberReconcilerï¼Œä»–çš„updateContainerå¦‚ä¸‹åœ¨è¿™é‡Œè®¡ç®—äº†ä¸€ä¸ªæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å«åšexpirationTimeï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¿™æ¬¡æ›´æ–°çš„ è¶…æ—¶æ—¶é—´ã€‚</span><br><span class="line"></span><br><span class="line"># ç„¶åè°ƒç”¨äº†updateContainerAtExpirationTimeï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œè°ƒç”¨äº†scheduleRootUpdateå°±éå¸¸é‡è¦äº†</span><br><span class="line"></span><br><span class="line">export function updateContainer(</span><br><span class="line">  element: ReactNodeList,</span><br><span class="line">  container: OpaqueRoot,</span><br><span class="line">  parentComponent: ?React$Component&lt;any, any&gt;,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">): ExpirationTime &#123;</span><br><span class="line">  const current = container.current</span><br><span class="line">  const currentTime = requestCurrentTime()</span><br><span class="line">  const expirationTime = computeExpirationForFiber(currentTime, current)</span><br><span class="line">  return updateContainerAtExpirationTime(</span><br><span class="line">    element,</span><br><span class="line">    container,</span><br><span class="line">    parentComponent,</span><br><span class="line">    expirationTime,</span><br><span class="line">    callback,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function updateContainerAtExpirationTime(</span><br><span class="line">  element: ReactNodeList,</span><br><span class="line">  container: OpaqueRoot,</span><br><span class="line">  parentComponent: ?React$Component&lt;any, any&gt;,</span><br><span class="line">  expirationTime: ExpirationTime,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">) &#123;</span><br><span class="line">  // TODO: If this is a nested container, this won&apos;t be the root.</span><br><span class="line">  const current = container.current</span><br><span class="line">  const context = getContextForSubtree(parentComponent)</span><br><span class="line">  if (container.context === null) &#123;</span><br><span class="line">    container.context = context</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    container.pendingContext = context</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return scheduleRootUpdate(current, element, expirationTime, callback)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># å¼€å§‹è°ƒåº¦</span><br><span class="line"># é¦–å…ˆè¦ç”Ÿæˆä¸€ä¸ªupdateï¼Œä¸ç®¡ä½ æ˜¯setStateè¿˜æ˜¯ReactDOM.renderé€ æˆçš„ React æ›´æ–°ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå«updateçš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šèµ‹å€¼ç»™Fiber.updateQueue</span><br><span class="line"># ç„¶åå°±æ˜¯è°ƒç”¨scheduleWorkã€‚æ³¨æ„åˆ°è¿™é‡Œä¹‹å‰setStateå’ŒReactDOM.renderæ˜¯ä¸ä¸€æ ·ï¼Œä½†è¿›å…¥schedulerWorkä¹‹åï¼Œå°±æ˜¯ä»»åŠ¡è°ƒåº¦çš„äº‹æƒ…äº†ï¼Œè·Ÿä¹‹å‰ä½ æ˜¯æ€ä¹ˆè°ƒç”¨çš„æ²¡æœ‰ä»»ä½•å…³ç³»</span><br><span class="line"></span><br><span class="line">function scheduleRootUpdate(</span><br><span class="line">  current: Fiber,</span><br><span class="line">  element: ReactNodeList,</span><br><span class="line">  expirationTime: ExpirationTime,</span><br><span class="line">  callback: ?Function,</span><br><span class="line">) &#123;</span><br><span class="line">  const update = createUpdate(expirationTime)</span><br><span class="line"></span><br><span class="line">  update.payload = &#123; element &#125;</span><br><span class="line"></span><br><span class="line">  callback = callback === undefined ? null : callback</span><br><span class="line">  if (callback !== null) &#123;</span><br><span class="line">    warningWithoutStack(</span><br><span class="line">      typeof callback === &apos;function&apos;,</span><br><span class="line">      &apos;render(...): Expected the last optional `callback` argument to be a &apos; +</span><br><span class="line">        &apos;function. Instead received: %s.&apos;,</span><br><span class="line">      callback,</span><br><span class="line">    )</span><br><span class="line">    update.callback = callback</span><br><span class="line">  &#125;</span><br><span class="line">  enqueueUpdate(current, update)</span><br><span class="line"></span><br><span class="line">  scheduleWork(current, expirationTime)</span><br><span class="line">  return expirationTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="2ã€cjsã€amdã€umdå’Œesm"><a href="#2ã€cjsã€amdã€umdå’Œesm" class="headerlink" title="2ã€cjsã€amdã€umdå’Œesm"></a>2ã€cjsã€amdã€umdå’Œesm</h4><pre><code>JavaScriptæœ€åˆä»…ç”¨äºäº¤äº’å¼æµè§ˆå™¨ã€‚ä¸Nodeä¸€èµ·ï¼Œå¯åœ¨éæµè§ˆå™¨ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚ç”±äºè¿™ä¸ªå› ç´ å’Œå…¶ä»–å› ç´ ï¼Œæ¨¡å—çš„æ ¼å¼ä¸å…¼å®¹ã€‚CJSã€AMDã€UMD å’Œ ESMéƒ½æ˜¯ç»™ Javascript æ·»åŠ æ¨¡å—åŒ–çš„æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•ï¼Œä½†è¿™äº›æ˜¯æ¯”è¾ƒé€šç”¨çš„ã€‚
</code></pre><p>  <strong>CJS</strong> ï¼ŒCommonJSï¼Œæ˜¯åŒæ­¥å¯¼å…¥æ¨¡å—ï¼Œæè¿°äº† exports å¯¹è±¡çš„ä½¿ç”¨ã€‚ NodeJSæ˜¯CommonJSæ ¼å¼çš„æœ€æµè¡Œå®ç°ã€‚ä¸å…è®¸åœ¨äº¤äº’å¼æµè§ˆå™¨ä¸­åŠ è½½CommonJSæ¨¡å—ï¼Œå®ƒå¿…é¡»ç»è¿‡è½¬æ¢å’Œæ‰“åŒ…ã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ï¼šéƒ½å¯ä»¥èµ·ä½œç”¨,å½“ CJS å¯¼å…¥æ—¶ï¼Œå®ƒä¼šç»™ä½ ä¸€ä¸ªå¯¼å…¥å¯¹è±¡çš„å‰¯æœ¬ã€‚</span></span><br><span class="line"><span class="keyword">const</span> doSomething = <span class="built_in">require</span>(<span class="string">'./doSomething.js'</span>); æˆ– <span class="keyword">const</span> React = <span class="built_in">require</span>(<span class="string">'react'</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºï¼š</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;...&#125;;</span><br></pre></td></tr></table></figure></p>
<pre><code>æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚
CommonJSè§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„ï¼Œç”±äºNode.jsä¸»è¦ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ï¼Œæ¨¡å—æ–‡ä»¶ä¸€èˆ¬éƒ½å·²ç»å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ï¼Œæ‰€ä»¥åŠ è½½èµ·æ¥æ¯”è¾ƒå¿«ï¼Œä¸ç”¨è€ƒè™‘éåŒæ­¥åŠ è½½çš„æ–¹å¼ï¼Œæ‰€ä»¥CommonJSè§„èŒƒæ¯”è¾ƒé€‚ç”¨
</code></pre><blockquote>
<p>ä¸»è¦ç‰¹ç‚¹ï¼š<br>æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ<br>æ¨¡å—å¯ä»¥å¤šæ¬¡åŠ è½½ï¼Œä½†æ˜¯åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™æ‰§è¡Œï¼Œç„¶åä¼šç¼“å­˜ä¸€ä»½ï¼Œåé¢å†å¼•ç”¨è¿”å›çš„éƒ½æ˜¯ç¼“å­˜<br>æ¨¡å—åŠ è½½çš„é¡ºåºæ˜¯æŒ‰ç…§å‡ºç°çš„ä½ç½®æ¥å®š<br>å› ä¸ºè¢«è¾“å‡ºçš„æ˜¯æ‹·è´å€¼ï¼Œåˆ™å¦‚æœåœ¨å¤–éƒ¨å¯¹æ¨¡å—ä»£ç å°±è¡Œä¿®æ”¹åˆ™ä¸ä¼šç”Ÿæ•ˆ<br>ä¸€èˆ¬ç”¨äºæœåŠ¡ç«¯çš„è§„èŒƒ</p>
</blockquote>
<p>  <strong>AMD</strong>ï¼ŒAsynchronously  Module Definitionï¼Œå¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œæè¿°äº†å¦‚ä½•åœ¨å‡å®šå°†JavaScriptæ¨¡å—åŠ è½½åˆ°äº¤äº’å¼æµè§ˆå™¨ä¸­çš„æƒ…å†µä¸‹æ†ç»‘JavaScriptæ¨¡å—ã€‚</p>
<p>  è·ŸCJSå¹¶ç§°é‡å¤§é€šç”¨æ¨¡å—è§„èŒƒï¼Œä¸»è¦ç”¨äºå®¢æˆ·ç«¯ï¼Œå› ä¸ºå®¢æˆ·ç«¯åœ¨åŠ è½½çš„æ—¶å€™ä¸»è¦çœ‹ä¸­åŠ è½½é€Ÿåº¦ï¼Œå¦‚æœåƒæ˜¯CJSé‚£æ ·åŒæ­¥æ‰§è¡Œçš„è¯ï¼Œåœ¨åŠ è½½ä¸€ä¸ªå¾ˆå¤§çš„ç»„ä»¶çš„æƒ…å†µä¸‹ä¼šç›¸å½“çš„è€½è¯¯æ—¶é—´ï¼Œæ‰€ä»¥å‚¬ç”Ÿäº†AMDå®¢æˆ·ç«¯çš„å¼‚æ­¥è§„èŒƒã€‚<br>  ç¬¬ä¸€ä¸ªå‚æ•°[module]ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„æˆå‘˜å°±æ˜¯è¦åŠ è½½çš„æ¨¡å—ï¼›ç¬¬äºŒä¸ªå‚æ•°callbackï¼Œåˆ™æ˜¯åŠ è½½æˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°ã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'lodash'</span>], <span class="function"><span class="keyword">function</span> (<span class="params">lh</span>) </span>&#123;</span><br><span class="line">  lo.isArray([]);</span><br><span class="line">  <span class="comment">// Define the module value by returning a value.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>  <strong>UMD</strong>ï¼ŒUniversal Module Definitionï¼Œé€šç”¨æ¨¡å—å®šä¹‰ï¼Œæ˜¯ä¸€ç§å°è¯•åˆ¶ä½œå¯è¢«ä½¿ç”¨çš„æ¨¡å—çš„æ¨¡å¼ã€‚ä¸ºäº†åŒæ—¶æ”¯æŒCJSå’ŒAMDçš„è§„èŒƒï¼Œåˆ¤æ–­è°çš„è§„èŒƒæ”¯æŒå°±ä½¿ç”¨è°çš„è§„èŒƒï¼Œä»–çš„æœ€å¤–å±‚æ˜¯ä¸€ä¸ªiifeã€‚<br>    åœ¨å‰ç«¯å’Œåç«¯éƒ½é€‚ç”¨ï¼ˆâ€œé€šç”¨â€å› æ­¤å¾—åï¼‰<br>    ä¸ CJS æˆ– AMD ä¸åŒï¼ŒUMD æ›´åƒæ˜¯ä¸€ç§é…ç½®å¤šä¸ªæ¨¡å—ç³»ç»Ÿçš„æ¨¡å¼ã€‚è¿™é‡Œå¯ä»¥æ‰¾åˆ°æ›´å¤šçš„æ¨¡å¼<br>    å½“ä½¿ç”¨ Rollup/Webpack ä¹‹ç±»çš„æ‰“åŒ…å™¨æ—¶ï¼ŒUMD é€šå¸¸ç”¨ä½œå¤‡ç”¨æ¨¡å—<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">root, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">"function"</span> &amp;&amp; define.amd) &#123;</span><br><span class="line">    define([<span class="string">"jquery"</span>, <span class="string">"underscore"</span>], factory);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> exports === <span class="string">"object"</span>) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = factory(<span class="built_in">require</span>(<span class="string">"jquery"</span>), <span class="built_in">require</span>(<span class="string">"underscore"</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    root.Requester = factory(root.$, root._);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$, _</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this is where I defined my module implementation</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Requester = &#123; ... &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Requester;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure></p>
<pre><code>æç„¶ï¼Œå› ä¸ºæˆ‘æ‰“å¼€çš„æ˜¯umd/react-dom.development.jsï¼Œæ‰€ä»¥ä¸Šé¢é‚£ä¹ˆå†™ï¼Œå…¶å®å«umdè§„èŒƒå†™æ³•ã€‚å“ˆå“ˆå“ˆã€‚
</code></pre><p>  <strong>ESM</strong>ï¼ŒECMAScript Moduleï¼Œ2015å®šä¹‰äº† export å’Œ import è¯­æ³•ï¼ˆä¸åŒäºä¸Šè¿°æ‰€æœ‰å†…å®¹ï¼‰ä»¥æ”¯æŒæ¨¡å—ã€‚<br>    å®ƒå…¼å…·ä¸¤æ–¹é¢çš„ä¼˜ç‚¹ï¼šå…·æœ‰ CJS çš„ç®€å•è¯­æ³•å’Œ AMD çš„å¼‚æ­¥<br>    å¾—ç›Šäº ES6 çš„é™æ€æ¨¡å—ç»“æ„ï¼Œå¯ä»¥è¿›è¡Œ Tree Shaking<br>    ESM å…è®¸åƒ Rollup è¿™æ ·çš„æ‰“åŒ…å™¨ï¼Œåˆ é™¤ä¸å¿…è¦çš„ä»£ç ï¼Œå‡å°‘ä»£ç åŒ…å¯ä»¥è·å¾—æ›´å¿«çš„åŠ è½½<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;foo, bar&#125; <span class="keyword">from</span> <span class="string">'./myLib'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// your Function</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> function1() &#123;...&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> function2() &#123;...&#125;;</span><br></pre></td></tr></table></figure></p>
<p>  ESMç”±äºå…·æœ‰ç®€å•çš„è¯­æ³•ï¼Œå¼‚æ­¥åŠ è½½çš„ç‰¹æ€§ï¼Œä»¥åŠTree-shakeableçš„ç‰¹æ€§ï¼Œå› æ­¤è¢«å¹¿æ³›ä½¿ç”¨ã€‚<br>  UMDå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ESMä¸èƒ½ä½¿ç”¨çš„æƒ…å†µä¸‹é€‰æ‹©UMDã€‚<br>  CJSæ˜¯åŒæ­¥çš„ï¼Œé€‚ç”¨äºåç«¯ç¯å¢ƒã€‚<br>  AMDæ˜¯å¼‚æ­¥çš„ï¼Œé€‚ç”¨äºå‰ç«¯ç¯å¢ƒã€‚</p>
<p>  åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†çœ‹ç›´æ¥çœ‹æºç çš„ç¬¬ä¸€æ­¥ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å†™ï¼Œè¿™å°±æ˜¯umdè§„èŒƒå–ã€‚å› ä¸ºæˆ‘æ‰“å¼€çš„æ˜¯umd/react-dom.development.jsï¼Œè™½ç„¶ä¹‹å‰ä¹Ÿä¸æ˜¯ååˆ†äº†è§£umdåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å°±æ˜¯è§‰å¾—åº”è¯¥çœ‹umdçš„ã€‚å“ˆå“ˆå“ˆã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">typeof</span> exports === <span class="string">'object'</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> ? factory(exports, <span class="built_in">require</span>(<span class="string">'react'</span>)) :</span><br><span class="line">  <span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd ? define([<span class="string">'exports'</span>, <span class="string">'react'</span>], factory) :</span><br><span class="line">  (global = global || self, factory(global.ReactDOM = &#123;&#125;, global.React));</span><br><span class="line">&#125;(<span class="keyword">this</span>, (<span class="function"><span class="keyword">function</span> (<span class="params">exports, React</span>) </span>&#123; </span><br><span class="line">  ...</span><br><span class="line">  exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED = Internals;</span><br><span class="line">  exports.createPortal = createPortal$<span class="number">1</span>;</span><br><span class="line">  exports.findDOMNode = findDOMNode;</span><br><span class="line">  exports.flushSync = flushSync;</span><br><span class="line">  exports.hydrate = hydrate;</span><br><span class="line">  exports.render = render;</span><br><span class="line">  exports.unmountComponentAtNode = unmountComponentAtNode;</span><br><span class="line">  exports.unstable_batchedUpdates = batchedUpdates$<span class="number">1</span>;</span><br><span class="line">  exports.unstable_createPortal = unstable_createPortal;</span><br><span class="line">  exports.unstable_renderSubtreeIntoContainer = renderSubtreeIntoContainer;</span><br><span class="line">  exports.version = ReactVersion;</span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure></p>
<p>  å…¶å®å¯¹äºè¿™ä¸ªæ¨¡å—åŒ–è¯é¢˜ï¼Œè¿˜å¯ä»¥æ¢ç´¢åœ°æ›´æ·±ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ä¸»é¢˜æ˜¯reactæºç ï¼Œå°±å…ˆåˆ°è¿™äº†ã€‚</p>
<h4 id="3ã€å…¶ä»–å°ç‚¹"><a href="#3ã€å…¶ä»–å°ç‚¹" class="headerlink" title="3ã€å…¶ä»–å°ç‚¹"></a>3ã€å…¶ä»–å°ç‚¹</h4><p>  <code>èŠ‚ç‚¹ç±»å‹ nodeType</code></p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹ç±»å‹</th>
<th>æè¿°</th>
<th>å­èŠ‚ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 Element</td>
<td>ä»£è¡¨å…ƒç´ </td>
<td>Element, Text, Comment, ProcessingInstruction, CDATASection, EntityReference</td>
</tr>
<tr>
<td>2 Attr</td>
<td>ä»£è¡¨å±æ€§</td>
<td>Text, EntityReference</td>
</tr>
<tr>
<td>3 Text</td>
<td>ä»£è¡¨å…ƒç´ æˆ–å±æ€§ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚</td>
<td>None</td>
</tr>
<tr>
<td>4 CDATASection</td>
<td>ä»£è¡¨æ–‡æ¡£ä¸­çš„ CDATA éƒ¨åˆ†ï¼ˆä¸ä¼šç”±è§£æå™¨è§£æçš„æ–‡æœ¬ï¼‰ã€‚</td>
<td>None</td>
</tr>
<tr>
<td>5 EntityReference</td>
<td>ä»£è¡¨å®ä½“å¼•ç”¨ã€‚</td>
<td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td>
</tr>
<tr>
<td>6 Entity</td>
<td>ä»£è¡¨å®ä½“ã€‚</td>
<td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td>
</tr>
<tr>
<td>7 ProcessingInstruction</td>
<td>ä»£è¡¨å¤„ç†æŒ‡ä»¤ã€‚</td>
<td>None</td>
</tr>
<tr>
<td>8 Comment</td>
<td>ä»£è¡¨æ³¨é‡Šã€‚</td>
<td>None</td>
</tr>
<tr>
<td>9 Document</td>
<td>ä»£è¡¨æ•´ä¸ªæ–‡æ¡£ï¼ˆDOM æ ‘çš„æ ¹èŠ‚ç‚¹ï¼‰ã€‚</td>
<td>Element, ProcessingInstruction, Comment, DocumentType</td>
</tr>
<tr>
<td>10 DocumentType</td>
<td>å‘ä¸ºæ–‡æ¡£å®šä¹‰çš„å®ä½“æä¾›æ¥å£</td>
<td>None</td>
</tr>
<tr>
<td>11 DocumentFragment</td>
<td>ä»£è¡¨è½»é‡çº§çš„ Document å¯¹è±¡ï¼Œèƒ½å¤Ÿå®¹çº³æ–‡æ¡£çš„æŸä¸ªéƒ¨åˆ†</td>
<td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td>
</tr>
<tr>
<td>12 Notation</td>
<td>ä»£è¡¨ DTD ä¸­å£°æ˜çš„ç¬¦å·ã€‚</td>
<td>None</td>
</tr>
</tbody>
</table>
<p>  <code>{ } å°é—­ä½œç”¨åŸŸ</code><br>  <code>!! çœŸå‡</code><br>  <code>â€˜â€™ + â€˜â€™ æ‹¼æ¥é•¿å­—ç¬¦ä¸²</code><br>  <code>â€˜xxxâ€™ + Math.random.toString(36).slice(2) æ‰“æ ‡è¯†</code></p>
<p>  å¼€å•ƒä¹‹åå°±ä¼šå‘ç°ï¼Œå°ä¸‘ ğŸ¤¡ æœç„¶è¿˜æ˜¯è‡ªå·±ï¼Œç›´æ¥ä¸Šå£çœŸæ˜¯åƒä¸æ¶ˆï¼Œè¿˜æ˜¯è¦æœ‰æ–¹æ³•å»çœ‹è¿™ç§å¤§æ¡†æ¶æºç ã€‚<br>  ä¸æ˜¯ä¸€æœä¸€å¤•çš„äº‹æƒ…ï¼Œè¦æœ‰è¶³å¤Ÿçš„è€å¿ƒå’Œæ—¶é—´æ‰è¡Œã€‚</p>
<h2 id="æ€ä¹ˆå­¦reactæºç "><a href="#æ€ä¹ˆå­¦reactæºç " class="headerlink" title="æ€ä¹ˆå­¦reactæºç "></a>æ€ä¹ˆå­¦reactæºç </h2><pre><code>ç›´æ¥çœ‹æºç ï¼Œå°±åƒæ˜¯ç›²äººæ‘¸è±¡ï¼Œä¸ï¼Œåº”è¯¥æ˜¯ç›²èš‚èš ğŸœ æ‘¸è±¡ ğŸ˜ï¼Œ è¿™ä¸æ˜¯ä¸€æœä¸€å¤•å°±èƒ½å®Œæˆçš„äº‹æƒ…ã€‚
ç—›å®šæ€ç—›ï¼šä¸€å®šè¦å…ˆæ‰¾å‡ºæˆ‘ä»¬çš„å¤§æ–¹å‘ï¼Œå¾ªåºæ¸è¿›ã€‚
è¾¹çœ‹æˆç†Ÿçš„ç»“è®ºï¼Œè¾¹çœ‹æºç å®ç°ï¼Œç›¸è¾…ç›¸æˆï¼Œåå¤éªŒè¯ã€‚
</code></pre>  <!-- - å‰äººçš„è‚©è†€æ¨èï¼š
    [React æºç è§£æ](https://react.jokcy.me/) ï¼Œä»APIçš„è§’åº¦è§£æreactã€‚
    [å…¨æ ˆæ½‡æ™¨-reactæºç è§£æ](https://xiaochen1024.com/courseware/60b1b2f6cf10a4003b634718/60b1b311cf10a4003b634719)ï¼Œä»APIå’ŒæŠ½è±¡è§’åº¦è§£æreactã€‚
    [Reactå®˜æ–¹-å®ç°è¯´æ˜](https://zh-hans.reactjs.org/docs/implementation-notes.html)
  - æºç å¯ä»¥ç›´æ¥ download react æºç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥çœ‹åŒ…ä¸­çš„umdçš„development.jsã€‚ -->
<p>  çœ‹æˆ‘ä»¬å¸¦ç€ä»€ä¹ˆæ ·çš„ç›®çš„å»çœ‹reactæºç </p>
<p><br><br><br><br><br><br><br></p>
<h1 id="äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ"><a href="#äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ" class="headerlink" title="äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ"></a>äºŒã€reactæºç æ¡†æ¶æ€»è§ˆ</h1><p>  æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ·±å…¥äº†è§£ï¼Œç„¶ååˆ¶å®šå‡ºç›¸å¯¹æ»¡æ„çš„é•¿æœŸå­¦ä¹ è®¡åˆ’ã€‚ä»ä¸Šå¸è§†è§’ï¼Œä¿¯å†²å‘ä¸‹ï¼Œç›´è‡³ä¸€ä¸ªä¸ªå¹³æ°‘ã€‚<br>  <div class="post-desc">reactçš„æ ¸å¿ƒå¯ä»¥ç”¨ui = fn(state)æ¥è¡¨ç¤ºï¼Œæ›´è¯¦ç»†å¯ä»¥ç”¨ï¼š<br>    const state = reconcile (update);<br>    const UI = commit (state);<br>  </div></p>
<p>  çŠ¶æ€æ›´æ–°è§†å›¾ï¼Œè°ƒåº¦å™¨ï¼Œåè°ƒå™¨ï¼Œæ¸²æŸ“å™¨ã€‚<br>  <canvas id="react-zong" width="500" height="390"></canvas></p>
  <script>const oReactZong = document.getElementById('react-zong');const oReactZongPen = oReactZong.getContext('2d');oReactZongPen.fillText('jsx', 28, 220);oReactZongPen.fillText('task2', 155, 133);oReactZongPen.fillText('ä¸­ä¼˜å…ˆçº§', 150, 146);oReactZongPen.fillText('task3', 155, 165);oReactZongPen.fillText('ä½ä¼˜å…ˆçº§', 150, 175);oReactZongPen.fillText('task1', 268, 133);oReactZongPen.fillText('é«˜ä¼˜å…ˆçº§', 260, 146);oReactZongPen.fillStyle='blue';oReactZongPen.fillText('mount/update', 2, 190);oReactZongPen.fillText('renderé˜¶æ®µ', 250, 100);oReactZongPen.fillText('åœ¨å†…å­˜ä¸­è¿›è¡Œ', 180, 350);oReactZongPen.fillText('commité˜¶æ®µ', 410, 100);oReactZongPen.font = '14px sans-serif';oReactZongPen.fillText('Scheduler', 135, 210);oReactZongPen.fillText('ï¼ˆè°ƒåº¦å™¨ï¼‰', 130, 225);oReactZongPen.fillText('Reconciler', 245, 210);oReactZongPen.fillText('ï¼ˆåè°ƒå™¨ï¼‰', 239, 225);oReactZongPen.fillText('Renderer', 409, 210);oReactZongPen.fillText('ï¼ˆæ¸²æŸ“å™¨ï¼‰', 405, 225);oReactZongPen.lineWidth = 0.5;oReactZongPen.strokeStyle = 'black';oReactZongPen.beginPath();oReactZongPen.setLineDash([2]);oReactZongPen.strokeRect( 5 , 203 , 60, 30 );oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.arc(305, 90, 20, -Math.PI/2 , Math.PI, true);oReactZongPen.arc(265, 90, 20, 0, -Math.PI/2, true);oReactZongPen.font = '10px sans-serif';oReactZongPen.fillStyle='black';oReactZongPen.fillText('æ ¹æ®updateè®¡ç®—state', 240, 40);oReactZongPen.fillText('diffç®—æ³•', 270, 52);oReactZongPen.fillText('ç»™Fiberæ‰“ä¸ŠFlags', 250, 64);oReactZongPen.lineTo(233, 70);oReactZongPen.lineTo(233, 25);oReactZongPen.lineTo(343, 25);oReactZongPen.lineTo(343, 70);oReactZongPen.closePath();oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.arc(460, 90, 20, -Math.PI/2 , Math.PI, true);oReactZongPen.arc(420, 90, 20, 0, -Math.PI/2, true);oReactZongPen.fillText('react-dom', 415, 28);oReactZongPen.fillText('react-art', 415, 40);oReactZongPen.fillText('......', 420, 52);oReactZongPen.fillText('æ“ä½œDOM', 415, 64);oReactZongPen.lineTo(400, 70);oReactZongPen.lineTo(400, 15);oReactZongPen.lineTo(480, 15);oReactZongPen.lineTo(480, 70);oReactZongPen.closePath();oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.arc(150, 90, 20, -Math.PI/2 , Math.PI, true);oReactZongPen.arc(110, 90, 20, 0, -Math.PI/2, true);oReactZongPen.font = '10px sans-serif';oReactZongPen.fillStyle='black';oReactZongPen.fillText('å¦‚æœä½ä¼˜å…ˆçº§taskè¢«æ‰“æ–­ï¼Œ', 75, 40);oReactZongPen.fillText('ä¹Ÿåªæ˜¯å‘ç”Ÿåœ¨å†…å­˜ä¸­ï¼Œ', 85, 52);oReactZongPen.fillText('ä¸å½±å“çœŸå®èŠ‚ç‚¹', 95, 64);oReactZongPen.lineTo(64, 70);oReactZongPen.lineTo(64, 25);oReactZongPen.lineTo(200, 25);oReactZongPen.lineTo(200, 70);oReactZongPen.closePath();oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.strokeRect( 98 , 85 , 260 , 280 );oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.setLineDash([]);oReactZongPen.lineTo(65, 220);oReactZongPen.lineTo(123, 220);oReactZongPen.fillStyle='black';oReactZongPen.fillText('â†’' , 119, 223);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.strokeRect( 130 , 120 , 80 , 200 );oReactZongPen.setLineDash([2]);oReactZongPen.lineTo(130, 150);oReactZongPen.lineTo(210, 150);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.lineTo(130, 180);oReactZongPen.lineTo(210, 180);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.setLineDash([]);oReactZongPen.strokeRect( 240 , 120 , 80 , 200 );oReactZongPen.setLineDash([2]);oReactZongPen.lineTo(240, 150);oReactZongPen.lineTo(320, 150);oReactZongPen.stroke();oReactZongPen.beginPath();oReactZongPen.setLineDash([]);oReactZongPen.strokeRect( 400 , 120 , 80 , 200 );</script>


<p>  <img src="https://img-blog.csdnimg.cn/img_convert/f81d27cf172e1ea3718b9d54cdf8e307.png" alt="tusods"></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºæ›´æ–°</span><br><span class="line">    ReactDOM.render</span><br><span class="line">    setState &amp; forceUpdate</span><br><span class="line">    expirationTime è®¡ç®—</span><br><span class="line">ä»»åŠ¡è°ƒåº¦</span><br><span class="line">    å…¨å±€å˜é‡</span><br><span class="line">    scheduleWork</span><br><span class="line">    react-scheduler</span><br><span class="line">    performWork</span><br><span class="line">    performUnitOfWork</span><br><span class="line">    renderRoot</span><br><span class="line">    beginWork</span><br><span class="line">    reconcileChildren</span><br><span class="line">commit é˜¶æ®µ</span><br><span class="line">    commitRoot</span><br><span class="line">    invokeGuardedCallback</span><br><span class="line">    commitBeforeMutationLifecycles</span><br><span class="line">    commitAllHostEffects</span><br><span class="line">    commitPlacement</span><br><span class="line">åŠŸèƒ½</span><br><span class="line">    context</span><br><span class="line">    hydrate</span><br><span class="line">    ref</span><br><span class="line">    äº‹ä»¶ç³»ç»Ÿåˆå§‹åŒ–</span><br><span class="line">    äº‹ä»¶ç»‘å®š</span><br><span class="line">    äº‹ä»¶è§¦å‘</span><br><span class="line">    äº‹ä»¶å¯¹è±¡ç”Ÿæˆ</span><br><span class="line">    Suspense</span><br><span class="line">    æŒ‚èµ·ä»»åŠ¡çš„å«ä¹‰</span><br><span class="line">    lazy ç»„ä»¶</span><br></pre></td></tr></table></figure>
<p>  fiberRootæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ï¼Œåªå­˜åœ¨ä¸€ä¸ªï¼ŒrootFiberæ˜¯åº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªï¼Œä¾‹å¦‚å¤šä¸ªReactDOM.render(&lt; App /&gt;, document.getElementById(â€œrootâ€));åˆ›å»ºå¤šä¸ªåº”ç”¨èŠ‚ç‚¹</p>
<h2 id="jsx"><a href="#jsx" class="headerlink" title="jsx"></a>jsx</h2><p>  <code>jsx</code> å£°æ˜å¼åœ°ç¼–å†™æˆ‘ä»¬æƒ³è¦çš„UIæ•ˆæœï¼Œæœ¬è´¨ä¸Šæ˜¯React.createElementçš„è¯­æ³•ç³–ã€‚è¯­æ³•ç³–çš„æ„æ€å°±æ˜¯äºŒè€…æœ¬è´¨æ˜¯ç­‰ä»·çš„ï¼Œåªæ˜¯è£¹äº†ä¸€å±‚ç³–è¡£ï¼ˆå†™èµ·æ¥æ›´ç”œæ›´ç®€å•ç›´æ¥ï¼‰ã€‚è¿™å±‚ç³–è¡£å°±æ˜¯babelæ¥åšçš„ï¼Œreacté€šè¿‡babelè¯æ³•è§£æï¼Œå°†jsxè½¬æ¢æˆReact.createElementã€‚</p>
<p>  React.createElementæ–¹æ³•è¿”å›virtual domå¯¹è±¡ï¼ˆå†…å­˜ä¸­ç”¨æ¥æè¿°domé˜¶æ®µçš„å¯¹è±¡ï¼‰ã€‚</p>
<h2 id="FiberåŒç¼“å­˜"><a href="#FiberåŒç¼“å­˜" class="headerlink" title="FiberåŒç¼“å­˜"></a>FiberåŒç¼“å­˜</h2><pre><code>Fiberå¯¹è±¡æ˜ å°„èŠ‚ç‚¹ä¿¡æ¯ã€‚Fiberå¯¹è±¡ï¼ˆFiberRootNodeã€FiberNodeï¼‰ä¸Šä¿å­˜äº†è¿™ä¸ªèŠ‚ç‚¹çš„å±æ€§ã€ç±»å‹ã€domï¼ˆchildã€siblingï¼‰ç­‰ï¼ŒFiberé€šè¿‡childã€siblingã€returnï¼ˆæŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼‰æ¥å½¢æˆFiberæ ‘ã€‚è¿˜ä¿å­˜äº†æ›´æ–°çŠ¶æ€æ—¶ç”¨äºè®¡ç®—stateçš„updateQueueï¼ŒupdateQueueæ˜¯ä¸€ç§é“¾è¡¨ç»“æ„ï¼Œä¸Šé¢å¯èƒ½å­˜åœ¨å¤šä¸ªæœªè®¡ç®—çš„updateï¼Œupdateä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸Šé¢åŒ…å«äº†æ›´æ–°çš„æ•°æ®ã€ä¼˜å…ˆçº§ç­‰ï¼Œé™¤äº†è¿™äº›ä¹‹å¤–ï¼Œä¸Šé¢è¿˜æœ‰å’Œå‰¯ä½œç”¨æœ‰å…³çš„ä¿¡æ¯ã€‚

åŒç¼“å­˜æ˜¯æŒ‡æœ‰ä¸¤æ£µFiberæ ‘ï¼Œcurrent Fiberæ ‘æè¿°äº†å½“å‰å·²ç»å‘ˆç°çš„domæ ‘ï¼ŒworkInProgress Fiberæ ‘æ˜¯æ­£åœ¨æ›´æ–°çš„Fiberæ ‘ã€‚å½“workInProgress Fiberæ ‘æ„å»ºå®Œæˆåï¼Œä¼šå°†å…¶ä½œä¸ºcurrent Fiberæ ‘æ›´æ–°åˆ°çœŸå®Domæ ‘ä¸Šã€‚

åœ¨mountï¼ˆè£…è½½ï¼Œé¦–æ¬¡æ¸²æŸ“ï¼‰æ—¶ï¼Œä¼šæ ¹æ®jsxå¯¹è±¡ï¼ˆclass componentçš„renderå‡½æ•°æˆ–è€…Function Componentçš„è¿”å›å€¼ï¼‰ç”ŸæˆworkInProgress Fiberæ ‘ï¼ŒæŠŠworkInProgress Fiberåˆ‡æ¢æˆcurrent Fiberï¼ŒCurrent Fiberæ ‘åº”ç”¨åˆ°çœŸå®çš„domä¸Šã€‚åœ¨updateï¼ˆçŠ¶æ€æ›´æ–°ï¼Œå¦‚setStateï¼‰æ—¶ï¼Œä¼šæ ¹æ®çŠ¶æ€æ›´æ–°åçš„jsxå¯¹è±¡å’ŒCurrent fiberæ ‘ä½œå¯¹æ¯”é€æ¸å½¢æˆæ–°çš„workInProgress Fiberæ ‘ï¼ŒworkInProgress Fiberæ„å»ºå®Œæˆåä¼šæ›¿æ¢æˆCurrent Fiberï¼Œæ›´æ–°åˆ°çœŸå®çš„domä¸Šã€‚è€Œè¿™ä¸€åˆ‡éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ï¼Œå‡å°‘çœŸå®domæ¸²æŸ“è€—æ€§èƒ½ã€‚

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function App() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line">  return (</span><br><span class="line">    &lt;h1</span><br><span class="line">      onClick=&#123;() =&gt; &#123;</span><br><span class="line">        setCount(() =&gt; count + 1);</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">        &lt;p title=&#123;count&#125;&gt;&#123;count&#125;&lt;/p&gt; jyy</span><br><span class="line">    &lt;/h1&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.getElementById(&quot;root&quot;));</span><br></pre></td></tr></table></figure>
</code></pre>  <canvas id="react-fiber" width="600" height="500"></canvas>

  <script>const oReactFiber = document.getElementById('react-fiber');const oReactFiberPen = oReactFiber.getContext('2d');oReactFiberPen.font = '14px sans-serif';oReactFiberPen.fillStyle='black';oReactFiberPen.strokeRect(245, 10, 110, 40);oReactFiberPen.strokeRect(160, 120, 90, 40);oReactFiberPen.strokeRect(160, 210, 90, 40);oReactFiberPen.strokeRect(160, 300, 90, 40);oReactFiberPen.strokeRect(160, 390, 90, 40);oReactFiberPen.strokeRect(30, 391, 50, 38);oReactFiberPen.strokeRect(348, 120, 90, 40);oReactFiberPen.strokeRect(348, 210, 90, 40);oReactFiberPen.strokeRect(348, 300, 90, 40);oReactFiberPen.strokeRect(348, 390, 90, 40);oReactFiberPen.strokeRect(520, 391, 50, 38);oReactFiberPen.beginPath();oReactFiberPen.lineTo(245, 50);oReactFiberPen.lineTo(180, 120);oReactFiberPen.lineTo(181, 111);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(180, 120);oReactFiberPen.lineTo(190, 117);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 120);oReactFiberPen.lineTo(285, 50);oReactFiberPen.lineTo(284, 59);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(285, 50);oReactFiberPen.lineTo(275, 54);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 160);oReactFiberPen.lineTo(200, 210);oReactFiberPen.lineTo(196, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 210);oReactFiberPen.lineTo(204, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 250);oReactFiberPen.lineTo(200, 300);oReactFiberPen.lineTo(196, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 300);oReactFiberPen.lineTo(204, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 340);oReactFiberPen.lineTo(200, 391);oReactFiberPen.lineTo(196, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(200, 391);oReactFiberPen.lineTo(204, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 210);oReactFiberPen.lineTo(220, 160);oReactFiberPen.lineTo(216, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 160);oReactFiberPen.lineTo(224, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 300);oReactFiberPen.lineTo(220, 250);oReactFiberPen.lineTo(216, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 250);oReactFiberPen.lineTo(224, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 391);oReactFiberPen.lineTo(220, 340);oReactFiberPen.lineTo(216, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(220, 340);oReactFiberPen.lineTo(224, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 160);oReactFiberPen.lineTo(388, 210);oReactFiberPen.lineTo(384, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 210);oReactFiberPen.lineTo(392, 206);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 250);oReactFiberPen.lineTo(388, 300);oReactFiberPen.lineTo(384, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 300);oReactFiberPen.lineTo(392, 296);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 340);oReactFiberPen.lineTo(388, 391);oReactFiberPen.lineTo(384, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(388, 391);oReactFiberPen.lineTo(392, 387);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 210);oReactFiberPen.lineTo(408, 160);oReactFiberPen.lineTo(404, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 160);oReactFiberPen.lineTo(412, 164);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 300);oReactFiberPen.lineTo(408, 250);oReactFiberPen.lineTo(404, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 250);oReactFiberPen.lineTo(412, 254);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 391);oReactFiberPen.lineTo(408, 340);oReactFiberPen.lineTo(404, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(408, 340);oReactFiberPen.lineTo(412, 344);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(160, 410);oReactFiberPen.lineTo(80, 410);oReactFiberPen.lineTo(85, 406);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(80, 410);oReactFiberPen.lineTo(85, 414);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(60, 391);oReactFiberPen.lineTo(160, 320);oReactFiberPen.lineTo(150, 324);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(160, 320);oReactFiberPen.lineTo(153, 329);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(438, 410);oReactFiberPen.lineTo(520, 410);oReactFiberPen.lineTo(515, 406);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(520, 410);oReactFiberPen.lineTo(515, 414);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(540, 391);oReactFiberPen.lineTo(438, 320);oReactFiberPen.lineTo(443, 328);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(438, 320);oReactFiberPen.lineTo(448, 322);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 140);oReactFiberPen.lineTo(348, 140);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 230);oReactFiberPen.lineTo(348, 230);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 320);oReactFiberPen.lineTo(348, 320);oReactFiberPen.stroke();oReactFiberPen.beginPath();oReactFiberPen.lineTo(250, 410);oReactFiberPen.lineTo(348, 410);oReactFiberPen.stroke();oReactFiberPen.setLineDash([2]);oReactFiberPen.strokeRect(20, 76, 250, 400);oReactFiberPen.strokeRect(330, 76, 250, 400);oReactFiberPen.fillStyle='#4F2F64';oReactFiberPen.fillText('fiberRootNode', 253, 35);oReactFiberPen.fillText('rootFiber', 175, 144);oReactFiberPen.fillText('App', 192, 234);oReactFiberPen.fillText('h1', 198, 325);oReactFiberPen.fillText('p', 202, 414);oReactFiberPen.fillText('jyy', 45, 415);oReactFiberPen.fillText('rootFiber', 365, 144);oReactFiberPen.fillText('App', 378, 234);oReactFiberPen.fillText('h1', 384, 325);oReactFiberPen.fillText('p', 390, 414);oReactFiberPen.fillText('jyy', 536, 415);oReactFiberPen.fillStyle='#E22312';oReactFiberPen.fillText('Current Fiber', 60, 58);oReactFiberPen.fillText('WorkInProgress Fiber', 400, 58);oReactFiberPen.fillStyle='#21AFF2';oReactFiberPen.fillText('current', 150, 100);oReactFiberPen.fillText('stateNode', 249, 100);oReactFiberPen.fillText('child', 166, 190);oReactFiberPen.fillText('return ', 225, 190);oReactFiberPen.fillText('child', 166, 281);oReactFiberPen.fillText('return', 225, 281);oReactFiberPen.fillText('child', 166, 368);oReactFiberPen.fillText('return', 225, 368);oReactFiberPen.fillText('sibling', 104, 405);oReactFiberPen.fillText('return', 63, 355);oReactFiberPen.fillText('child', 353, 190);oReactFiberPen.fillText('return ', 412, 190);oReactFiberPen.fillText('child', 353, 281);oReactFiberPen.fillText('return', 412, 281);oReactFiberPen.fillText('child', 353, 368);oReactFiberPen.fillText('return', 412, 368);oReactFiberPen.fillText('sibling', 462, 405);oReactFiberPen.fillText('return', 495, 355);oReactFiberPen.fillText('alternate', 272, 136);oReactFiberPen.fillText('alternate', 272, 226);oReactFiberPen.fillText('alternate', 272, 316);oReactFiberPen.fillText('alternate', 272, 406);</script>


<h2 id="scheduler"><a href="#scheduler" class="headerlink" title="scheduler"></a>scheduler</h2><pre><code>Schedulerçš„ä½œç”¨æ˜¯è°ƒåº¦ä»»åŠ¡ï¼Œreact15æ²¡æœ‰Schedulerè¿™éƒ¨åˆ†ï¼Œæ‰€ä»¥æ‰€æœ‰ä»»åŠ¡æ²¡æœ‰ä¼˜å…ˆçº§ï¼Œä¹Ÿä¸èƒ½ä¸­æ–­ï¼Œåªèƒ½åŒæ­¥æ‰§è¡Œã€‚

æˆ‘ä»¬çŸ¥é“äº†è¦å®ç°å¼‚æ­¥å¯ä¸­æ–­çš„æ›´æ–°ï¼Œéœ€è¦æµè§ˆå™¨æŒ‡å®šä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´å‰©ä½™äº†å°±éœ€è¦æš‚åœä»»åŠ¡ï¼ŒrequestIdleCallbackè²Œä¼¼æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯å®ƒå­˜åœ¨å…¼å®¹å’Œè§¦å‘ä¸ç¨³å®šçš„åŸå› ï¼Œreact17ä¸­é‡‡ç”¨MessageChannelæ¥å®ç°ã€‚

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoopConcurrent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Perform work until Scheduler asks us to yield</span></span><br><span class="line">  <span class="keyword">while</span> (workInProgress !== <span class="literal">null</span> &amp;&amp; !shouldYield()) &#123;</span><br><span class="line">    performUnitOfWork(workInProgress);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

åœ¨Schedulerä¸­çš„æ¯çš„æ¯ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ä½¿ç”¨è¿‡æœŸæ—¶é—´è¡¨ç¤ºçš„ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡çš„è¿‡æœŸæ—¶é—´ç¦»ç°åœ¨å¾ˆè¿‘ï¼Œè¯´æ˜å®ƒé©¬ä¸Šå°±è¦è¿‡æœŸäº†ï¼Œä¼˜å…ˆçº§å¾ˆé«˜ï¼Œå¦‚æœè¿‡æœŸæ—¶é—´å¾ˆé•¿ï¼Œé‚£å®ƒçš„ä¼˜å…ˆçº§å°±ä½ï¼Œæ²¡æœ‰è¿‡æœŸçš„ä»»åŠ¡å­˜æ”¾åœ¨timerQueueä¸­ï¼Œè¿‡æœŸçš„ä»»åŠ¡å­˜æ”¾åœ¨taskQueueä¸­ï¼ŒtimerQueueå’ŒtimerQueueéƒ½æ˜¯å°é¡¶å †ï¼Œæ‰€ä»¥peekå–å‡ºæ¥çš„éƒ½æ˜¯ç¦»ç°åœ¨æ—¶é—´æœ€è¿‘ä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åä¼˜å…ˆæ‰§è¡Œå®ƒã€‚
</code></pre>  <!-- ## Laneæ¨¡å‹ -->
<h2 id="reconcilerï¼ˆrender-é˜¶æ®µï¼‰"><a href="#reconcilerï¼ˆrender-é˜¶æ®µï¼‰" class="headerlink" title="reconcilerï¼ˆrender é˜¶æ®µï¼‰"></a>reconcilerï¼ˆrender é˜¶æ®µï¼‰</h2><pre><code>åè°ƒå™¨æ˜¯åœ¨renderé˜¶æ®µå·¥ä½œçš„ï¼Œç®€å•ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯Reconcilerä¼šåˆ›å»ºæˆ–è€…æ›´æ–°FiberèŠ‚ç‚¹ã€‚åœ¨mountçš„æ—¶å€™ä¼šæ ¹æ®jsxç”ŸæˆFiberå¯¹è±¡ï¼Œåœ¨updateçš„æ—¶å€™ä¼šæ ¹æ®æœ€æ–°çš„stateå½¢æˆçš„jsxå¯¹è±¡å’Œcurrent Fiberæ ‘å¯¹æ¯”æ„å»ºworkInProgress Fiberæ ‘ï¼Œè¿™ä¸ªå¯¹æ¯”çš„è¿‡ç¨‹å°±æ˜¯diffç®—æ³•ã€‚

diffç®—æ³•å‘ç”Ÿåœ¨renderé˜¶æ®µçš„reconcileChildFiberså‡½æ•°ä¸­ï¼Œdiffç®—æ³•åˆ†ä¸ºå•èŠ‚ç‚¹çš„diffå’Œå¤šèŠ‚ç‚¹çš„diffï¼ˆä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹å°±å±äºå¤šèŠ‚ç‚¹çš„diffï¼‰ï¼Œå•èŠ‚ç‚¹ä¼šæ ¹æ®èŠ‚ç‚¹çš„keyå’Œtypeï¼Œpropsç­‰æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¤ç”¨è¿˜æ˜¯ç›´æ¥æ–°åˆ›å»ºèŠ‚ç‚¹ï¼Œå¤šèŠ‚ç‚¹diffä¼šæ¶‰åŠèŠ‚ç‚¹çš„å¢åˆ å’ŒèŠ‚ç‚¹ä½ç½®çš„å˜åŒ–ã€‚

reconcileæ—¶ä¼šåœ¨è¿™äº›Fiberä¸Šæ‰“ä¸ŠFlagsæ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾ä»£è¡¨èŠ‚ç‚¹çš„å¢åˆ æ”¹ï¼Œåœ¨commité˜¶æ®µæŠŠè¿™äº›æ ‡ç­¾åº”ç”¨åˆ°çœŸå®domä¸Šã€‚

renderé˜¶æ®µéå†Fiberæ ‘ç±»ä¼¼dfsçš„è¿‡ç¨‹ï¼Œâ€˜æ•è·â€™é˜¶æ®µå‘ç”Ÿåœ¨beginWorkå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°åšçš„ä¸»è¦å·¥ä½œæ˜¯åˆ›å»ºFiberèŠ‚ç‚¹ï¼Œè®¡ç®—stateå’Œdiffç®—æ³•ï¼Œâ€˜å†’æ³¡â€™é˜¶æ®µå‘ç”Ÿåœ¨completeWorkä¸­ï¼Œè¯¥å‡½æ•°ä¸»è¦æ˜¯åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚å¤„ç†èŠ‚ç‚¹çš„propsã€å’Œå½¢æˆä¸€æ¡effectListçš„é“¾è¡¨ï¼Œè¯¥é“¾è¡¨æ˜¯è¢«æ ‡è®°äº†æ›´æ–°çš„èŠ‚ç‚¹å½¢æˆçš„é“¾è¡¨ã€‚ï¼ˆå¯ä»¥çœ‹ä¸Šé¢ FiberåŒç¼“å­˜ é‚£å¼ å›¾ï¼Œè‡ªä¸Šè€Œä¸‹çš„æ˜¯beginWorkï¼Œè‡ªä¸‹è€Œä¸Šæ˜¯completeWorkï¼‰
</code></pre><h2 id="rendererï¼ˆcommit-é˜¶æ®µï¼‰"><a href="#rendererï¼ˆcommit-é˜¶æ®µï¼‰" class="headerlink" title="rendererï¼ˆcommit é˜¶æ®µï¼‰"></a>rendererï¼ˆcommit é˜¶æ®µï¼‰</h2><pre><code>Rendereræ˜¯åœ¨commité˜¶æ®µå·¥ä½œçš„ï¼Œcommité˜¶æ®µä¼šéå†renderé˜¶æ®µå½¢æˆçš„effectListï¼Œå¹¶æ‰§è¡ŒçœŸå®domèŠ‚ç‚¹çš„æ“ä½œå’Œä¸€äº›ç”Ÿå‘½å‘¨æœŸï¼Œä¸åŒå¹³å°å¯¹åº”çš„Rendererä¸åŒï¼Œä¾‹å¦‚æµè§ˆå™¨å¯¹åº”çš„å°±æ˜¯react-domã€‚

commité˜¶æ®µå‘ç”Ÿåœ¨commitRootå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ä¸»è¦éå†effectListï¼Œåˆ†åˆ«ç”¨ä¸‰ä¸ªå‡½æ•°æ¥å¤„ç†effectListä¸Šçš„èŠ‚ç‚¹ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°æ˜¯commitBeforeMutationEffectsã€commitMutationEffectsã€commitLayoutEffectsï¼Œä»–ä»¬ä¸»è¦åšçš„äº‹æƒ…å¦‚ä¸‹ï¼Œåé¢ä¼šè¯¦ç»†ç ”ç©¶ï¼Œç°åœ¨åœ¨å¤§è„‘é‡Œæœ‰ä¸€ä¸ªç»“æ„å°±è¡Œã€‚
</code></pre><h2 id="concurrent"><a href="#concurrent" class="headerlink" title="concurrent"></a>concurrent</h2><pre><code>å®ƒæ˜¯ä¸€ç±»åŠŸèƒ½çš„åˆé›†ï¼ˆå¦‚fiberã€schdulerã€laneã€suspenseï¼‰ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦ï¼Œä½¿åº”ç”¨cpuå¯†é›†å‹çš„æ›´æ–°ä¸å†é‚£ä¹ˆå¡é¡¿ï¼Œå…¶æ ¸å¿ƒæ˜¯å®ç°äº†ä¸€å¥—å¼‚æ­¥å¯ä¸­æ–­ã€å¸¦ä¼˜å…ˆçº§çš„æ›´æ–°ã€‚

ä¸€èˆ¬æµè§ˆå™¨çš„fpsæ˜¯60Hzï¼Œä¹Ÿå°±æ˜¯æ¯16.6msä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œè€Œjsæ‰§è¡Œçº¿ç¨‹å’ŒGUIï¼ˆä¹Ÿå°±æ˜¯æµè§ˆå™¨çš„ç»˜åˆ¶ï¼‰æ˜¯äº’æ–¥çš„ï¼Œå› ä¸ºjså¯ä»¥æ“ä½œdomï¼Œå½±å“æœ€åå‘ˆç°çš„ç»“æœï¼Œæ‰€ä»¥å¦‚æœjsæ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨æ²¡æ—¶é—´ç»˜åˆ¶domï¼Œé€ æˆå¡é¡¿ã€‚react17ä¼šåœ¨æ¯ä¸€å¸§åˆ†é…ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶é—´ç‰‡ï¼‰ç»™jsæ‰§è¡Œï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…jsè¿˜æ²¡æ‰§è¡Œå®Œï¼Œé‚£å°±è¦æš‚åœå®ƒçš„æ‰§è¡Œï¼Œç­‰ä¸‹ä¸€å¸§ç»§ç»­æ‰§è¡Œï¼ŒæŠŠæ‰§è¡Œæƒäº¤å›ç»™æµè§ˆå™¨å»ç»˜åˆ¶ã€‚
</code></pre>  <div class="post-warning">FPS ï¼ˆFrames Per Second, æ¯ç§’ä¼ è¾“å¸§æ•°ï¼‰ï¼Œ FPSæ˜¯å›¾åƒé¢†åŸŸä¸­çš„å®šä¹‰ï¼Œæ˜¯æŒ‡ç”»é¢æ¯ç§’ä¼ è¾“å¸§æ•°ï¼Œé€šä¿—æ¥è®²å°±æ˜¯æŒ‡åŠ¨ç”»æˆ–è§†é¢‘çš„ç”»é¢æ•°ã€‚FPSæ˜¯æµ‹é‡ç”¨äºä¿å­˜ã€æ˜¾ç¤ºåŠ¨æ€è§†é¢‘çš„ä¿¡æ¯æ•°é‡ã€‚æ¯ç§’é’Ÿå¸§æ•°è¶Šå¤šï¼Œæ‰€æ˜¾ç¤ºçš„åŠ¨ä½œå°±ä¼šè¶Šæµç•…ã€‚60Hzçš„åˆ·æ–°ç‡åˆ·ä¹Ÿå°±æ˜¯æŒ‡å±å¹•ä¸€ç§’å†…åªæ‰«æ60æ¬¡ï¼Œå³60å¸§/ç§’ã€‚è€Œå½“åˆ·æ–°ç‡å¤ªä½æ—¶æˆ‘ä»¬è‚‰çœ¼éƒ½èƒ½æ„Ÿè§‰åˆ°å±å¹•çš„é—ªçƒï¼Œä¸è¿è´¯ï¼Œå¯¹å›¾åƒæ˜¾ç¤ºæ•ˆæœå’Œè§†è§‰æ„Ÿè§‚äº§ç”Ÿä¸å¥½çš„å½±å“ã€‚</div>

  <canvas id="concurrent-browser" width="600" height="300"></canvas>

  <script>const oConcurrent = document.getElementById('concurrent-browser');const oConcurrentPen = oConcurrent.getContext('2d');oConcurrentPen.font = '14px sans-serif';oConcurrentPen.fillStyle='black';oConcurrentPen.fillText('jsæ‰§è¡Œ', 16, 245);oConcurrentPen.fillText('é‡æ’', 70, 245);oConcurrentPen.fillText('é‡ç»˜', 122, 245);oConcurrentPen.fillText('jsæ‰§è¡Œ', 68, 125);oConcurrentPen.fillText('jsæ‰§è¡Œ', 218, 125);oConcurrentPen.fillText('é‡æ’', 422, 125);oConcurrentPen.fillText('é‡ç»˜', 471, 125);oConcurrentPen.fillText('16.6ms', 65, 93);oConcurrentPen.fillText('16.6ms', 218, 93);oConcurrentPen.fillText('16.6ms', 65, 213);oConcurrentPen.font = '10px sans-serif';oConcurrentPen.fillText('......å¾ˆé•¿ä¸€æ®µæ—¶é—´', 320, 93);oConcurrentPen.fillText('æ²¡æ—¶é—´æ‰§è¡Œ', 435, 93);oConcurrentPen.strokeRect(10, 220, 50, 40);oConcurrentPen.strokeRect(60, 220, 50, 40);oConcurrentPen.strokeRect(110, 220, 50, 40);oConcurrentPen.strokeRect(10, 100, 150, 40);oConcurrentPen.strokeRect(160, 100, 150, 40);oConcurrentPen.strokeRect(410, 100, 50, 40);oConcurrentPen.strokeRect(460, 100, 50, 40);oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 82);oConcurrentPen.lineTo(10, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(160, 82);oConcurrentPen.lineTo(160, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 88);oConcurrentPen.lineTo(55, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(115, 88);oConcurrentPen.lineTo(160, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(310, 82);oConcurrentPen.lineTo(310, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(160, 88);oConcurrentPen.lineTo(205, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(265, 88);oConcurrentPen.lineTo(310, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(410, 82);oConcurrentPen.lineTo(410, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(510, 82);oConcurrentPen.lineTo(510, 94);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(410, 88);oConcurrentPen.lineTo(430, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(490, 88);oConcurrentPen.lineTo(510, 88);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 202);oConcurrentPen.lineTo(10, 214);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(160, 202);oConcurrentPen.lineTo(160, 214);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(10, 208);oConcurrentPen.lineTo(55, 208);oConcurrentPen.stroke();oConcurrentPen.beginPath();oConcurrentPen.lineTo(115, 208);oConcurrentPen.lineTo(160, 208);oConcurrentPen.stroke();</script>


<h1 id="ä¸‰ã€reactæºç æ·±å…¥è§£æ"><a href="#ä¸‰ã€reactæºç æ·±å…¥è§£æ" class="headerlink" title="ä¸‰ã€reactæºç æ·±å…¥è§£æ"></a>ä¸‰ã€reactæºç æ·±å…¥è§£æ</h1><p>  ç›´æ¥çœ‹reactæºç ï¼Œå°±åƒæ˜¯ä¸€ä¸ªäººç«™åœ¨ä½ é¢å‰ï¼Œä»–å°±åœ¨ä½ é¢å‰ï¼Œé¢é¢ç›¸è§‘ï¼Œä½ ä¸äº†è§£ä»–ã€‚<br>  æ¥ä¸‹æ¥ï¼Œè¿™ä¸€partæˆ‘ä»¬å¬åˆ«äººå»è®²ä»–ï¼Œæˆ‘ä»¬å»ç†è§£ï¼Œå†äº²è‡ªå»éªŒè¯ï¼Œæ·±å…¥ç†è§£ä»–ã€‚</p>
<h2 id="æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•"><a href="#æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•" class="headerlink" title="æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•"></a>æºç ç›®å½•ç»“æ„å’Œè°ƒè¯•</h2><ol>
<li>æºç ä¸­ä¸»è¦åŒ…æ‹¬å¦‚ä¸‹éƒ¨åˆ†<br> fixturesï¼šä¸ºä»£ç è´¡çŒ®è€…æä¾›çš„æµ‹è¯•React<br> packagesï¼šä¸»è¦éƒ¨åˆ†ï¼ŒåŒ…å«Schedulerï¼Œreconcilerç­‰<br> scriptsï¼šreactæ„å»ºç›¸å…³</li>
<li>packagesä¸»è¦åŒ…å«çš„æ¨¡å—</li>
</ol>
<pre><code>- reactï¼šæ ¸å¿ƒApiï¼Œå¦‚ï¼šReact.createElementã€React.Componentéƒ½åœ¨è¿™

- å’Œå¹³å°ç›¸å…³renderç›¸å…³çš„æ–‡ä»¶å¤¹ï¼š 
  react-artï¼šå¦‚canvas svgçš„æ¸²æŸ“ 
  react-domï¼šæµè§ˆå™¨ç¯å¢ƒ 
  react-native-rendererï¼šåŸç”Ÿç›¸å…³ react-noop-rendererï¼šè°ƒè¯•æˆ–è€…fiberç”¨

- è¯•éªŒæ€§çš„åŒ…
  react-server: ssrç›¸å…³
  react-fetch: è¯·æ±‚ç›¸å…³
  react-interactions: å’Œäº‹ä»¶å¦‚ç‚¹å‡»äº‹ä»¶ç›¸å…³
  react-reconciler: æ„å»ºèŠ‚ç‚¹

- sharedï¼šåŒ…å«å…¬å…±æ–¹æ³•å’Œå˜é‡

- è¾…åŠ©åŒ…ï¼š
  react-is : åˆ¤æ–­ç±»å‹
  react-client: æµç›¸å…³
  react-fetch: æ•°æ®è¯·æ±‚ç›¸å…³
  react-refresh: çƒ­åŠ è½½ç›¸å…³
  schedulerï¼šè°ƒåº¦å™¨ç›¸å…³
  React-reconcilerï¼šåœ¨renderé˜¶æ®µç”¨å®ƒæ¥æ„å»ºfiberèŠ‚ç‚¹
</code></pre><ul>
<li>è°ƒè¯•æ–¹æ³•</li>
</ul>
<p>  æ–¹æ³•ä¸€ï¼šè¿™ç§æ–¹æ³•æˆ‘æ²¡èµ°é€šï¼Œç›´æ¥èµ°çš„é‡è·¯å­æ–¹æ³•äºŒã€‚</p>
<ol>
<li>cloneæºç ï¼šgit clone <a href="https://github.com/facebook/react.git" target="_blank" rel="noopener">https://github.com/facebook/react.git</a></li>
<li>ä¾èµ–å®‰è£…ï¼šnpm install or yarn</li>
<li>buildæºç ï¼šnpm run build react/index,react/jsx,react-dom/index,scheduler â€“type=NODE<br>ä¸ºæºç å»ºç«‹è½¯é“¾ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> build/node_modules/react</span><br><span class="line">npm link</span><br><span class="line"><span class="built_in">cd</span> build/node_modules/react-dom</span><br><span class="line">npm link</span><br><span class="line">create-react-appåˆ›å»ºé¡¹ç›®</span><br><span class="line"></span><br><span class="line">npx create-react-app demo</span><br><span class="line">npm link react react-dom</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>æ–¹æ³•äºŒï¼šé‡è·¯å­ï¼Œç›´æ£é»„é¾™</p>
<ol>
<li>npm i react react-dom</li>
<li><p>åŒç›®å½•åˆ›å»ºhtmlæ–‡ä»¶ï¼Œscriptæ–¹å¼ä½¿ç”¨reactå’Œreact-dom</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">'./node_modules/react/umd/react.development.js'</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src=<span class="string">'./node_modules/react-dom/umd/react-dom.development.js'</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;div id=<span class="string">'root'</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    <span class="string">'app'</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> a = <span class="string">'abc'</span>;</span><br><span class="line">  <span class="comment">// ReactDOM.render(null, document.getElementById('root'));</span></span><br><span class="line">  ReactDOM.render(React.createElement(<span class="string">'h1'</span>, &#123;<span class="attr">className</span>: <span class="string">'name'</span>, <span class="attr">onClick</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="built_in">console</span>.log(<span class="string">'ç‚¹æˆ‘å¹²å˜›'</span>);&#125;&#125;, [<span class="string">'abc'</span>, React.createElement(<span class="string">'div'</span>, &#123;<span class="attr">key</span>: <span class="string">'num'</span>&#125;, <span class="string">'123456'</span>)]), <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>));</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›´æ¥äº›jsxä¸å¯ä»¥ï¼Œæ²¡æœ‰æ¢ç´¢babelæœ‰æ²¡æœ‰cdnçš„ä½¿ç”¨æ–¹å¼ï¼Œç›´æ¥React.createElememtç²—æš´ä»£æ›¿ã€‚</p>
</li>
</ol>
<h2 id="jsx-1"><a href="#jsx-1" class="headerlink" title="jsx"></a>jsx</h2><h3 id="virtual-Dom-æ˜¯ä»€ä¹ˆ"><a href="#virtual-Dom-æ˜¯ä»€ä¹ˆ" class="headerlink" title="virtual Dom æ˜¯ä»€ä¹ˆ"></a>virtual Dom æ˜¯ä»€ä¹ˆ</h3><p>  virtual Domæ˜¯ä¸€ä¸ªjså¯¹è±¡ï¼Œæè¿°äº†domä¿¡æ¯ã€‚æ›´æ–°å°±æ˜¯æ¸²æŸ“æ›´æ–°åçš„jså¯¹è±¡åˆ°çœŸå®domï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯React.createElement()è¿”å›çš„ç»“æœã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆç”¨virtual-Dom"><a href="#ä¸ºä»€ä¹ˆç”¨virtual-Dom" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨virtual Dom"></a>ä¸ºä»€ä¹ˆç”¨virtual Dom</h3><p>  çœŸå®DOMæ›´æ–°æ¸²æŸ“ï¼Œå¾ˆå°çš„æ›´æ–°å°±å¯èƒ½å¼•èµ·é¡µé¢çš„é‡ç»˜é‡æ’ï¼Œè€—æ—¶è€—æ€§èƒ½ã€‚<br>  jså¯¹è±¡æ˜¯åœ¨å†…å­˜ä¸­å¤„ç†çš„ï¼Œå¾ˆå¿«ï¼Œå¹¶é€šè¿‡diffç®—æ³•æ¯”è¾ƒvirtual domçš„å˜åŒ–ï¼Œèƒ½åšåˆ°æ‰¹é‡ï¼Œå¼‚æ­¥ï¼Œæœ€å°åŒ–çš„domå˜æ›´ï¼Œæœ‰æ•ˆæå‡æ€§èƒ½ã€‚</p>
<h3 id="jsx-amp-createElement"><a href="#jsx-amp-createElement" class="headerlink" title="jsx&amp;createElement"></a>jsx&amp;createElement</h3><p>  jsxæ˜¯Class componentçš„renderå‡½æ•°çš„è¿”å›å€¼æˆ–Function componentçš„è¿”å›å€¼ï¼Œç”¨æ¥è¡¨ç¤ºç»„ä»¶ï¼Œå£°æ˜å¼åœ°æè¿°è§†å›¾ã€‚ç»è¿‡babelè½¬ä¹‰æˆReact.createElementã€‚</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jsxç»“æ„:</span><br><span class="line">&lt;h1 class=&quot;name&quot; onClick=&#123;() =&gt; &#123;console.log(&apos;ç‚¹æˆ‘å¹²å˜›&apos;)&#125;&#125;&gt;</span><br><span class="line">  abc</span><br><span class="line">  &lt;div&gt;123456&lt;/div&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">ç»è¿‡babelè½¬ç§»æˆReact.createElement</span><br><span class="line">React.createElement(</span><br><span class="line">  &apos;h1&apos;, &#123;className: &apos;name&apos;, onClick: () =&gt; &#123;console.log(&apos;ç‚¹æˆ‘å¹²å˜›&apos;);&#125;&#125;, </span><br><span class="line">    [&apos;abc&apos;, React.createElement(&apos;div&apos;, &#123;key: &apos;num&apos;&#125;, &apos;123456&apos;)])</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>  PSï¼šè¿™å°±æ˜¯ä¸ºä»€ä¹ˆjsxæ–‡ä»¶è¦å£°æ˜import React from â€˜reactâ€™çš„åŸå› ï¼ˆç°åœ¨æˆ‘è¿˜ä¸çŸ¥é“ä¸ºä»€ä¹ˆreact17ä¹‹åä¸ç”¨å¯¼å…¥ï¼Ÿï¼‰</p>
<p>  React.createElement(810):</p>
<ul>
<li>å¤„ç†configï¼ŒæŠŠé™¤äº†ä¿ç•™å±æ€§å¤–çš„å…¶ä»–configèµ‹å€¼ç»™props</li>
<li>æŠŠchildrenå¤„ç†åèµ‹å€¼ç»™props.children</li>
<li>å¤„ç†defaultProps</li>
<li>è°ƒç”¨ReactElement(724)è¿”å›ä¸€ä¸ªjsxå¯¹è±¡(virtual-dom)</li>
</ul>
<p>  æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹jsxå¯¹è±¡ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $$typeof: Symbol(react.element),</span><br><span class="line">  key: null,</span><br><span class="line">  props: &#123;</span><br><span class="line">    children: [</span><br><span class="line">      &quot;abc&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        $$typeof: Symbol(react.element),</span><br><span class="line">        key: &quot;num&quot;,</span><br><span class="line">        props: &#123;</span><br><span class="line">          children: &quot;123456&quot;,</span><br><span class="line">          key: undefined,</span><br><span class="line">          get key: Æ’ (),</span><br><span class="line">          ref: null,</span><br><span class="line">          type: &quot;div&quot;,</span><br><span class="line">          _owner: null,</span><br><span class="line">          _store: &#123;validated: false&#125;,</span><br><span class="line">          _self: null,</span><br><span class="line">          _source: null,</span><br><span class="line">        &#125;  </span><br><span class="line">      &#125;,</span><br><span class="line">      length: 2,</span><br><span class="line">    ],</span><br><span class="line">    className: &quot;name&quot;,</span><br><span class="line">    onClick: () =&gt; &#123;console.log(&apos;ç‚¹æˆ‘å¹²å˜›&apos;);&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  ref: null,</span><br><span class="line">  type: &quot;h1&quot;,</span><br><span class="line">  _owner: null,</span><br><span class="line">  _store: &#123;validated: false&#125;,</span><br><span class="line">  _self: null,</span><br><span class="line">  _source: null,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  $$typeofè¡¨ç¤ºçš„æ˜¯ç»„ä»¶çš„ç±»å‹ï¼Œä¾‹å¦‚åœ¨æºç ä¸­æœ‰ä¸€ä¸ªæ£€æŸ¥æ˜¯å¦æ˜¯åˆæ³•Elementçš„å‡½æ•°(isValidElement902)ï¼Œå°±æ˜¯æ ¹object.$$typeof === REACT_ELEMENT_TYPEæ¥åˆ¤æ–­çš„</p>
<p>  çœ‹åˆ°è¿™é‡Œï¼Œå¯¹jsxè±ç„¶å¼€æœ—ï¼Œè‡³äºbabelæ˜¯æ€ä¹ˆè½¬è¯‘çš„ï¼Œä»¥åæœ‰æœºä¼šå†åšå­¦ä¹ ã€‚<br>  <code>jsx -&gt; Virtual Dom(jsxå¯¹è±¡ï¼ŒFiber) -&gt; Dom</code><br>  è¿˜æœ‰ä¸ªç–‘é—®ï¼Œjsxå¯¹è±¡å’ŒFiberå¯¹è±¡çš„å…³ç³»ï¼Ÿæ¥ç€æ¥å¤§è‡´çœ‹ä¸€ä¸‹Fiber</p>
<blockquote>
<p>jsxå¯¹è±¡ä¸Šæ²¡æœ‰ä¼˜å…ˆçº§ã€çŠ¶æ€ã€effectTagç­‰æ ‡è®°ï¼Œè¿™äº›æ ‡è®°åœ¨Fiberå¯¹è±¡ä¸Šï¼Œåœ¨mountæ—¶Fiberæ ¹æ®jsxå¯¹è±¡æ¥æ„å»ºï¼Œåœ¨updateæ—¶æ ¹æ®æœ€æ–°çŠ¶æ€çš„jsxå’Œcurrent Fiberå¯¹æ¯”ï¼Œå½¢æˆæ–°çš„workInProgress Fiberï¼Œæœ€åworkInProgress Fiberåˆ‡æ¢æˆcurrent Fiberã€‚</p>
</blockquote>
<p>  å°ç»“ï¼šjsxæ˜¯React.createElementçš„è¯­æ³•ç³–ï¼Œjsxé€šè¿‡babelè½¬åŒ–æˆReact.createElementå‡½æ•°ï¼ŒReact.createElementæ‰§è¡Œä¹‹åè¿”å›jsxå¯¹è±¡ï¼Œä¹Ÿå«virtual-domï¼ŒFiberä¼šæ ¹æ®jsxå¯¹è±¡å’Œcurrent Fiberè¿›è¡Œå¯¹æ¯”å½¢æˆworkInProgress Fiber<br>  <!-- ## legacyå’Œconcurrentæ¨¡å¼å…¥å£å‡½æ•° --></p>
<h2 id="Fiberæ¶æ„"><a href="#Fiberæ¶æ„" class="headerlink" title="Fiberæ¶æ„"></a>Fiberæ¶æ„</h2><p>  react 15 åœ¨renderé˜¶æ®µçš„reconcileè¿‡ç¨‹æ˜¯åŒæ­¥ä¸å¯ä¸­æ–­çš„ï¼Œå½“è¿›è¡Œå¤§é‡èŠ‚ç‚¹çš„reconcileæ—¶å°±å¯èƒ½äº§ç”Ÿå¡é¡¿ç­‰ï¼Œå› ä¸ºjsæ‰§è¡Œæ˜¯å•çº¿ç¨‹çš„ï¼Œä¸€ç›´åœ¨æ‰§è¡Œjsï¼Œä¸æ”¾å‡ºæ‰§è¡Œæƒï¼Œæµè§ˆå™¨è¦ç­‰åˆ°jsæ‰§è¡Œå®Œæˆåæ‰èƒ½è¿›è¡Œç»˜åˆ¶å’Œé‡æ’ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒä¸€å®šæ˜¯ä¸å¥½çš„ã€‚</p>
<p>  react 16 å¢åŠ äº†schedulerå¯¹æ—¶é—´ç‰‡è¿›è¡Œç®¡ç†ï¼Œåˆ†å‰²taskï¼Œç»™æ¯ä¸ªtaskï¼ˆå·¥ä½œå•å…ƒï¼‰ä¸€å®šçš„æ—¶é—´æ‰§è¡Œï¼Œæ—¶é—´åˆ°äº†æ²¡æ‰§è¡Œå®Œä¹Ÿè¦äº¤å‡ºæ‰§è¡Œæƒç»™åˆ°æµè§ˆå™¨è¿›è¡Œé‡ç»˜é‡æ’ã€‚è¿™ç§å¼‚æ­¥å¯ä¸­æ–­çš„æ•°æ®ç»“æ„å°±æ˜¯Fiberã€‚</p>
<p>  Fiberï¼š</p>
<ul>
<li><strong>å·¥ä½œå•å…ƒ ä»»åŠ¡åˆ†è§£</strong>ï¼šè¿™æ˜¯Fiberæœ€é‡è¦çš„å·¥ä½œï¼Œä¿å­˜èŠ‚ç‚¹å¯¹åº”çš„ä¿¡æ¯ï¼Œä»¥æŒ‡é’ˆçš„å½¢å¼å½¢æˆFiberæ ‘ã€‚</li>
<li><strong>å¢é‡æ¸²æŸ“</strong>ï¼šé€šè¿‡jsxå¯¹è±¡å’ŒCurrent Fiberè¿›è¡Œå¯¹æ¯”ï¼Œç”Ÿæˆæœ€å°çš„å·®å¼‚è¡¥ä¸ï¼Œåº”ç”¨åˆ°çœŸå®èŠ‚ç‚¹ä¸Šã€‚</li>
<li><strong>ä¿å­˜çŠ¶æ€</strong>ï¼šå› ä¸ºFiberèƒ½ä¿å­˜çŠ¶æ€å’Œæ›´æ–°çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å°±èƒ½å®ç°å‡½æ•°ç»„ä»¶çš„çŠ¶æ€æ›´æ–°ï¼Œä¹Ÿå°±æ˜¯hooks</li>
<li><strong>æ ¹æ®ä¼˜å…ˆçº§æš‚åœã€ç»§ç»­ã€æ’åˆ—ä¼˜å…ˆçº§</strong>ï¼šFiberèŠ‚ç‚¹ä¸Šä¿å­˜äº†ä¼˜å…ˆçº§ï¼Œèƒ½é€šè¿‡ä¸åŒèŠ‚ç‚¹ä¼˜å…ˆçº§çš„å¯¹æ¯”è¾¾åˆ°æ­¤ç›®çš„ï¼Œä¹Ÿä¸ºä¸Šå±‚æ‰¹é‡æ›´æ–°ã€Suspenseæä¾›äº†åŸºç¡€ã€‚</li>
</ul>
<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FiberNode</span>(<span class="params">tag, pendingProps, key, mode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä½œä¸ºé™æ€çš„æ•°æ®ç»“æ„ ä¿å­˜èŠ‚ç‚¹çš„ä¿¡æ¯ </span></span><br><span class="line">  <span class="keyword">this</span>.tag = tag; <span class="comment">// å¯¹åº”ç»„ä»¶çš„ç±»å‹</span></span><br><span class="line">  <span class="keyword">this</span>.key = key;</span><br><span class="line">  <span class="keyword">this</span>.elementType = <span class="literal">null</span>; <span class="comment">// å…ƒç´ ç±»å‹</span></span><br><span class="line">  <span class="keyword">this</span>.type = <span class="literal">null</span>; <span class="comment">// classæˆ–Function</span></span><br><span class="line">  <span class="keyword">this</span>.stateNode = <span class="literal">null</span>; <span class="comment">// Fiberï¼ŒçœŸå®DOMèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½œä¸ºfiberæ ‘æ¶æ„ è¿æ¥æˆfiberæ ‘</span></span><br><span class="line">  <span class="keyword">this</span>.return = <span class="literal">null</span>; <span class="comment">// æŒ‡å‘çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">this</span>.child = <span class="literal">null</span>; <span class="comment">// æŒ‡å‘å­©å­</span></span><br><span class="line">  <span class="keyword">this</span>.sibling = <span class="literal">null</span>; <span class="comment">// æŒ‡å‘å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">this</span>.index = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">this</span>.ref = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½œä¸ºå·¥ä½œå•å…ƒ æ¥è®¡ç®—state</span></span><br><span class="line">  <span class="keyword">this</span>.pendingProps = pendingProps;</span><br><span class="line">  <span class="keyword">this</span>.memoizedProps = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.updateQueue = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.memoizedState = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.dependencies = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.mode = mode; <span class="comment">// Effects</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// effectç›¸å…³</span></span><br><span class="line">  <span class="keyword">this</span>.flags = NoFlags;</span><br><span class="line">  <span class="keyword">this</span>.nextEffect = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.firstEffect = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.lastEffect = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¼˜å…ˆçº§ç›¸å…³</span></span><br><span class="line">  <span class="keyword">this</span>.lanes = NoLanes;</span><br><span class="line">  <span class="keyword">this</span>.childLanes = NoLanes;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// currentå’ŒworkInProgressçš„æŒ‡é’ˆ</span></span><br><span class="line">  <span class="keyword">this</span>.alternate = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>  <canvas id="fiber" width="600" height="460"></canvas>

<script>const oFiber = document.getElementById('fiber');const oFiberPen = oFiber.getContext('2d');oFiberPen.font = '14px sans-serif';oFiberPen.fillStyle='black';oFiberPen.strokeRect(150, 10, 100, 50);oFiberPen.strokeRect(150, 140, 100, 50);oFiberPen.strokeRect(150, 260, 100, 50);oFiberPen.strokeRect(150, 380, 100, 50);oFiberPen.strokeRect(460, 380, 100, 50);oFiberPen.beginPath();oFiberPen.lineTo(185, 60);oFiberPen.lineTo(185, 140);oFiberPen.lineTo(180, 135);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 140);oFiberPen.lineTo(190, 135);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 190);oFiberPen.lineTo(185, 260);oFiberPen.lineTo(180, 255);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 260);oFiberPen.lineTo(190, 255);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 310);oFiberPen.lineTo(185, 380);oFiberPen.lineTo(180, 375);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(185, 380);oFiberPen.lineTo(190, 375);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 140);oFiberPen.lineTo(215, 60);oFiberPen.lineTo(210, 65);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 60);oFiberPen.lineTo(220, 65);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 260);oFiberPen.lineTo(215, 190);oFiberPen.lineTo(210, 195);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 190);oFiberPen.lineTo(220, 195);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 380);oFiberPen.lineTo(215, 310);oFiberPen.lineTo(210, 315);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(215, 310);oFiberPen.lineTo(220, 315);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(250, 405);oFiberPen.lineTo(460, 405);oFiberPen.lineTo(455, 400);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(460, 405);oFiberPen.lineTo(455, 410);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(510, 380);oFiberPen.lineTo(250, 295);oFiberPen.lineTo(257, 302);oFiberPen.stroke();oFiberPen.beginPath();oFiberPen.lineTo(250, 295);oFiberPen.lineTo(260, 296);oFiberPen.stroke();oFiberPen.fillText('rootFiber', 170, 40);oFiberPen.fillText('App', 188, 168);oFiberPen.fillText('h1', 193, 290);oFiberPen.fillText('p', 198, 408);oFiberPen.fillText('jyy', 503, 408);oFiberPen.fillText('child', 153, 105);oFiberPen.fillText('return ', 218, 105);oFiberPen.fillText('child', 153, 227);oFiberPen.fillText('return', 218, 227);oFiberPen.fillText('child', 153, 348);oFiberPen.fillText('return', 218, 348);oFiberPen.fillText('sibling', 340, 399);oFiberPen.fillText('return', 365, 330);</script>

<blockquote>
<p>åœ¨mountæ—¶ï¼šåˆ›å»ºfiberRootå’ŒrootFiberï¼Œç„¶åæ ¹æ®jsxåˆ›å»ºworkInProgress Fiberï¼ŒæŠŠworkInProgress Fiberåˆ‡æ¢æˆcurrent Fiberã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨updateæ—¶ï¼šä¼šæ ¹æ®æ–°çš„çŠ¶æ€å½¢æˆçš„jsxï¼ˆClassComponentçš„renderæˆ–è€…FuncComponentçš„è¿”å›å€¼ï¼‰å’Œcurrent Fiberå¯¹æ¯”å½¢ï¼ˆdiffç®—æ³•ï¼‰æˆä¸€æ£µworkInProgress Fiberæ ‘ï¼Œç„¶åå°†fiberRootçš„currentæŒ‡å‘workInProgressæ ‘ï¼Œæ­¤æ—¶workInProgresså°±å˜æˆäº†current Fiberã€‚</p>
</blockquote>
<pre><code>fiberRootï¼šæŒ‡æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼Œåªå­˜åœ¨ä¸€ä¸ª

rootFiberï¼šReactDOM.renderæˆ–è€…ReactDOM.unstable_createRootåˆ›å»ºå‡ºæ¥çš„åº”ç”¨çš„èŠ‚ç‚¹ï¼Œå¯ä»¥å­˜åœ¨å¤šä¸ªã€‚
</code></pre><h2 id="renderé˜¶æ®µ"><a href="#renderé˜¶æ®µ" class="headerlink" title="renderé˜¶æ®µ"></a>renderé˜¶æ®µ</h2><pre><code>renderé˜¶æ®µçš„ä¸»è¦å·¥ä½œæ˜¯æ„å»ºFiberæ ‘å’Œç”ŸæˆeffectListé“¾è¡¨ã€‚
</code></pre><h3 id="reactå¯åŠ¨æ¨¡å¼"><a href="#reactå¯åŠ¨æ¨¡å¼" class="headerlink" title="reactå¯åŠ¨æ¨¡å¼"></a>reactå¯åŠ¨æ¨¡å¼</h3><pre><code>å‡ ä¸ªæœˆä¹‹å‰ï¼Œåˆšå¼€å§‹çœ‹reactæºç çš„æ—¶å€™ï¼Œæœ€æ–°ç‰ˆæœ¬è¿˜æ˜¯17.0.2ï¼Œç°åœ¨ï¼ˆ2021-11-04ï¼‰React 18ç‰ˆæœ¬å°±å·²ç»å‘å¸ƒäº† Alpha ç‰ˆæœ¬ã€‚

React 18 å¸¦æ¥äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å‚çœ‹å®˜ç½‘çš„[å‘å¸ƒè®¡åˆ’](https://zh-hans.reactjs.org/blog/2021/06/08/the-plan-for-react-18.html)ã€‚

è¿™é‡Œå¯¹18æ¯”è¾ƒæ„Ÿå…´è¶£çš„æ˜¯å¹¶å‘æ¸²æŸ“ï¼ˆconcurrent renderingï¼‰æœºåˆ¶ï¼Œåªæœ‰ç”±æ–°ç‰¹æ€§è§¦å‘çš„æ›´æ–°ä¼šå¯ç”¨å¹¶å‘æ¸²æŸ“ã€‚å¦‚æœæ²¡ç”¨åˆ°æ–°å±æ€§ï¼Œå³ä½¿ç”¨äº†ReactDOM.createRoot(rootNode).render(...)ï¼Œä¹Ÿä¼šèµ°åŸè·¯ã€‚

è¯•ç€ç”¨äº†ä¸€ä¸‹react 18ç‰ˆæœ¬ï¼ŒreactDom.renderä¼šæŠ¥Warningï¼šReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it&apos;s running React 17ã€‚

è¿™å°±æ˜¯reactæ–°çš„å¯åŠ¨æ¨¡å¼ï¼š
1ï¼‰legacy æ¨¡å¼ï¼š ReactDOM.render(&lt;App /&gt;, rootNode)ã€‚åœ¨react18ä¸­ä½¿ç”¨è¿™ç§æ¨¡å¼ä¸react17å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ä¼šæœ‰ä¸€æ¡è­¦å‘Šï¼Œè¡¨æ˜å®ƒå·²è¢«å¼ƒç”¨å¹¶åˆ‡æ¢åˆ°æ–°çš„ Root APIã€‚
2ï¼‰concurrent æ¨¡å¼ï¼š ReactDOM.createRoot(rootNode).render(&lt;App /&gt;)ã€‚å¹¶å‘æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼å¼€å¯äº†æ‰€æœ‰çš„æ–°åŠŸèƒ½ã€‚




è¿˜å‘ç°ä¸€ä¸ªhydrateRootï¼Œä¸çŸ¥é“æ˜¯åšä»€ä¹ˆçš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥å’ŒcreateRootå¾ˆåƒï¼Œä¹Ÿå¯ä»¥è¿™æ ·ç”¨ï¼Œæ¸²æŸ“é¡µé¢ï¼š
ReactDOM.hydrateRoot(rootNode).render(&lt;App /&gt;);æš‚ç•™
</code></pre><h4 id="ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹"><a href="#ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹"></a>ä¸¤ç§æ¨¡å¼å‡½æ•°ä¸»è¦æ‰§è¡Œè¿‡ç¨‹</h4>  <canvas id="primary-progress" width="500" height="400"></canvas>

  <script>
    const oMain = document.getElementById('primary-progress');
    const oMainPen = oMain.getContext('2d');oMainPen.font = '14px sans-serif';oMainPen.strokeRect(92, 10, 320, 30);oMainPen.strokeRect(30, 80, 450, 30);oMainPen.strokeRect(93, 150, 316, 30);oMainPen.strokeRect(10, 220, 480, 30);oMainPen.strokeRect(160, 290, 180, 30);oMainPen.fillText('createContainerï¼ˆåˆ›å»ºfiberRootNodeã€rootFiberï¼‰', 96, 30);oMainPen.fillText('updateContainerï¼ˆåˆ›å»ºupdateå¯¹è±¡ï¼Œä¿å­˜åœ¨updateQueueç¯çŠ¶é“¾è¡¨ä¸­ï¼‰', 34, 100);oMainPen.fillText('scheduleUpdateOnFiberï¼ˆåœ¨Fiberä¸Šè°ƒåº¦updateï¼‰', 95, 163);oMainPen.fillText('ensureRootIsScheduledï¼ˆè°ƒåº¦æ ¹èŠ‚ç‚¹ï¼‰', 125, 177);oMainPen.fillText('commitRootï¼ˆcommité˜¶æ®µï¼‰', 164, 310);oMainPen.fillStyle='blue';oMainPen.fillText('performSyncWorkOnRoot | performConcurrentWorkOnRootï¼ˆrenderé˜¶æ®µï¼‰', 12, 240);oMainPen.fillStyle='black';oMainPen.beginPath();oMainPen.lineTo(252, 40);oMainPen.lineTo(252, 75);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 75);oMainPen.lineTo(256, 75);oMainPen.lineTo(252, 80);oMainPen.closePath();oMainPen.fill();oMainPen.beginPath();oMainPen.lineTo(252, 110);oMainPen.lineTo(252, 145);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 145);oMainPen.lineTo(256, 145);oMainPen.lineTo(252, 150);oMainPen.closePath();oMainPen.fill();oMainPen.beginPath();oMainPen.lineTo(252, 180);oMainPen.lineTo(252, 215);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 215);oMainPen.lineTo(256, 215);oMainPen.lineTo(252, 220);oMainPen.closePath();oMainPen.fill();oMainPen.beginPath();oMainPen.lineTo(252, 250);oMainPen.lineTo(252, 285);oMainPen.stroke();oMainPen.beginPath();oMainPen.lineTo(248, 285);oMainPen.lineTo(256, 285);oMainPen.lineTo(252, 290);oMainPen.closePath();oMainPen.fill();
  </script>

<h4 id="legacyæ¨¡å¼"><a href="#legacyæ¨¡å¼" class="headerlink" title="legacyæ¨¡å¼"></a>legacyæ¨¡å¼</h4><p>  renderè°ƒç”¨legacyRenderSubtreeIntoContainerï¼ŒcreateContainerè°ƒç”¨createFiberRootåˆ›å»ºfiberRootNodeï¼Œè°ƒç”¨createHostRootFiberåˆ›å»ºrootFiberã€‚å…¶ä¸­fiberRootNodeæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹ï¼ŒrootFiberæ˜¯å½“å‰åº”ç”¨æŒ‚è½½çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ReactDom.renderè°ƒç”¨åçš„æ ¹èŠ‚ç‚¹ã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ€ä¸Šå±‚çš„èŠ‚ç‚¹æ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¹èŠ‚ç‚¹fiberRootNode</span></span><br><span class="line">ReactDOM.render(&lt;App /&gt;, document.getElementById("root")); // rootFiber</span><br><span class="line"></span><br><span class="line">fiberRootNode.current = rootFiber;</span><br><span class="line">rootFiber.stateNode = fiberRootNode;</span><br></pre></td></tr></table></figure></p>
<p>  åˆ›å»ºå®ŒfiberèŠ‚ç‚¹åï¼ŒlegacyRenderSubtreeIntoContainerè°ƒç”¨updateContaineråˆ›å»ºUpdateå¯¹è±¡æŒ‚è½½åˆ°updateQueueç¯çŠ¶é“¾è¡¨ä¸Šï¼Œç„¶åæ‰§è¡ŒscheduleUpdateOnFiberè°ƒç”¨performSyncWorkOnRootè¿›å…¥renderé˜¶æ®µå’Œcommité˜¶æ®µã€‚</p>
<h4 id="concurrentæ¨¡å¼"><a href="#concurrentæ¨¡å¼" class="headerlink" title="concurrentæ¨¡å¼"></a>concurrentæ¨¡å¼</h4><p>  createRootè°ƒç”¨createContaineråˆ›å»ºfiberRootNodeå’ŒrootFiberã€‚åˆ›å»ºå®ŒfiberèŠ‚ç‚¹åï¼Œreturn new ReactDOMRoot(root); è°ƒç”¨ReactDOMRoot.propertype.renderæ‰§è¡ŒupdateContainerï¼Œç„¶åå¼‚æ­¥è°ƒåº¦scheduleUpdateOnFiberï¼ŒperformConcurrentWorkOnRootè¿›å…¥renderé˜¶æ®µå’Œcommité˜¶æ®µã€‚</p>
<h4 id="ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹"><a href="#ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹" class="headerlink" title="ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹"></a>ä¸¤ç§æ¨¡å¼çš„ä¸åŒç‚¹</h4><p>  1ï¼‰createContainerä¸­ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°tagä¸ä¸€æ · ä¸€ä¸ªæ˜¯LegacyRoot 0ï¼Œä¸€ä¸ªæ˜¯ConcurrentRoot 1ã€‚<br>  2ï¼‰requestUpdateLaneä¸­è·å–çš„laneçš„ä¼˜å…ˆçº§ä¸åŒã€‚<br>  3) åœ¨å‡½æ•°scheduleUpdateOnFiberä¸­æ ¹æ®ä¸åŒä¼˜å…ˆçº§è¿›å…¥ä¸åŒåˆ†æ”¯ï¼Œlegacyæ¨¡å¼è¿›å…¥performSyncWorkOnRootï¼Œconcurrentæ¨¡å¼ <strong>å¼‚æ­¥è°ƒåº¦</strong> performConcurrentWorkOnRootã€‚</p>
<h3 id="ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹"><a href="#ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹"></a>ä¸¤ç§æ¨¡å¼çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹</h3>  <canvas id="renderTransfer" width="650" height="600"></canvas>

  <script>const oRenderTransfer = document.getElementById('renderTransfer');const oRenderTransferPen = oRenderTransfer.getContext('2d');oRenderTransferPen.font = '12px sans-serif';oRenderTransferPen.fillStyle='black';oRenderTransferPen.fillText('Lagacy', 205, 15);oRenderTransferPen.fillText('Concurrent', 412, 15);oRenderTransferPen.fillText('render', 210, 50);oRenderTransferPen.fillText('createRoot', 408, 50);oRenderTransferPen.fillText('ReactDOMRoot.prototype.render', 360, 191);oRenderTransferPen.fillText('createUpdate', 50, 270);oRenderTransferPen.fillText('enqueueUpdate', 160, 270);oRenderTransferPen.fillText('ensureRootIsScheduled', 270, 270);oRenderTransferPen.fillText('root.tag === LegacyRoot', 146, 315);oRenderTransferPen.fillText('performSyncWorkOnRoot', 142, 385);oRenderTransferPen.fillText('performConcurrentWorkOnRoot', 380, 385);oRenderTransferPen.fillText('rederRootSync', 165, 425);oRenderTransferPen.fillText('renderRootConcurrent', 400, 425);oRenderTransferPen.fillText('workLoopSync', 170, 460);oRenderTransferPen.fillText('workLoopConcurrent', 430, 460);oRenderTransferPen.fillText('performUnitWork', 286, 492);oRenderTransferPen.fillText('beginWork', 198, 535);oRenderTransferPen.fillText('completeWork', 402, 535);oRenderTransferPen.fillText('.', 333, 555);oRenderTransferPen.fillText('.', 333, 558);oRenderTransferPen.fillText('.', 333, 561);oRenderTransferPen.fillText('.', 333, 564);oRenderTransferPen.fillText('.', 333, 567);oRenderTransferPen.fillText('.', 333, 570);oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 20);oRenderTransferPen.lineTo(225, 35);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(221, 35);oRenderTransferPen.lineTo(229, 35);oRenderTransferPen.lineTo(225, 40);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 20);oRenderTransferPen.lineTo(442, 35);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(438, 35);oRenderTransferPen.lineTo(446, 35);oRenderTransferPen.lineTo(442, 40);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 55);oRenderTransferPen.lineTo(225, 80);oRenderTransferPen.lineTo(270, 80);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(270, 76);oRenderTransferPen.lineTo(270, 84);oRenderTransferPen.lineTo(275, 80);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 55);oRenderTransferPen.lineTo(442, 80);oRenderTransferPen.lineTo(392, 80);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(392, 76);oRenderTransferPen.lineTo(392, 84);oRenderTransferPen.lineTo(387, 80);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(334, 86);oRenderTransferPen.lineTo(334, 93);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(331, 93);oRenderTransferPen.lineTo(337, 93);oRenderTransferPen.lineTo(334, 97);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(334, 108);oRenderTransferPen.lineTo(334, 115);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(331, 115);oRenderTransferPen.lineTo(337, 115);oRenderTransferPen.lineTo(334, 120);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 80);oRenderTransferPen.lineTo(225, 156);oRenderTransferPen.lineTo(278, 156);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(278, 153);oRenderTransferPen.lineTo(278, 159);oRenderTransferPen.lineTo(281, 156);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 80);oRenderTransferPen.lineTo(442, 156);oRenderTransferPen.lineTo(389, 156);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(389, 153);oRenderTransferPen.lineTo(389, 159);oRenderTransferPen.lineTo(386, 156);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 156);oRenderTransferPen.lineTo(225, 217);oRenderTransferPen.lineTo(270, 217);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(270, 212);oRenderTransferPen.lineTo(270, 222);oRenderTransferPen.lineTo(275, 217);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 156);oRenderTransferPen.lineTo(442, 178);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(438, 178);oRenderTransferPen.lineTo(446, 178);oRenderTransferPen.lineTo(442, 182);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 192);oRenderTransferPen.lineTo(442, 217);oRenderTransferPen.lineTo(400, 217);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(400, 212);oRenderTransferPen.lineTo(400, 222);oRenderTransferPen.lineTo(395, 217);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 222);oRenderTransferPen.lineTo(335, 240);oRenderTransferPen.lineTo(90, 240);oRenderTransferPen.lineTo(90, 253);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(87, 253);oRenderTransferPen.lineTo(93, 253);oRenderTransferPen.lineTo(90, 258);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(205, 240);oRenderTransferPen.lineTo(205, 253);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(202, 253);oRenderTransferPen.lineTo(208, 253);oRenderTransferPen.lineTo(205, 258);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 240);oRenderTransferPen.lineTo(335, 253);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(332, 253);oRenderTransferPen.lineTo(338, 253);oRenderTransferPen.lineTo(335, 258);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 272);oRenderTransferPen.lineTo(335, 290);oRenderTransferPen.lineTo(205, 290);oRenderTransferPen.lineTo(205, 300);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(202, 300);oRenderTransferPen.lineTo(208, 300);oRenderTransferPen.lineTo(205, 305);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 290);oRenderTransferPen.lineTo(465, 290);oRenderTransferPen.lineTo(465, 370);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(462, 370);oRenderTransferPen.lineTo(468, 370);oRenderTransferPen.lineTo(465, 375);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(200, 320);oRenderTransferPen.lineTo(180, 340);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(210, 320);oRenderTransferPen.lineTo(230, 340);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(180, 355);oRenderTransferPen.lineTo(200, 372);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(230, 355);oRenderTransferPen.lineTo(210, 372);oRenderTransferPen.stroke();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(206, 388);oRenderTransferPen.lineTo(206, 408);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(203, 408);oRenderTransferPen.lineTo(209, 408);oRenderTransferPen.lineTo(206, 412);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 388);oRenderTransferPen.lineTo(465, 408);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(462, 408);oRenderTransferPen.lineTo(468, 408);oRenderTransferPen.lineTo(465, 412);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 398);oRenderTransferPen.lineTo(256, 421);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(256, 418);oRenderTransferPen.lineTo(258, 424);oRenderTransferPen.lineTo(250, 422);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(206, 428);oRenderTransferPen.lineTo(206, 448);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(203, 448);oRenderTransferPen.lineTo(209, 448);oRenderTransferPen.lineTo(206, 452);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 428);oRenderTransferPen.lineTo(465, 448);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(462, 448);oRenderTransferPen.lineTo(468, 448);oRenderTransferPen.lineTo(465, 452);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(206, 463);oRenderTransferPen.lineTo(206, 488);oRenderTransferPen.lineTo(275, 488);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(275, 484);oRenderTransferPen.lineTo(275, 492);oRenderTransferPen.lineTo(279, 488);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(465, 463);oRenderTransferPen.lineTo(465, 488);oRenderTransferPen.lineTo(391, 488);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(391, 484);oRenderTransferPen.lineTo(391, 492);oRenderTransferPen.lineTo(387, 488);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 494);oRenderTransferPen.lineTo(335, 510);oRenderTransferPen.lineTo(225, 510);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(335, 510);oRenderTransferPen.lineTo(442, 510);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(225, 510);oRenderTransferPen.lineTo(225, 520);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(221, 520);oRenderTransferPen.lineTo(229, 520);oRenderTransferPen.lineTo(225, 525);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(442, 510);oRenderTransferPen.lineTo(442, 520);oRenderTransferPen.stroke();oRenderTransferPen.beginPath();oRenderTransferPen.lineTo(438, 520);oRenderTransferPen.lineTo(446, 520);oRenderTransferPen.lineTo(442, 525);oRenderTransferPen.closePath();oRenderTransferPen.fill();oRenderTransferPen.font = '8px sans-serif';oRenderTransferPen.fillText('ä¼ å‚ä¸åŒ', 235, 214);oRenderTransferPen.fillText('ä¼ å‚ä¸åŒ', 403, 214);oRenderTransferPen.fillText('createFiberRoot', 302, 106);oRenderTransferPen.fillText('createHostFoorFiber', 298, 126);oRenderTransferPen.fillText('listenToAllSupportedEvents', 283, 158);oRenderTransferPen.fillText('åˆ›å»ºupdateå¯¹è±¡', 57, 280);oRenderTransferPen.fillText('ä¿å­˜åœ¨updateQueueç¯çŠ¶é“¾è¡¨ä¸Š', 145, 280);oRenderTransferPen.fillText('æ˜¯', 180, 330);oRenderTransferPen.fillText('å¦', 223, 330);oRenderTransferPen.fillText('åŒæ­¥è°ƒç”¨', 160, 350);oRenderTransferPen.fillText('å¼‚æ­¥è°ƒç”¨', 220, 350);oRenderTransferPen.fillText('å¼‚æ­¥è°ƒç”¨', 470, 350);oRenderTransferPen.fillText('æ˜¯å¦ä½¿ç”¨äº†æ–°åŠŸèƒ½', 470, 394);oRenderTransferPen.fillText('æ˜¯', 470, 412);oRenderTransferPen.fillText('å¦', 420, 399);oRenderTransferPen.fillText('workOnProgress !== null', 110, 480);oRenderTransferPen.fillText('workOnProgress !== null && !shouldYield()', 470, 480);oRenderTransferPen.font = '14px sans-serif';oRenderTransferPen.fillStyle='red';oRenderTransferPen.fillText('createContainer', 278, 85);oRenderTransferPen.fillText('updateContainer', 281, 221);</script>


<pre><code>ä¸¤ç§å¯åŠ¨æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸€èµ·å›é¡¾ä¸€ä¸‹ã€‚é«˜è§’åº¦åœ°æ¥çœ‹å°±æ˜¯createContainerå’ŒupdateContainerã€‚
1ï¼‰åˆšå¼€å§‹æ˜¯è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼ŒcreateContaineråˆ›å»ºfiberRootå’ŒrootFiberï¼ˆæœ‰æ—¶é—´ä»”ç»†çœ‹ä¸€ä¸‹è¿™é‡Œï¼‰ï¼Œç»‘å®šä¸Šæ‰€æœ‰æ”¯æŒçš„å‡½æ•°ï¼Œè¿™ä¸€æ­¥ä¸¤ç§æ¨¡å¼æ˜¯ç›¸åŒçš„ï¼ŒLegacyæ˜¯è°ƒç”¨æš´éœ²å‡ºçš„renderå‡½æ•°ï¼ŒConcurrentæ˜¯è°ƒç”¨æš´éœ²å‡ºçš„createRootå‡½æ•°ã€‚
2ï¼‰ä¸‹ä¸€æ­¥å°±æ˜¯updateContainerï¼Œä¹‹åçš„renderé˜¶æ®µä»¥åŠcommité˜¶æ®µéƒ½æ˜¯åœ¨å…¶ä¸­è°ƒç”¨æˆ–è¿æ¥ã€‚æˆ‘ä»¬å…ˆçœ‹renderé˜¶æ®µï¼Œè¿™æ—¶ä¸¤ç§æ¨¡å¼éƒ½è°ƒç”¨äº†updateContainerï¼ŒLegacyæ˜¯ä¹‹å‰renderå‡½æ•°è°ƒç”¨ï¼ŒConcurrentæ˜¯å†æ¬¡è°ƒç”¨createRootå‡½æ•°è¿”å›çš„new ReactDOMRootçš„åŸå‹ä¸Šçš„renderæ–¹æ³•è°ƒç”¨ï¼ŒäºŒè€…ä¼ å‚ä¸åŒã€‚updateContaineré¦–å…ˆè°ƒç”¨createUpdateåˆ›å»ºupdateå¯¹è±¡ï¼Œå†è°ƒç”¨enqueueUpdateå°†å…¶ä¿å­˜åœ¨updateQueueç¯çŠ¶é“¾è¡¨ä¸Šï¼Œæœ€åè°ƒç”¨ensureRootIsScheduledï¼ŒensureRootIsScheduledä¼šæ ¹æ®ä¹‹å‰Legacyå’ŒConcurrentä¼ å‚çš„ä¸åŒï¼Œæœ‰ä¸åŒçš„å¤„ç†ã€‚Legacyè¿™è¾¹ä¼šåˆ¤æ–­root.tagæ˜¯å¦ç­‰äºLegacyRootï¼Œå¦‚æœç›¸ç­‰åˆ™åŒæ­¥è°ƒç”¨performSyncWorkOnRootï¼Œå¦åˆ™å¼‚æ­¥è°ƒç”¨performSyncWorkOnRootï¼Œè€ŒConcurrentè¿™è¾¹æ˜¯ç›´æ¥å¼‚æ­¥è°ƒç”¨performConcurrentWorkOnRootã€‚æ¥ä¸‹æ¥performSyncWorkOnRootä¼šè°ƒç”¨renderRootSync,è€ŒperformConcurrentWorkOnRootè¿™æ—¶ä¼šåˆ¤æ–­ï¼Œæ˜¯å¦è°ƒç”¨äº†æ–°çš„åŠŸèƒ½ç‰¹æ€§ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šè°ƒç”¨renderRootSyncï¼Œèµ°å›Legacyçš„æ¨¡å¼ã€‚å¦‚æœä½¿ç”¨äº†æ–°çš„åŠŸèƒ½ç‰¹æ€§æ‰ä¼šè°ƒç”¨renderRootConcurrentã€‚renderRootSyncå’ŒrenderRootConcurrentéƒ½å›è°ƒç”¨prepareFreshStackï¼Œè¿™é‡Œå¾ˆé‡è¦ï¼ŒprepareFreshStackä¼šç”Ÿæˆæ–°çš„workInProgressçš„Fiberå¯¹è±¡ï¼Œç„¶årenderRootSyncä¼šè°ƒç”¨workLoopSyncï¼ŒrenderRootConcurrentä¼šè°ƒç”¨workLoopConcurrentï¼ŒworkLoopSyncå’ŒworkLoopConcurrentäºŒè€…éƒ½ä¼šLoopè°ƒç”¨performUnitOfWorkï¼Œåªæ˜¯è°ƒç”¨çš„æ¡ä»¶æœ‰ä¸€ç‚¹ä¸åŒï¼ŒworkLoopSyncçš„åœæ­¢æ¡ä»¶åªæœ‰workInProgress===nullï¼Œè€Œï¼ŒworkLoopConcurrentçš„åœæ­¢æ¡ä»¶æ˜¯workInProgress === nullæˆ–shouldYield()ï¼Œä¹Ÿå°±æ˜¯ä¸ä»…workInProgressä¸ºnullæ—¶ä¼šåœä¸‹æ¥ï¼Œå½“æµè§ˆå™¨æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´çš„æ—¶å€™ä¹Ÿä¼šåœä¸‹æ¥ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¼‚æ­¥å¯ä¸­æ–­æœºåˆ¶ä¸­çš„å¯ä¸­æ–­å®ç°ã€‚ä¹‹åperformUnitOfWorkä¼šè°ƒç”¨beginWorkå’ŒcompleteWorkå®Œæˆåè°ƒå’Œè°ƒåº¦çš„è¿‡ç¨‹ï¼Œç„¶åå°†è°ƒåº¦ç»“æœä¼ ç»™commitRootå‡½æ•°ï¼Œè¿›å…¥commité˜¶æ®µã€‚renderé˜¶æ®µçš„ä»beginWorkå’ŒcompleteWorkåˆ°commitRootçš„è¯¦ç»†å­¦ä¹ ï¼Œæ”¾åœ¨ä¸‹é¢ã€‚
</code></pre><h3 id="renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹"><a href="#renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹" class="headerlink" title="renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹"></a>renderé˜¶æ®µå‡½æ•°è°ƒç”¨è¿‡ç¨‹</h3><ul>
<li>workInProgressï¼šæ–°åˆ›å»ºçš„workInProgress Fiber</li>
<li>performUnitOfWorkï¼šworkInprogress å’Œ å·²ç»åˆ›å»ºçš„Fiberè¿æ¥å½¢æˆfiberæ ‘ï¼Œè¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºæ·±åº¦ä¼˜åŒ–éå†ã€‚</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  React.createElement(</span><br><span class="line">    &apos;div&apos;, </span><br><span class="line">    &#123;key: &apos;name&apos;&#125;, </span><br><span class="line">    [React.createElement(&apos;h1&apos;, &#123;key: &apos;num&apos;&#125;, 123), &apos;jyy&apos;]), </span><br><span class="line">  document.getElementById(&quot;root&quot;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
  <canvas id="performUnitOfWork" width="600" height="460"></canvas>

<script>
  const oPerformUnitOfWork = document.getElementById('performUnitOfWork');
  const oPerformUnitOfWorkPen = oPerformUnitOfWork.getContext('2d');
  oPerformUnitOfWorkPen.font = '14px sans-serif';oPerformUnitOfWorkPen.fillStyle='black';oPerformUnitOfWorkPen.strokeRect(150, 10, 100, 50);oPerformUnitOfWorkPen.strokeRect(150, 140, 100, 50);oPerformUnitOfWorkPen.strokeRect(150, 260, 100, 50);oPerformUnitOfWorkPen.strokeRect(150, 380, 100, 50);oPerformUnitOfWorkPen.strokeRect(460, 260, 100, 50);oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 60);oPerformUnitOfWorkPen.lineTo(185, 140);oPerformUnitOfWorkPen.lineTo(180, 135);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 140);oPerformUnitOfWorkPen.lineTo(190, 135);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 190);oPerformUnitOfWorkPen.lineTo(185, 260);oPerformUnitOfWorkPen.lineTo(180, 255);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 260);oPerformUnitOfWorkPen.lineTo(190, 255);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 310);oPerformUnitOfWorkPen.lineTo(185, 380);oPerformUnitOfWorkPen.lineTo(180, 375);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(185, 380);oPerformUnitOfWorkPen.lineTo(190, 375);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 140);oPerformUnitOfWorkPen.lineTo(215, 60);oPerformUnitOfWorkPen.lineTo(210, 65);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 60);oPerformUnitOfWorkPen.lineTo(220, 65);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 260);oPerformUnitOfWorkPen.lineTo(215, 190);oPerformUnitOfWorkPen.lineTo(210, 195);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 190);oPerformUnitOfWorkPen.lineTo(220, 195);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 380);oPerformUnitOfWorkPen.lineTo(215, 310);oPerformUnitOfWorkPen.lineTo(210, 315);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(215, 310);oPerformUnitOfWorkPen.lineTo(220, 315);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(250, 295);oPerformUnitOfWorkPen.lineTo(460, 295);oPerformUnitOfWorkPen.lineTo(455, 290);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(460, 295);oPerformUnitOfWorkPen.lineTo(455, 300);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(510, 260);oPerformUnitOfWorkPen.lineTo(250, 175);oPerformUnitOfWorkPen.lineTo(257, 182);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.beginPath();oPerformUnitOfWorkPen.lineTo(250, 175);oPerformUnitOfWorkPen.lineTo(260, 176);oPerformUnitOfWorkPen.stroke();oPerformUnitOfWorkPen.fillText('rootFiber', 170, 40);oPerformUnitOfWorkPen.fillText('div.name', 168, 168);oPerformUnitOfWorkPen.fillText('h1.num', 178, 290);oPerformUnitOfWorkPen.fillText('123', 189, 408);oPerformUnitOfWorkPen.fillText('jyy', 503, 288);oPerformUnitOfWorkPen.fillText('child', 153, 105);oPerformUnitOfWorkPen.fillText('return ', 218, 105);oPerformUnitOfWorkPen.fillText('child', 153, 227);oPerformUnitOfWorkPen.fillText('return', 218, 227);oPerformUnitOfWorkPen.fillText('sibling', 280, 310);oPerformUnitOfWorkPen.fillText('return', 365, 210);oPerformUnitOfWorkPen.fillStyle='#F612E3';oPerformUnitOfWorkPen.fillText('1.beginWork', 60, 40);oPerformUnitOfWorkPen.fillText('2.beginWork', 60, 168);oPerformUnitOfWorkPen.fillText('3-1.beginWork', 50, 290);oPerformUnitOfWorkPen.fillText('4-1.beginWork', 360, 270);oPerformUnitOfWorkPen.fillStyle='#3CF612';oPerformUnitOfWorkPen.fillText('3-2.completeWork', 255, 290);oPerformUnitOfWorkPen.fillText('4-2.completeWork', 470, 240);oPerformUnitOfWorkPen.fillText('4-3.completeWork', 255, 168);oPerformUnitOfWorkPen.fillText('4-4.completeWork', 255, 40);
</script>


<ol>
<li><p><code>beginWorké˜¶æ®µ</code> ä»æ ¹èŠ‚ç‚¹rootFiberå¼€å§‹ï¼Œéå†åˆ°å¶å­èŠ‚ç‚¹ï¼Œæ¯æ¬¡éå†åˆ°çš„èŠ‚ç‚¹éƒ½ä¼šæ‰§è¡ŒbeginWorkï¼Œå¹¶ä¸”ä¼ å…¥å½“å‰FiberèŠ‚ç‚¹ï¼Œç„¶ååˆ›å»ºæˆ–å¤ç”¨å®ƒçš„å­FiberèŠ‚ç‚¹ï¼Œå¹¶èµ‹å€¼ç»™workInProgress.childã€‚</p>
</li>
<li><p><code>completeWorké˜¶æ®µ</code> åœ¨æ•è·é˜¶æ®µéå†åˆ°å­èŠ‚ç‚¹ä¹‹åï¼Œä¼šæ‰§è¡ŒcompleteWorkæ–¹æ³•ï¼Œæ‰§è¡Œå®Œæˆä¹‹åä¼šåˆ¤æ–­æ­¤èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹å­˜ä¸å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ä¼šä¸ºå…„å¼ŸèŠ‚ç‚¹æ‰§è¡ŒcompleteWorkï¼Œå½“å…¨éƒ¨å…„å¼ŸèŠ‚ç‚¹æ‰§è¡Œå®Œä¹‹åï¼Œä¼šå‘ä¸Šâ€˜å†’æ³¡â€™åˆ°çˆ¶èŠ‚ç‚¹æ‰§è¡ŒcompleteWorkï¼Œç›´åˆ°rootFiberã€‚</p>
</li>
</ol>
  <div class="post-warning">æ³¨æ„ï¼šå½“éå†åˆ°åªæœ‰ä¸€ä¸ªå­æ–‡æœ¬èŠ‚ç‚¹çš„Fiberæ—¶ï¼Œè¯¥FiberèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ä¼šæ‰§è¡ŒbeginWorkå’ŒcompleteWorkï¼Œå¦‚å›¾ä¸­çš„â€˜countâ€™æ–‡æœ¬èŠ‚ç‚¹ã€‚è¿™æ˜¯reactçš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µ</div>

<ul>
<li>renderé˜¶æ®µæ•´ä½“è°ƒç”¨æµç¨‹ï¼š</li>
</ul>
  <canvas id="render" width="700" height="530"></canvas>


  <script>var oRender = document.getElementById('render');var oRenderPen = oRender.getContext('2d');oRenderPen.font = '10px sans-serif';oRenderPen.strokeRect(159, 10, 130, 30);oRenderPen.fillText('performSyncWorkOnRoot', 165, 28);oRenderPen.beginPath();oRenderPen.lineTo(224, 40);oRenderPen.lineTo(224, 54);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(220, 54);oRenderPen.lineTo(228, 54);oRenderPen.lineTo(224, 59);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(320, 10, 158, 30);oRenderPen.fillText('performConcurrentWorkOnRoot', 325, 28);oRenderPen.beginPath();oRenderPen.lineTo(398, 40);oRenderPen.lineTo(398, 54);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(394, 54);oRenderPen.lineTo(402, 54);oRenderPen.lineTo(398, 59);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(185, 60, 80, 30);oRenderPen.fillText('workLoopSync', 192, 78);oRenderPen.beginPath();oRenderPen.lineTo(265, 75);oRenderPen.lineTo(285, 75);oRenderPen.lineTo(285, 104);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(281, 104);oRenderPen.lineTo(289, 104);oRenderPen.lineTo(285, 109);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(340, 60, 110, 30);oRenderPen.fillText('workLoopConcurrent', 347, 78);oRenderPen.beginPath();oRenderPen.lineTo(340, 75);oRenderPen.lineTo(320, 75);oRenderPen.lineTo(320, 104);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(316, 104);oRenderPen.lineTo(324, 104);oRenderPen.lineTo(320, 109);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(253, 110, 100, 30);oRenderPen.fillText('performUnitOfWork', 257, 128);oRenderPen.beginPath();oRenderPen.lineTo(253, 125);oRenderPen.lineTo(224, 125);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(224, 121);oRenderPen.lineTo(224, 129);oRenderPen.lineTo(219, 125);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(160, 110, 58, 30);oRenderPen.fillText('beginWork', 164, 128);oRenderPen.beginPath();oRenderPen.lineTo(189, 140);oRenderPen.lineTo(189, 155);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(185, 155);oRenderPen.lineTo(193, 155);oRenderPen.lineTo(189, 160);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(189, 160);oRenderPen.lineTo(244, 185);oRenderPen.lineTo(189, 210);oRenderPen.lineTo(134, 185);oRenderPen.closePath();oRenderPen.fillText('current !== null', 152, 182);oRenderPen.fillText('update | mount', 154, 193);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(134, 185);oRenderPen.lineTo(70, 185);oRenderPen.lineTo(70, 220);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 220);oRenderPen.lineTo(74, 220);oRenderPen.lineTo(70, 225);oRenderPen.closePath();oRenderPen.fill();oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(244, 185);oRenderPen.lineTo(342, 185);oRenderPen.lineTo(342, 250);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(338, 250);oRenderPen.lineTo(346, 250);oRenderPen.lineTo(342, 255);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(70, 225);oRenderPen.lineTo(108, 240);oRenderPen.lineTo(70, 255);oRenderPen.lineTo(32, 240);oRenderPen.closePath();oRenderPen.stroke();oRenderPen.fillText('æ˜¯å¦èƒ½å¤ç”¨', 44, 243);oRenderPen.beginPath();oRenderPen.lineTo(108, 240);oRenderPen.lineTo(262, 240);oRenderPen.lineTo(262, 250);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(258, 250);oRenderPen.lineTo(266, 250);oRenderPen.lineTo(262, 255);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(70, 255);oRenderPen.lineTo(70, 275);oRenderPen.lineTo(70, 275);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 275);oRenderPen.lineTo(74, 275);oRenderPen.lineTo(70, 280);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(1, 280, 144, 30);oRenderPen.fillText('bailoutOnAlreadyFinishedWork', 2, 298);oRenderPen.beginPath();oRenderPen.lineTo(70, 310);oRenderPen.lineTo(70, 340);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 340);oRenderPen.lineTo(74, 340);oRenderPen.lineTo(70, 345);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(70, 345);oRenderPen.lineTo(128, 360);oRenderPen.lineTo(70, 375);oRenderPen.lineTo(12, 360);oRenderPen.closePath();oRenderPen.stroke();oRenderPen.fillText('èŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°', 31, 364);oRenderPen.beginPath();oRenderPen.lineTo(70, 375);oRenderPen.lineTo(70, 395);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(66, 395);oRenderPen.lineTo(74, 395);oRenderPen.lineTo(70, 400);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(30, 400, 82, 30);oRenderPen.fillText('cloneChildFibers', 31, 418);oRenderPen.beginPath();oRenderPen.lineTo(128, 360);oRenderPen.lineTo(142, 360);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(142, 356);oRenderPen.lineTo(142, 364);oRenderPen.lineTo(147, 360);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(147, 344, 50, 30);oRenderPen.fillText('return null', 148, 362);oRenderPen.strokeRect(236, 255, 128, 30);oRenderPen.fillText('æ ¹æ®workInProgress.tagè¿›å…¥', 236, 268);oRenderPen.fillText('ä¸åŒçš„Fiberåˆ›å»ºå‡½æ•°', 254, 280);oRenderPen.beginPath();oRenderPen.lineTo(262, 285);oRenderPen.lineTo(262, 315);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(258, 315);oRenderPen.lineTo(266, 315);oRenderPen.lineTo(262, 320);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(342, 285);oRenderPen.lineTo(342, 315);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(338, 315);oRenderPen.lineTo(346, 315);oRenderPen.lineTo(342, 320);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(202, 320, 96, 30);oRenderPen.fillText('reconcileChildFibers', 203, 338);oRenderPen.strokeRect(310, 320, 82, 30);oRenderPen.fillText('mountchildFibers', 312, 338);oRenderPen.beginPath();oRenderPen.lineTo(262, 350);oRenderPen.lineTo(262, 375);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(258, 375);oRenderPen.lineTo(266, 375);oRenderPen.lineTo(262, 380);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(342, 350);oRenderPen.lineTo(342, 375);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(338, 375);oRenderPen.lineTo(346, 375);oRenderPen.lineTo(342, 380);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(258, 380, 90, 30);oRenderPen.fillText('childReconclier', 268, 398);oRenderPen.strokeRect(272, 430, 64, 30);oRenderPen.fillText('createFibers', 275, 448);oRenderPen.beginPath();oRenderPen.lineTo(302, 410);oRenderPen.lineTo(302, 425);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(298, 425);oRenderPen.lineTo(306, 425);oRenderPen.lineTo(302, 430);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(353, 125);oRenderPen.lineTo(365, 125);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(365, 121);oRenderPen.lineTo(365, 129);oRenderPen.lineTo(370, 125);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(370, 110, 108, 30);oRenderPen.fillText('completeUnitOfWork', 374, 128);oRenderPen.beginPath();oRenderPen.lineTo(478, 125);oRenderPen.lineTo(505, 125);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(505, 121);oRenderPen.lineTo(505, 129);oRenderPen.lineTo(510, 125);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(510, 110, 76, 30);oRenderPen.fillText('completeWork', 514, 128);oRenderPen.beginPath();oRenderPen.lineTo(548, 140);oRenderPen.lineTo(548, 155);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(544, 155);oRenderPen.lineTo(552, 155);oRenderPen.lineTo(548, 160);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(482, 160, 142, 30);oRenderPen.fillText('æ ¹æ®workInProgress.tagçš„ç±»å‹', 483, 172);oRenderPen.fillText('è¿›å…¥ä¸åŒçš„å‡½æ•°', 516, 184);oRenderPen.beginPath();oRenderPen.lineTo(550, 190);oRenderPen.lineTo(550, 200);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(546, 200);oRenderPen.lineTo(554, 200);oRenderPen.lineTo(550, 205);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(551, 205);oRenderPen.lineTo(599, 220);oRenderPen.lineTo(551, 235);oRenderPen.lineTo(503, 220);oRenderPen.closePath();oRenderPen.stroke();oRenderPen.fillText('update | mount', 516, 222);oRenderPen.beginPath();oRenderPen.lineTo(503, 220);oRenderPen.lineTo(458, 220);oRenderPen.lineTo(458, 265);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(454, 265);oRenderPen.lineTo(462, 265);oRenderPen.lineTo(458, 270);oRenderPen.closePath();oRenderPen.fill();oRenderPen.beginPath();oRenderPen.lineTo(599, 220);oRenderPen.lineTo(644, 220);oRenderPen.lineTo(644, 265);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(640, 265);oRenderPen.lineTo(648, 265);oRenderPen.lineTo(644, 270);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(404, 270, 120, 30);oRenderPen.fillText('updateHostComponent$1', 405, 288);oRenderPen.beginPath();oRenderPen.lineTo(460, 300);oRenderPen.lineTo(460, 435);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(456, 435);oRenderPen.lineTo(464, 435);oRenderPen.lineTo(460, 440);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(404, 440, 192, 30);oRenderPen.fillText('æŠŠå¸¦æœ‰effectTagçš„èŠ‚ç‚¹åŠ å…¥åˆ°effectListä¸­', 405, 453);oRenderPen.fillText('è¿”å›ä¸‹ä¸€ä¸ªworkInProgressèŠ‚ç‚¹', 430, 465);oRenderPen.beginPath();oRenderPen.lineTo(530, 470);oRenderPen.lineTo(530, 485);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(526, 485);oRenderPen.lineTo(534, 485);oRenderPen.lineTo(530, 490);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(610, 270, 70, 30);oRenderPen.fillText('createInstance', 611, 288);oRenderPen.beginPath();oRenderPen.lineTo(644, 300);oRenderPen.lineTo(644, 315);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(640, 315);oRenderPen.lineTo(648, 315);oRenderPen.lineTo(644, 320);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(603, 320, 86, 30);oRenderPen.fillText('appendAllChildren', 604, 338);oRenderPen.beginPath();oRenderPen.lineTo(644, 350);oRenderPen.lineTo(644, 365);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(640, 365);oRenderPen.lineTo(648, 365);oRenderPen.lineTo(644, 370);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(598, 370, 96, 30);oRenderPen.fillText('finalizeInitialchildren', 599, 388);oRenderPen.beginPath();oRenderPen.lineTo(644, 400);oRenderPen.lineTo(644, 455);oRenderPen.lineTo(601, 455);oRenderPen.stroke();oRenderPen.beginPath();oRenderPen.lineTo(601, 451);oRenderPen.lineTo(601, 459);oRenderPen.lineTo(596, 455);oRenderPen.closePath();oRenderPen.fill();oRenderPen.strokeRect(496, 490, 70, 30);oRenderPen.fillText('commitRoot', 503, 508);oRenderPen.fillStyle='blue';oRenderPen.fillText('update', 92, 180);oRenderPen.fillText('mount', 260, 180);oRenderPen.fillText('å¦', 120, 236);oRenderPen.fillText('èƒ½', 74, 270);oRenderPen.fillText('å¦', 130, 357);oRenderPen.fillText('æ˜¯', 74, 388);oRenderPen.fillText('cloneå­èŠ‚ç‚¹', 114, 418);oRenderPen.fillText('update',228, 305);oRenderPen.fillText('mount', 344, 305);oRenderPen.fillText('å¸¦ä¸ŠeffectTag',190, 315);oRenderPen.fillText('ä¸å¸¦ä¸ŠeffectTag', 350, 315);oRenderPen.fillText('diffç®—æ³•', 225, 370);oRenderPen.fillText('åˆ›å»ºå­èŠ‚ç‚¹', 214, 450);oRenderPen.fillText('å‡è®¾è¿›å…¥äº†', 430, 175);oRenderPen.fillText('HostComponent', 402, 187);oRenderPen.fillText('update', 467, 216);oRenderPen.fillText('mount', 603, 216);oRenderPen.fillText('å¤„ç†propså°†å˜åŒ–çš„éƒ¨åˆ†èµ‹å€¼ç»™', 462, 250);oRenderPen.fillText('workInprogress.updateQueue', 462, 262);oRenderPen.fillText('åˆ›å»ºdomèŠ‚ç‚¹èµ‹å€¼', 529, 282);oRenderPen.fillText('ç»™fiber.stateNode', 528, 294);oRenderPen.fillText('å°†åä»£èŠ‚ç‚¹æ’å…¥å½“å‰èŠ‚ç‚¹', 492, 338);oRenderPen.fillText('åˆå§‹åŒ–domå±æ€§', 525, 387);</script>


<h3 id="beginWork"><a href="#beginWork" class="headerlink" title="beginWork"></a>beginWork</h3><p>  beginWorkä¸»è¦çš„å·¥ä½œæ˜¯åˆ›å»ºæˆ–å¤ç”¨å­fiberèŠ‚ç‚¹ã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">beginWork</span>(<span class="params">current, workInProgress, renderLanes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> updateLanes = workInProgress.lanes;</span><br><span class="line">  <span class="comment">// 1.updateæ—¶æ»¡è¶³æ¡ä»¶å³å¯å¤ç”¨current fiberè¿›å…¥bailoutOnAlreadyFinishedWorkå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (current !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> oldProps = current.memoizedProps;</span><br><span class="line">    <span class="keyword">var</span> newProps = workInProgress.pendingProps;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (oldProps !== newProps || hasContextChanged() || (workInProgress.type !== current.type )) &#123;</span><br><span class="line">      didReceiveUpdate = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!includesSomeLane(renderLanes, updateLanes)) &#123;</span><br><span class="line">      didReceiveUpdate = <span class="literal">false</span>; </span><br><span class="line">      <span class="keyword">switch</span> (workInProgress.tag) &#123;</span><br><span class="line">       <span class="comment">// ......</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> bailoutOnAlreadyFinishedWork(current, workInProgress, renderLanes);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ((current.flags &amp; ForceUpdateForLegacySuspense) !== NoFlags) &#123;</span><br><span class="line">        didReceiveUpdate = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        didReceiveUpdate = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    didReceiveUpdate = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  workInProgress.lanes = NoLanes;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.æ ¹æ®tagæ¥åˆ›å»ºä¸åŒçš„fiber æœ€åè¿›å…¥reconcileChildrenå‡½æ•°</span></span><br><span class="line">  <span class="keyword">switch</span> (workInProgress.tag) &#123;</span><br><span class="line">    <span class="keyword">case</span> IndeterminateComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> LazyComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> FunctionComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ClassComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostRoot: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostText: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> SuspenseComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> HostPortal: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ForwardRef: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Fragment: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Mode: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Profiler: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ContextProvider: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ContextConsumer: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> MemoComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> SimpleMemoComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> IncompleteClassComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> SuspenseListComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> FundamentalComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> ScopeComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> Block:   <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> OffscreenComponent: <span class="comment">// ......</span></span><br><span class="line">    <span class="keyword">case</span> LegacyHiddenComponent: <span class="comment">// ......</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">Error</span>( <span class="string">"Unknown unit of work tag ("</span> + workInProgress.tag + <span class="string">"). This error is likely caused by a bug in React. Please file an issue."</span> );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°å‚æ•°ä¸­æœ‰current Fiberï¼Œä¹Ÿå°±æ˜¯å½“å‰çœŸå®domå¯¹åº”çš„Fiberæ ‘ï¼Œåœ¨ä¹‹å‰ä»‹ç»FiberåŒç¼“å­˜æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶é™¤äº†rootFiberå¤–ï¼Œcurrent ç­‰äº nullï¼Œå› ä¸ºé¦–æ¬¡æ¸²æŸ“domè¿˜æ²¡æ„å»ºå‡ºæ¥ï¼Œåœ¨updateæ—¶currentä¸ç­‰äº nullï¼Œå› ä¸ºupdateæ—¶domæ ‘å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥beginWorkå‡½æ•°ä¸­ç”¨current === nullæ¥åˆ¤æ–­æ˜¯mountè¿˜æ˜¯updateè¿›å…¥ä¸åŒçš„é€»è¾‘ã€‚</p>
<blockquote>
<p>mountï¼šæ ¹æ®fiber.tagè¿›å…¥ä¸åŒfiberçš„åˆ›å»ºå‡½æ•°ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨åˆ°reconcileChildrenåˆ›å»ºå­Fiber<br>updateï¼šåœ¨æ„å»ºworkInProgressçš„æ—¶å€™ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶ï¼Œä¼šå¤ç”¨current Fiberæ¥è¿›è¡Œä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥bailoutOnAlreadyFinishedWorkçš„é€»è¾‘ï¼Œèƒ½å¤ç”¨didReceiveUpdateå˜é‡æ˜¯falseï¼Œå¤ç”¨çš„æ¡ä»¶æ˜¯<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oldProps === newProps &amp;&amp; workInProgress.type === current.type å±æ€§å’Œfiberçš„typeä¸å˜</span><br><span class="line">!includesSomeLane(renderLanes, updateLanes) æ›´æ–°çš„ä¼˜å…ˆçº§æ˜¯å¦è¶³å¤Ÿã€‚</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="bailoutOnAlreadyFinishedWork"><a href="#bailoutOnAlreadyFinishedWork" class="headerlink" title="bailoutOnAlreadyFinishedWork"></a>bailoutOnAlreadyFinishedWork</h4>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bailoutOnAlreadyFinishedWork</span>(<span class="params">current, workInProgress, renderLanes</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ä¼˜å…ˆçº§è¶³å¤Ÿåˆ™è¿›å…¥cloneChildFibersï¼Œå¦åˆ™è¿”å›nullï¼Œä¸éœ€è¦æ›´æ–°</span></span><br><span class="line">  <span class="keyword">if</span> (!includesSomeLane(renderLanes, workInProgress.childLanes)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    cloneChildFibers(current, workInProgress);</span><br><span class="line">    <span class="keyword">return</span> workInProgress.child;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="reconcileChildren-mountChildFibers"><a href="#reconcileChildren-mountChildFibers" class="headerlink" title="reconcileChildren/mountChildFibers"></a>reconcileChildren/mountChildFibers</h4><p>  åˆ›å»ºå­fiberçš„è¿‡ç¨‹ä¼šè¿›å…¥reconcileChildrenï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹æºç ï¼‰ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯ä¸ºworkInProgress fiberèŠ‚ç‚¹ç”Ÿæˆå®ƒçš„child fiberå³ workInProgress.childã€‚<strong>ç„¶åç»§ç»­æ·±åº¦ä¼˜å…ˆéå†å®ƒçš„å­èŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</strong></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reconcileChildren</span>(<span class="params">current, workInProgress, nextChildren, renderLanes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (current === <span class="literal">null</span>) &#123;</span><br><span class="line">    workInProgress.child = mountChildFibers(workInProgress, <span class="literal">null</span>, nextChildren, renderLanes);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    workInProgress.child = reconcileChildFibers(workInProgress, current.child, nextChildren, renderLanes);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  reconcileChildrenä¼šåŒºåˆ†mountå’Œupdateä¸¤ç§æƒ…å†µï¼Œè¿›å…¥reconcileChildFibersæˆ–mountChildFibersï¼ŒreconcileChildFiberså’ŒmountChildFibersæœ€ç»ˆå…¶å®éƒ½æ˜¯è°ƒç”¨ChildReconcilerä¼ é€’ä¸åŒçš„å‚æ•°è¿”å›çš„å‡½æ•°ï¼Œè¿™ä¸ªå‚æ•°ï¼ˆshouldTrackSideEffectsï¼‰ç”¨æ¥è¡¨ç¤ºæ˜¯å¦è¿½è¸ªå‰¯ä½œç”¨ï¼Œåœ¨ChildReconcilerä¸­ç”¨shouldTrackSideEffectsæ¥åˆ¤æ–­æ˜¯å¦ä¸ºå¯¹åº”çš„èŠ‚ç‚¹æ‰“ä¸ŠeffectTagã€‚</p>
<p>  ä¸ºFiberæ‰“ä¸ŠeffectTagä¹‹ååœ¨commité˜¶æ®µä¼šè¢«æ‰§è¡Œå¯¹åº”domçš„å¢åˆ æ”¹ï¼Œè€Œä¸”åœ¨reconcileChildrençš„æ—¶å€™ï¼ŒrootFiberæ˜¯å­˜åœ¨alternateçš„ï¼Œå³rootFiberå­˜åœ¨å¯¹åº”çš„current Fiberï¼Œæ‰€ä»¥rootFiberä¼šèµ°reconcileChildFibersçš„é€»è¾‘ï¼Œæ‰€ä»¥shouldTrackSideEffectsç­‰äºtrueä¼šè¿½è¸ªå‰¯ä½œç”¨ï¼Œæœ€åä¸ºrootFiberæ‰“ä¸ŠPlacementçš„effectTagï¼Œç„¶åå°†domä¸€æ¬¡æ€§æ’å…¥ï¼Œæé«˜æ€§èƒ½ã€‚</p>
<h3 id="completeWork"><a href="#completeWork" class="headerlink" title="completeWork"></a>completeWork</h3><p>  completeWorkä¸»è¦å·¥ä½œæ˜¯å¤„ç†fiberçš„propsã€åˆ›å»ºdomã€åˆ›å»ºeffectListã€‚</p>
<p>  ä»å‡½æ•°è°ƒç”¨æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»performUnitOfWorkæ¥çœ‹ï¼Œåœ¨WorkLoopSyncæˆ–WorkLoopConcurrentä¸­éƒ½ä¼šdoâ€¦whileè°ƒç”¨performUnitOfWorkï¼Œåœæ­¢çš„æ¡ä»¶æ˜¯workInprogressç­‰äºnullã€‚</p>
<p>  performUnitOfWorké¦–å…ˆä¼šè°ƒç”¨beginWorkï¼Œåˆ›å»ºæˆ–å¤ç”¨å­fiberèŠ‚ç‚¹ï¼Œå¦‚æœå­èŠ‚ç‚¹è¿˜æœ‰æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶èµ‹ä¸ºæ–°çš„workInprogressç»§ç»­æ‰§è¡ŒbeginWorkã€‚å¦‚æœæ²¡æœ‰å­èŠ‚ç‚¹å¼€å§‹è°ƒç”¨completeUnitOfWorkã€‚</p>
<p>  completeUnitOfWorkä¼šdoâ€¦whileè°ƒç”¨completeWorkï¼Œå¦‚æœå½“å‰æœ‰å…„å¼ŸèŠ‚ç‚¹siblingFiberï¼Œåˆ™å¯¹å°†siblingFiberèµ‹å€¼ç»™workInProgressï¼Œå†èµ°beginWorkã€‚ã€‚ã€‚å¦‚æœå½“å‰å­èŠ‚ç‚¹æœ‰returnFiberåˆ™å°†returnFiberèµ‹ç»™workInProgressï¼Œç»§ç»­æ‰§è¡ŒcompleteWorkã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">completeWork</span>(<span class="params">current, workInProgress, renderLanes</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> newProps = workInProgress.pendingProps; </span><br><span class="line"></span><br><span class="line">  popTreeContext(workInProgress);</span><br><span class="line">  <span class="keyword">switch</span> (workInProgress.tag) &#123;</span><br><span class="line">    <span class="keyword">case</span> IndeterminateComponent:</span><br><span class="line">    <span class="keyword">case</span> LazyComponent:</span><br><span class="line">    <span class="keyword">case</span> SimpleMemoComponent:</span><br><span class="line">    <span class="keyword">case</span> FunctionComponent:</span><br><span class="line">    <span class="keyword">case</span> ForwardRef:</span><br><span class="line">    <span class="keyword">case</span> Fragment:</span><br><span class="line">    <span class="keyword">case</span> Mode:</span><br><span class="line">    <span class="keyword">case</span> Profiler:</span><br><span class="line">    <span class="keyword">case</span> ContextConsumer:</span><br><span class="line">    <span class="keyword">case</span> MemoComponent:</span><br><span class="line">      ...</span><br><span class="line">    <span class="keyword">case</span> ClassComponent:</span><br><span class="line">      ...</span><br><span class="line">    <span class="keyword">case</span> HostComponent:</span><br><span class="line">      &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (current !== <span class="literal">null</span> &amp;&amp; workInProgress.stateNode != <span class="literal">null</span>) &#123;</span><br><span class="line">          updateHostComponent(current, workInProgress, type, newProps, rootContainerInstance);</span><br><span class="line">          ...</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ...</span><br><span class="line">          <span class="keyword">var</span> instance = createInstance(type, newProps, rootContainerInstance, currentHostContext, workInProgress);</span><br><span class="line"></span><br><span class="line">          appendAllChildren(instance, workInProgress, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">          workInProgress.stateNode = instance;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (finalizeInitialChildren(instance, type, newProps, rootContainerInstance)) &#123;</span><br><span class="line">            markUpdate(workInProgress);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        bubbleProperties(workInProgress);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>æ ¹æ®workInProgress.tagè¿›å…¥ä¸åŒå‡½æ•°ï¼Œæˆ‘ä»¬ä»¥HostComponentä¸¾ä¾‹</li>
<li>updateæ—¶ï¼ˆé™¤äº†åˆ¤æ–­current===nullå¤–è¿˜éœ€è¦åˆ¤æ–­workInProgress.stateNode===nullï¼‰ï¼Œè°ƒç”¨updateHostComponentå¤„ç†propsï¼ˆåŒ…æ‹¬onClickã€styleã€children â€¦ï¼‰ï¼Œå¹¶å°†å¤„ç†å¥½çš„propsèµ‹å€¼ç»™updatePayload,æœ€åä¼šä¿å­˜åœ¨workInProgress.updateQueueä¸Šã€‚<br>mountæ—¶ è°ƒç”¨createInstanceåˆ›å»ºdomï¼Œå°†åä»£domèŠ‚ç‚¹æ’å…¥åˆšåˆ›å»ºçš„domä¸­ï¼Œè°ƒç”¨finalizeInitialChildrenå¤„ç†propsï¼ˆå’ŒupdateHostComponentå¤„ç†çš„é€»è¾‘ç±»ä¼¼ï¼‰</li>
<li>åœ¨beginWorkçš„mountæ—¶ï¼ŒrootFiberå­˜åœ¨å¯¹åº”çš„currentï¼Œæ‰€ä»¥ä»–ä¼šæ‰§è¡ŒmountChildFibersæ‰“ä¸ŠPlacementçš„effectTagï¼Œåœ¨å†’æ³¡é˜¶æ®µä¹Ÿå°±æ˜¯æ‰§è¡ŒcompleteWorkæ—¶ï¼Œæˆ‘ä»¬å°†å­å­™èŠ‚ç‚¹é€šè¿‡appendAllChildrenæŒ‚è½½åˆ°æ–°åˆ›å»ºçš„domèŠ‚ç‚¹ä¸Šï¼Œæœ€åå°±å¯ä»¥ä¸€æ¬¡æ€§å°†å†…å­˜ä¸­çš„èŠ‚ç‚¹ç”¨domåŸç”Ÿæ–¹æ³•ååº”åˆ°çœŸå®domä¸­ã€‚</li>
<li>åœ¨beginWork ä¸­æˆ‘ä»¬çŸ¥é“æœ‰çš„èŠ‚ç‚¹è¢«æ‰“ä¸Šäº†effectTagçš„æ ‡è®°ï¼Œæœ‰çš„æ²¡æœ‰ï¼Œè€Œåœ¨commité˜¶æ®µæ—¶è¦éå†æ‰€æœ‰åŒ…å«effectTagçš„Fiberæ¥æ‰§è¡Œå¯¹åº”çš„å¢åˆ æ”¹ï¼Œé‚£æˆ‘ä»¬è¿˜éœ€è¦ä»Fiberæ ‘ä¸­æ‰¾åˆ°è¿™äº›å¸¦effectTagçš„èŠ‚ç‚¹å˜›ï¼Œç­”æ¡ˆæ˜¯ä¸éœ€è¦çš„ï¼Œè¿™é‡Œæ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œåœ¨æ‰§è¡ŒcompleteWorkçš„æ—¶å€™é‡åˆ°äº†å¸¦effectTagçš„èŠ‚ç‚¹ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹åŠ å…¥ä¸€ä¸ªå«effectListä¸­,æ‰€ä»¥åœ¨commité˜¶æ®µåªè¦éå†effectListå°±å¯ä»¥äº†ï¼ˆrootFiber.firstEffect.nextEffectå°±å¯ä»¥è®¿é—®å¸¦effectTagçš„Fiberäº†ï¼‰</li>
</ol>
<p>  ç”»ä¸ªç®€å•çš„ç¤ºæ„å›¾ï¼š</p>
  <canvas id="pic" width="400" height="200"></canvas>


<script>
  const oPic = document.getElementById('pic');
  const oPicPen = oPic.getContext('2d');oPicPen.beginPath();oPicPen.lineTo(200, 20);oPicPen.lineTo(200, 60);oPicPen.lineTo(140, 100);oPicPen.lineTo(100, 140);oPicPen.lineTo(75, 170);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(200, 60);oPicPen.lineTo(260, 100);oPicPen.lineTo(220, 140);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(140, 100);oPicPen.lineTo(180, 140);oPicPen.lineTo(155, 170);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(260, 100);oPicPen.lineTo(300, 140);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(100, 140);oPicPen.lineTo(125, 170);oPicPen.stroke();oPicPen.beginPath();oPicPen.lineTo(180, 140);oPicPen.lineTo(205, 170);oPicPen.stroke();oPicPen.strokeStyle='blue';oPicPen.beginPath();oPicPen.lineTo(180, 10);oPicPen.lineTo(180, 60);oPicPen.lineTo(120, 100);oPicPen.lineTo(80, 140);oPicPen.lineTo(55, 180);oPicPen.lineTo(138, 180);oPicPen.lineTo(110, 140);oPicPen.lineTo(170, 140);oPicPen.lineTo(143, 180);oPicPen.lineTo(225, 180);oPicPen.lineTo(160, 100);oPicPen.lineTo(250, 100);oPicPen.lineTo(205, 150);oPicPen.lineTo(320, 150);oPicPen.lineTo(280, 100);oPicPen.lineTo(220, 60);oPicPen.lineTo(220, 10);oPicPen.stroke();oPicPen.fillStyle='red';oPicPen.fillText('1.begin', 142, 20);oPicPen.fillText('2.begin', 140, 60);oPicPen.fillText('3.begin', 82, 100);oPicPen.fillText('4.begin', 42, 140);oPicPen.fillText('5.begin', 25, 170);oPicPen.fillText('6.begin', 100, 190);oPicPen.fillText('7.b', 157, 140);oPicPen.fillText('8.begin', 150, 179);oPicPen.fillText('9.begin', 226, 190);oPicPen.fillText('10.begin', 213, 98);oPicPen.fillText('11.begin', 210, 148);oPicPen.fillText('12.begin', 320, 158);oPicPen.fillStyle='green';oPicPen.fillText('5.complete', 2, 180);oPicPen.fillText('6.complete', 83, 179);oPicPen.fillText('6.c', 110, 140);oPicPen.fillText('8.complete', 150, 190);oPicPen.fillText('9.complete', 226, 179);oPicPen.fillText('9.c', 180, 140);oPicPen.fillText('9.complete', 150, 98);oPicPen.fillText('11.complete', 210, 158);oPicPen.fillText('12.complete', 320, 148);oPicPen.fillText('12.complete', 280, 100);oPicPen.fillText('12.complete', 225, 60);oPicPen.fillText('12.complete', 225, 20);
</script>

<h2 id="commité˜¶æ®µ"><a href="#commité˜¶æ®µ" class="headerlink" title="commité˜¶æ®µ"></a>commité˜¶æ®µ</h2><h2 id="diffç®—æ³•"><a href="#diffç®—æ³•" class="headerlink" title="diffç®—æ³•"></a>diffç®—æ³•</h2><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><h2 id="çŠ¶æ€æ›´æ–°æµç¨‹"><a href="#çŠ¶æ€æ›´æ–°æµç¨‹" class="headerlink" title="çŠ¶æ€æ›´æ–°æµç¨‹"></a>çŠ¶æ€æ›´æ–°æµç¨‹</h2><h2 id="hooks"><a href="#hooks" class="headerlink" title="hooks"></a>hooks</h2><h2 id="scheduler-amp-Lane"><a href="#scheduler-amp-Lane" class="headerlink" title="scheduler&amp;Lane"></a>scheduler&amp;Lane</h2><h2 id="concurrentæ¨¡å¼-1"><a href="#concurrentæ¨¡å¼-1" class="headerlink" title="concurrentæ¨¡å¼"></a>concurrentæ¨¡å¼</h2><h2 id="context"><a href="#context" class="headerlink" title="context"></a>context</h2><h2 id="äº‹ä»¶ç³»ç»Ÿ"><a href="#äº‹ä»¶ç³»ç»Ÿ" class="headerlink" title="äº‹ä»¶ç³»ç»Ÿ"></a>äº‹ä»¶ç³»ç»Ÿ</h2><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>  ä¸æ­¢åœç•™åœ¨ç†è®ºï¼Œä¹Ÿä¸åªåœç•™åœ¨æºç ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/07/13/interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/13/interview/" itemprop="url">interview</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-07-13T11:21:46+08:00">
                2021-07-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ä¸“é¢˜/" itemprop="url" rel="index">
                    <span itemprop="name">ä¸“é¢˜</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ¯å¤©ä¸€é“é¢è¯•é¢˜</p>
<h1 id="html"><a href="#html" class="headerlink" title="html"></a>html</h1><h1 id="css"><a href="#css" class="headerlink" title="css"></a>css</h1><h1 id="js"><a href="#js" class="headerlink" title="js"></a>js</h1><h2 id="å›è°ƒå‡½æ•°ï¼ŒPromiseï¼Œasync-awaitçš„åŒºåˆ«åŠç†è§£"><a href="#å›è°ƒå‡½æ•°ï¼ŒPromiseï¼Œasync-awaitçš„åŒºåˆ«åŠç†è§£" class="headerlink" title="å›è°ƒå‡½æ•°ï¼ŒPromiseï¼Œasync awaitçš„åŒºåˆ«åŠç†è§£"></a>å›è°ƒå‡½æ•°ï¼ŒPromiseï¼Œasync awaitçš„åŒºåˆ«åŠç†è§£</h2><h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h1 id="react"><a href="#react" class="headerlink" title="react"></a>react</h1><h1 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h1><h1 id="å°ç¨‹åº"><a href="#å°ç¨‹åº" class="headerlink" title="å°ç¨‹åº"></a>å°ç¨‹åº</h1><h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h1><h1 id="æ•°æ®ç»“æ„-amp-ç®—æ³•"><a href="#æ•°æ®ç»“æ„-amp-ç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„&amp;ç®—æ³•"></a>æ•°æ®ç»“æ„&amp;ç®—æ³•</h1><h1 id="ä¸“é¢˜"><a href="#ä¸“é¢˜" class="headerlink" title="ä¸“é¢˜"></a>ä¸“é¢˜</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/05/13/nodejs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/13/nodejs/" itemprop="url">nodejs</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-05-13T20:07:53+08:00">
                2021-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ¡†æ¶/" itemprop="url" rel="index">
                    <span itemprop="name">æ¡†æ¶</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="åˆè¯†"><a href="#åˆè¯†" class="headerlink" title="åˆè¯†"></a>åˆè¯†</h1><p>  Node.js æ˜¯ä¸€ä¸ªå¼€æºä¸è·¨å¹³å°çš„ JavaScript è¿è¡Œæ—¶ç¯å¢ƒã€‚<br>  Node.js åœ¨æµè§ˆå™¨å¤–è¿è¡Œ V8 JavaScript å¼•æ“ï¼ˆGoogle Chrome çš„å†…æ ¸ï¼‰ã€‚</p>
<p>  Node.js 2009å¹´è¯ç”Ÿã€‚</p>
<p>  å¸¸è§çš„Node.js æ¡†æ¶å’Œå·¥å…·ï¼Œæ¯”å¦‚ï¼šExpressã€‚</p>
<h1 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h1><h2 id="V8-JavaScript-å¼•æ“"><a href="#V8-JavaScript-å¼•æ“" class="headerlink" title="V8 JavaScript å¼•æ“"></a><font color="#ff99cc">V8 JavaScript å¼•æ“</font></h2><p>  <a href="https://v8.dev/" target="_blank" rel="noopener">V8</a> æä¾›äº†æ‰§è¡Œ JavaScript çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ DOM å’Œå…¶ä»– Web å¹³å° API åˆ™ç”±æµè§ˆå™¨æä¾›ã€‚</p>
<p>  JavaScript å¼•æ“ç‹¬ç«‹äºæ‰˜ç®¡å®ƒçš„æµè§ˆå™¨ã€‚ è¿™ä¸ªå…³é”®çš„ç‰¹æ€§æ¨åŠ¨äº† Node.js çš„å…´èµ·ã€‚ V8 äº 2009 å¹´è¢«é€‰ä¸ºä¸º Node.js æä¾›æ”¯æŒçš„å¼•æ“ï¼Œå¹¶ä¸”éšç€ Node.js çš„çˆ†ç‚¸æ€§å‘å±•ï¼ŒV8 æˆä¸ºäº†ç°åœ¨ä¸ºå¤§é‡çš„æœåŠ¡å™¨ç«¯ä»£ç ï¼ˆä½¿ç”¨ JavaScript ç¼–å†™ï¼‰æä¾›æ”¯æŒçš„å¼•æ“ã€‚</p>
<p>  V8 ä½¿ç”¨ C++ ç¼–å†™ï¼Œå¹¶ä¸”ä¸æ–­åœ°è¢«æ”¹è¿›ã€‚ å®ƒæ˜¯å¯ç§»æ¤çš„ï¼Œä¸”å¯è¿è¡Œäº Macã€Windowsã€Linux å’Œå…¶ä»–ä¸€äº›ç³»ç»Ÿã€‚</p>
<h2 id="ä»å‘½ä»¤è¡Œè¿è¡Œ-Node-js-è„šæœ¬"><a href="#ä»å‘½ä»¤è¡Œè¿è¡Œ-Node-js-è„šæœ¬" class="headerlink" title="ä»å‘½ä»¤è¡Œè¿è¡Œ Node.js è„šæœ¬"></a><font color="#ff99cc">ä»å‘½ä»¤è¡Œè¿è¡Œ Node.js è„šæœ¬</font></h2>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node xxx.js</span><br></pre></td></tr></table></figure>
<h2 id="Node-jsç¨‹åºä¸­é€€å‡º"><a href="#Node-jsç¨‹åºä¸­é€€å‡º" class="headerlink" title="Node.jsç¨‹åºä¸­é€€å‡º"></a><font color="#ff99cc">Node.jsç¨‹åºä¸­é€€å‡º</font></h2><pre><code>å‘½ä»¤è¡Œï¼šCtrl + c
ç¨‹åºï¼š
1ï¼‰process.exit()
  å¦‚ï¼šprocess.exit(1)  ä¸å†™é»˜è®¤0ã€‚ [é€€å‡ºç ](http://nodejs.cn/api/process.html#process_exit_codes)

  ä¹Ÿå¯ä»¥è®¾ç½® process.exitCode å±æ€§ï¼š
  process.exitCode = 1
  å½“ç¨‹åºç»“æŸæ—¶ï¼ŒNode.js ä¼šè¿”å›è¯¥é€€å‡ºç ã€‚

  å½“è¿›ç¨‹å®Œæˆæ‰€æœ‰å¤„ç†åï¼Œç¨‹åºä¼šæ­£å¸¸åœ°é€€å‡ºã€‚
</code></pre>  <div class="post-warning">æ³¨æ„ï¼šprocess ä¸éœ€è¦ â€œrequireâ€ï¼Œå®ƒæ˜¯è‡ªåŠ¨å¯ç”¨çš„ã€‚</div>

<pre><code>2ï¼‰ä¿¡å·
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process.on(&apos;SIGTERM&apos;, () =&gt; &#123;</span><br><span class="line">  server.close(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;è¿›ç¨‹å·²ç»ˆæ­¢&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</code></pre>  <div class="post-warning">ä»€ä¹ˆæ˜¯ä¿¡å·ï¼Ÿä¿¡å·æ˜¯ä¸€ä¸ª POSIX å†…éƒ¨é€šä¿¡ç³»ç»Ÿï¼šå‘é€é€šçŸ¥ç»™è¿›ç¨‹ï¼Œä»¥å‘ŠçŸ¥å…¶å‘ç”Ÿçš„äº‹ä»¶ã€‚</div>

<pre><code>SIGKILL æ˜¯å‘Šè¯‰è¿›ç¨‹è¦ç«‹å³ç»ˆæ­¢çš„ä¿¡å·ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äº process.exit()ã€‚

SIGTERM æ˜¯å‘Šè¯‰è¿›ç¨‹è¦æ­£å¸¸ç»ˆæ­¢çš„ä¿¡å·ã€‚å®ƒæ˜¯ä»è¿›ç¨‹ç®¡ç†è€…ï¼ˆå¦‚ upstart æˆ– supervisordï¼‰ç­‰å‘å‡ºçš„ä¿¡å·ã€‚

å¯ä»¥ä»ç¨‹åºå†…éƒ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­å‘é€æ­¤ä¿¡å·ï¼š
process.kill(process.pid, &apos;SIGTERM&apos;)
æˆ–ä»å¦ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Node.js ç¨‹åºã€æˆ–ä»ç³»ç»Ÿä¸­è¿è¡Œçš„å…¶ä»–ä»»ä½•çš„åº”ç”¨ç¨‹åºï¼ˆèƒ½çŸ¥é“è¦ç»ˆæ­¢çš„è¿›ç¨‹çš„ PIDï¼‰ã€‚
</code></pre><h2 id="ä»-Node-js-è¯»å–ç¯å¢ƒå˜é‡"><a href="#ä»-Node-js-è¯»å–ç¯å¢ƒå˜é‡" class="headerlink" title="ä» Node.js è¯»å–ç¯å¢ƒå˜é‡"></a><font color="#ff99cc">ä» Node.js è¯»å–ç¯å¢ƒå˜é‡</font></h2><pre><code>Node.js çš„ process æ ¸å¿ƒæ¨¡å—æä¾›äº† env å±æ€§ï¼Œè¯¥å±æ€§æ‰¿è½½äº†åœ¨å¯åŠ¨è¿›ç¨‹æ—¶è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚
è¿™æ˜¯è®¿é—® NODE_ENV ç¯å¢ƒå˜é‡çš„ç¤ºä¾‹ï¼Œè¯¥ç¯å¢ƒå˜é‡é»˜è®¤æƒ…å†µä¸‹è¢«è®¾ç½®ä¸º developmentã€‚åœ¨è„šæœ¬è¿è¡Œä¹‹å‰å°†å…¶è®¾ç½®ä¸º &quot;production&quot;ï¼Œåˆ™å¯å‘Šè¯‰ Node.js è¿™æ˜¯ç”Ÿäº§ç¯å¢ƒã€‚
å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼è®¿é—®è®¾ç½®çš„ä»»ä½•è‡ªå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.env.NODE_ENV // &quot;development&quot;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="ä½¿ç”¨-Node-js-REPL"><a href="#ä½¿ç”¨-Node-js-REPL" class="headerlink" title="ä½¿ç”¨ Node.js REPL"></a><font color="#ff99cc">ä½¿ç”¨ Node.js REPL</font></h2>  <div class="post-warning">REPL ä¹Ÿè¢«ç§°ä¸ºè¿è¡Œè¯„ä¼°æ‰“å°å¾ªç¯ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ç¯å¢ƒï¼ˆä¸»è¦æ˜¯æ§åˆ¶å°çª—å£ï¼‰ï¼Œå®ƒä½¿ç”¨å•ä¸ªè¡¨è¾¾å¼ä½œä¸ºç”¨æˆ·è¾“å…¥ï¼Œå¹¶åœ¨æ‰§è¡Œåå°†ç»“æœè¿”å›åˆ°æ§åˆ¶å°ã€‚</div>

<ol>
<li><p>ç»ˆç«¯ç›´æ¥æ‰§è¡Œnode<br>ä¼šç­‰å¾…jsä»£ç çš„è¾“å…¥ï¼Œé…·ã€‚<br>Ctrl+c æˆ–è€….exité€€å‡ºç¨‹åºã€‚<br>ä½¿ç”¨ tab é”®è‡ªåŠ¨è¡¥å…¨</p>
</li>
<li><p>ç‚¹æç¤º<br>å°è¯•è¾“å…¥ JavaScript ç±»çš„åç§°ï¼Œä¾‹å¦‚ Numberï¼Œæ·»åŠ ä¸€ä¸ªç‚¹å·å¹¶æŒ‰ä¸‹ tabã€‚REPL ä¼šæ‰“å°å¯ä»¥åœ¨è¯¥ç±»ä¸Šè®¿é—®çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ã€‚<br>é€šè¿‡è¾“å…¥ global. å¹¶æŒ‰ä¸‹ tabï¼Œå¯ä»¥æ£€æŸ¥å¯ä»¥è®¿é—®çš„å…¨å±€å˜é‡ã€‚</p>
</li>
<li><p>ç‚¹å‘½ä»¤<br>REPL æœ‰ä¸€äº›ç‰¹æ®Šçš„å‘½ä»¤ï¼Œæ‰€æœ‰è¿™äº›å‘½ä»¤éƒ½ä»¥ç‚¹å· . å¼€å¤´ã€‚å®ƒä»¬æ˜¯ï¼š<br>.help: æ˜¾ç¤ºç‚¹å‘½ä»¤çš„å¸®åŠ©ã€‚<br>.editor: å¯ç”¨ç¼–è¾‘å™¨æ¨¡å¼ï¼Œå¯ä»¥è½»æ¾åœ°ç¼–å†™å¤šè¡Œ JavaScript ä»£ç ã€‚å½“å¤„äºæ­¤æ¨¡å¼æ—¶ï¼ŒæŒ‰ä¸‹ ctrl-D å¯ä»¥è¿è¡Œç¼–å†™çš„ä»£ç ã€‚<br>.break: å½“è¾“å…¥å¤šè¡Œçš„è¡¨è¾¾å¼æ—¶ï¼Œè¾“å…¥ .break å‘½ä»¤å¯ä»¥ä¸­æ­¢è¿›ä¸€æ­¥çš„è¾“å…¥ã€‚ç›¸å½“äºæŒ‰ä¸‹ ctrl-Cã€‚<br>.clear: å°† REPL ä¸Šä¸‹æ–‡é‡ç½®ä¸ºç©ºå¯¹è±¡ï¼Œå¹¶æ¸…é™¤å½“å‰æ­£åœ¨è¾“å…¥çš„ä»»ä½•å¤šè¡Œçš„è¡¨è¾¾å¼ã€‚<br>.load: åŠ è½½ JavaScript æ–‡ä»¶ï¼ˆç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•ï¼‰ã€‚<br>.save: å°†åœ¨ REPL ä¼šè¯ä¸­è¾“å…¥çš„æ‰€æœ‰å†…å®¹ä¿å­˜åˆ°æ–‡ä»¶ï¼ˆéœ€æŒ‡å®šæ–‡ä»¶åï¼‰ã€‚<br>.exit: é€€å‡º REPLï¼ˆç›¸å½“äºæŒ‰ä¸‹ä¸¤æ¬¡ ctrl-Cï¼‰ã€‚</p>
</li>
</ol>
<h2 id="Node-js-ä»å‘½ä»¤è¡Œæ¥æ”¶å‚æ•°"><a href="#Node-js-ä»å‘½ä»¤è¡Œæ¥æ”¶å‚æ•°" class="headerlink" title="Node.js ä»å‘½ä»¤è¡Œæ¥æ”¶å‚æ•°"></a><font color="#ff99cc">Node.js ä»å‘½ä»¤è¡Œæ¥æ”¶å‚æ•°</font></h2><pre><code>process å¯¹è±¡çš„argvå±æ€§ã€‚
</code></pre><h2 id="ä½¿ç”¨-Node-js-è¾“å‡ºåˆ°å‘½ä»¤è¡Œ"><a href="#ä½¿ç”¨-Node-js-è¾“å‡ºåˆ°å‘½ä»¤è¡Œ" class="headerlink" title="ä½¿ç”¨ Node.js è¾“å‡ºåˆ°å‘½ä»¤è¡Œ"></a><font color="#ff99cc">ä½¿ç”¨ Node.js è¾“å‡ºåˆ°å‘½ä»¤è¡Œ</font></h2><h3 id="ä½¿ç”¨æ§åˆ¶å°æ¨¡å—çš„åŸºç¡€è¾“å‡º"><a href="#ä½¿ç”¨æ§åˆ¶å°æ¨¡å—çš„åŸºç¡€è¾“å‡º" class="headerlink" title="ä½¿ç”¨æ§åˆ¶å°æ¨¡å—çš„åŸºç¡€è¾“å‡º"></a>ä½¿ç”¨æ§åˆ¶å°æ¨¡å—çš„åŸºç¡€è¾“å‡º</h3><p>   Node.js æä¾›äº† console æ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾›äº†å¤§é‡éå¸¸æœ‰ç”¨çš„ä¸å‘½ä»¤è¡Œäº¤äº’çš„æ–¹æ³•ã€‚å®ƒåŸºæœ¬ä¸Šä¸æµè§ˆå™¨ä¸­çš„ console å¯¹è±¡ç›¸åŒã€‚æœ€åŸºç¡€ã€æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯ console.log()ï¼Œè¯¥æ–¹æ³•ä¼šæ‰“å°ä¼ å…¥åˆ°æ§åˆ¶å°çš„å­—ç¬¦ä¸²ã€‚<br>   å¯ä»¥ä¼ å…¥å¤šä¸ªå˜é‡åˆ° console.logï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¼ å…¥å˜é‡å’Œæ ¼å¼è¯´æ˜ç¬¦æ¥æ ¼å¼åŒ–ç”¨è¯­ã€‚<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&apos;æˆ‘çš„%så·²ç»%då²&apos;, &apos;çŒ«&apos;, 2); // æˆ‘çš„çŒ«å·²ç»2å²</span><br></pre></td></tr></table></figure></p>
<pre><code>%s ä¼šæ ¼å¼åŒ–å˜é‡ä¸ºå­—ç¬¦ä¸²
%d ä¼šæ ¼å¼åŒ–å˜é‡ä¸ºæ•°å­—
%i ä¼šæ ¼å¼åŒ–å˜é‡ä¸ºå…¶æ•´æ•°éƒ¨åˆ†
%o ä¼šæ ¼å¼åŒ–å˜é‡ä¸ºå¯¹è±¡
</code></pre><h3 id="æ¸…ç©ºæ§åˆ¶å°"><a href="#æ¸…ç©ºæ§åˆ¶å°" class="headerlink" title="æ¸…ç©ºæ§åˆ¶å°"></a>æ¸…ç©ºæ§åˆ¶å°</h3><pre><code>console.clear()
</code></pre><h3 id="å…ƒç´ è®¡æ•°"><a href="#å…ƒç´ è®¡æ•°" class="headerlink" title="å…ƒç´ è®¡æ•°"></a>å…ƒç´ è®¡æ•°</h3><pre><code>console.count()
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const oranges = [&apos;æ©™å­&apos;, &apos;æ©™å­&apos;]</span><br><span class="line">const apples = [&apos;è‹¹æœ&apos;]</span><br><span class="line">oranges.forEach(fruit =&gt; &#123;</span><br><span class="line">  console.count(fruit)</span><br><span class="line">&#125;)</span><br><span class="line">apples.forEach(fruit =&gt; &#123;</span><br><span class="line">  console.count(fruit)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">æ©™å­: 1</span><br><span class="line">æ©™å­: 2</span><br><span class="line">è‹¹æœ: 1</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="æ‰“å°å †æ ˆè¸ªè¿¹"><a href="#æ‰“å°å †æ ˆè¸ªè¿¹" class="headerlink" title="æ‰“å°å †æ ˆè¸ªè¿¹"></a>æ‰“å°å †æ ˆè¸ªè¿¹</h3><pre><code>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‰“å°å‡½æ•°çš„è°ƒç”¨å †æ ˆè¸ªè¿¹å¾ˆæœ‰ç”¨ï¼Œconsole.trace()
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const function2 = () =&gt; console.trace()</span><br><span class="line">const function1 = () =&gt; function2()</span><br><span class="line">function1()</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="è®¡ç®—è€—æ—¶"><a href="#è®¡ç®—è€—æ—¶" class="headerlink" title="è®¡ç®—è€—æ—¶"></a>è®¡ç®—è€—æ—¶</h3>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const doSomething = () =&gt; console.log(&apos;æµ‹è¯•&apos;)</span><br><span class="line">const measureDoingSomething = () =&gt; &#123;</span><br><span class="line">  console.time(&apos;å¼€å§‹&apos;)</span><br><span class="line">  //åšç‚¹äº‹ï¼Œå¹¶æµ‹é‡æ‰€éœ€çš„æ—¶é—´ã€‚</span><br><span class="line">  doSomething()</span><br><span class="line">  console.timeEnd(&apos;å¼€å§‹&apos;)</span><br><span class="line">&#125;</span><br><span class="line">measureDoingSomething()</span><br><span class="line"></span><br><span class="line">å¼€å§‹: 10401.35498046875 ms</span><br></pre></td></tr></table></figure>
<h3 id="stdout-å’Œ-stderr"><a href="#stdout-å’Œ-stderr" class="headerlink" title="stdout å’Œ stderr"></a>stdout å’Œ stderr</h3><pre><code>console.log éå¸¸é€‚åˆåœ¨æ§åˆ¶å°ä¸­æ‰“å°æ¶ˆæ¯ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„æ ‡å‡†è¾“å‡ºï¼ˆæˆ–ç§°ä¸º stdoutï¼‰ã€‚
console.error ä¼šæ‰“å°åˆ° stderr æµã€‚
å®ƒä¸ä¼šå‡ºç°åœ¨æ§åˆ¶å°ä¸­ï¼Œä½†æ˜¯ä¼šå‡ºç°åœ¨é”™è¯¯æ—¥å¿—ä¸­ã€‚
</code></pre><h3 id="ä¸ºè¾“å‡ºç€è‰²"><a href="#ä¸ºè¾“å‡ºç€è‰²" class="headerlink" title="ä¸ºè¾“å‡ºç€è‰²"></a>ä¸ºè¾“å‡ºç€è‰²</h3><p>   1ï¼‰å¯ä»¥ä½¿ç”¨è½¬ä¹‰åºåˆ—åœ¨æ§åˆ¶å°ä¸­ä¸ºæ–‡æœ¬çš„è¾“å‡ºç€è‰²ã€‚ è½¬ä¹‰åºåˆ—æ˜¯ä¸€ç»„æ ‡è¯†é¢œè‰²çš„å­—ç¬¦ã€‚<br>    console.log(â€˜\033[30m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // é»‘è‰²<br>    console.log(â€˜\033[31m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // çº¢è‰²<br>    console.log(â€˜\033[32m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // ç»¿è‰²<br>    console.log(â€˜\033[33m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // é»„è‰²<br>    console.log(â€˜\033[34m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // æ·±è“<br>    console.log(â€˜\033[35m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // æ·±ç²‰<br>    console.log(â€˜\033[36m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // æµ…è“<br>    console.log(â€˜\033[37m%s\033[0mâ€™, â€˜ä½ å¥½â€™) // ç™½è‰²<br>    console.log(â€˜\x1b[33m%s\x1b[0mâ€™, â€˜ä½ å¥½â€™)  // é»„è‰²</p>
<p>  2ï¼‰ ä¸ºæ§åˆ¶å°è¾“å‡ºç€è‰²çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨åº“ã€‚ Chalk æ˜¯ä¸€ä¸ªè¿™æ ·çš„åº“ï¼Œé™¤äº†ä¸ºå…¶ç€è‰²å¤–ï¼Œå®ƒè¿˜æœ‰åŠ©äºå…¶ä»–æ ·å¼çš„è®¾ç½®ï¼ˆä¾‹å¦‚ä½¿æ–‡æœ¬å˜ä¸ºç²—ä½“ã€æ–œä½“æˆ–å¸¦ä¸‹åˆ’çº¿ï¼‰ã€‚<br>      å¯ä»¥ä½¿ç”¨ npm install chalk è¿›è¡Œå®‰è£…ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨å®ƒï¼š<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const chalk = require(&apos;chalk&apos;)</span><br><span class="line">console.log(chalk.yellow(&apos;ä½ å¥½&apos;))</span><br></pre></td></tr></table></figure></p>
<h3 id="åˆ›å»ºè¿›åº¦æ¡"><a href="#åˆ›å»ºè¿›åº¦æ¡" class="headerlink" title="åˆ›å»ºè¿›åº¦æ¡"></a>åˆ›å»ºè¿›åº¦æ¡</h3><p>   Progress æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„è½¯ä»¶åŒ…ï¼Œå¯åœ¨æ§åˆ¶å°ä¸­åˆ›å»ºè¿›åº¦æ¡ã€‚ ä½¿ç”¨ npm install progress è¿›è¡Œå®‰è£…ã€‚</p>
<p>   ä»¥ä¸‹ä»£ç æ®µä¼šåˆ›å»ºä¸€ä¸ª 10 æ­¥çš„è¿›åº¦æ¡ï¼Œæ¯ 100 æ¯«ç§’å®Œæˆä¸€æ­¥ã€‚ å½“è¿›åº¦æ¡ç»“æŸæ—¶ï¼Œåˆ™æ¸…é™¤å®šæ—¶å™¨ï¼š<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const ProgressBar = require(&apos;progress&apos;)</span><br><span class="line"></span><br><span class="line">const bar = new ProgressBar(&apos;:bar&apos;, &#123; total: 10 &#125;)</span><br><span class="line">const timer = setInterval(() =&gt; &#123;</span><br><span class="line">  bar.tick()</span><br><span class="line">  if (bar.complete) &#123;</span><br><span class="line">    clearInterval(timer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, 100)</span><br></pre></td></tr></table></figure></p>
<h2 id="åœ¨-Node-js-ä¸­ä»å‘½ä»¤è¡Œæ¥æ”¶è¾“å…¥"><a href="#åœ¨-Node-js-ä¸­ä»å‘½ä»¤è¡Œæ¥æ”¶è¾“å…¥" class="headerlink" title="åœ¨ Node.js ä¸­ä»å‘½ä»¤è¡Œæ¥æ”¶è¾“å…¥"></a><font color="#ff99cc">åœ¨ Node.js ä¸­ä»å‘½ä»¤è¡Œæ¥æ”¶è¾“å…¥</font></h2><p>  ä»ç‰ˆæœ¬ 7 å¼€å§‹ï¼ŒNode.js æä¾›äº† readline <a href="http://nodejs.cn/api/readline.html" target="_blank" rel="noopener">æ¨¡å—</a>æ¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šæ¯æ¬¡ä¸€è¡Œåœ°ä»å¯è¯»æµï¼ˆä¾‹å¦‚ process.stdin æµï¼Œåœ¨ Node.js ç¨‹åºæ‰§è¡ŒæœŸé—´è¯¥æµå°±æ˜¯ç»ˆç«¯è¾“å…¥ï¼‰è·å–è¾“å…¥ã€‚</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const readline = require(&apos;readline&apos;).createInterface(&#123;</span><br><span class="line">  input: process.stdin,</span><br><span class="line">  output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">readline.question(`ä½ å«ä»€ä¹ˆåå­—?`, name =&gt; &#123;</span><br><span class="line">  console.log(`ä½ å¥½ $&#123;name&#125;!`)</span><br><span class="line">  readline.close()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const inquirer = require(&apos;inquirer&apos;)</span><br><span class="line"></span><br><span class="line">var questions = [</span><br><span class="line">  &#123;</span><br><span class="line">    type: &apos;input&apos;,</span><br><span class="line">    name: &apos;name&apos;,</span><br><span class="line">    message: &quot;ä½ å«ä»€ä¹ˆåå­—?&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">inquirer.prompt(questions).then(answers =&gt; &#123;</span><br><span class="line">  console.log(`ä½ å¥½ $&#123;answers[&apos;name&apos;]&#125;!`)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>  Inquirer.js å¯ä»¥æ‰§è¡Œè®¸å¤šæ“ä½œï¼Œä¾‹å¦‚è¯¢é—®å¤šé¡¹é€‰æ‹©ã€å±•ç¤ºå•é€‰æŒ‰é’®ã€ç¡®è®¤ç­‰ã€‚</p>
<h2 id="ä½¿ç”¨-exports-ä»-Node-js-æ–‡ä»¶ä¸­å…¬å¼€åŠŸèƒ½"><a href="#ä½¿ç”¨-exports-ä»-Node-js-æ–‡ä»¶ä¸­å…¬å¼€åŠŸèƒ½" class="headerlink" title="ä½¿ç”¨ exports ä» Node.js æ–‡ä»¶ä¸­å…¬å¼€åŠŸèƒ½"></a><font color="#ff99cc">ä½¿ç”¨ exports ä» Node.js æ–‡ä»¶ä¸­å…¬å¼€åŠŸèƒ½</font></h2><pre><code>Node.js å…·æœ‰å†…ç½®çš„æ¨¡å—ç³»ç»Ÿã€‚
1) ç¬¬ä¸€ç§æ–¹å¼æ˜¯å°†å¯¹è±¡èµ‹å€¼ç»™ module.exportsï¼ˆè¿™æ˜¯æ¨¡å—ç³»ç»Ÿæä¾›çš„å¯¹è±¡ï¼‰ï¼Œè¿™ä¼šä½¿æ–‡ä»¶åªå¯¼å‡ºè¯¥å¯¹è±¡ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const car = &#123;</span><br><span class="line">  brand: &apos;Ford&apos;,</span><br><span class="line">  model: &apos;Fiesta&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = car</span><br><span class="line"></span><br><span class="line">//åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­</span><br><span class="line"></span><br><span class="line">const car = require(&apos;./car&apos;)</span><br></pre></td></tr></table></figure>

2) ç¬¬äºŒç§æ–¹å¼æ˜¯å°†è¦å¯¼å‡ºçš„å¯¹è±¡æ·»åŠ ä¸º exports çš„å±æ€§ã€‚è¿™ç§æ–¹å¼å¯ä»¥å¯¼å‡ºå¤šä¸ªå¯¹è±¡ã€å‡½æ•°æˆ–æ•°æ®ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const car = &#123;</span><br><span class="line">  brand: &apos;Ford&apos;,</span><br><span class="line">  model: &apos;Fiesta&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.car = car</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œåˆ™é€šè¿‡å¼•ç”¨å¯¼å…¥çš„å±æ€§æ¥ä½¿ç”¨å®ƒï¼š</span><br><span class="line">const items = require(&apos;./items&apos;)</span><br><span class="line">items.car</span><br><span class="line">æˆ–</span><br><span class="line">const car = require(&apos;./items&apos;).car</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>module.exports å’Œ exports ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br>  å‰è€…å…¬å¼€äº†å®ƒæŒ‡å‘çš„å¯¹è±¡ã€‚ åè€…å…¬å¼€äº†å®ƒæŒ‡å‘çš„å¯¹è±¡çš„å±æ€§ã€‚</li>
</ul>
<h2 id="npm-åŒ…ç®¡ç†å™¨ç®€ä»‹"><a href="#npm-åŒ…ç®¡ç†å™¨ç®€ä»‹" class="headerlink" title="npm åŒ…ç®¡ç†å™¨ç®€ä»‹"></a><font color="#ff99cc">npm åŒ…ç®¡ç†å™¨ç®€ä»‹</font></h2><p>  npm æ˜¯ Node.js æ ‡å‡†çš„è½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚</p>
  <div class="post-warning">Yarn æ˜¯ npm çš„ä¸€ä¸ªæ›¿ä»£é€‰æ‹©ã€‚</div>

  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm install  // å¦‚æœé¡¹ç›®å…·æœ‰ package.json æ–‡ä»¶ï¼Œåˆ™é€šè¿‡è¿è¡Œæ­¤å‘½ä»¤å¯å®‰è£…å…¨éƒ¨ä¾èµ–</span><br><span class="line">npm install xxx</span><br><span class="line"> npm install &lt;package-name&gt;@0.0.1</span><br><span class="line">npm i --save</span><br><span class="line">npm i --save-dev</span><br><span class="line">npm update</span><br><span class="line">npm update &lt;package-name&gt;</span><br><span class="line">npm run &lt;task-name&gt; // è¿è¡Œscriptå‘½ä»¤</span><br></pre></td></tr></table></figure>
<h2 id="npm-å°†è½¯ä»¶åŒ…å®‰è£…åˆ°å“ªé‡Œ"><a href="#npm-å°†è½¯ä»¶åŒ…å®‰è£…åˆ°å“ªé‡Œ" class="headerlink" title="npm å°†è½¯ä»¶åŒ…å®‰è£…åˆ°å“ªé‡Œ"></a><font color="#ff99cc">npm å°†è½¯ä»¶åŒ…å®‰è£…åˆ°å“ªé‡Œ</font></h2><ul>
<li><p>æœ¬åœ°å®‰è£…<br>è½¯ä»¶åŒ…ä¼šè¢«å®‰è£…åˆ°å½“å‰æ–‡ä»¶æ ‘ä¸­çš„ node_modules å­æ–‡ä»¶å¤¹ä¸‹ã€‚</p>
</li>
<li><p>å…¨å±€å®‰è£…<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œnpm ä¸ä¼šå°†è½¯ä»¶åŒ…å®‰è£…åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ä¸‹ï¼Œè€Œæ˜¯ä½¿ç”¨å…¨å±€çš„ä½ç½®ã€‚<br>npm root -g å‘½ä»¤ä¼šå‘ŠçŸ¥å…¶åœ¨è®¡ç®—æœºä¸Šçš„ç¡®åˆ‡ä½ç½®ã€‚</p>
<p>åœ¨ macOS æˆ– Linux ä¸Šï¼Œæ­¤ä½ç½®å¯èƒ½æ˜¯ /usr/local/lib/node_modulesã€‚ åœ¨ Windows ä¸Šï¼Œå¯èƒ½æ˜¯ C:\Users\YOU\AppData\Roaming\npm\node_modulesã€‚</p>
</li>
</ul>
<h2 id="å¦‚ä½•ä½¿ç”¨æˆ–æ‰§è¡Œ-npm-å®‰è£…çš„è½¯ä»¶åŒ…"><a href="#å¦‚ä½•ä½¿ç”¨æˆ–æ‰§è¡Œ-npm-å®‰è£…çš„è½¯ä»¶åŒ…" class="headerlink" title="å¦‚ä½•ä½¿ç”¨æˆ–æ‰§è¡Œ npm å®‰è£…çš„è½¯ä»¶åŒ…"></a><font color="#ff99cc">å¦‚ä½•ä½¿ç”¨æˆ–æ‰§è¡Œ npm å®‰è£…çš„è½¯ä»¶åŒ…</font></h2><h2 id="package-json-æŒ‡å—"><a href="#package-json-æŒ‡å—" class="headerlink" title="package.json æŒ‡å—"></a><font color="#ff99cc">package.json æŒ‡å—</font></h2><p>  package.json æ–‡ä»¶æ˜¯é¡¹ç›®çš„æ¸…å•ã€‚ å®ƒå¯ä»¥åšå¾ˆå¤šå®Œå…¨äº’ä¸ç›¸å…³çš„äº‹æƒ…ã€‚ ä¾‹å¦‚ï¼Œå®ƒæ˜¯ç”¨äºå·¥å…·çš„é…ç½®ä¸­å¿ƒã€‚ å®ƒä¹Ÿæ˜¯ npm å’Œ yarn å­˜å‚¨æ‰€æœ‰å·²å®‰è£…è½¯ä»¶åŒ…çš„åç§°å’Œç‰ˆæœ¬çš„åœ°æ–¹ã€‚</p>
<h3 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h3><p>  å¯¹äºpackage.json æ–‡ä»¶ä¸­çš„å†…å®¹æ²¡æœ‰å›ºå®šçš„è¦æ±‚ï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯å¿…é¡»éµå®ˆ JSON æ ¼å¼ã€‚</p>
<h3 id="å±æ€§åˆ†ç±»"><a href="#å±æ€§åˆ†ç±»" class="headerlink" title="å±æ€§åˆ†ç±»"></a>å±æ€§åˆ†ç±»</h3><pre><code>- name
- author
- contributors
- bugs
- homepage
- version
- license
- keywords
- description
- repository
- main
- private
- scripts
- dependencies
- devDependencies
- engines
- browserslist
- å‘½ä»¤ç‰¹æœ‰çš„å±æ€§
  package.json æ–‡ä»¶è¿˜å¯ä»¥æ‰¿è½½å‘½ä»¤ç‰¹æœ‰çš„é…ç½®ï¼Œä¾‹å¦‚ Babelã€ESLint ç­‰ã€‚
  æ¯ä¸ªéƒ½æœ‰ç‰¹æœ‰çš„å±æ€§ï¼Œä¾‹å¦‚ eslintConfigã€babel ç­‰ã€‚ å®ƒä»¬æ˜¯å‘½ä»¤ç‰¹æœ‰çš„ï¼Œå¯ä»¥åœ¨ç›¸åº”çš„å‘½ä»¤/é¡¹ç›®æ–‡æ¡£ä¸­æ‰¾åˆ°å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚
</code></pre><h3 id="è½¯ä»¶åŒ…ç‰ˆæœ¬"><a href="#è½¯ä»¶åŒ…ç‰ˆæœ¬" class="headerlink" title="è½¯ä»¶åŒ…ç‰ˆæœ¬"></a>è½¯ä»¶åŒ…ç‰ˆæœ¬</h3><ul>
<li>åœ¨ä¸Šé¢çš„æè¿°ä¸­ï¼Œå·²ç»çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„ç‰ˆæœ¬å·ï¼šã€œ0.13.0 æˆ– ^0.13.0ã€‚ å®ƒä»¬æ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å“ªäº›å…¶ä»–çš„ç‰ˆæœ¬è¯´æ˜ç¬¦ï¼Ÿ<br>è¯¥ç¬¦å·æŒ‡å®šäº†è½¯ä»¶åŒ…èƒ½ä»è¯¥ä¾èµ–æ¥å—çš„æ›´æ–°ã€‚<br>å¦‚æœå†™å…¥çš„æ˜¯ ã€œ0.13.0ï¼Œåˆ™åªæ›´æ–°è¡¥ä¸ç‰ˆæœ¬ï¼šå³ 0.13.1 å¯ä»¥ï¼Œä½† 0.14.0 ä¸å¯ä»¥ã€‚<br>å¦‚æœå†™å…¥çš„æ˜¯ ^0.13.0ï¼Œåˆ™è¦æ›´æ–°è¡¥ä¸ç‰ˆæœ¬å’Œæ¬¡ç‰ˆæœ¬ï¼šå³ 0.13.1ã€0.14.0ã€ä¾æ­¤ç±»æ¨ã€‚<br>å¦‚æœå†™å…¥çš„æ˜¯ 0.13.0ï¼Œåˆ™å§‹ç»ˆä½¿ç”¨ç¡®åˆ‡çš„ç‰ˆæœ¬ã€‚</li>
</ul>
<h2 id="package-lock-json-æ–‡ä»¶"><a href="#package-lock-json-æ–‡ä»¶" class="headerlink" title="package-lock.json æ–‡ä»¶"></a><font color="#ff99cc">package-lock.json æ–‡ä»¶</font></h2><pre><code>package-lock.json ä¼šå›ºåŒ–å½“å‰å®‰è£…çš„æ¯ä¸ªè½¯ä»¶åŒ…çš„ç‰ˆæœ¬ï¼Œå½“è¿è¡Œ npm installæ—¶ï¼Œnpm ä¼šä½¿ç”¨è¿™äº›ç¡®åˆ‡çš„ç‰ˆæœ¬ã€‚
package-lock.json æ–‡ä»¶éœ€è¦è¢«æäº¤åˆ° Git ä»“åº“ï¼Œä»¥ä¾¿è¢«å…¶ä»–äººè·å–ï¼ˆå¦‚æœé¡¹ç›®æ˜¯å…¬å¼€çš„æˆ–æœ‰åˆä½œè€…ï¼Œæˆ–è€…å°† Git ä½œä¸ºéƒ¨ç½²æºï¼‰ã€‚
å½“è¿è¡Œ npm update æ—¶ï¼Œpackage-lock.json æ–‡ä»¶ä¸­çš„ä¾èµ–çš„ç‰ˆæœ¬ä¼šè¢«æ›´æ–°ã€‚
&lt;div class=&apos;post-warning&apos;&gt;å¦‚æœæŒ‡å®šç¡®åˆ‡çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ç¤ºä¾‹ä¸­çš„ 0.13.0ï¼Œåˆ™ä¸ä¼šå—åˆ°æ­¤é—®é¢˜çš„å½±å“ã€‚å¦‚æœæŒ‡å®šç¡®åˆ‡çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ç¤ºä¾‹ä¸­çš„ 0.13.0ï¼Œåˆ™ä¸ä¼šå—åˆ°æ­¤é—®é¢˜çš„å½±å“ã€‚&lt;/div&gt;
</code></pre><h2 id="npm-åŒ…"><a href="#npm-åŒ…" class="headerlink" title="npm åŒ…"></a><font color="#ff99cc">npm åŒ…</font></h2><h3 id="æŸ¥çœ‹-npm-åŒ…å®‰è£…çš„ç‰ˆæœ¬"><a href="#æŸ¥çœ‹-npm-åŒ…å®‰è£…çš„ç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ npm åŒ…å®‰è£…çš„ç‰ˆæœ¬"></a>æŸ¥çœ‹ npm åŒ…å®‰è£…çš„ç‰ˆæœ¬</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm list  // æŸ¥çœ‹æ‰€æœ‰å·²å®‰è£…çš„ npm è½¯ä»¶åŒ…ï¼ˆåŒ…æ‹¬å®ƒä»¬çš„ä¾èµ–åŒ…ï¼‰ï¼Œä¹Ÿå¯ä»¥æ‰“å¼€ package-lock.json æ–‡ä»¶ï¼Œä½†è¿™éœ€è¦è¿›è¡Œä¸€äº›è§†è§‰æ‰«æã€‚</span><br><span class="line">npm list -g  // ä¹Ÿä¸€æ ·ï¼Œä½†é€‚ç”¨äºå…¨å±€å®‰è£…çš„è½¯ä»¶åŒ…ã€‚</span><br><span class="line">npm list --depth=0  // ä»…è·å–é¡¶å±‚çš„è½¯ä»¶åŒ…</span><br><span class="line">npm list &lt;package-name&gt; // è·å–ç‰¹å®šè½¯ä»¶åŒ…çš„ç‰ˆæœ¬</span><br><span class="line">npm view [package_name] version // æŸ¥çœ‹è½¯ä»¶åŒ…åœ¨ npm ä»“åº“ä¸Šæœ€æ–°çš„å¯ç”¨ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="å®‰è£…-npm-åŒ…çš„æ—§ç‰ˆæœ¬"><a href="#å®‰è£…-npm-åŒ…çš„æ—§ç‰ˆæœ¬" class="headerlink" title="å®‰è£… npm åŒ…çš„æ—§ç‰ˆæœ¬"></a>å®‰è£… npm åŒ…çš„æ—§ç‰ˆæœ¬</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install &lt;package&gt;@&lt;version&gt;  // å®‰è£…æŒ‡å®šç‰ˆæœ¬</span><br><span class="line">npm view &lt;package&gt; versions  // æŸ¥çœ‹åŒ…çš„æ‰€æœ‰ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="npmåŒ…æ›´æ–°"><a href="#npmåŒ…æ›´æ–°" class="headerlink" title="npmåŒ…æ›´æ–°"></a>npmåŒ…æ›´æ–°</h3><pre><code>npm updateï¼Œåˆ™!æˆ–~å·²å®‰è£…çš„ç‰ˆæœ¬ä¼šè¢«æ›´æ–°ï¼Œå¹¶ä¸” package-lock.json æ–‡ä»¶ä¼šè¢«æ–°ç‰ˆæœ¬å¡«å……ã€‚package.json åˆ™ä¿æŒä¸å˜ã€‚
ä¸»ç‰ˆæœ¬æ°¸è¿œä¸ä¼šè¢«è¿™ç§æ–¹å¼æ›´æ–°ï¼Œå› ä¸ºå®ƒä»¬ï¼ˆæ ¹æ®å®šä¹‰ï¼‰ä¼šå¼•å…¥é‡å¤§çš„æ›´æ”¹ï¼Œnpm å¸Œæœ›ä¸ºä½ å‡å°‘éº»çƒ¦ã€‚
è‹¥è¦å‘è§‰è½¯ä»¶åŒ…çš„æ–°ç‰ˆæœ¬ï¼Œåˆ™è¿è¡Œ npm outdatedã€‚
</code></pre><h3 id="npmçš„è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶"><a href="#npmçš„è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="npmçš„è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶"></a>npmçš„è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶</h3><pre><code>è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶çš„æ¦‚å¿µå¾ˆç®€å•ï¼šæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½æœ‰ 3 ä¸ªæ•°å­—ï¼šx.y.zã€‚
- ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯ä¸»ç‰ˆæœ¬ã€‚è¿›è¡Œä¸å…¼å®¹çš„ API æ›´æ”¹ã€‚
- ç¬¬äºŒä¸ªæ•°å­—æ˜¯æ¬¡ç‰ˆæœ¬ã€‚ä»¥å‘åå…¼å®¹çš„æ–¹å¼æ·»åŠ åŠŸèƒ½ã€‚
- ç¬¬ä¸‰ä¸ªæ•°å­—æ˜¯è¡¥ä¸ç‰ˆæœ¬ã€‚è¿›è¡Œå‘åå…¼å®¹çš„ç¼ºé™·ä¿®å¤ã€‚

è§„åˆ™ï¼š
  ^: åªä¼šæ‰§è¡Œä¸æ›´æ”¹æœ€å·¦è¾¹éé›¶æ•°å­—çš„æ›´æ–°ã€‚ å¦‚æœå†™å…¥çš„æ˜¯ ^0.13.0ï¼Œåˆ™å½“è¿è¡Œ npm update æ—¶ï¼Œå¯ä»¥æ›´æ–°åˆ° 0.13.1ã€0.13.2 ç­‰ï¼Œä½†ä¸èƒ½æ›´æ–°åˆ° 0.14.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚ å¦‚æœå†™å…¥çš„æ˜¯ ^1.13.0ï¼Œåˆ™å½“è¿è¡Œ npm update æ—¶ï¼Œå¯ä»¥æ›´æ–°åˆ° 1.13.1ã€1.14.0 ç­‰ï¼Œä½†ä¸èƒ½æ›´æ–°åˆ° 2.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
  ~: å¦‚æœå†™å…¥çš„æ˜¯ ã€œ0.13.0ï¼Œåˆ™å½“è¿è¡Œ npm update æ—¶ï¼Œä¼šæ›´æ–°åˆ°è¡¥ä¸ç‰ˆæœ¬ï¼šå³ 0.13.1 å¯ä»¥ï¼Œä½† 0.14.0 ä¸å¯ä»¥ã€‚
  &gt;: æ¥å—é«˜äºæŒ‡å®šç‰ˆæœ¬çš„ä»»ä½•ç‰ˆæœ¬ã€‚
  &gt;=: æ¥å—ç­‰äºæˆ–é«˜äºæŒ‡å®šç‰ˆæœ¬çš„ä»»ä½•ç‰ˆæœ¬ã€‚
  &lt;=: æ¥å—ç­‰äºæˆ–ä½äºæŒ‡å®šç‰ˆæœ¬çš„ä»»ä½•ç‰ˆæœ¬ã€‚
  &lt;: æ¥å—ä½äºæŒ‡å®šç‰ˆæœ¬çš„ä»»ä½•ç‰ˆæœ¬ã€‚
  =: æ¥å—ç¡®åˆ‡çš„ç‰ˆæœ¬ã€‚
  -: æ¥å—ä¸€å®šèŒƒå›´çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼š2.1.0 - 2.6.2ã€‚
  ||: ç»„åˆé›†åˆã€‚ä¾‹å¦‚ &lt; 2.1 || &gt; 2.6ã€‚
  å¯ä»¥åˆå¹¶å…¶ä¸­çš„ä¸€äº›ç¬¦å·ï¼Œä¾‹å¦‚ 1.0.0 || &gt;=1.1.0 &lt;1.2.0ï¼Œå³ä½¿ç”¨ 1.0.0 æˆ–ä» 1.1.0 å¼€å§‹ä½†ä½äº 1.2.0 çš„ç‰ˆæœ¬ã€‚

  è¿˜æœ‰å…¶ä»–çš„è§„åˆ™ï¼š
  æ— ç¬¦å·: ä»…æ¥å—æŒ‡å®šçš„ç‰¹å®šç‰ˆæœ¬ï¼ˆä¾‹å¦‚ 1.2.1ï¼‰ã€‚
  latest: ä½¿ç”¨å¯ç”¨çš„æœ€æ–°ç‰ˆæœ¬ã€‚
</code></pre><h3 id="å¸è½½-npm-è½¯ä»¶åŒ…"><a href="#å¸è½½-npm-è½¯ä»¶åŒ…" class="headerlink" title="å¸è½½ npm è½¯ä»¶åŒ…"></a>å¸è½½ npm è½¯ä»¶åŒ…</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall &lt;package-name&gt;</span><br><span class="line"></span><br><span class="line">å¦‚æœä½¿ç”¨ -S æˆ– --save æ ‡å¿—ï¼Œåˆ™æ­¤æ“ä½œè¿˜ä¼šç§»é™¤ package.json æ–‡ä»¶ä¸­çš„å¼•ç”¨:</span><br><span class="line">npm uninstall -S &lt;package-name&gt;</span><br><span class="line">npm uninstall -D &lt;package-name&gt;  // -D æˆ– --save-dev</span><br><span class="line"></span><br><span class="line">å¦‚æœè¯¥è½¯ä»¶åŒ…æ˜¯å…¨å±€å®‰è£…çš„ï¼Œåˆ™éœ€è¦æ·»åŠ  -g æˆ– --global æ ‡å¿—ï¼š</span><br><span class="line">npm uninstall -g &lt;package-name&gt;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="Node-js-åŒ…è¿è¡Œå™¨-npx"><a href="#Node-js-åŒ…è¿è¡Œå™¨-npx" class="headerlink" title="Node.js åŒ…è¿è¡Œå™¨ npx"></a><font color="#ff99cc">Node.js åŒ…è¿è¡Œå™¨ npx</font></h2><pre><code>npx æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å‘½ä»¤ï¼Œä» npm çš„ 5.2 ç‰ˆæœ¬ï¼ˆå‘å¸ƒäº 2017 å¹´ 7 æœˆï¼‰å¼€å§‹å¯ç”¨ã€‚
</code></pre><h3 id="è½»æ¾åœ°è¿è¡Œæœ¬åœ°å‘½ä»¤"><a href="#è½»æ¾åœ°è¿è¡Œæœ¬åœ°å‘½ä»¤" class="headerlink" title="è½»æ¾åœ°è¿è¡Œæœ¬åœ°å‘½ä»¤"></a>è½»æ¾åœ°è¿è¡Œæœ¬åœ°å‘½ä»¤</h3><pre><code>è¿è¡Œ npx commandname ä¼šè‡ªåŠ¨åœ°åœ¨é¡¹ç›®çš„ node_modules æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°å‘½ä»¤çš„æ­£ç¡®å¼•ç”¨ï¼Œè€Œæ— éœ€çŸ¥é“ç¡®åˆ‡çš„è·¯å¾„ï¼Œä¹Ÿä¸éœ€è¦åœ¨å…¨å±€å’Œç”¨æˆ·è·¯å¾„ä¸­å®‰è£…è½¯ä»¶åŒ…ã€‚
</code></pre><h3 id="æ— éœ€å®‰è£…çš„å‘½ä»¤æ‰§è¡Œ"><a href="#æ— éœ€å®‰è£…çš„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ— éœ€å®‰è£…çš„å‘½ä»¤æ‰§è¡Œ"></a>æ— éœ€å®‰è£…çš„å‘½ä»¤æ‰§è¡Œ</h3><pre><code>npx çš„å¦ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§æ˜¯ï¼Œæ— éœ€å…ˆå®‰è£…å‘½ä»¤å³å¯è¿è¡Œå‘½ä»¤ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx å¯ä»¥è¿è¡Œè¯¥ npm å‘½ä»¤ï¼Œè€Œæ— éœ€åœ¨æœ¬åœ°å®‰è£…ï¼š</span><br><span class="line">npx cowsay &quot;ä½ å¥½&quot;</span><br></pre></td></tr></table></figure>

å…¶ä»–åœºæ™¯æœ‰ï¼š
  è¿è¡Œ vue CLI å·¥å…·ä»¥åˆ›å»ºæ–°çš„åº”ç”¨ç¨‹åºå¹¶è¿è¡Œå®ƒä»¬ï¼šnpx @vue/cli create my-vue-appã€‚
  ä½¿ç”¨ create-react-app åˆ›å»ºæ–°çš„ React åº”ç”¨ï¼šnpx create-react-app my-react-appã€‚
  è¿˜æœ‰æ›´å¤šå…¶ä»–çš„åœºæ™¯ã€‚

  å½“è¢«ä¸‹è½½å®Œï¼Œåˆ™ä¸‹è½½çš„ä»£ç ä¼šè¢«æ“¦é™¤ã€‚
</code></pre><h3 id="ä½¿ç”¨ä¸åŒçš„-Node-js-ç‰ˆæœ¬è¿è¡Œä»£ç "><a href="#ä½¿ç”¨ä¸åŒçš„-Node-js-ç‰ˆæœ¬è¿è¡Œä»£ç " class="headerlink" title="ä½¿ç”¨ä¸åŒçš„ Node.js ç‰ˆæœ¬è¿è¡Œä»£ç "></a>ä½¿ç”¨ä¸åŒçš„ Node.js ç‰ˆæœ¬è¿è¡Œä»£ç </h3><pre><code>ä½¿ç”¨ @ æŒ‡å®šç‰ˆæœ¬ï¼Œå¹¶å°†å…¶ä¸ node npm è½¯ä»¶åŒ… ç»“åˆä½¿ç”¨,è¿™æœ‰åŠ©äºé¿å…ä½¿ç”¨ nvm ä¹‹ç±»çš„å·¥å…·æˆ–å…¶ä»– Node.js ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx node@10 -v #v10.18.1</span><br><span class="line">npx node@12 -v #v12.14.1</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="ç›´æ¥ä»-URL-è¿è¡Œä»»æ„ä»£ç ç‰‡æ®µ"><a href="#ç›´æ¥ä»-URL-è¿è¡Œä»»æ„ä»£ç ç‰‡æ®µ" class="headerlink" title="ç›´æ¥ä» URL è¿è¡Œä»»æ„ä»£ç ç‰‡æ®µ"></a>ç›´æ¥ä» URL è¿è¡Œä»»æ„ä»£ç ç‰‡æ®µ</h3><h2 id="Node-js-äº‹ä»¶å¾ªç¯"><a href="#Node-js-äº‹ä»¶å¾ªç¯" class="headerlink" title="Node.js äº‹ä»¶å¾ªç¯"></a><font color="#ff99cc">Node.js äº‹ä»¶å¾ªç¯</font></h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><pre><code>Node.js JavaScript ä»£ç è¿è¡Œåœ¨å•ä¸ªçº¿ç¨‹ä¸Šã€‚ æ¯æ¬¡åªå¤„ç†ä¸€ä»¶äº‹ã€‚
è¿™ä¸ªé™åˆ¶å®é™…ä¸Šéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¤§å¤§ç®€åŒ–äº†ç¼–ç¨‹æ–¹å¼ï¼Œè€Œä¸å¿…æ‹…å¿ƒå¹¶å‘é—®é¢˜ã€‚
</code></pre><h3 id="é˜»å¡äº‹ä»¶å¾ªç¯"><a href="#é˜»å¡äº‹ä»¶å¾ªç¯" class="headerlink" title="é˜»å¡äº‹ä»¶å¾ªç¯"></a>é˜»å¡äº‹ä»¶å¾ªç¯</h3><h3 id="è°ƒç”¨å †æ ˆ"><a href="#è°ƒç”¨å †æ ˆ" class="headerlink" title="è°ƒç”¨å †æ ˆ"></a>è°ƒç”¨å †æ ˆ</h3><pre><code>è°ƒç”¨å †æ ˆæ˜¯ä¸€ä¸ª LIFO é˜Ÿåˆ—ï¼ˆåè¿›å…ˆå‡ºï¼‰ã€‚
äº‹ä»¶å¾ªç¯ä¸æ–­åœ°æ£€æŸ¥è°ƒç”¨å †æ ˆï¼Œä»¥æŸ¥çœ‹æ˜¯å¦éœ€è¦è¿è¡Œä»»ä½•å‡½æ•°ã€‚
</code></pre><h3 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h3><pre><code>setTimeout(() =&gt; {}, 0) çš„ç”¨ä¾‹æ˜¯è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æ˜¯åœ¨ä»£ç ä¸­çš„æ¯ä¸ªå…¶ä»–å‡½æ•°å·²è¢«æ‰§è¡Œä¹‹åã€‚
äº‹ä»¶å¾ªç¯ä¼šèµ‹äºˆè°ƒç”¨å †æ ˆä¼˜å…ˆçº§ï¼Œå®ƒé¦–å…ˆå¤„ç†åœ¨è°ƒç”¨å †æ ˆä¸­æ‰¾åˆ°çš„æ‰€æœ‰ä¸œè¥¿ï¼Œä¸€æ—¦å…¶ä¸­æ²¡æœ‰ä»»ä½•ä¸œè¥¿ï¼Œä¾¿å¼€å§‹å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä¸œè¥¿ã€‚
æˆ‘ä»¬ä¸å¿…ç­‰å¾…è¯¸å¦‚ setTimeoutã€fetchã€æˆ–å…¶ä»–çš„å‡½æ•°æ¥å®Œæˆå®ƒä»¬è‡ªèº«çš„å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±æµè§ˆå™¨æä¾›çš„ï¼Œå¹¶ä¸”ä½äºå®ƒä»¬è‡ªèº«çš„çº¿ç¨‹ä¸­ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå°† setTimeout çš„è¶…æ—¶è®¾ç½®ä¸º 2 ç§’ï¼Œä½†ä¸å¿…ç­‰å¾… 2 ç§’ï¼Œç­‰å¾…å‘ç”Ÿåœ¨å…¶ä»–åœ°æ–¹ã€‚
</code></pre><h3 id="ä½œä¸šé˜Ÿåˆ—"><a href="#ä½œä¸šé˜Ÿåˆ—" class="headerlink" title="ä½œä¸šé˜Ÿåˆ—"></a>ä½œä¸šé˜Ÿåˆ—</h3><pre><code>ECMAScript 2015 å¼•å…¥äº†ä½œä¸šé˜Ÿåˆ—çš„æ¦‚å¿µï¼ŒPromise ä½¿ç”¨äº†è¯¥é˜Ÿåˆ—ï¼ˆä¹Ÿåœ¨ ES6/ES2015 ä¸­å¼•å…¥ï¼‰ã€‚ è¿™ç§æ–¹å¼ä¼šå°½å¿«åœ°æ‰§è¡Œå¼‚æ­¥å‡½æ•°çš„ç»“æœï¼Œè€Œä¸æ˜¯æ”¾åœ¨è°ƒç”¨å †æ ˆçš„æœ«å°¾ã€‚

  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const bar = () =&gt; console.log(&apos;bar&apos;)</span><br><span class="line">const baz = () =&gt; console.log(&apos;baz&apos;)</span><br><span class="line"></span><br><span class="line">const foo = () =&gt; &#123;</span><br><span class="line">  console.log(&apos;foo&apos;)</span><br><span class="line">  setTimeout(bar, 0)</span><br><span class="line">  new Promise((resolve, reject) =&gt;&#123;</span><br><span class="line">    console.log(&apos;ğŸ‰&apos;);</span><br><span class="line">    resolve(&apos;åº”è¯¥åœ¨ baz ä¹‹åã€bar ä¹‹å‰&apos;);</span><br><span class="line">  &#125;).then(resolve =&gt; console.log(resolve))</span><br><span class="line">  baz()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

  foo
  ğŸ‰
  baz
  åº”è¯¥åœ¨ baz ä¹‹åã€bar ä¹‹å‰
  bar

è¿™æ˜¯ Promiseï¼ˆä»¥åŠåŸºäº promise æ„å»ºçš„ async/awaitï¼‰ä¸é€šè¿‡ setTimeout() æˆ–å…¶ä»–å¹³å° API çš„æ™®é€šçš„æ—§å¼‚æ­¥å‡½æ•°ä¹‹é—´çš„å·¨å¤§åŒºåˆ«ã€‚
</code></pre><h2 id="äº†è§£-process-nextTick"><a href="#äº†è§£-process-nextTick" class="headerlink" title="äº†è§£ process.nextTick()"></a><font color="#ff99cc">äº†è§£ process.nextTick()</font></h2><p>  æ¯å½“äº‹ä»¶å¾ªç¯è¿›è¡Œä¸€æ¬¡å®Œæ•´çš„è¡Œç¨‹æ—¶ï¼Œæˆ‘ä»¬éƒ½å°†å…¶ç§°ä¸ºä¸€ä¸ªæ»´ç­”ã€‚<br>  å½“å°†ä¸€ä¸ªå‡½æ•°ä¼ ç»™ process.nextTick() æ—¶ï¼Œåˆ™æŒ‡ç¤ºå¼•æ“åœ¨å½“å‰æ“ä½œç»“æŸï¼ˆåœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ»´ç­”å¼€å§‹ä¹‹å‰ï¼‰æ—¶è°ƒç”¨æ­¤å‡½æ•°ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">process.nextTick(() =&gt; &#123;</span><br><span class="line">  //åšäº›äº‹æƒ…</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>  å½“è¯¥æ“ä½œç»“æŸæ—¶ï¼ŒJS å¼•æ“ä¼šè¿è¡Œåœ¨è¯¥æ“ä½œæœŸé—´ä¼ ç»™ nextTick è°ƒç”¨çš„æ‰€æœ‰å‡½æ•°ã€‚<br>  è¿™æ˜¯å¯ä»¥å‘Šè¯‰ JS å¼•æ“å¼‚æ­¥åœ°ï¼ˆåœ¨å½“å‰å‡½æ•°ä¹‹åï¼‰å¤„ç†å‡½æ•°çš„æ–¹å¼ï¼Œä½†æ˜¯å°½å¿«æ‰§è¡Œè€Œä¸æ˜¯å°†å…¶æ’å…¥é˜Ÿåˆ—ã€‚<br>  è°ƒç”¨ setTimeout(() =&gt; {}, 0) ä¼šåœ¨ä¸‹ä¸€ä¸ªæ»´ç­”ç»“æŸæ—¶æ‰§è¡Œè¯¥å‡½æ•°ï¼Œæ¯”ä½¿ç”¨ nextTick()ï¼ˆå…¶ä¼šä¼˜å…ˆæ‰§è¡Œè¯¥è°ƒç”¨å¹¶åœ¨ä¸‹ä¸€ä¸ªæ»´ç­”å¼€å§‹ä¹‹å‰æ‰§è¡Œè¯¥å‡½æ•°ï¼‰æ™šå¾—å¤šã€‚<br>  å½“è¦ç¡®ä¿åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯è¿­ä»£ä¸­ä»£ç å·²è¢«æ‰§è¡Œï¼Œåˆ™ä½¿ç”¨ nextTick()ã€‚</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const bar = () =&gt; console.log(&apos;bar&apos;)</span><br><span class="line">const baz = () =&gt; console.log(&apos;baz&apos;)</span><br><span class="line"></span><br><span class="line">const foo = () =&gt; &#123;</span><br><span class="line">  console.log(&apos;foo&apos;)</span><br><span class="line">  process.nextTick(() =&gt; &#123;</span><br><span class="line">    console.log(&apos;æ»´ç­”ğŸ¦&apos;)</span><br><span class="line">  &#125;)</span><br><span class="line">  setTimeout(bar, 0)</span><br><span class="line">  new Promise((resolve, reject) =&gt;&#123;</span><br><span class="line">    console.log(&apos;ğŸ‰&apos;);</span><br><span class="line">    resolve(&apos;åº”è¯¥åœ¨ baz ä¹‹åã€bar ä¹‹å‰&apos;);</span><br><span class="line">  &#125;).then(resolve =&gt; console.log(resolve))</span><br><span class="line">  baz()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>
<pre><code>foo
ğŸ‰
baz
æ»´ç­”ğŸ¦
åº”è¯¥åœ¨ baz ä¹‹åã€bar ä¹‹å‰
bar
</code></pre><h2 id="äº†è§£-setImmediate"><a href="#äº†è§£-setImmediate" class="headerlink" title="äº†è§£ setImmediate()"></a><font color="#ff99cc">äº†è§£ setImmediate()</font></h2><pre><code>ä½œä¸º setImmediate() å‚æ•°ä¼ å…¥çš„ä»»ä½•å‡½æ•°éƒ½æ˜¯åœ¨äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ªè¿­ä»£ä¸­æ‰§è¡Œçš„å›è°ƒã€‚
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(() =&gt; &#123;</span><br><span class="line">  //è¿è¡Œä¸€äº›ä¸œè¥¿</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

setImmediate() ä¸ setTimeout(() =&gt; {}, 0)ï¼ˆä¼ å…¥ 0 æ¯«ç§’çš„è¶…æ—¶ï¼‰ã€process.nextTick() æœ‰ä½•ä¸åŒï¼Ÿ
ä¼ ç»™ process.nextTick() çš„å‡½æ•°ä¼šåœ¨äº‹ä»¶å¾ªç¯çš„å½“å‰è¿­ä»£ä¸­ï¼ˆå½“å‰æ“ä½œç»“æŸä¹‹åï¼‰è¢«æ‰§è¡Œã€‚ è¿™æ„å‘³ç€å®ƒä¼šå§‹ç»ˆåœ¨ setTimeout å’Œ setImmediate ä¹‹å‰æ‰§è¡Œã€‚
å»¶è¿Ÿ 0 æ¯«ç§’çš„ setTimeout() å›è°ƒä¸ setImmediate() éå¸¸ç›¸ä¼¼ã€‚ æ‰§è¡Œé¡ºåºå–å†³äºå„ç§å› ç´ ï¼Œä½†æ˜¯å®ƒä»¬éƒ½ä¼šåœ¨äº‹ä»¶å¾ªç¯çš„ä¸‹ä¸€ä¸ªè¿­ä»£ä¸­è¿è¡Œã€‚
</code></pre><h2 id="æ¢ç´¢-JavaScript-å®šæ—¶å™¨"><a href="#æ¢ç´¢-JavaScript-å®šæ—¶å™¨" class="headerlink" title="æ¢ç´¢ JavaScript å®šæ—¶å™¨"></a><font color="#ff99cc">æ¢ç´¢ JavaScript å®šæ—¶å™¨</font></h2><h3 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout()"></a>setTimeout()</h3><pre><code>è¯¥è¯­æ³•å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚ å¯ä»¥åœ¨å…¶ä¸­è°ƒç”¨æ‰€éœ€çš„ä»»ä½•å…¶ä»–å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ç°æœ‰çš„å‡½æ•°åç§°å’Œä¸€ç»„å‚æ•°ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const myFunction = (firstParam, secondParam) =&gt; &#123;</span><br><span class="line">  // åšäº›äº‹æƒ…</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 2 ç§’ä¹‹åè¿è¡Œ</span><br><span class="line">const id = setTimeout(myFunction, 2000, firstParam, secondParam)</span><br><span class="line"></span><br><span class="line">clearTimeout(id)</span><br></pre></td></tr></table></figure>

setTimeout ä¼šè¿”å›å®šæ—¶å™¨çš„ idã€‚ é€šå¸¸ä¸ä½¿ç”¨å®ƒï¼Œä½†æ˜¯å¯ä»¥ä¿å­˜æ­¤ idï¼Œå¹¶åœ¨è¦åˆ é™¤æ­¤å®‰æ’çš„å‡½æ•°æ‰§è¡Œæ—¶æ¸…é™¤å®ƒã€‚

- é›¶å»¶è¿Ÿ

&lt;div class=&apos;post-warning&apos;&gt;
  æŸäº›æµè§ˆå™¨ï¼ˆIE å’Œ Edgeï¼‰å®ç°çš„ setImmediate() æ–¹æ³•å…·æœ‰ç›¸åŒçš„ç¡®åˆ‡åŠŸèƒ½ï¼Œä½†æ˜¯ä¸æ˜¯æ ‡å‡†çš„ï¼Œå¹¶ä¸”åœ¨å…¶ä»–æµè§ˆå™¨ä¸Šä¸å¯ç”¨ã€‚ä½†æ˜¯åœ¨ Node.js ä¸­å®ƒæ˜¯æ ‡å‡†çš„å‡½æ•°ã€‚
  Node.js è¿˜æä¾› setImmediate()ï¼ˆç›¸å½“äºä½¿ç”¨ setTimeout(() =&gt; {}, 0)ï¼‰ï¼Œé€šå¸¸ç”¨äºä¸ Node.js äº‹ä»¶å¾ªç¯é…åˆä½¿ç”¨ã€‚
&lt;/div&gt;
</code></pre><h3 id="setInterval"><a href="#setInterval" class="headerlink" title="setInterval()"></a>setInterval()</h3><pre><code>é™¤éä½¿ç”¨ clearInterval å‘Šè¯‰å®ƒåœæ­¢ï¼ˆä¼ å…¥ setInterval è¿”å›çš„é—´éš”å®šæ—¶å™¨ idï¼‰ï¼Œå¦åˆ™å®ƒä¼šåœ¨æŒ‡å®šçš„ç‰¹å®šæ—¶é—´é—´éš”ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ä¸€ç›´åœ°è¿è¡Œå›è°ƒå‡½æ•°ï¼Œè€Œä¸æ˜¯åªè¿è¡Œä¸€æ¬¡ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const id = setInterval(() =&gt; &#123;</span><br><span class="line">  // æ¯ 2 ç§’è¿è¡Œä¸€æ¬¡</span><br><span class="line">&#125;, 2000)</span><br><span class="line"></span><br><span class="line">clearInterval(id)</span><br></pre></td></tr></table></figure>

  é€šå¸¸åœ¨ setInterval å›è°ƒå‡½æ•°ä¸­è°ƒç”¨ clearIntervalï¼Œä»¥ä½¿å…¶è‡ªè¡Œåˆ¤æ–­æ˜¯å¦åº”è¯¥å†æ¬¡è¿è¡Œæˆ–åœæ­¢ã€‚ ä¾‹å¦‚ï¼Œæ­¤ä»£ç ä¼šè¿è¡ŒæŸäº›äº‹æƒ…ï¼Œé™¤é App.somethingIWait å…·æœ‰å€¼ arrivedï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const interval = setInterval(() =&gt; &#123;</span><br><span class="line">  if (App.somethingIWait === &apos;arrived&apos;) &#123;</span><br><span class="line">    clearInterval(interval)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  // å¦åˆ™åšäº›äº‹æƒ…</span><br><span class="line">&#125;, 100)</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="JavaScript-å¼‚æ­¥ç¼–ç¨‹ä¸å›è°ƒ"><a href="#JavaScript-å¼‚æ­¥ç¼–ç¨‹ä¸å›è°ƒ" class="headerlink" title="JavaScript å¼‚æ­¥ç¼–ç¨‹ä¸å›è°ƒ"></a><font color="#ff99cc">JavaScript å¼‚æ­¥ç¼–ç¨‹ä¸å›è°ƒ</font></h2><pre><code>ç¨‹åºåœ¨å†…éƒ¨ä¼šä½¿ç”¨ä¸­æ–­ï¼Œä¸€ç§è¢«å‘é€åˆ°å¤„ç†å™¨ä»¥è·å–ç³»ç»Ÿå…³æ³¨çš„ä¿¡å·ã€‚
å½“ç¨‹åºæ­£åœ¨ç­‰å¾…æ¥è‡ªç½‘ç»œçš„å“åº”æ—¶ï¼Œåˆ™å®ƒæ— æ³•åœ¨è¯·æ±‚å®Œæˆä¹‹å‰åœæ­¢å¤„ç†å™¨ã€‚

JSåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯åŒæ­¥çš„ï¼Œå¹¶ä¸”æ˜¯å•çº¿ç¨‹çš„ã€‚è¿™æ„å‘³ç€ä»£ç æ— æ³•åˆ›å»ºæ–°çš„çº¿ç¨‹å¹¶ä¸”ä¸èƒ½å¹¶è¡Œè¿è¡Œã€‚
</code></pre><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><pre><code>JavaScript è¯ç”Ÿäºæµè§ˆå™¨å†…éƒ¨ï¼Œä¸€å¼€å§‹çš„ä¸»è¦å·¥ä½œæ˜¯å“åº”ç”¨æˆ·çš„æ“ä½œï¼Œä¾‹å¦‚ onClickã€onMouseOverã€onChangeã€onSubmit ç­‰ã€‚
- ä½¿ç”¨åŒæ­¥çš„ç¼–ç¨‹æ¨¡å‹è¯¥å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ
  ç­”æ¡ˆå°±åœ¨äºå®ƒçš„ç¯å¢ƒã€‚ æµè§ˆå™¨é€šè¿‡æä¾›ä¸€ç»„å¯ä»¥å¤„ç†è¿™ç§åŠŸèƒ½çš„ API æ¥æä¾›äº†ä¸€ç§å®ç°æ–¹å¼ã€‚

  Node.js å¼•å…¥äº†éé˜»å¡çš„ I/O ç¯å¢ƒï¼Œä»¥å°†è¯¥æ¦‚å¿µæ‰©å±•åˆ°æ–‡ä»¶è®¿é—®ã€ç½‘ç»œè°ƒç”¨ç­‰ã€‚
</code></pre><h3 id="å›è°ƒ"><a href="#å›è°ƒ" class="headerlink" title="å›è°ƒ"></a>å›è°ƒ</h3><pre><code>å›è°ƒæ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œä¼šä½œä¸ºå€¼ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä»…åœ¨äº‹ä»¶å‘ç”Ÿæ—¶æ‰è¢«æ‰§è¡Œã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšï¼Œæ˜¯å› ä¸ºJSå…·æœ‰é¡¶çº§çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥è¢«åˆ†é…ç»™å˜é‡å¹¶ä¼ ç»™å…¶ä»–å‡½æ•°ï¼ˆæˆä¸ºé«˜é˜¶å‡½æ•°ï¼‰ã€‚

- å¤„ç†å›è°ƒä¸­çš„é”™è¯¯
  ä¸€ç§éå¸¸å¸¸è§çš„ç­–ç•¥æ˜¯ä½¿ç”¨ Node.js æ‰€é‡‡ç”¨çš„æ–¹å¼ï¼šä»»ä½•å›è°ƒå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé”™è¯¯å¯¹è±¡ï¼ˆå³é”™è¯¯ä¼˜å…ˆçš„å›è°ƒï¼‰ã€‚
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(&apos;/æ–‡ä»¶.json&apos;, (err, data) =&gt; &#123;</span><br><span class="line">  if (err !== null) &#123;</span><br><span class="line">    //å¤„ç†é”™è¯¯</span><br><span class="line">    console.log(err)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //æ²¡æœ‰é”™è¯¯ï¼Œåˆ™å¤„ç†æ•°æ®ã€‚</span><br><span class="line">  console.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

- å›è°ƒçš„é—®é¢˜
  å›è°ƒé€‚ç”¨äºç®€å•çš„åœºæ™¯ï¼
  å›è°ƒå¤æ‚æ—¶å¯èƒ½ä¼šæ˜¯å›è°ƒåœ°ç‹±ã€‚ã€‚ã€‚

- å›è°ƒçš„æ›¿ä»£æ–¹æ³•
  ä» ES6 å¼€å§‹ï¼ŒJavaScript å¼•å…¥äº†ä¸€äº›ç‰¹æ€§ï¼Œå¯ä»¥å¸®åŠ©å¤„ç†å¼‚æ­¥ä»£ç è€Œä¸æ¶‰åŠä½¿ç”¨å›è°ƒï¼šPromiseï¼ˆES6ï¼‰å’Œ Async/Awaitï¼ˆES2017ï¼‰ã€‚
</code></pre><h2 id="äº†è§£-JavaScript-Promise"><a href="#äº†è§£-JavaScript-Promise" class="headerlink" title="äº†è§£ JavaScript Promise"></a><font color="#ff99cc">äº†è§£ JavaScript Promise</font></h2><pre><code>Promiseé€šå¸¸è¢«å®šä¹‰ä¸º**æœ€ç»ˆä¼šè¢«å˜ä¸ºå¯ç”¨å€¼çš„ä»£ç†**ã€‚  

å½“promiseè¢«è°ƒç”¨åï¼Œå®ƒä¼šä»¥å¤„ç†ä¸­çŠ¶æ€å¼€å§‹ã€‚è¿™æ„å‘³ç€è°ƒç”¨çš„å‡½æ•°ä¼šç»§ç»­æ‰§è¡Œï¼Œè€Œpromiseä»å¤„äºå¤„ç†ä¸­ç›´åˆ°è§£å†³æœªçŸ¥ï¼Œä»è€Œä¸ºè°ƒç”¨çš„å‡½æ•°æä¾›æ‰€è¯·æ±‚çš„ä»»ä½•æ•°æ®ã€‚

è¢«åˆ›å»ºçš„promiseæœ€ç»ˆä¼šä»¥**è¢«è§£å†³çŠ¶æ€**æˆ–**è¢«æ‹’ç»çŠ¶æ€**ç»“æŸï¼Œå¹¶åœ¨å®Œæˆæ—¶è°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼ˆthenæˆ–catchï¼‰ã€‚
resolve -&gt; then
rejecte -&gt; catch
å¦‚æœåœ¨æ‰§è¡Œè·¯å¾„ä¸­ä»æœªè°ƒç”¨è¿‡è¿™äº›å‡½æ•°ä¹‹ä¸€ï¼Œåˆ™ promise ä¼šä¿æŒå¤„ç†ä¸­(pending)çŠ¶æ€ã€‚

ä¸€ç§è¢«ç§°ä¸º Promisifying çš„æŠ€æœ¯ã€‚ è¿™é¡¹æŠ€æœ¯èƒ½å¤Ÿä½¿ç”¨ç»å…¸çš„ JavaScript å‡½æ•°æ¥æ¥å—å›è°ƒå¹¶ä½¿å…¶è¿”å› promiseï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">const getFile = (fileName) =&gt; &#123;</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    fs.readFile(fileName, (err, data) =&gt; &#123;</span><br><span class="line">      if (err) &#123;</span><br><span class="line">        reject(err)  // è°ƒç”¨ `reject` ä¼šå¯¼è‡´ promise å¤±è´¥ï¼Œæ— è®ºæ˜¯å¦ä¼ å…¥é”™è¯¯ä½œä¸ºå‚æ•°ï¼Œ</span><br><span class="line">        return        // ä¸”ä¸å†è¿›è¡Œä¸‹å»ã€‚</span><br><span class="line">      &#125;</span><br><span class="line">      resolve(data)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFile(&apos;/etc/passwd&apos;)</span><br><span class="line">.then(data =&gt; console.log(data))</span><br><span class="line">.catch(err =&gt; console.error(err))</span><br></pre></td></tr></table></figure>
</code></pre>  <div class="post-warning">åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Node.js ä¸­ï¼Œæ— éœ€ä¸ºå¤§å¤šæ•° API è¿›è¡Œæ‰‹åŠ¨åœ°è½¬æ¢ã€‚å¦‚æœéœ€è¦ promisifying çš„å‡½æ•°å…·æœ‰æ­£ç¡®çš„ç­¾åï¼Œåˆ™ util æ¨¡å—ä¸­æœ‰ä¸€ä¸ª promisifying å‡½æ•°å¯ä»¥å®Œæˆæ­¤æ“ä½œã€‚</div>

<h3 id="é“¾å¼-promise"><a href="#é“¾å¼-promise" class="headerlink" title="é“¾å¼ promise"></a>é“¾å¼ promise</h3><p>  Promise å¯ä»¥è¿”å›åˆ°å¦ä¸€ä¸ª promiseï¼Œä»è€Œåˆ›å»ºä¸€ä¸ª promise é“¾ã€‚</p>
<p>  Fetch API æ˜¯åŸºäº promise çš„æœºåˆ¶ï¼Œè°ƒç”¨ fetch() ç›¸å½“äºä½¿ç”¨ new Promise() æ¥å®šä¹‰ promsieã€‚<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const status = response =&gt; &#123;</span><br><span class="line">  if (response.status &gt;= 200 &amp;&amp; response.status &lt; 300) &#123;</span><br><span class="line">    return Promise.resolve(response)</span><br><span class="line">  &#125;</span><br><span class="line">  return Promise.reject(new Error(response.statusText))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const json = response =&gt; response.json()</span><br><span class="line"></span><br><span class="line">fetch(&apos;/todos.json&apos;)</span><br><span class="line">  .then(status)    // æ³¨æ„ï¼Œ`status` å‡½æ•°å®é™…ä¸Šåœ¨è¿™é‡Œè¢«è°ƒç”¨ï¼Œå¹¶ä¸”åŒæ ·è¿”å› promiseï¼Œ</span><br><span class="line">  .then(json)      // è¿™é‡Œå”¯ä¸€çš„åŒºåˆ«æ˜¯çš„ `json` å‡½æ•°ä¼šè¿”å›è§£å†³æ—¶ä¼ å…¥ `data` çš„ promiseï¼Œ</span><br><span class="line">  .then(data =&gt; &#123;  // è¿™æ˜¯ `data` ä¼šåœ¨æ­¤å¤„ä½œä¸ºåŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åŸå› ã€‚</span><br><span class="line">    console.log(&apos;è¯·æ±‚æˆåŠŸè·å¾— JSON å“åº”&apos;, data)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    console.log(&apos;è¯·æ±‚å¤±è´¥&apos;, error)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="å¤„ç†é”™è¯¯"><a href="#å¤„ç†é”™è¯¯" class="headerlink" title="å¤„ç†é”™è¯¯"></a>å¤„ç†é”™è¯¯</h3><p>  å½“ promise é“¾ä¸­çš„ä»»ä½•å†…å®¹å¤±è´¥å¹¶å¼•å‘é”™è¯¯æˆ–æ‹’ç» promise æ—¶ï¼Œåˆ™æ§åˆ¶æƒä¼šè½¬åˆ°é“¾ä¸­æœ€è¿‘çš„ catch() è¯­å¥ã€‚</p>
<p>  å¦‚æœå†catchå†…éƒ¨å‘ç”Ÿé”™è¯¯ï¼Œåˆ™å¯ä»¥é™„åŠ ç¬¬äºŒä¸ªcatchæ¥å¤„ç†ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<h3 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all()"></a>Promise.all()</h3><p>  å¦‚æœéœ€è¦åŒæ­¥ä¸åŒçš„ promiseï¼Œåˆ™ Promise.all() å¯ä»¥å¸®åŠ©å®šä¹‰ promise åˆ—è¡¨ï¼Œå¹¶åœ¨æ‰€æœ‰ promise éƒ½è¢«è§£å†³åæ‰§è¡Œä¸€äº›æ“ä½œã€‚</p>
<p>  ç¤ºä¾‹ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const f1 = fetch(&apos;/something.json&apos;)</span><br><span class="line">const f2 = fetch(&apos;/something2.json&apos;)</span><br><span class="line"></span><br><span class="line">Promise.all([f1, f2])</span><br><span class="line">  .then(res =&gt; &#123;</span><br><span class="line">    console.log(&apos;ç»“æœçš„æ•°ç»„&apos;, res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure></p>
<pre><code>ES2015 è§£æ„èµ‹å€¼è¯­æ³•ä¹Ÿå¯ä»¥æ‰§è¡Œï¼š
</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Promise.all([f1, f2]).then(([res1, res2]) =&gt; &#123;</span><br><span class="line">  console.log(&apos;ç»“æœ&apos;, res1, res2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>å½“ç„¶ï¼Œä¸é™äºä½¿ç”¨ fetchï¼Œä»»ä½• promise éƒ½å¯ä»¥ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ã€‚
</code></pre><h3 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race()"></a>Promise.race()</h3><p>  å½“ä¼ ç»™å…¶çš„é¦–ä¸ª promise è¢«è§£å†³æ—¶ï¼Œåˆ™ Promise.race() å¼€å§‹è¿è¡Œï¼Œå¹¶ä¸”åªè¿è¡Œä¸€æ¬¡é™„åŠ çš„å›è°ƒï¼ˆä¼ å…¥ç¬¬ä¸€ä¸ªè¢«è§£å†³çš„ promise çš„ç»“æœï¼‰ã€‚</p>
<p>  ç¤ºä¾‹ï¼š<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const first = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">  setTimeout(resolve, 500, &apos;ç¬¬ä¸€ä¸ª&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">const second = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">  setTimeout(resolve, 100, &apos;ç¬¬äºŒä¸ª&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Promise.race([first, second]).then(result =&gt; &#123;</span><br><span class="line">  console.log(result) // ç¬¬äºŒä¸ª</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="å¸¸è§çš„é”™è¯¯"><a href="#å¸¸è§çš„é”™è¯¯" class="headerlink" title="å¸¸è§çš„é”™è¯¯"></a>å¸¸è§çš„é”™è¯¯</h3><pre><code>- Uncaught TypeError: undefined is not a promise
å¦‚æœåœ¨æ§åˆ¶å°ä¸­æ”¶åˆ° Uncaught TypeError: undefined is not a promise é”™è¯¯ï¼Œåˆ™è¯·ç¡®ä¿ä½¿ç”¨ new Promise() è€Œä¸æ˜¯ Promise()ã€‚

- UnhandledPromiseRejectionWarning
è¿™æ„å‘³ç€è°ƒç”¨çš„ promise è¢«æ‹’ç»ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨äºå¤„ç†é”™è¯¯çš„ catchã€‚ åœ¨ then ä¹‹åæ·»åŠ  catch åˆ™å¯ä»¥æ­£ç¡®åœ°å¤„ç†ã€‚
</code></pre><h2 id="å…·æœ‰-Async-å’Œ-Await-çš„ç°ä»£å¼‚æ­¥-JavaScript"><a href="#å…·æœ‰-Async-å’Œ-Await-çš„ç°ä»£å¼‚æ­¥-JavaScript" class="headerlink" title="å…·æœ‰ Async å’Œ Await çš„ç°ä»£å¼‚æ­¥ JavaScript"></a><font color="#ff99cc">å…·æœ‰ Async å’Œ Await çš„ç°ä»£å¼‚æ­¥ JavaScript</font></h2><pre><code>Promise è¢«å¼•å…¥äº†ç”¨äºè§£å†³è‘—åçš„å›è°ƒåœ°ç‹±é—®é¢˜ï¼Œä½†æ˜¯å®ƒä»¬è‡ªèº«å¼•å…¥äº†å¤æ‚æ€§ä»¥åŠè¯­æ³•å¤æ‚æ€§ã€‚
å®ƒä»¬ä½¿ä»£ç çœ‹èµ·æ¥åƒæ˜¯åŒæ­¥çš„ï¼Œä½†å®ƒæ˜¯å¼‚æ­¥çš„å¹¶ä¸”åœ¨åå°æ— é˜»å¡ã€‚

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const doSomethingAsync = () =&gt; &#123;</span><br><span class="line">  return new Promise(resolve =&gt; &#123;</span><br><span class="line">    console.log(&apos;+1&apos;);resolve(&apos;åšäº›äº‹æƒ…&apos;);console.log(&apos;+2&apos;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const doSomething = async () =&gt; &#123;</span><br><span class="line">  console.log(&apos;+3&apos;);</span><br><span class="line">  console.log(await doSomethingAsync());</span><br><span class="line">  console.log(&apos;+4&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(&apos;ä¹‹å‰&apos;);</span><br><span class="line">doSomething();</span><br><span class="line">console.log(&apos;ä¹‹å&apos;);</span><br><span class="line"></span><br><span class="line">// ä¹‹å‰  +3   +1   +2   ä¹‹å åšäº›äº‹æƒ… +4</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="Promise-æ‰€æœ‰äº‹æƒ…"><a href="#Promise-æ‰€æœ‰äº‹æƒ…" class="headerlink" title="Promise æ‰€æœ‰äº‹æƒ…"></a>Promise æ‰€æœ‰äº‹æƒ…</h3><pre><code>åœ¨ä»»ä½•å‡½æ•°ä¹‹å‰åŠ ä¸Š async å…³é”®å­—æ„å‘³ç€è¯¥å‡½æ•°ä¼šè¿”å› promiseã€‚å³ä½¿æ²¡æœ‰æ˜¾å¼åœ°è¿™æ ·åšï¼Œå®ƒä¹Ÿä¼šåœ¨å†…éƒ¨ä½¿å®ƒè¿”å› promiseã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ­¤ä»£ç æœ‰æ•ˆçš„åŸå› ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const aFunction = async () =&gt; &#123;</span><br><span class="line">  return &apos;æµ‹è¯•&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aFunction().then(alert) // è¿™ä¼š alert &apos;æµ‹è¯•&apos;</span><br></pre></td></tr></table></figure>

ç­‰åŒäºï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const aFunction = () =&gt; &#123;</span><br><span class="line">  return Promise.resolve(&apos;æµ‹è¯•&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aFunction().then(alert) // è¿™ä¼š alert &apos;æµ‹è¯•&apos;</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="ä»£ç æ›´å®¹æ˜“é˜…è¯»"><a href="#ä»£ç æ›´å®¹æ˜“é˜…è¯»" class="headerlink" title="ä»£ç æ›´å®¹æ˜“é˜…è¯»"></a>ä»£ç æ›´å®¹æ˜“é˜…è¯»</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const getFirstUserData = () =&gt; &#123;</span><br><span class="line">  return fetch(&apos;/users.json&apos;) // è·å–ç”¨æˆ·åˆ—è¡¨</span><br><span class="line">    .then(response =&gt; response.json()) // è§£æ JSON</span><br><span class="line">    .then(users =&gt; users[0]) // é€‰æ‹©ç¬¬ä¸€ä¸ªç”¨æˆ·</span><br><span class="line">    .then(user =&gt; fetch(`/users/$&#123;user.name&#125;`)) // è·å–ç”¨æˆ·æ•°æ®</span><br><span class="line">    .then(userResponse =&gt; userResponse.json()) // è§£æ JSON</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFirstUserData()</span><br></pre></td></tr></table></figure>

è¿™æ˜¯ä½¿ç”¨ await/async æä¾›çš„ç›¸åŒåŠŸèƒ½ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const getFirstUserData = async () =&gt; &#123;</span><br><span class="line">  const response = await fetch(&apos;/users.json&apos;) // è·å–ç”¨æˆ·åˆ—è¡¨</span><br><span class="line">  const users = await response.json() // è§£æ JSON</span><br><span class="line">  const user = users[0] // é€‰æ‹©ç¬¬ä¸€ä¸ªç”¨æˆ·</span><br><span class="line">  const userResponse = await fetch(`/users/$&#123;user.name&#125;`) // è·å–ç”¨æˆ·æ•°æ®</span><br><span class="line">  const userData = await userResponse.json() // è§£æ JSON</span><br><span class="line">  return userData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFirstUserData()</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="å¤šä¸ªå¼‚æ­¥å‡½æ•°ä¸²è”"><a href="#å¤šä¸ªå¼‚æ­¥å‡½æ•°ä¸²è”" class="headerlink" title="å¤šä¸ªå¼‚æ­¥å‡½æ•°ä¸²è”"></a>å¤šä¸ªå¼‚æ­¥å‡½æ•°ä¸²è”</h3><pre><code>å¼‚æ­¥å‡½æ•°å¯ä»¥å¾ˆå®¹æ˜“åœ°é“¾æ¥èµ·æ¥ï¼Œå¹¶ä¸”è¯­æ³•æ¯”æ™®é€šçš„ promise æ›´å…·å¯è¯»æ€§ã€‚ä¾‹å­ç•¥ï¼Œæœ‰éœ€è¦è§å®˜ç½‘ã€‚
</code></pre><h3 id="æ›´å®¹æ˜“è°ƒè¯•"><a href="#æ›´å®¹æ˜“è°ƒè¯•" class="headerlink" title="æ›´å®¹æ˜“è°ƒè¯•"></a>æ›´å®¹æ˜“è°ƒè¯•</h3><pre><code>è°ƒè¯• promise å¾ˆéš¾ï¼Œå› ä¸ºè°ƒè¯•å™¨ä¸ä¼šè·³è¿‡å¼‚æ­¥çš„ä»£ç ã€‚

Async/await ä½¿è¿™éå¸¸å®¹æ˜“ï¼Œå› ä¸ºå¯¹äºç¼–è¯‘å™¨è€Œè¨€ï¼Œå®ƒå°±åƒåŒæ­¥ä»£ç ä¸€æ ·ã€‚
</code></pre><h2 id="Node-js-äº‹ä»¶è§¦å‘å™¨"><a href="#Node-js-äº‹ä»¶è§¦å‘å™¨" class="headerlink" title="Node.js äº‹ä»¶è§¦å‘å™¨"></a><font color="#ff99cc">Node.js äº‹ä»¶è§¦å‘å™¨</font></h2><pre><code>åœ¨åç«¯ï¼ŒNode.js ä¹Ÿæä¾›äº†ä½¿ç”¨ events æ¨¡å—æ„å»ºç±»ä¼¼ç³»ç»Ÿçš„é€‰é¡¹ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const EventEmitter = require(&apos;events&apos;)</span><br><span class="line">const eventEmitter = new EventEmitter()</span><br></pre></td></tr></table></figure>

- è¯¥å¯¹è±¡å…¬å¼€äº† on å’Œ emit æ–¹æ³•ã€‚
  emit ç”¨äºè§¦å‘äº‹ä»¶ã€‚
  on ç”¨äºæ·»åŠ å›è°ƒå‡½æ•°ï¼ˆä¼šåœ¨äº‹ä»¶è¢«è§¦å‘æ—¶æ‰§è¡Œï¼‰ã€‚

å¯ä¼ å‚ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eventEmitter.on(&apos;start&apos;, (start, end) =&gt; &#123;</span><br><span class="line">  console.log(`ä» $&#123;start&#125; åˆ° $&#123;end&#125;`)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">eventEmitter.emit(&apos;start&apos;, 1, 100);</span><br></pre></td></tr></table></figure>

- EventEmitter å¯¹è±¡è¿˜å…¬å¼€äº†å…¶ä»–å‡ ä¸ªä¸äº‹ä»¶è¿›è¡Œäº¤äº’çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š
  once(): æ·»åŠ å•æ¬¡ç›‘å¬å™¨ã€‚
  removeListener() / off(): ä»äº‹ä»¶ä¸­ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ã€‚
  removeAllListeners(): ç§»é™¤äº‹ä»¶çš„æ‰€æœ‰ç›‘å¬å™¨ã€‚
  å¯ä»¥åœ¨[äº‹ä»¶æ¨¡å—](http://nodejs.cn/api/events.html)çš„é¡µé¢ä¸Šé˜…è¯»å…¶æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚
</code></pre><h2 id="æ­å»º-HTTP-æœåŠ¡å™¨"><a href="#æ­å»º-HTTP-æœåŠ¡å™¨" class="headerlink" title="æ­å»º HTTP æœåŠ¡å™¨"></a><font color="#ff99cc">æ­å»º HTTP æœåŠ¡å™¨</font></h2><pre><code>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ HTTP web æœåŠ¡å™¨çš„ç¤ºä¾‹ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;)</span><br><span class="line"></span><br><span class="line">const port = 3000</span><br><span class="line"></span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  res.statusCode = 200</span><br><span class="line">  res.setHeader(&apos;Content-Type&apos;, &apos;text/plain&apos;)</span><br><span class="line">  res.end(&apos;ä½ å¥½ä¸–ç•Œ\n&apos;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">server.listen(port, () =&gt; &#123;</span><br><span class="line">  console.log(`æœåŠ¡å™¨è¿è¡Œåœ¨ http://$&#123;hostname&#125;:$&#123;port&#125;/`)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="ä½¿ç”¨-Node-js-å‘é€-HTTP-è¯·æ±‚"><a href="#ä½¿ç”¨-Node-js-å‘é€-HTTP-è¯·æ±‚" class="headerlink" title="ä½¿ç”¨ Node.js å‘é€ HTTP è¯·æ±‚"></a><font color="#ff99cc">ä½¿ç”¨ Node.js å‘é€ HTTP è¯·æ±‚</font></h2><pre><code>- æ‰§è¡Œ GET è¯·æ±‚
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const https = require(&apos;https&apos;)</span><br><span class="line">const options = &#123;</span><br><span class="line">  hostname: &apos;nodejs.cn&apos;,</span><br><span class="line">  port: 443,</span><br><span class="line">  path: &apos;/todos&apos;,</span><br><span class="line">  method: &apos;GET&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const req = https.request(options, res =&gt; &#123;</span><br><span class="line">  console.log(`çŠ¶æ€ç : $&#123;res.statusCode&#125;`)</span><br><span class="line"></span><br><span class="line">  res.on(&apos;data&apos;, d =&gt; &#123;</span><br><span class="line">    process.stdout.write(d)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.on(&apos;error&apos;, error =&gt; &#123;</span><br><span class="line">  console.error(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.end()</span><br></pre></td></tr></table></figure>

- æ‰§è¡Œ POST è¯·æ±‚
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const https = require(&apos;https&apos;)</span><br><span class="line"></span><br><span class="line">const data = JSON.stringify(&#123;</span><br><span class="line">  todo: &apos;åšç‚¹äº‹æƒ…&apos;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  hostname: &apos;nodejs.cn&apos;,</span><br><span class="line">  port: 443,</span><br><span class="line">  path: &apos;/todos&apos;,</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &apos;Content-Type&apos;: &apos;application/json&apos;,</span><br><span class="line">    &apos;Content-Length&apos;: data.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const req = https.request(options, res =&gt; &#123;</span><br><span class="line">  console.log(`çŠ¶æ€ç : $&#123;res.statusCode&#125;`)</span><br><span class="line"></span><br><span class="line">  res.on(&apos;data&apos;, d =&gt; &#123;</span><br><span class="line">    process.stdout.write(d)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.on(&apos;error&apos;, error =&gt; &#123;</span><br><span class="line">  console.error(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.write(data)</span><br><span class="line">req.end()</span><br></pre></td></tr></table></figure>


- PUT å’Œ DELETE
  PUT å’Œ DELETE è¯·æ±‚ä½¿ç”¨ç›¸åŒçš„ POST è¯·æ±‚æ ¼å¼ï¼Œåªéœ€æ›´æ”¹ options.method çš„å€¼å³å¯ã€‚
</code></pre><h2 id="ä½¿ç”¨-Node-js-å‘é€-HTTP-POST-è¯·æ±‚"><a href="#ä½¿ç”¨-Node-js-å‘é€-HTTP-POST-è¯·æ±‚" class="headerlink" title="ä½¿ç”¨ Node.js å‘é€ HTTP POST è¯·æ±‚"></a><font color="#ff99cc">ä½¿ç”¨ Node.js å‘é€ HTTP POST è¯·æ±‚</font></h2><pre><code>åœ¨ Node.js ä¸­ï¼Œæœ‰å¤šç§æ–¹å¼å¯ä»¥æ‰§è¡Œ HTTP POST è¯·æ±‚ï¼Œå…·ä½“å–å†³äºè¦ä½¿ç”¨çš„æŠ½è±¡çº§åˆ«ã€‚

ä½¿ç”¨ Node.js æ‰§è¡Œ HTTP è¯·æ±‚çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ Axios åº“ï¼š

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const axios = require(&apos;axios&apos;)</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .post(&apos;http://nodejs.cn/todos&apos;, &#123;</span><br><span class="line">    todo: &apos;åšç‚¹äº‹æƒ…&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(res =&gt; &#123;</span><br><span class="line">    console.log(`çŠ¶æ€ç : $&#123;res.statusCode&#125;`)</span><br><span class="line">    console.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    console.error(error)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

Axios éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åº“ã€‚
ä¹Ÿå¯ä»¥åªä½¿ç”¨ Node.js çš„æ ‡å‡†æ¨¡å—æ¥å‘é€ POST è¯·æ±‚ï¼Œå°½ç®¡å®ƒæ¯”å‰é¢çš„é€‰æ‹©å†—é•¿äº›ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const https = require(&apos;https&apos;)</span><br><span class="line"></span><br><span class="line">const data = JSON.stringify(&#123;</span><br><span class="line">  todo: &apos;åšç‚¹äº‹æƒ…&apos;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const options = &#123;</span><br><span class="line">  hostname: &apos;nodejs.cn&apos;,</span><br><span class="line">  port: 443,</span><br><span class="line">  path: &apos;/todos&apos;,</span><br><span class="line">  method: &apos;POST&apos;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    &apos;Content-Type&apos;: &apos;application/json&apos;,</span><br><span class="line">    &apos;Content-Length&apos;: data.length</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const req = https.request(options, res =&gt; &#123;</span><br><span class="line">  console.log(`çŠ¶æ€ç : $&#123;res.statusCode&#125;`)</span><br><span class="line"></span><br><span class="line">  res.on(&apos;data&apos;, d =&gt; &#123;</span><br><span class="line">    process.stdout.write(d)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.on(&apos;error&apos;, error =&gt; &#123;</span><br><span class="line">  console.error(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">req.write(data)</span><br><span class="line">req.end()</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="ä½¿ç”¨-Node-js-è·å–-HTTP-è¯·æ±‚çš„æ­£æ–‡æ•°æ®"><a href="#ä½¿ç”¨-Node-js-è·å–-HTTP-è¯·æ±‚çš„æ­£æ–‡æ•°æ®" class="headerlink" title="ä½¿ç”¨ Node.js è·å– HTTP è¯·æ±‚çš„æ­£æ–‡æ•°æ®"></a><font color="#ff99cc">ä½¿ç”¨ Node.js è·å– HTTP è¯·æ±‚çš„æ­£æ–‡æ•°æ®</font></h2><pre><code>å¦‚æœä½¿ç”¨çš„æ˜¯ Expressï¼Œåˆ™éå¸¸ç®€å•ï¼šä½¿ç”¨ body-parser Node.js æ¨¡å—ã€‚

ä¾‹å¦‚ï¼Œè·å–æ­¤è¯·æ±‚çš„æ­£æ–‡ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const axios = require(&apos;axios&apos;)</span><br><span class="line"></span><br><span class="line">axios.post(&apos;http://nodejs.cn/todos&apos;, &#123;</span><br><span class="line">  todo: &apos;åšç‚¹äº‹æƒ…&apos;</span><br><span class="line">&#125;)</span><br><span class="line">è¿™æ˜¯å¯¹åº”çš„æœåŠ¡å™¨ç«¯ä»£ç ï¼š</span><br><span class="line"></span><br><span class="line">const express = require(&apos;express&apos;)</span><br><span class="line">const app = express()</span><br><span class="line"></span><br><span class="line">app.use(</span><br><span class="line">  express.urlencoded(&#123;</span><br><span class="line">    extended: true</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app.use(express.json())</span><br><span class="line"></span><br><span class="line">app.post(&apos;/todos&apos;, (req, res) =&gt; &#123;</span><br><span class="line">  console.log(req.body.todo)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

  å¦‚æœä¸ä½¿ç”¨ Express å¹¶æƒ³åœ¨æ™®é€šçš„ Node.js ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œåˆ™éœ€è¦åšå¤šä¸€ç‚¹çš„å·¥ä½œï¼Œå› ä¸º Express æŠ½è±¡äº†å¾ˆå¤šå·¥ä½œã€‚

  è¦ç†è§£çš„å…³é”®æ˜¯ï¼Œå½“ä½¿ç”¨ http.createServer() åˆå§‹åŒ– HTTP æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåœ¨è·å¾—æ‰€æœ‰ HTTP è¯·æ±‚å¤´ï¼ˆè€Œä¸æ˜¯è¯·æ±‚æ­£æ–‡æ—¶ï¼‰æ—¶è°ƒç”¨å›è°ƒã€‚

  åœ¨è¿æ¥å›è°ƒä¸­ä¼ å…¥çš„ request å¯¹è±¡æ˜¯ä¸€ä¸ªæµã€‚

  å› æ­¤ï¼Œå¿…é¡»ç›‘å¬è¦å¤„ç†çš„ä¸»ä½“å†…å®¹ï¼Œå¹¶ä¸”å…¶æ˜¯æŒ‰æ•°æ®å—å¤„ç†çš„ã€‚

  é¦–å…ˆï¼Œé€šè¿‡ç›‘å¬æµçš„ data äº‹ä»¶æ¥è·å–æ•°æ®ï¼Œç„¶ååœ¨æ•°æ®ç»“æŸæ—¶è°ƒç”¨ä¸€æ¬¡æµçš„ end äº‹ä»¶ï¼š

  const server = http.createServer((req, res) =&gt; {
    // å¯ä»¥è®¿é—® HTTP è¯·æ±‚å¤´
    req.on(&apos;data&apos;, chunk =&gt; {
      console.log(`å¯ç”¨çš„æ•°æ®å—: ${chunk}`)
    })
    req.on(&apos;end&apos;, () =&gt; {
      //æ•°æ®ç»“æŸ
    })
  })
  å› æ­¤ï¼Œè‹¥è¦è®¿é—®æ•°æ®ï¼ˆå‡è®¾æœŸæœ›æ¥æ”¶åˆ°å­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™å¿…é¡»å°†å…¶æ”¾å…¥æ•°ç»„ä¸­ï¼š

  const server = http.createServer((req, res) =&gt; {
    let data = &apos;&apos;;
    req.on(&apos;data&apos;, chunk =&gt; {
      data += chunk;
    })
    req.on(&apos;end&apos;, () =&gt; {
      JSON.parse(data).todo // &apos;åšç‚¹äº‹æƒ…&apos;
    })
  })
</code></pre><h2 id="åœ¨-Node-js-ä¸­ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦"><a href="#åœ¨-Node-js-ä¸­ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦" class="headerlink" title="åœ¨ Node.js ä¸­ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦"></a><font color="#ff99cc">åœ¨ Node.js ä¸­ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦</font></h2><pre><code>æ–‡ä»¶æè¿°ç¬¦æ˜¯ä½¿ç”¨ fs æ¨¡å—æä¾›çš„ open() æ–¹æ³•æ‰“å¼€æ–‡ä»¶åè¿”å›çš„ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">fs.open(&apos;/Users/joe/test.txt&apos;, &apos;r&apos;, (err, fd) =&gt; &#123;</span><br><span class="line">  //fd æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

æ³¨æ„ï¼Œå°† r ä½œä¸º fs.open() è°ƒç”¨çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚
è¯¥æ ‡å¿—æ„å‘³ç€æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å–ã€‚

å…¶ä»–å¸¸ç”¨çš„æ ‡å¿—æœ‰ï¼š
r+ æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ã€‚
w+ æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ï¼Œå°†æµå®šä½åˆ°æ–‡ä»¶çš„å¼€å¤´ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ã€‚
a æ‰“å¼€æ–‡ä»¶ç”¨äºå†™å…¥ï¼Œå°†æµå®šä½åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ã€‚
a+ æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ï¼Œå°†æµå®šä½åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨ fs.openSync æ–¹æ³•æ‰“å¼€æ–‡ä»¶ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼ˆè€Œä¸æ˜¯åœ¨å›è°ƒä¸­æä¾›ï¼‰ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">  const fd = fs.openSync(&apos;/Users/joe/test.txt&apos;, &apos;r&apos;)</span><br><span class="line">&#125; catch (err) &#123;</span><br><span class="line">  console.error(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

ä¸€æ—¦è·å¾—æ–‡ä»¶æè¿°ç¬¦ï¼Œå°±å¯ä»¥ä»¥ä»»ä½•æ–¹å¼æ‰§è¡Œæ‰€æœ‰éœ€è¦å®ƒçš„æ“ä½œï¼Œä¾‹å¦‚è°ƒç”¨ fs.open() ä»¥åŠè®¸å¤šä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’çš„å…¶ä»–æ“ä½œã€‚
</code></pre><h2 id="Node-js-æ–‡ä»¶å±æ€§"><a href="#Node-js-æ–‡ä»¶å±æ€§" class="headerlink" title="Node.js æ–‡ä»¶å±æ€§"></a><font color="#ff99cc">Node.js æ–‡ä»¶å±æ€§</font></h2><pre><code>æ¯ä¸ªæ–‡ä»¶éƒ½å¸¦æœ‰ä¸€ç»„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ Node.js è¿›è¡Œæ£€æŸ¥ã€‚å…·ä½“åœ°è¯´ï¼Œä½¿ç”¨ fs æ¨¡å—æä¾›çš„ stat() æ–¹æ³•ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line">fs.stat(&apos;/Users/joe/test.txt&apos;, (err, stats) =&gt; &#123;</span><br><span class="line">  if (err) &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  stats.isFile() //true</span><br><span class="line">  stats.isDirectory() //false</span><br><span class="line">  stats.isSymbolicLink() //false</span><br><span class="line">  stats.size //1024000 //= 1MB</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

Node.js ä¹Ÿæä¾›äº†åŒæ­¥çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°æ–‡ä»¶å±æ€§å‡†å¤‡å°±ç»ªä¸ºæ­¢ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line">try &#123;</span><br><span class="line">  const stats = fs.statSync(&apos;/Users/joe/test.txt&apos;)</span><br><span class="line">&#125; catch (err) &#123;</span><br><span class="line">  console.error(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="Node-js-æ–‡ä»¶è·¯å¾„"><a href="#Node-js-æ–‡ä»¶è·¯å¾„" class="headerlink" title="Node.js æ–‡ä»¶è·¯å¾„"></a><font color="#ff99cc">Node.js æ–‡ä»¶è·¯å¾„</font></h2><pre><code>- ä»è·¯å¾„ä¸­è·å–ä¿¡æ¯
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const notes = &apos;/users/joe/notes.txt&apos;</span><br><span class="line"></span><br><span class="line">path.dirname(notes) // /users/joe   è·å–æ–‡ä»¶çš„çˆ¶æ–‡ä»¶å¤¹ã€‚</span><br><span class="line">path.basename(notes) // notes.txt   è·å–æ–‡ä»¶åéƒ¨åˆ†ã€‚</span><br><span class="line">path.extname(notes) // .txt         è·å–æ–‡ä»¶çš„æ‰©å±•åã€‚</span><br><span class="line">path.basename(notes, path.extname(notes)) //notes  å¯ä»¥é€šè¿‡ä¸º basename æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°æ¥è·å–ä¸å¸¦æ‰©å±•åçš„æ–‡ä»¶åï¼š</span><br></pre></td></tr></table></figure>

- ä½¿ç”¨è·¯å¾„
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¿æ¥è·¯å¾„:</span><br><span class="line">const name = &apos;joe&apos;</span><br><span class="line">path.join(&apos;/&apos;, &apos;users&apos;, name, &apos;notes.txt&apos;) // &apos;/users/joe/notes.txt&apos;</span><br><span class="line"></span><br><span class="line">path.resolve() è·å¾—ç›¸å¯¹è·¯å¾„çš„ç»å¯¹è·¯å¾„:</span><br><span class="line">path.resolve(&apos;joe.txt&apos;) // &apos;/Users/joe/joe.txt&apos; å¦‚æœä»ä¸»æ–‡ä»¶å¤¹è¿è¡Œã€‚</span><br><span class="line">path.resolve(&apos;tmp&apos;, &apos;joe.txt&apos;) // &apos;/Users/joe/tmp/joe.txt&apos;    å¦‚æœä»ä¸»æ–‡ä»¶å¤¹è¿è¡Œã€‚</span><br><span class="line">path.resolve(&apos;/etc&apos;, &apos;joe.txt&apos;) // &apos;/etc/joe.txt&apos;   å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä»¥æ–œæ å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯ç»å¯¹è·¯å¾„</span><br><span class="line"></span><br><span class="line">path.normalize() æ˜¯å¦ä¸€ä¸ªæœ‰ç”¨çš„å‡½æ•°ï¼Œå½“åŒ…å«è¯¸å¦‚ .ã€.. æˆ–åŒæ–œæ ä¹‹ç±»çš„ç›¸å¯¹è¯´æ˜ç¬¦æ—¶ï¼Œå…¶ä¼šå°è¯•è®¡ç®—å®é™…çš„è·¯å¾„ï¼š</span><br><span class="line">path.normalize(&apos;/users/joe/..//test.txt&apos;) // &apos;/users/test.txt&apos;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="ä½¿ç”¨-Node-js-è¯»å–æ–‡ä»¶"><a href="#ä½¿ç”¨-Node-js-è¯»å–æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ Node.js è¯»å–æ–‡ä»¶"></a><font color="#ff99cc">ä½¿ç”¨ Node.js è¯»å–æ–‡ä»¶</font></h2><pre><code>åœ¨ Node.js ä¸­è¯»å–æ–‡ä»¶æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ fs.readFile() æ–¹æ³•ï¼Œå‘å…¶ä¼ å…¥æ–‡ä»¶è·¯å¾„ã€ç¼–ç ã€ä»¥åŠä¼šå¸¦ä¸Šæ–‡ä»¶æ•°æ®ï¼ˆä»¥åŠé”™è¯¯ï¼‰è¿›è¡Œè°ƒç”¨çš„å›è°ƒå‡½æ•°ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">fs.readFile(&apos;/Users/joe/test.txt&apos;, &apos;utf8&apos; , (err, data) =&gt; &#123;</span><br><span class="line">  if (err) &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ­¥çš„ç‰ˆæœ¬ fs.readFileSync()ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">  const data = fs.readFileSync(&apos;/Users/joe/test.txt&apos;, &apos;utf8&apos;)</span><br><span class="line">  console.log(data)</span><br><span class="line">&#125; catch (err) &#123;</span><br><span class="line">  console.error(err)</span><br><span class="line">&#125;</span><br><span class="line">fs.readFile() å’Œ fs.readFileSync() éƒ½ä¼šåœ¨è¿”å›æ•°æ®ä¹‹å‰å°†æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ã€‚</span><br></pre></td></tr></table></figure>

è¿™æ„å‘³ç€å¤§æ–‡ä»¶ä¼šå¯¹å†…å­˜çš„æ¶ˆè€—å’Œç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦äº§ç”Ÿé‡å¤§çš„å½±å“ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´å¥½çš„é€‰æ‹©æ˜¯ä½¿ç”¨æµæ¥è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚
</code></pre><h2 id="ä½¿ç”¨-Node-js-å†™å…¥æ–‡ä»¶"><a href="#ä½¿ç”¨-Node-js-å†™å…¥æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ Node.js å†™å…¥æ–‡ä»¶"></a><font color="#ff99cc">ä½¿ç”¨ Node.js å†™å…¥æ–‡ä»¶</font></h2>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line">const content = &apos;ä¸€äº›å†…å®¹&apos;</span><br><span class="line"></span><br><span class="line">fs.writeFile(&apos;/Users/joe/test.txt&apos;, content, err =&gt; &#123;</span><br><span class="line">  if (err) &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  //æ–‡ä»¶å†™å…¥æˆåŠŸã€‚</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ­¥çš„ç‰ˆæœ¬ fs.writeFileSync()ï¼š
</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">const content = &apos;ä¸€äº›å†…å®¹&apos;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">  const data = fs.writeFileSync(&apos;/Users/joe/test.txt&apos;, content)</span><br><span class="line">  //æ–‡ä»¶å†™å…¥æˆåŠŸã€‚</span><br><span class="line">&#125; catch (err) &#123;</span><br><span class="line">  console.error(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ API ä¼šæ›¿æ¢æ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼‰ã€‚å¯ä»¥é€šè¿‡æŒ‡å®šæ ‡å¿—æ¥ä¿®æ”¹é»˜è®¤çš„è¡Œä¸ºï¼š
</code></pre>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.writeFile(&apos;/Users/joe/test.txt&apos;, content, &#123; flag: &apos;a+&apos; &#125;, err =&gt; &#123;&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>å¯èƒ½ä¼šä½¿ç”¨çš„æ ‡å¿—æœ‰ï¼š
r+ æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ã€‚
w+ æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ï¼Œå°†æµå®šä½åˆ°æ–‡ä»¶çš„å¼€å¤´ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ã€‚
a æ‰“å¼€æ–‡ä»¶ç”¨äºå†™å…¥ï¼Œå°†æµå®šä½åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ã€‚
a+ æ‰“å¼€æ–‡ä»¶ç”¨äºè¯»å†™ï¼Œå°†æµå®šä½åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶ã€‚
(å¯ä»¥åœ¨ http://nodejs.cn/api/fs.html#fs_file_system_flags ä¸­æŸ¥çœ‹æ›´å¤šæ ‡å¿—)
</code></pre><ul>
<li><p>è¿½åŠ åˆ°æ–‡ä»¶<br>å°†å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾çš„ä¾¿æ·æ–¹æ³•æ˜¯ fs.appendFile()ï¼ˆåŠå…¶å¯¹åº”çš„ fs.appendFileSync()ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const content = &apos;ä¸€äº›å†…å®¹&apos;</span><br><span class="line"></span><br><span class="line">fs.appendFile(&apos;file.log&apos;, content, err =&gt; &#123;</span><br><span class="line">  if (err) &#123;</span><br><span class="line">    console.error(err)</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line">  //å®Œæˆï¼</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨æµ<br>æ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ˜¯åœ¨å°†å…¨éƒ¨å†…å®¹å†™å…¥æ–‡ä»¶ä¹‹åæ‰ä¼šå°†æ§åˆ¶æƒè¿”å›ç»™ç¨‹åºï¼ˆåœ¨å¼‚æ­¥çš„ç‰ˆæœ¬ä¸­ï¼Œè¿™æ„å‘³ç€æ‰§è¡Œå›è°ƒï¼‰ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ›´å¥½çš„é€‰æ‹©æ˜¯ä½¿ç”¨æµå†™å…¥æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<h2 id="Node-js-æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"><a href="#Node-js-æ–‡ä»¶ç³»ç»Ÿæ¨¡å—" class="headerlink" title="Node.js æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"></a><font color="#ff99cc">Node.js æ–‡ä»¶ç³»ç»Ÿæ¨¡å—</font></h2><p>fs æ¨¡å—æä¾›äº†è®¸å¤šéå¸¸å®ç”¨çš„å‡½æ•°æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚<br>æ— éœ€å®‰è£…ã€‚ ä½œä¸º Node.js æ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡ç®€å•åœ°å¼•ç”¨æ¥ä½¿ç”¨å®ƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const fs = require(&apos;fs&apos;)</span><br></pre></td></tr></table></figure>
<p>å…¶æ‰€æœ‰çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š<br>fs.access(): æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠ Node.js æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚<br>fs.appendFile(): è¿½åŠ æ•°æ®åˆ°æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ã€‚<br>fs.chmod(): æ›´æ”¹æ–‡ä»¶ï¼ˆé€šè¿‡ä¼ å…¥çš„æ–‡ä»¶åæŒ‡å®šï¼‰çš„æƒé™ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.lchmod()ã€fs.fchmod()ã€‚<br>fs.chown(): æ›´æ”¹æ–‡ä»¶ï¼ˆé€šè¿‡ä¼ å…¥çš„æ–‡ä»¶åæŒ‡å®šï¼‰çš„æ‰€æœ‰è€…å’Œç¾¤ç»„ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.fchown()ã€fs.lchown()ã€‚<br>fs.close(): å…³é—­æ–‡ä»¶æè¿°ç¬¦ã€‚<br>fs.copyFile(): æ‹·è´æ–‡ä»¶ã€‚<br>fs.createReadStream(): åˆ›å»ºå¯è¯»çš„æ–‡ä»¶æµã€‚<br>fs.createWriteStream(): åˆ›å»ºå¯å†™çš„æ–‡ä»¶æµã€‚<br>fs.link(): æ–°å»ºæŒ‡å‘æ–‡ä»¶çš„ç¡¬é“¾æ¥ã€‚<br>fs.mkdir(): æ–°å»ºæ–‡ä»¶å¤¹ã€‚<br>fs.mkdtemp(): åˆ›å»ºä¸´æ—¶ç›®å½•ã€‚<br>fs.open(): è®¾ç½®æ–‡ä»¶æ¨¡å¼ã€‚<br>fs.readdir(): è¯»å–ç›®å½•çš„å†…å®¹ã€‚<br>fs.readFile(): è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.read()ã€‚<br>fs.readlink(): è¯»å–ç¬¦å·é“¾æ¥çš„å€¼ã€‚<br>fs.realpath(): å°†ç›¸å¯¹çš„æ–‡ä»¶è·¯å¾„æŒ‡é’ˆï¼ˆ.ã€..ï¼‰è§£æä¸ºå®Œæ•´çš„è·¯å¾„ã€‚<br>fs.rename(): é‡å‘½åæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚<br>fs.rmdir(): åˆ é™¤æ–‡ä»¶å¤¹ã€‚<br>fs.stat(): è¿”å›æ–‡ä»¶ï¼ˆé€šè¿‡ä¼ å…¥çš„æ–‡ä»¶åæŒ‡å®šï¼‰çš„çŠ¶æ€ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.fstat()ã€fs.lstat()ã€‚<br>fs.symlink(): æ–°å»ºæ–‡ä»¶çš„ç¬¦å·é“¾æ¥ã€‚<br>fs.truncate(): å°†ä¼ é€’çš„æ–‡ä»¶åæ ‡è¯†çš„æ–‡ä»¶æˆªæ–­ä¸ºæŒ‡å®šçš„é•¿åº¦ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.ftruncate()ã€‚<br>fs.unlink(): åˆ é™¤æ–‡ä»¶æˆ–ç¬¦å·é“¾æ¥ã€‚<br>fs.unwatchFile(): åœæ­¢ç›‘è§†æ–‡ä»¶ä¸Šçš„æ›´æ”¹ã€‚<br>fs.utimes(): æ›´æ”¹æ–‡ä»¶ï¼ˆé€šè¿‡ä¼ å…¥çš„æ–‡ä»¶åæŒ‡å®šï¼‰çš„æ—¶é—´æˆ³ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.futimes()ã€‚<br>fs.watchFile(): å¼€å§‹ç›‘è§†æ–‡ä»¶ä¸Šçš„æ›´æ”¹ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.watch()ã€‚<br>fs.writeFile(): å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚ç›¸å…³æ–¹æ³•ï¼šfs.write()ã€‚</p>
<p>å…³äº fs æ¨¡å—çš„ç‰¹æ®Šä¹‹å¤„æ˜¯ï¼Œæ‰€æœ‰çš„æ–¹æ³•é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯é€šè¿‡åœ¨å‰é¢åŠ ä¸Š Sync ä¹Ÿå¯ä»¥åŒæ­¥åœ°å·¥ä½œã€‚<br>ä¾‹å¦‚ï¼š</p>
<pre><code>fs.rename()
fs.renameSync()
fs.write()
fs.writeSync()
</code></pre><p>è¿™åœ¨åº”ç”¨ç¨‹åºæµç¨‹ä¸­ä¼šäº§ç”Ÿå·¨å¤§çš„å·®å¼‚ã€‚</p>
</li>
</ul>
<h2 id="Node-js-è·¯å¾„æ¨¡å—"><a href="#Node-js-è·¯å¾„æ¨¡å—" class="headerlink" title="Node.js è·¯å¾„æ¨¡å—"></a><font color="#ff99cc">Node.js è·¯å¾„æ¨¡å—</font></h2><p>  path æ¨¡å—æä¾›äº†è®¸å¤šéå¸¸å®ç”¨çš„å‡½æ•°æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚<br>  æ— éœ€å®‰è£…ã€‚ ä½œä¸º Node.js æ ¸å¿ƒçš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡ç®€å•åœ°å¼•ç”¨æ¥ä½¿ç”¨å®ƒï¼š<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;)</span><br></pre></td></tr></table></figure></p>
<p>  è¯¥æ¨¡å—æä¾›äº† path.sepï¼ˆä½œä¸ºè·¯å¾„æ®µåˆ†éš”ç¬¦ï¼Œåœ¨ Windows ä¸Šæ˜¯ \ï¼Œåœ¨ Linux/macOS ä¸Šæ˜¯ /ï¼‰å’Œ path.delimiterï¼ˆä½œä¸ºè·¯å¾„å®šç•Œç¬¦ï¼Œåœ¨ Windows ä¸Šæ˜¯ ;ï¼Œåœ¨ Linux/macOS ä¸Šæ˜¯ :ï¼‰ã€‚</p>
<p>  è¿˜æœ‰è¿™äº› path æ–¹æ³•ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">path.basename()  è¿”å›è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†ã€‚ ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥è¿‡æ»¤æ‰æ–‡ä»¶çš„æ‰©å±•åï¼š</span><br><span class="line">  require(&apos;path&apos;).basename(&apos;/test/something&apos;) //something</span><br><span class="line">  require(&apos;path&apos;).basename(&apos;/test/something.txt&apos;) //something.txt</span><br><span class="line">  require(&apos;path&apos;).basename(&apos;/test/something.txt&apos;, &apos;.txt&apos;) //something</span><br><span class="line"></span><br><span class="line">path.dirname()  è¿”å›è·¯å¾„çš„ç›®å½•éƒ¨åˆ†ï¼š</span><br><span class="line">  require(&apos;path&apos;).dirname(&apos;/test/something&apos;) // /test</span><br><span class="line">  require(&apos;path&apos;).dirname(&apos;/test/something/file.txt&apos;) // /test/something</span><br><span class="line"></span><br><span class="line">path.extname()  è¿”å›è·¯å¾„çš„æ‰©å±•åéƒ¨åˆ†ã€‚</span><br><span class="line">  require(&apos;path&apos;).extname(&apos;/test/something&apos;) // &apos;&apos;</span><br><span class="line">  require(&apos;path&apos;).extname(&apos;/test/something/file.txt&apos;) // &apos;.txt&apos;</span><br><span class="line"></span><br><span class="line">path.isAbsolute()  å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ï¼Œåˆ™è¿”å› trueã€‚</span><br><span class="line">  require(&apos;path&apos;).isAbsolute(&apos;/test/something&apos;) // true</span><br><span class="line">  require(&apos;path&apos;).isAbsolute(&apos;./test/something&apos;) // false</span><br><span class="line"></span><br><span class="line">path.join()  è¿æ¥è·¯å¾„çš„ä¸¤ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†ï¼š</span><br><span class="line">  const name = &apos;joe&apos;</span><br><span class="line">  require(&apos;path&apos;).join(&apos;/&apos;, &apos;users&apos;, name, &apos;notes.txt&apos;) //&apos;/users/joe/notes.txt&apos;</span><br><span class="line"></span><br><span class="line">path.normalize()  å½“åŒ…å«ç±»ä¼¼ .ã€.. æˆ–åŒæ–œæ ç­‰ç›¸å¯¹çš„è¯´æ˜ç¬¦æ—¶ï¼Œåˆ™å°è¯•è®¡ç®—å®é™…çš„è·¯å¾„ï¼š</span><br><span class="line">  require(&apos;path&apos;).normalize(&apos;/users/joe/..//test.txt&apos;) //&apos;/users/test.txt&apos;</span><br><span class="line"></span><br><span class="line">path.parse()</span><br><span class="line">  è§£æå¯¹è±¡çš„è·¯å¾„ä¸ºç»„æˆå…¶çš„ç‰‡æ®µï¼š</span><br><span class="line">    root: æ ¹è·¯å¾„ã€‚</span><br><span class="line">    dir: ä»æ ¹è·¯å¾„å¼€å§‹çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚</span><br><span class="line">    base: æ–‡ä»¶å + æ‰©å±•å</span><br><span class="line">    name: æ–‡ä»¶å</span><br><span class="line">    ext: æ–‡ä»¶æ‰©å±•å</span><br><span class="line">  </span><br><span class="line">  require(&apos;path&apos;).parse(&apos;/users/test.txt&apos;)</span><br><span class="line">    ç»“æœæ˜¯ï¼š</span><br><span class="line">    &#123;</span><br><span class="line">      root: &apos;/&apos;,</span><br><span class="line">      dir: &apos;/users&apos;,</span><br><span class="line">      base: &apos;test.txt&apos;,</span><br><span class="line">      ext: &apos;.txt&apos;,</span><br><span class="line">      name: &apos;test&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">path.relative() æ¥å— 2 ä¸ªè·¯å¾„ä½œä¸ºå‚æ•°ã€‚ åŸºäºå½“å‰å·¥ä½œç›®å½•ï¼Œè¿”å›ä»ç¬¬ä¸€ä¸ªè·¯å¾„åˆ°ç¬¬äºŒä¸ªè·¯å¾„çš„ç›¸å¯¹è·¯å¾„ã€‚</span><br><span class="line">  require(&apos;path&apos;).relative(&apos;/Users/joe&apos;, &apos;/Users/joe/test.txt&apos;) //&apos;test.txt&apos;</span><br><span class="line">  require(&apos;path&apos;).relative(&apos;/Users/joe&apos;, &apos;/Users/joe/something/test.txt&apos;) //&apos;something/test.txt&apos;</span><br><span class="line"></span><br><span class="line">path.resolve() å¯ä»¥ä½¿ç”¨ path.resolve() è·å¾—ç›¸å¯¹è·¯å¾„çš„ç»å¯¹è·¯å¾„è®¡ç®—ï¼š</span><br><span class="line">  path.resolve(&apos;joe.txt&apos;) //&apos;/Users/joe/joe.txt&apos; å¦‚æœä»ä¸»æ–‡ä»¶å¤¹è¿è¡Œ</span><br><span class="line"> </span><br><span class="line">  é€šè¿‡æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ï¼Œresolve ä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°çš„åŸºå‡†ï¼š</span><br><span class="line">  path.resolve(&apos;tmp&apos;, &apos;joe.txt&apos;) //&apos;/Users/joe/tmp/joe.txt&apos; å¦‚æœä»ä¸»æ–‡ä»¶å¤¹è¿è¡Œ</span><br><span class="line">   </span><br><span class="line">  å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä»¥æ–œæ å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯ç»å¯¹è·¯å¾„ï¼š</span><br><span class="line">  path.resolve(&apos;/etc&apos;, &apos;joe.txt&apos;) //&apos;/etc/joe.txt&apos;</span><br></pre></td></tr></table></figure></p>
<h2 id="Node-js-æ“ä½œç³»ç»Ÿæ¨¡å—"><a href="#Node-js-æ“ä½œç³»ç»Ÿæ¨¡å—" class="headerlink" title="Node.js æ“ä½œç³»ç»Ÿæ¨¡å—"></a><font color="#ff99cc">Node.js æ“ä½œç³»ç»Ÿæ¨¡å—</font></h2><pre><code>è¯¥æ¨¡å—æä¾›äº†è®¸å¤šå‡½æ•°ï¼Œå¯ç”¨äºä»åº•å±‚çš„æ“ä½œç³»ç»Ÿå’Œç¨‹åºè¿è¡Œæ‰€åœ¨çš„è®¡ç®—æœºä¸Šæ£€ç´¢ä¿¡æ¯å¹¶ä¸å…¶è¿›è¡Œäº¤äº’ã€‚
  os.arch()
  os.cpus()
  os.endianness()
  os.freemem()
  os.homedir()
  os.hostname()
  os.loadavg()
  os.networkInterfaces()
  os.platform()
  os.release()
  os.tmpdir()
  os.totalmem()
  os.type()
  os.uptime()
  os.userInfo()
</code></pre><h2 id="Node-js-äº‹ä»¶æ¨¡å—"><a href="#Node-js-äº‹ä»¶æ¨¡å—" class="headerlink" title="Node.js äº‹ä»¶æ¨¡å—"></a><font color="#ff99cc">Node.js äº‹ä»¶æ¨¡å—</font></h2><pre><code>events æ¨¡å—ä¸ºæä¾›äº† EventEmitter ç±»ï¼Œè¿™æ˜¯åœ¨ Node.js ä¸­å¤„ç†äº‹ä»¶çš„å…³é”®ã€‚
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const EventEmitter = require(&apos;events&apos;)</span><br><span class="line">const emitter = new EventEmitter()</span><br></pre></td></tr></table></figure>

  emitter.addListener()
  emitter.emit()
  emitter.eventNames()
  emitter.getMaxListeners()
  emitter.listenerCount()
  emitter.listeners()
  emitter.off()
  emitter.on()
  emitter.once()
  emitter.prependListener()
  emitter.prependOnceListener()
  emitter.removeAllListeners()
  emitter.removeListener()
  emitter.setMaxListeners()
</code></pre><h2 id="Node-js-http-æ¨¡å—"><a href="#Node-js-http-æ¨¡å—" class="headerlink" title="Node.js http æ¨¡å—"></a><font color="#ff99cc">Node.js http æ¨¡å—</font></h2><pre><code>HTTP æ ¸å¿ƒæ¨¡å—æ˜¯ Node.js ç½‘ç»œçš„å…³é”®æ¨¡å—ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;)</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="Node-js-Buffer"><a href="#Node-js-Buffer" class="headerlink" title="Node.js Buffer"></a><font color="#ff99cc">Node.js Buffer</font></h2><pre><code>Buffer æ˜¯å†…å­˜åŒºåŸŸï¼Œç”± Node.js Buffer ç±»å®ç°ã€‚ å®ƒè¡¨ç¤ºåœ¨ V8 JavaScript å¼•æ“å¤–éƒ¨åˆ†é…çš„å›ºå®šå¤§å°çš„å†…å­˜å—ï¼ˆæ— æ³•è°ƒæ•´å¤§å°ï¼‰ã€‚

Buffer ä¸æµç´§å¯†ç›¸è¿ã€‚ å½“æµå¤„ç†å™¨æ¥æ”¶æ•°æ®çš„é€Ÿåº¦å¿«äºå…¶æ¶ˆåŒ–çš„é€Ÿåº¦æ—¶ï¼Œåˆ™ä¼šå°†æ•°æ®æ”¾å…¥ buffer ä¸­ã€‚

- åˆ›å»ºbufferï¼š
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Buffer.from()ã€Buffer.alloc() å’Œ Buffer.allocUnsafe() æ–¹æ³•å¯ä»¥åˆ›å»º bufferã€‚</span><br><span class="line">  const buf = Buffer.from(&apos;Hey!&apos;)</span><br><span class="line">  Buffer.from(array)</span><br><span class="line">  Buffer.from(arrayBuffer[, byteOffset[, length]])</span><br><span class="line">  Buffer.from(buffer)</span><br><span class="line">  Buffer.from(string[, encoding])</span><br><span class="line">  </span><br><span class="line">ä¹Ÿå¯ä»¥åªåˆå§‹åŒ– bufferï¼ˆä¼ å…¥å¤§å°ï¼‰ã€‚ ä»¥ä¸‹ä¼šåˆ›å»ºä¸€ä¸ª 1KB çš„ bufferï¼š</span><br><span class="line">  const buf = Buffer.alloc(1024)</span><br><span class="line">  //æˆ–</span><br><span class="line">  const buf = Buffer.allocUnsafe(1024) </span><br><span class="line"></span><br><span class="line">ï¼ˆallocUnsafe ä¸å®‰å…¨çš„åŸå› ï¼Œåœ¨ä½¿ç”¨å®ƒæ—¶å¿…é¡»æ ¼å¤–å°å¿ƒã€‚ï¼‰</span><br></pre></td></tr></table></figure>

  &lt;div class=&apos;post-warning&apos;&gt;æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨æ•°å­—ï¼ˆè®¾ç½®å…¶å¤§å°ï¼‰åˆå§‹åŒ– bufferï¼Œåˆ™å¯ä»¥è®¿é—®åˆ°åŒ…å«éšæœºæ•°æ®çš„å·²é¢„åˆå§‹åŒ–çš„å†…å­˜ï¼ˆè€Œä¸æ˜¯ç©ºçš„ bufferï¼‰&lt;/div&gt;

- ä½¿ç”¨ buffer
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Bufferï¼ˆå­—èŠ‚æ•°ç»„ï¼‰å¯ä»¥åƒæ•°ç»„ä¸€æ ·è¢«è®¿é—®ï¼š</span><br><span class="line">  const buf = Buffer.from(&apos;Hey!&apos;)</span><br><span class="line">  buf[0] //72   Unicode ç </span><br><span class="line">  buf[1] //101  Unicode ç </span><br><span class="line">  buf[2] //121  Unicode ç </span><br><span class="line">  buf.toString()  // Hey!</span><br><span class="line"></span><br><span class="line">è·å– buffer çš„é•¿åº¦ï¼šbuf.length // 4</span><br><span class="line"></span><br><span class="line">éå† buffer çš„å†…å®¹ï¼š</span><br><span class="line">  for (const item of buf) &#123;</span><br><span class="line">    console.log(item) //72 101 121 33</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">æ›´æ”¹ buffer çš„å†…å®¹ï¼š</span><br><span class="line">  const buf = Buffer.alloc(4)</span><br><span class="line">  buf.write(&apos;Hey!&apos;)</span><br><span class="line">  æˆ–</span><br><span class="line">  buf[1] = 111 //o</span><br><span class="line">  console.log(buf.toString()) //Hoy</span><br><span class="line"></span><br><span class="line">å¤åˆ¶ bufferï¼š</span><br><span class="line">  const buf = Buffer.from(&apos;Hey!&apos;)</span><br><span class="line">  let bufcopy = Buffer.alloc(4) //åˆ†é… 4 ä¸ªå­—èŠ‚ã€‚</span><br><span class="line">  buf.copy(bufcopy)</span><br><span class="line">  bufcopy.toString()  // &apos;Hey!&apos;</span><br><span class="line"></span><br><span class="line">  é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šå¤åˆ¶æ•´ä¸ª bufferã€‚ å¦å¤–çš„ 3 ä¸ªå‚æ•°å¯ä»¥å®šä¹‰å¼€å§‹ä½ç½®ã€ç»“æŸä½ç½®ã€ä»¥åŠæ–°çš„ buffer é•¿åº¦ï¼š</span><br><span class="line">  const buf = Buffer.from(&apos;Hey!&apos;)</span><br><span class="line">  let bufcopy = Buffer.alloc(2) //åˆ†é… 2 ä¸ªå­—èŠ‚ã€‚</span><br><span class="line">  buf.copy(bufcopy, 0, 0, 2)</span><br><span class="line">  bufcopy.toString() //&apos;He&apos;</span><br><span class="line"></span><br><span class="line">åˆ‡ç‰‡ buffer</span><br><span class="line">  å¦‚æœè¦åˆ›å»º buffer çš„å±€éƒ¨è§†å›¾ï¼Œåˆ™å¯ä»¥åˆ›å»ºåˆ‡ç‰‡ã€‚ åˆ‡ç‰‡ä¸æ˜¯å‰¯æœ¬ï¼šåŸå§‹ buffer ä»ç„¶æ˜¯çœŸæ­£çš„æ¥æºã€‚ å¦‚æœé‚£æ”¹å˜äº†ï¼Œåˆ™åˆ‡ç‰‡ä¹Ÿä¼šæ”¹å˜ã€‚</span><br><span class="line">  ä½¿ç”¨ slice() æ–¹æ³•åˆ›å»ºå®ƒã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èµ·å§‹ä½ç½®ï¼Œå¯ä»¥æŒ‡å®šç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºç»“æŸä½ç½®ï¼š</span><br><span class="line"></span><br><span class="line">  const buf = Buffer.from(&apos;Hey!&apos;)</span><br><span class="line">  buf.slice(0).toString() //Hey!</span><br><span class="line">  const slice = buf.slice(0, 2)</span><br><span class="line">  console.log(slice.toString()) //He</span><br><span class="line">  buf[1] = 111 //o</span><br><span class="line">  console.log(slice.toString()) //Ho</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="Node-js-æµ"><a href="#Node-js-æµ" class="headerlink" title="Node.js æµ"></a><font color="#ff99cc">Node.js æµ</font></h2><h3 id="ä»€ä¹ˆæ˜¯æµ"><a href="#ä»€ä¹ˆæ˜¯æµ" class="headerlink" title="ä»€ä¹ˆæ˜¯æµ"></a>ä»€ä¹ˆæ˜¯æµ</h3><pre><code>æµæ˜¯ä¸ºNode.jsåº”ç”¨ç¨‹åºæä¾›åŠ¨åŠ›çš„åŸºæœ¬æ¦‚å¿µä¹‹ä¸€ã€‚å®ƒä»¬æ˜¯ä¸€ç§ä»¥é«˜æ•ˆçš„æ–¹å¼å¤„ç†è¯»/å†™æ–‡ä»¶ï¼Œç½‘ç»œé€šä¿¡ï¼Œæˆ–ä»»ä½•ç±»å‹çš„ç«¯åˆ°ç«¯çš„ä¿¡æ¯äº¤æ¢ã€‚
æµä¸æ˜¯Nodejsç‰¹æœ‰çš„æ¦‚å¿µã€‚å®ƒä»¬æ˜¯å‡ åå¹´å‰åœ¨Unixæ“ä½œç³»ç»Ÿä¸­å¼•å…¥çš„ï¼Œç¨‹åºå¯ä»¥é€šè¿‡ç®¡é“è¿ç®—ç¬¦ï¼ˆ|ï¼‰å¯¹æµè¿›è¡Œç›¸äº’äº¤äº’ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¼ ç»Ÿçš„æ–¹å¼ä¸­ï¼Œå½“å‘Šè¯‰ç¨‹åºè¯»å–æ–‡ä»¶æ—¶ï¼Œè¿™ä¼šå°†æ–‡ä»¶ä»å¤´åˆ°å°¾è¯»å…¥å†…å­˜ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚ä½¿ç”¨æµï¼Œåˆ™å¯ä»¥é€ä¸ªç‰‡æ®µåœ°è¯»å–ã€‚

Node.jsçš„ Stream æ¨¡å— æä¾›äº†æ„å»ºæ‰€æœ‰æµ API çš„åŸºç¡€ã€‚æ‰€æœ‰çš„æµéƒ½æ˜¯ EventEmitter çš„å®ä¾‹ã€‚

ç›¸å¯¹äºå…¶ä»–çš„æ•°æ®å¤„ç†æ–¹å¼ï¼Œæµå…·æœ‰ä¸¤å¤§ä¼˜ç‚¹ï¼š
1ï¼‰å†…å­˜æ•ˆç‡ï¼šæ— éœ€åŠ è½½å¤§é‡çš„æ•°æ®åˆ°å†…å­˜å°±å¯ä»¥è¿›è¡Œå¤„ç†ã€‚
2ï¼‰æ—¶é—´æ•ˆç‡ï¼šå½“è·å¾—æ•°æ®ä¹‹åå³å¯ç«‹å³å¼€å§‹å¤„ç†æ•°æ®ï¼Œè¿™æ ·æ‰€éœ€çš„æ—¶é—´æ›´æ˜¯ï¼Œè€Œä¸å¿…ç­‰åˆ°æ•´ä¸ªæ•°æ®çš„æœ‰æ•ˆè´Ÿè½½å¯ç”¨æ‰å¼€å§‹ã€‚
</code></pre><h3 id="æµçš„ç¤ºä¾‹"><a href="#æµçš„ç¤ºä¾‹" class="headerlink" title="æµçš„ç¤ºä¾‹"></a>æµçš„ç¤ºä¾‹</h3><pre><code>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯ä»ç£ç›˜è¯»å–æ–‡ä»¶ã€‚

- ä½¿ç”¨ Node.js çš„ fs æ¨¡å—ï¼Œå¯ä»¥è¯»å–æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸ HTTP æœåŠ¡å™¨å»ºç«‹æ–°è¿æ¥æ—¶é€šè¿‡ HTTP æä¾›æ–‡ä»¶ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;)</span><br><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">const server = http.createServer(function(req, res) &#123;</span><br><span class="line">  fs.readFile(__dirname + &apos;/data.txt&apos;, (err, data) =&gt; &#123;</span><br><span class="line">    res.end(data)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(3000)</span><br></pre></td></tr></table></figure>

  readFile() è¯»å–æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼Œå¹¶åœ¨å®Œæˆæ—¶è°ƒç”¨å›è°ƒå‡½æ•°ã€‚å›è°ƒä¸­çš„ res.end(data) ä¼šè¿”å›æ–‡ä»¶çš„å†…å®¹ç»™ HTTP å®¢æˆ·ç«¯ã€‚

- å¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼Œåˆ™è¯¥æ“ä½œä¼šèŠ±è´¹è¾ƒå¤šçš„æ—¶é—´ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨æµç¼–å†™çš„ç›¸åŒå†…å®¹ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const http = require(&apos;http&apos;)</span><br><span class="line">const fs = require(&apos;fs&apos;)</span><br><span class="line"></span><br><span class="line">const server = http.createServer((req, res) =&gt; &#123;</span><br><span class="line">  const stream = fs.createReadStream(__dirname + &apos;/data.txt&apos;)</span><br><span class="line">  stream.pipe(res)</span><br><span class="line">&#125;)</span><br><span class="line">server.listen(3000)</span><br></pre></td></tr></table></figure>

  å½“è¦å‘é€çš„æ•°æ®å—å·²è·å¾—æ—¶å°±ç«‹å³å¼€å§‹å°†å…¶æµå¼ä¼ è¾“åˆ° HTTP å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç›´åˆ°æ–‡ä»¶è¢«å®Œå…¨è¯»å–ã€‚
</code></pre><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><pre><code>- pipe()
  å®ƒæ˜¯è·å–æ¥æºæµï¼Œå¹¶å°†å…¶é€šè¿‡ç®¡é“ä¼ è¾“åˆ°ç›®æ ‡æµã€‚

  åœ¨æ¥æºæµä¸Šè°ƒç”¨pipe()ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ–‡ä»¶æµé€šè¿‡ç®¡é“ä¼ è¾“åˆ°HTTPå“åº”ã€‚
  pipe()è¿”å›çš„æ˜¯ç›®æ ‡æµï¼Œå¯ä»¥é“¾å¼è°ƒç”¨ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src.pipe(dest1).pipe(dest2)</span><br><span class="line">æ­¤æ„é€ ç›¸å¯¹äºï¼š</span><br><span class="line"></span><br><span class="line">src.pipe(dest1)</span><br><span class="line">dest1.pipe(dest2)</span><br></pre></td></tr></table></figure>

- æµé©±åŠ¨çš„ Node.js API
  ç”±äºå®ƒä»¬çš„ä¼˜ç‚¹ï¼Œè®¸å¤š Node.js æ ¸å¿ƒæ¨¡å—æä¾›äº†åŸç”Ÿçš„æµå¤„ç†åŠŸèƒ½ï¼Œæœ€å€¼å¾—æ³¨æ„çš„æœ‰ï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">process.stdin è¿”å›è¿æ¥åˆ° stdin çš„æµã€‚</span><br><span class="line">process.stdout è¿”å›è¿æ¥åˆ° stdout çš„æµã€‚</span><br><span class="line">process.stderr è¿”å›è¿æ¥åˆ° stderr çš„æµã€‚</span><br><span class="line">fs.createReadStream() åˆ›å»ºæ–‡ä»¶çš„å¯è¯»æµã€‚</span><br><span class="line">fs.createWriteStream() åˆ›å»ºåˆ°æ–‡ä»¶çš„å¯å†™æµã€‚</span><br><span class="line">net.connect() å¯åŠ¨åŸºäºæµçš„è¿æ¥ã€‚</span><br><span class="line">http.request() è¿”å› http.ClientRequest ç±»çš„å®ä¾‹ï¼Œè¯¥å®ä¾‹æ˜¯å¯å†™æµã€‚</span><br><span class="line">zlib.createGzip() ä½¿ç”¨ gzipï¼ˆå‹ç¼©ç®—æ³•ï¼‰å°†æ•°æ®å‹ç¼©åˆ°æµä¸­ã€‚</span><br><span class="line">zlib.createGunzip() è§£å‹ç¼© gzip æµã€‚</span><br><span class="line">zlib.createDeflate() ä½¿ç”¨ deflateï¼ˆå‹ç¼©ç®—æ³•ï¼‰å°†æ•°æ®å‹ç¼©åˆ°æµä¸­ã€‚</span><br><span class="line">zlib.createInflate() è§£å‹ç¼© deflate æµã€‚</span><br></pre></td></tr></table></figure>

- æµåˆ†ä¸ºå››ç±»ï¼š
  Readable: å¯ä»¥é€šè¿‡ç®¡é“è¯»å–ã€ä½†ä¸èƒ½é€šè¿‡ç®¡é“å†™å…¥çš„æµï¼ˆå¯ä»¥æ¥æ”¶æ•°æ®ï¼Œä½†ä¸èƒ½å‘å…¶å‘é€æ•°æ®ï¼‰ã€‚ å½“æ¨é€æ•°æ®åˆ°å¯è¯»æµä¸­æ—¶ï¼Œä¼šå¯¹å…¶è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°ä½¿ç”¨è€…å¼€å§‹è¯»å–æ•°æ®ä¸ºæ­¢ã€‚
  Writable: å¯ä»¥é€šè¿‡ç®¡é“å†™å…¥ã€ä½†ä¸èƒ½é€šè¿‡ç®¡é“è¯»å–çš„æµï¼ˆå¯ä»¥å‘é€æ•°æ®ï¼Œä½†ä¸èƒ½ä»ä¸­æ¥æ”¶æ•°æ®ï¼‰ã€‚
  Duplex: å¯ä»¥é€šè¿‡ç®¡é“å†™å…¥å’Œè¯»å–çš„æµï¼ŒåŸºæœ¬ä¸Šç›¸å¯¹äºæ˜¯å¯è¯»æµå’Œå¯å†™æµçš„ç»„åˆã€‚
  Transform: ç±»ä¼¼äºåŒå·¥æµã€ä½†å…¶è¾“å‡ºæ˜¯å…¶è¾“å…¥çš„è½¬æ¢çš„è½¬æ¢æµã€‚

- åˆ›å»ºå¯è¯»æµï¼š
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const Stream = require(&apos;stream&apos;)</span><br><span class="line">const readableStream = new Stream.Readable()</span><br><span class="line"></span><br><span class="line">readableStream._read = () =&gt; &#123;&#125;</span><br><span class="line">æˆ–</span><br><span class="line">const readableStream = new Stream.Readable(&#123;</span><br><span class="line">  read() &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ç°åœ¨ï¼Œæµå·²åˆå§‹åŒ–ï¼Œå¯ä»¥å‘å…¶å‘é€æ•°æ®äº†ï¼š</span><br><span class="line">readableStream.push(&apos;hi!&apos;)</span><br><span class="line">readableStream.push(&apos;ho!&apos;)</span><br></pre></td></tr></table></figure>

- åˆ›å»ºå¯å†™æµ
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const Stream = require(&apos;stream&apos;)</span><br><span class="line">const writableStream = new Stream.Writable()</span><br><span class="line"></span><br><span class="line">writableStream._write = (chunk, encoding, next) =&gt; &#123;</span><br><span class="line">  console.log(chunk.toString())</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ç°åœ¨ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼ è¾“å¯è¯»æµï¼š</span><br><span class="line">process.stdin.pipe(writableStream)</span><br></pre></td></tr></table></figure>

- ä»å¯è¯»æµä¸­è·å–æ•°æ®
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const Stream = require(&apos;stream&apos;)</span><br><span class="line">const readableStream = new Stream.Readable(&#123;</span><br><span class="line">  read() &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line">const writableStream = new Stream.Writable()</span><br><span class="line"></span><br><span class="line">writableStream._write = (chunk, encoding, next) =&gt; &#123;</span><br><span class="line">  console.log(chunk.toString())</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readableStream.pipe(writableStream)</span><br><span class="line"></span><br><span class="line">readableStream.push(&apos;hi!&apos;)</span><br><span class="line">readableStream.push(&apos;ho!&apos;)</span><br><span class="line">ä¹Ÿå¯ä»¥ä½¿ç”¨ readable äº‹ä»¶ç›´æ¥åœ°æ¶ˆè´¹å¯è¯»æµï¼š</span><br><span class="line"></span><br><span class="line">readableStream.on(&apos;readable&apos;, () =&gt; &#123;</span><br><span class="line">  console.log(readableStream.read())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

- å‘é€æ•°æ®åˆ°å¯å†™æµ
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">writableStream.write(&apos;hey!\n&apos;)</span><br></pre></td></tr></table></figure>

- ä½¿ç”¨ä¿¡å·é€šçŸ¥å·²ç»“æŸå†™å…¥çš„å¯å†™æµ
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const Stream = require(&apos;stream&apos;)</span><br><span class="line"></span><br><span class="line">const readableStream = new Stream.Readable(&#123;</span><br><span class="line">  read() &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line">const writableStream = new Stream.Writable()</span><br><span class="line"></span><br><span class="line">writableStream._write = (chunk, encoding, next) =&gt; &#123;</span><br><span class="line">  console.log(chunk.toString())</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readableStream.pipe(writableStream)</span><br><span class="line"></span><br><span class="line">readableStream.push(&apos;hi!&apos;)</span><br><span class="line">readableStream.push(&apos;ho!&apos;)</span><br><span class="line"></span><br><span class="line">writableStream.end()</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="Node-js-å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ«"><a href="#Node-js-å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ«" class="headerlink" title="Node.js å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ«"></a><font color="#ff99cc">Node.js å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ«</font></h2><pre><code>æ­¤ç¯å¢ƒå˜é‡æ˜¯ä¸€ä¸ªçº¦å®šï¼Œåœ¨å¤–éƒ¨åº“ä¸­ä¹Ÿå¹¿æ³›ä½¿ç”¨ã€‚

è®¾ç½®ç¯å¢ƒä¸º production é€šå¸¸å¯ä»¥ç¡®ä¿ï¼š
- æ—¥å¿—è®°å½•ä¿æŒåœ¨æœ€ä½æ°´å¹³ã€‚
- æ›´é«˜çš„ç¼“å­˜çº§åˆ«ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚

æœ€å¥½å°†å…¶æ”¾åœ¨çš„ shell é…ç½®æ–‡ä»¶ä¸­ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ Bash shell çš„ .bash_profileï¼‰ï¼Œå¦åˆ™å½“ç³»ç»Ÿé‡å¯æ—¶ï¼Œè¯¥è®¾ç½®ä¸ä¼šè¢«ä¿ç•™ã€‚
ä¹Ÿå¯ä»¥é€šè¿‡å°†ç¯å¢ƒå˜é‡æ”¾åœ¨åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–å‘½ä»¤ä¹‹å‰æ¥åº”ç”¨å®ƒï¼šNODE_ENV=production node app.js

å¯ä»¥ä½¿ç”¨æ¡ä»¶è¯­å¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­æ‰§è¡Œä»£ç ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (process.env.NODE_ENV === &quot;development&quot;) &#123;</span><br><span class="line">  //...</span><br><span class="line">&#125;</span><br><span class="line">if (process.env.NODE_ENV === &quot;production&quot;) &#123;</span><br><span class="line">  //...</span><br><span class="line">&#125;</span><br><span class="line">if([&apos;production&apos;, &apos;staging&apos;].indexOf(process.env.NODE_ENV) &gt;= 0) &#123;</span><br><span class="line">  //...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


ä¾‹å¦‚ï¼Œåœ¨ Express åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å·¥å…·ä¸ºæ¯ä¸ªç¯å¢ƒè®¾ç½®ä¸åŒçš„é”™è¯¯å¤„ç†ç¨‹åºï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (process.env.NODE_ENV === &quot;development&quot;) &#123;</span><br><span class="line">  app.use(express.errorHandler(&#123; dumpExceptions: true, showStack: true &#125;))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">if (process.env.NODE_ENV === &quot;production&quot;) &#123;</span><br><span class="line">  app.use(express.errorHandler())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="Node-js-ä¸­çš„é”™è¯¯å¤„ç†"><a href="#Node-js-ä¸­çš„é”™è¯¯å¤„ç†" class="headerlink" title="Node.js ä¸­çš„é”™è¯¯å¤„ç†"></a><font color="#ff99cc">Node.js ä¸­çš„é”™è¯¯å¤„ç†</font></h2><h3 id="åˆ›å»ºå¼‚å¸¸"><a href="#åˆ›å»ºå¼‚å¸¸" class="headerlink" title="åˆ›å»ºå¼‚å¸¸"></a>åˆ›å»ºå¼‚å¸¸</h3><pre><code>ä½¿ç”¨ throw å…³é”®å­—åˆ›å»ºå¼‚å¸¸ï¼šthrow value
ä¸€æ—¦ JavaScript æ‰§è¡Œåˆ°æ­¤è¡Œï¼Œåˆ™å¸¸è§„çš„ç¨‹åºæµä¼šè¢«åœæ­¢ï¼Œä¸”æ§åˆ¶ä¼šè¢«äº¤ç»™æœ€è¿‘çš„å¼‚å¸¸å¤„ç†ç¨‹åºã€‚

é€šå¸¸ï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œvalue å¯ä»¥æ˜¯ä»»ä½• JavaScript å€¼ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²ã€æ•°å­—ã€æˆ–å¯¹è±¡ï¼‰ã€‚
åœ¨ Node.js ä¸­ï¼Œæˆ‘ä»¬ä¸æŠ›å‡ºå­—ç¬¦ä¸²ï¼Œè€Œä»…æŠ›å‡º Error å¯¹è±¡ã€‚
</code></pre><h3 id="é”™è¯¯å¯¹è±¡"><a href="#é”™è¯¯å¯¹è±¡" class="headerlink" title="é”™è¯¯å¯¹è±¡"></a>é”™è¯¯å¯¹è±¡</h3><pre><code>é”™è¯¯å¯¹è±¡æ˜¯ Error å¯¹è±¡çš„å®ä¾‹ã€æˆ–è€…ç»§æ‰¿è‡ª Error ç±»ï¼ˆç”± Error æ ¸å¿ƒæ¨¡å—æä¾›ï¼‰ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">throw new Error(&apos;é”™è¯¯ä¿¡æ¯&apos;)</span><br><span class="line">æˆ–ï¼š</span><br><span class="line"></span><br><span class="line">class NotEnoughCoffeeError extends Error &#123;</span><br><span class="line">  //...</span><br><span class="line">&#125;</span><br><span class="line">throw new NotEnoughCoffeeError()</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="å¤„ç†å¼‚å¸¸"><a href="#å¤„ç†å¼‚å¸¸" class="headerlink" title="å¤„ç†å¼‚å¸¸"></a>å¤„ç†å¼‚å¸¸</h3><pre><code>å¼‚å¸¸å¤„ç†ç¨‹åºæ˜¯ try/catch è¯­å¥ã€‚
</code></pre><h3 id="æ•è·æœªæ•è·çš„å¼‚å¸¸"><a href="#æ•è·æœªæ•è·çš„å¼‚å¸¸" class="headerlink" title="æ•è·æœªæ•è·çš„å¼‚å¸¸"></a>æ•è·æœªæ•è·çš„å¼‚å¸¸</h3><pre><code>å¦‚æœåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¼•å‘äº†æœªæ•è·çš„å¼‚å¸¸ï¼Œåˆ™ç¨‹åºä¼šå´©æºƒã€‚

è‹¥è¦è§£å†³æ­¤é—®é¢˜ï¼Œåˆ™ç›‘å¬ process å¯¹è±¡ä¸Šçš„ uncaughtException äº‹ä»¶ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">process.on(&apos;uncaughtException&apos;, err =&gt; &#123;</span><br><span class="line">  console.error(&apos;æœ‰ä¸€ä¸ªæœªæ•è·çš„é”™è¯¯&apos;, err)</span><br><span class="line">  process.exit(1) //å¼ºåˆ¶æ€§çš„ï¼ˆæ ¹æ® Node.js æ–‡æ¡£ï¼‰</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

æ— éœ€ä¸ºæ­¤å¯¼å…¥ process æ ¸å¿ƒæ¨¡å—ï¼Œå› ä¸ºå®ƒæ˜¯è‡ªåŠ¨æ³¨å…¥çš„ã€‚
</code></pre><h3 id="Promise-çš„å¼‚å¸¸"><a href="#Promise-çš„å¼‚å¸¸" class="headerlink" title="Promise çš„å¼‚å¸¸"></a>Promise çš„å¼‚å¸¸</h3><ul>
<li>ä½¿ç”¨ promise å¯ä»¥é“¾æ¥ä¸åŒçš„æ“ä½œï¼Œå¹¶åœ¨æœ€åå¤„ç†é”™è¯¯ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">doSomething1()</span><br><span class="line">  .then(doSomething2)</span><br><span class="line">  .then(doSomething3)</span><br><span class="line">  .catch(err =&gt; console.error(err))</span><br><span class="line">ä½ æ€ä¹ˆçŸ¥é“é”™è¯¯å‘ç”Ÿåœ¨å“ªé‡Œï¼Ÿ ä½ å¹¶ä¸çŸ¥é“ï¼Œä½†æ˜¯ä½ å¯ä»¥å¤„ç†æ‰€è°ƒç”¨çš„æ¯ä¸ªå‡½æ•°ï¼ˆdoSomethingXï¼‰ä¸­çš„é”™è¯¯ï¼Œå¹¶ä¸”åœ¨é”™è¯¯å¤„ç†ç¨‹åºå†…éƒ¨æŠ›å‡ºæ–°çš„é”™è¯¯ï¼Œè¿™å°±ä¼šè°ƒç”¨å¤–éƒ¨çš„ catch å¤„ç†ç¨‹åºï¼š</span><br><span class="line"></span><br><span class="line">const doSomething1 = () =&gt; &#123;</span><br><span class="line">  //...</span><br><span class="line">  try &#123;</span><br><span class="line">    //...</span><br><span class="line">  &#125; catch (err) &#123;</span><br><span class="line">    //... åœ¨æœ¬åœ°å¤„ç†</span><br><span class="line">    throw new Error(err.message)</span><br><span class="line">  &#125;</span><br><span class="line">  //...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code>- ä¸ºäº†èƒ½å¤Ÿåœ¨æœ¬åœ°ï¼ˆè€Œä¸æ˜¯åœ¨è°ƒç”¨çš„å‡½æ•°ä¸­ï¼‰å¤„ç†é”™è¯¯ï¼Œåˆ™å¯ä»¥æ–­å¼€é“¾æ¡ï¼Œåœ¨æ¯ä¸ª then() å‡½æ•°ä¸­åˆ›å»ºå‡½æ•°å¹¶å¤„ç†å¼‚å¸¸ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">doSomething1()</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    return doSomething2().catch(err =&gt; &#123;</span><br><span class="line">      //å¤„ç†é”™è¯¯</span><br><span class="line">      throw err //æ‰“æ–­é“¾æ¡</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    return doSomething2().catch(err =&gt; &#123;</span><br><span class="line">      //å¤„ç†é”™è¯¯</span><br><span class="line">      throw err //æ‰“æ–­é“¾æ¡</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(err =&gt; console.error(err))</span><br></pre></td></tr></table></figure>

### async/await çš„é”™è¯¯å¤„ç†
  ä½¿ç”¨ async/await æ—¶ï¼Œä»ç„¶éœ€è¦æ•è·é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ“ä½œï¼š

  async function someFunction() {
    try {
      await someOtherFunction()
    } catch (err) {
      console.error(err.message)
    }
  }
</code></pre><h2 id="åœ¨-Node-js-ä¸­å¦‚ä½•è®°å½•å¯¹è±¡"><a href="#åœ¨-Node-js-ä¸­å¦‚ä½•è®°å½•å¯¹è±¡" class="headerlink" title="åœ¨ Node.js ä¸­å¦‚ä½•è®°å½•å¯¹è±¡"></a><font color="#ff99cc">åœ¨ Node.js ä¸­å¦‚ä½•è®°å½•å¯¹è±¡</font></h2><pre><code>åœ¨è¾¾åˆ°ä¸€å®šåµŒå¥—çº§åˆ«ä¹‹å‰ä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ åœ¨ç»è¿‡ä¸¤ä¸ªçº§åˆ«çš„åµŒå¥—åï¼ŒNode.js ä¼šæ”¾å¼ƒå¹¶æ‰“å° [Object] ä½œä¸ºå ä½ç¬¦ï¼š
å¦‚ä½•æ‰“å°æ•´ä¸ªå¯¹è±¡ï¼Ÿ

æœ€å¥½çš„æ–¹æ³•ï¼ˆåŒæ—¶ä¿ç•™æ¼‚äº®çš„æ‰“å°æ•ˆæœï¼‰æ˜¯ä½¿ç”¨ï¼š
console.log(JSON.stringify(obj, null, 2))
å…¶ä¸­ 2 æ˜¯ç”¨äºç¼©è¿›çš„ç©ºæ ¼æ•°ã€‚

å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ï¼š
require(&apos;util&apos;).inspect.defaultOptions.depth = null
console.log(obj)
ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œç¬¬ 2 çº§ä¹‹åçš„åµŒå¥—å¯¹è±¡ä¼šè¢«å±•å¹³ï¼Œè¿™å¯èƒ½æ˜¯å¤æ‚å¯¹è±¡çš„é—®é¢˜ã€‚
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/22/workReward/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/22/workReward/" itemprop="url">workReward</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-04-22T17:39:33+08:00">
                2021-04-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ä¸“é¢˜/" itemprop="url" rel="index">
                    <span itemprop="name">ä¸“é¢˜</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="js"><a href="#js" class="headerlink" title="js"></a>js</h1><h2 id="ES5-mapå¾ªç¯ï¼šå¾ªç¯éå†ç«Ÿç„¶å‡ºç°é€—å·ï¼"><a href="#ES5-mapå¾ªç¯ï¼šå¾ªç¯éå†ç«Ÿç„¶å‡ºç°é€—å·ï¼" class="headerlink" title="ES5 mapå¾ªç¯ï¼šå¾ªç¯éå†ç«Ÿç„¶å‡ºç°é€—å·ï¼"></a>ES5 mapå¾ªç¯ï¼šå¾ªç¯éå†ç«Ÿç„¶å‡ºç°é€—å·ï¼</h2>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var a = document.getElementById(&apos;root&apos;);</span><br><span class="line">var b = [1,2,3,4,5,6].map( item =&gt; item);</span><br><span class="line">a.innerText = b;   //  1,2,3,4,5,6</span><br></pre></td></tr></table></figure>
<p>  åŸæ¥:åˆ©ç”¨mapæ’å…¥åˆ°DOMæ—¶ mapæœ€ç»ˆè¿”å›çš„æ•°ç»„å› ä¸ºæ‹¼æ¥+=è°ƒç”¨äº†toStringæ–¹æ³•. æ•°ç»„ç»“æ„[1, 2, 3] é‡Œé¢å±…ç„¶æ˜¯è¿™ä¸ªé€—å·, è½¬æ¢çš„æ—¶å€™æŠŠå®ƒå¸¦ä¸Šäº†ï¼<br>  æˆ‘ä»¬çŸ¥é“äº†åŸå› ä¹‹åå°±éå¸¸æ–¹ä¾¿è§£å†³äº†ã€‚æˆ‘ä»¬å¯ä»¥å·§å¦™åœ°åˆ©ç”¨joinæ–¹æ³•ï¼šjoin()å¯ä»¥åˆ‡å¼€ä¸€ä¸ªæ•°ç»„, æŒ‡å®šè¦ä½¿ç”¨çš„åˆ†éš”ç¬¦ã€‚å¦‚æœçœç•¥è¯¥å‚æ•°ï¼Œåˆ™ä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚</p>
<h2 id="æ¨¡æ¿å­—ç¬¦ä¸²ä¸­-nå¤±æ•ˆé—®é¢˜"><a href="#æ¨¡æ¿å­—ç¬¦ä¸²ä¸­-nå¤±æ•ˆé—®é¢˜" class="headerlink" title="æ¨¡æ¿å­—ç¬¦ä¸²ä¸­\nå¤±æ•ˆé—®é¢˜"></a>æ¨¡æ¿å­—ç¬¦ä¸²ä¸­\nå¤±æ•ˆé—®é¢˜</h2><pre><code>white-space: pre-line;
</code></pre><h2 id="forEachä¸éå†å†…éƒ¨ä¸ºç©ºçš„æ•°ç»„ï¼Œå‡½æ•°å†…çš„ä»£ç ä¹Ÿä¸æ‰§è¡Œã€‚"><a href="#forEachä¸éå†å†…éƒ¨ä¸ºç©ºçš„æ•°ç»„ï¼Œå‡½æ•°å†…çš„ä»£ç ä¹Ÿä¸æ‰§è¡Œã€‚" class="headerlink" title="forEachä¸éå†å†…éƒ¨ä¸ºç©ºçš„æ•°ç»„ï¼Œå‡½æ•°å†…çš„ä»£ç ä¹Ÿä¸æ‰§è¡Œã€‚"></a>forEachä¸éå†å†…éƒ¨ä¸ºç©ºçš„æ•°ç»„ï¼Œå‡½æ•°å†…çš„ä»£ç ä¹Ÿä¸æ‰§è¡Œã€‚</h2><pre><code>ä¸ºç©ºæ˜¯æŒ‡Emptyï¼Œä¸æ˜¯nullæˆ–undefinedã€‚å¯ä»¥æ”¹å†™æˆforå¾ªç¯ã€‚
</code></pre><h2 id="åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ•°æ®æ˜¯å¦æ˜¯JSONæ ¼å¼ï¼š"><a href="#åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ•°æ®æ˜¯å¦æ˜¯JSONæ ¼å¼ï¼š" class="headerlink" title="åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ•°æ®æ˜¯å¦æ˜¯JSONæ ¼å¼ï¼š"></a>åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ•°æ®æ˜¯å¦æ˜¯JSONæ ¼å¼ï¼š</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const checkJson = (d: string) =&gt; &#123;</span><br><span class="line">  if (typeof d !== &apos;string&apos;) &#123;</span><br><span class="line">    message.warning(&apos;é JSON æ ¼å¼&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">  try &#123;</span><br><span class="line">    const obj = JSON.parse(d);</span><br><span class="line">    if (typeof obj === &apos;object&apos; &amp;&amp; obj) &#123;</span><br><span class="line">      message.warning(&apos;æ˜¯ JSON æ ¼å¼&apos;);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    message.warning(&apos;é JSON æ ¼å¼&apos;);</span><br><span class="line">    return false;</span><br><span class="line">  &#125; catch (info) &#123;</span><br><span class="line">    message.warning(&apos;é JSON æ ¼å¼&apos;);</span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="JSON-stringify-â€¦"><a href="#JSON-stringify-â€¦" class="headerlink" title="JSON.stringify(â€¦)"></a>JSON.stringify(â€¦)</h2><pre><code>JSON.stringify(â€¦)ç”¨äºå°†å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯æ³¨æ„JSON.stringify(â€¦)ä¹Ÿä¼šè½¬è¯‘å¼•å·ã€‚
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JSON.stringify(&#123;&#125;)  === â€œ&#123;&#125;â€                       <span class="literal">true</span></span><br><span class="line">JSON.stringify(â€˜123<span class="string">')  === 123                     false</span></span><br><span class="line"><span class="string">JSON.stringify(â€˜123'</span>)  === <span class="string">"\"123\â€â€               true</span></span><br><span class="line"><span class="string">JSON.stringify(&#123;a: 1&#125;)  === "</span>&#123;\<span class="string">"a\":1&#125;â€            true</span></span><br><span class="line"><span class="string">JSON.stringify(&#123;a: '123â€™&#125;) === "</span>&#123;\<span class="string">"a\":\"123\"&#125;â€   true</span></span><br></pre></td></tr></table></figure>
</code></pre><h2 id="switchâ€¦caseå’Œelseâ€¦if"><a href="#switchâ€¦caseå’Œelseâ€¦if" class="headerlink" title="switchâ€¦caseå’Œelseâ€¦if"></a>switchâ€¦caseå’Œelseâ€¦if</h2><pre><code>switchâ€¦caseå’Œelseâ€¦ifçš„æ ¹æœ¬åŒºåˆ«åœ¨äºï¼Œswitchâ€¦caseä¼šç”Ÿæˆä¸€ä¸ªå’Œç´¢å¼•å’Œswitchå˜é‡ç›¸ç­‰çš„è·³è½¬è¡¨æ¥æŒ‡å‘å®é™…çš„caseåˆ†æ”¯åœ°å€ï¼Œè€Œelseâ€¦iféœ€è¦ä¸€æ¡ä¸€æ¡åœ°éå†ã€‚å¦‚æ­¤çœ‹æ¥ï¼Œ switchâ€¦caseçš„æ•ˆç‡ä¼šæ›´é«˜ã€‚
switchâ€¦caseåªèƒ½åˆ¤æ–­byte,short,intæˆ–æ˜¯charç±»å‹ï¼Œifçš„æ¡ä»¶ä¼šæ›´çµæ´»

è¯¦è§£ï¼šswitch...caseä¼šç”Ÿæˆä¸€ä»½å¤§å°ï¼ˆè¡¨é¡¹æ•°ï¼‰ä¸ºæœ€å¤§caseå¸¸é‡ï¼‹1çš„è·³è¡¨ï¼Œç¨‹åºé¦–å…ˆåˆ¤æ–­switchå˜é‡æ˜¯å¦å¤§äºæœ€å¤§case å¸¸é‡ï¼Œè‹¥å¤§äºï¼Œåˆ™è·³åˆ°defaultåˆ†æ”¯å¤„ç†ï¼›å¦åˆ™å–å¾—ç´¢å¼•å·ä¸ºswitchå˜é‡å¤§å°çš„è·³è¡¨é¡¹çš„åœ°å€ï¼ˆå³è·³è¡¨çš„èµ·å§‹åœ°å€ï¼‹è¡¨é¡¹å¤§å°ï¼Šç´¢å¼•å·ï¼‰ï¼Œç¨‹åºæ¥ç€è·³åˆ°æ­¤åœ°å€æ‰§è¡Œï¼Œåˆ°æ­¤å®Œæˆäº†åˆ†æ”¯çš„è·³è½¬ã€‚
</code></pre><p>  ## </p>
<h1 id="å¾®ä¿¡å°ç¨‹åº"><a href="#å¾®ä¿¡å°ç¨‹åº" class="headerlink" title="å¾®ä¿¡å°ç¨‹åº"></a>å¾®ä¿¡å°ç¨‹åº</h1><h2 id="å¾®ä¿¡å°ç¨‹åºæ‰«ç è·³è½¬æŒ‡å®šé¡µé¢"><a href="#å¾®ä¿¡å°ç¨‹åºæ‰«ç è·³è½¬æŒ‡å®šé¡µé¢" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºæ‰«ç è·³è½¬æŒ‡å®šé¡µé¢"></a>å¾®ä¿¡å°ç¨‹åºæ‰«ç è·³è½¬æŒ‡å®šé¡µé¢</h2><p>  å¾®ä¿¡å…¬ä¼—å¹³å° - å¼€å‘ - å¼€å‘ç®¡ç† - å¼€å‘è®¾ç½® - æ‰«æ™®é€šé“¾æ¥äºŒç»´ç æ‰“å¼€å°ç¨‹åº - æ·»åŠ </p>
<p>  å¡«å†™è§„åˆ™ä¿¡æ¯ - å°†æ ¡éªŒæ–‡ä»¶æ”¾åœ¨æœåŠ¡å™¨å¯¹åº”ç›®å½•ä¸‹ - é€‰æ‹©æµ‹è¯•èŒƒå›´ï¼ˆéçº¿ä¸Šç‰ˆæœ¬æœ€å¤šå¯æ·»åŠ 5ä¸ªæµ‹è¯•é“¾æ¥ï¼Œè§„åˆ™å‘å¸ƒåå°†ä¸å—é™åˆ¶ï¼‰</p>
<h2 id="å°ç¨‹åºç™»å½•"><a href="#å°ç¨‹åºç™»å½•" class="headerlink" title="å°ç¨‹åºç™»å½•"></a>å°ç¨‹åºç™»å½•</h2><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.login(code)                                    -&gt;  </span><br><span class="line">                                                  -&gt; åç«¯æ¥å£ï¼ˆsession_key,openId  storageï¼‰ -&gt;  åç«¯æ¥å£ï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰</span><br><span class="line">Button(getPhoneNumber - iv,encryptedData storage) -&gt;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="å¾®ä¿¡å°ç¨‹åºç™»å½•é—®é¢˜â€“ç¬¬ä¸€æ¬¡ç™»å½•å¤±è´¥ï¼Œç¬¬äºŒæ¬¡ç™»å½•æˆåŠŸé—®é¢˜"><a href="#å¾®ä¿¡å°ç¨‹åºç™»å½•é—®é¢˜â€“ç¬¬ä¸€æ¬¡ç™»å½•å¤±è´¥ï¼Œç¬¬äºŒæ¬¡ç™»å½•æˆåŠŸé—®é¢˜" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºç™»å½•é—®é¢˜â€“ç¬¬ä¸€æ¬¡ç™»å½•å¤±è´¥ï¼Œç¬¬äºŒæ¬¡ç™»å½•æˆåŠŸé—®é¢˜"></a>å¾®ä¿¡å°ç¨‹åºç™»å½•é—®é¢˜â€“ç¬¬ä¸€æ¬¡ç™»å½•å¤±è´¥ï¼Œç¬¬äºŒæ¬¡ç™»å½•æˆåŠŸé—®é¢˜</h2><p>  å‡ºç°è¿™æ ·çš„é—®é¢˜éƒ½æ˜¯å…ˆè·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆgetPhoneNumberï¼‰encryptedDataä¸ivï¼Œå†è¿›è¡Œç™»å½•wx.loginï¼ˆï¼‰è·å–codeã€‚æ˜¯å› ä¸ºæ¯æ¬¡è·å–codeä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„session_keyï¼Œè¿™æ—¶çš„session_keyä¼šä¸encryptedDataè§£å¯†å‡ºæ¥çš„session_keyä¸åŒï¼Œæ‰€ä»¥å°±å¤±è´¥äº†ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å…ˆè·å–codeå†è·å–encryptedDataã€‚ä¹Ÿå°±æ˜¯å®çº¿wx.loginï¼ˆï¼‰ï¼Œè¿™æ ·åœ¨getPhoneNumberçš„æ—¶å€™å°±æ²¡é—®é¢˜äº†ã€‚</p>
<h1 id="å‘¨è¾¹"><a href="#å‘¨è¾¹" class="headerlink" title="å‘¨è¾¹"></a>å‘¨è¾¹</h1><h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><p>  åˆ«åï¼Œç”šè‡³æ˜¯ä½ æƒ³æ”¹æœ¬åœ°çš„npmåŒ…çš„ä»£ç ï¼Œå¥ˆä½•ç”Ÿæ•ˆçš„åªæ˜¯å‹ç¼©åçš„ä»£ç ï¼Œæœªå‹ç¼©ä»£ç ä¿®æ”¹åä¸ç”Ÿæ•ˆã€‚<br>  æ­¤æ—¶ï¼Œaliaså°å¯çˆ±å°±å¯ä»¥å¸®ä½ è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œniceã€‚<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      &apos;tblh-validate-upload&apos;: path.resolve(process.cwd(), &apos;node_modules&apos;, &apos;tblh-validate-upload/src/index.tsx&apos;),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line">git branch -M main</span><br><span class="line">git remote add origin https://github.com/LemonQueenx/summer.git</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure>
<h3 id="pull-request"><a href="#pull-request" class="headerlink" title="pull request"></a>pull request</h3><p>  æˆ‘ä»¬æœ‰éœ€æ±‚æƒ³æ”¹åˆ«äººçš„githubä»“åº“ä»£ç çš„bugæ—¶ï¼Œéœ€è¦æpull requestã€‚æµç¨‹æ˜¯æˆ‘ä»¬forkä¸€ä¸‹å¯¹æ–¹çš„ä»“åº“åˆ°æˆ‘ä»¬è´¦å·ä¸‹ï¼Œcloneåˆ°æœ¬åœ°ï¼Œæ–°å»ºä¸ªåˆ†æ”¯ï¼Œé€ ä½œåæäº¤åˆ°è¿œç¨‹ï¼Œç„¶åæpull requestç»™å¯¹æ–¹ã€‚å¯¹æ–¹å¦‚æœçœ‹åˆ°ï¼Œå¹¶ä¸”æ„¿æ„é‡‡çº³ä½ çš„ä¿®æ”¹ï¼Œå°±ä¼šmergeï¼Œåˆå¹¶åˆ°ä»–çš„é¡¹ç›®ä¸­ã€‚<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fork -&gt; </span><br><span class="line">git clone xxx</span><br><span class="line">cd xxx/</span><br><span class="line">git checkout -b fix_jyy</span><br><span class="line">git add .</span><br><span class="line">git commit -m &apos;yyy&apos;</span><br><span class="line">git push --set-upstream origin fix_jyy</span><br></pre></td></tr></table></figure></p>
<p>  å®Œæˆä¿®æ”¹ä¹‹åï¼Œå›åˆ° test-pr åˆ†æ”¯ï¼Œç‚¹å‡»æ—è¾¹ç»¿è‰²çš„ Compare &amp; pull request æŒ‰é’®</p>
<h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><p>  npm get registry<br>  npm config set registry xxx<br>  npm adduser â€“registry xxx<br>  npm profile set password â€“registry xxx</p>
<p>  npm publish<br>  å‘å¸ƒğŸ“¢ï¼š</p>
<ul>
<li>å‘å¸ƒä¹‹å‰è®°å¾—buildç¼–è¯‘ï¼Œå°åŒ…ä½¿ç”¨rollupæ‰“åŒ…å¾ˆç®€å•</li>
<li><p>å‘å¸ƒåœ¨å…¬å¸å†…æºçš„è¯ï¼Œéœ€è¦æ”¹å˜é¡¹ç›®çš„npmæºã€‚.npmrc registry=â€™xxxâ€™</p>
<p>npm view npmåŒ… versions</p>
</li>
</ul>
<h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="excel-csvæ–‡ä»¶çš„æ ¡éªŒå¹¶ä¸Šä¼ "><a href="#excel-csvæ–‡ä»¶çš„æ ¡éªŒå¹¶ä¸Šä¼ " class="headerlink" title="excel\csvæ–‡ä»¶çš„æ ¡éªŒå¹¶ä¸Šä¼ "></a>excel\csvæ–‡ä»¶çš„æ ¡éªŒå¹¶ä¸Šä¼ </h2><p>  åŸºäºantd-upload + exceljsäºŒæ¬¡å°è£…</p>
<ul>
<li>browserå¼•å…¥ä¸ä½¿ç”¨ï¼š<br>ï¼ˆ1ï¼‰npm install exceljs â€“save<br>ï¼ˆ2ï¼‰import * as ExcelJS from â€˜exceljs/dist/exceljs.bareâ€™<br>ï¼ˆ3ï¼‰declare module â€˜exceljs/dist/exceljs.bareâ€™</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import &#123; Upload, Modal, Button &#125; from &apos;antd&apos;;</span><br><span class="line">const ExcelJS = require(&apos;exceljs/dist/exceljs.bare&apos;);</span><br><span class="line">const Papa = require(&apos;papaparse&apos;);</span><br><span class="line">const jschardet = require(&apos;jschardet&apos;);</span><br><span class="line">const atob = require(&apos;atob&apos;);</span><br><span class="line"></span><br><span class="line">const &#123; Dragger &#125; = Upload as any;</span><br><span class="line">/**ç±»å‹å®šä¹‰ */</span><br><span class="line">interface IProps &#123;</span><br><span class="line">  sheetProps?: ISheetProps;</span><br><span class="line">  handleMoreValidate?: (rows: any, worksheet?: any) =&gt; string,</span><br><span class="line">  dragProps?: object,</span><br><span class="line">  style?: object,</span><br><span class="line">  children?: React.ReactNode | string,</span><br><span class="line">  uploadToolTip?: React.ReactNode | string,</span><br><span class="line">  resultTitle?: string,</span><br><span class="line">  type?: &apos;excel&apos; | &apos;csv&apos;, // é»˜è®¤excel</span><br><span class="line">&#125;;</span><br><span class="line">type IType = &apos;list&apos; | &apos;number&apos; | &apos;text&apos; | &apos;custome&apos;; </span><br><span class="line">interface ISheetProps &#123;</span><br><span class="line">  [key: string]: &#123;</span><br><span class="line">    colTitle: string;</span><br><span class="line">    type: IType,</span><br><span class="line">    allowBlank: boolean;</span><br><span class="line">    valueErrorMessage?: string;</span><br><span class="line">    formulae?: any;</span><br><span class="line">    isUnique?: boolean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">interface ICellErrorInfo &#123;</span><br><span class="line">    cellIndex: string;</span><br><span class="line">    errorMessage: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* å·¥å…·å‡½æ•°</span><br><span class="line">* @returns </span><br><span class="line">*/</span><br><span class="line">function getEN() &#123;</span><br><span class="line">    var arr = [null] as any;</span><br><span class="line">    for(var i = 65; i &lt; 91; i++)&#123;</span><br><span class="line">        arr.push(String.fromCharCode(i));</span><br><span class="line">    &#125;</span><br><span class="line">    return arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isInteger(value: number) &#123;</span><br><span class="line">    return value % 1 === 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function dataValidation(value: any, validation: any) &#123;</span><br><span class="line">    if (!validation) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!validation.allowBlank &amp;&amp; !String(value)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    //  é»˜è®¤è§„åˆ™</span><br><span class="line">    if (value &amp;&amp; validation.type === &apos;list&apos; &amp;&amp; !validation.formulae.includes(String(value))) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    if (value &amp;&amp; validation.type === &apos;number&apos; &amp;&amp; !isInteger(Number(value))) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    if (value &amp;&amp; validation.type === &apos;custom&apos; &amp;&amp; !validation.formulae.test(value)) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    if (value &amp;&amp; validation.type === &apos;text&apos; &amp;&amp; validation.formulae &amp;&amp; value.length &gt; validation.formulae) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const A2Zarray = getEN();</span><br><span class="line"></span><br><span class="line">function checkEncoding(base64Str: any) &#123;</span><br><span class="line">    // è¿™ç§æ–¹å¼å¾—åˆ°çš„æ˜¯ä¸€ç§äºŒè¿›åˆ¶ä¸²</span><br><span class="line">    let str = atob(base64Str.split(&apos;;base64,&apos;)[1]);</span><br><span class="line">    // console.log(str);</span><br><span class="line">    // è¦ç”¨äºŒè¿›åˆ¶æ ¼å¼</span><br><span class="line">    let encoding = jschardet.detect(str);</span><br><span class="line">    encoding = encoding.encoding;</span><br><span class="line">    // console.log( encoding );</span><br><span class="line">    if (encoding === &apos;windows-1252&apos;) &#123;</span><br><span class="line">      // æœ‰æ—¶ä¼šè¯†åˆ«é”™è¯¯ï¼ˆå¦‚UTF8çš„ä¸­æ–‡äºŒå­—ï¼‰</span><br><span class="line">      encoding = &apos;ANSI&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">    return encoding;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function getFileReaderResult(file: any) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        const fileReader = new FileReader()</span><br><span class="line">        fileReader.readAsDataURL(file);</span><br><span class="line">        fileReader.onload = (e: any) =&gt; &#123;</span><br><span class="line">            const result = e.target.result;</span><br><span class="line">            const encoding = checkEncoding(result);</span><br><span class="line">            resolve(&#123;</span><br><span class="line">                file,</span><br><span class="line">                encoding,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function getJsonFromCsv(file: any) &#123;</span><br><span class="line">    const data = await getFileReaderResult(file) as any;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        Papa.parse(data.file, &#123;</span><br><span class="line">            encoding: data.encoding,</span><br><span class="line">            complete: function(results: any) &#123;</span><br><span class="line">                resolve(results.data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* ç»„ä»¶</span><br><span class="line">* @param props </span><br><span class="line">* @returns </span><br><span class="line">*/</span><br><span class="line">const Demo = (props: IProps) =&gt; &#123;</span><br><span class="line">    const &#123; sheetProps, type=&apos;excel&apos; &#125; = props;</span><br><span class="line">    const [modal, setModal] = React.useState(&#123;</span><br><span class="line">        visible: false,</span><br><span class="line">        resultContent: &apos;&apos;,</span><br><span class="line">    &#125;);</span><br><span class="line">    const dragProps = &#123;</span><br><span class="line">        name: &apos;file&apos;,</span><br><span class="line">        multiple: true,</span><br><span class="line">        accept: &apos;.csv,.xlsx&apos;,</span><br><span class="line">        action: &apos;https://www.mocky.io/v2/5cc8019d300000980a055e76&apos;,</span><br><span class="line">        beforeUpload: async (file: any) =&gt; &#123;</span><br><span class="line">            if (!sheetProps) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">            return new Promise(async (resolve, reject) =&gt; &#123;</span><br><span class="line">                if (type === &apos;csv&apos;) &#123;</span><br><span class="line">                    const json = await getJsonFromCsv(file) as any;</span><br><span class="line">                    const csvInfo = &#123;</span><br><span class="line">                        bodyErrorInfo: [],</span><br><span class="line">                        titleError: [],</span><br><span class="line">                        isEmptyCsv: false,</span><br><span class="line">                        extraErrorInfo: &apos;&apos;,</span><br><span class="line">                    &#125; as any;</span><br><span class="line">                    // isEmpty</span><br><span class="line">                    if (!json.length) &#123;</span><br><span class="line">                        csvInfo.isEmptyCsv = true;</span><br><span class="line">                        // setModal(&#123;</span><br><span class="line">                        //     visible: true,</span><br><span class="line">                        //     resultContent: `$&#123;modal.resultContent&#125;\nä¸Šä¼ ä¸ºç©ºè¡¨ï¼Œè¯·æ£€æŸ¥`,</span><br><span class="line">                        // &#125;);</span><br><span class="line">                        // reject(false);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // isErrorTitle</span><br><span class="line">                    Object.values(sheetProps).forEach((item: any, index: number) =&gt; &#123;</span><br><span class="line">                        if (item.colTitle !== json[0][index]) &#123;</span><br><span class="line">                            csvInfo.titleError = (csvInfo.titleError || []).concat(index);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    // isErrorbody</span><br><span class="line">                    json.forEach((item: any, index: number) =&gt; &#123;</span><br><span class="line">                        if (index) &#123;</span><br><span class="line">                            item.forEach((value: any, i: number) =&gt; &#123;</span><br><span class="line">                                if (!dataValidation(value, sheetProps[A2Zarray[i + 1]])) &#123;</span><br><span class="line">                                    csvInfo.bodyErrorInfo.push(&#123;</span><br><span class="line">                                        cellIndex: `$&#123;index + 1&#125;è¡Œ $&#123;A2Zarray[i + 1]&#125;åˆ—`,</span><br><span class="line">                                        errorMessage: sheetProps[A2Zarray[i + 1]].valueErrorMessage || &apos;å€¼ä¸ºç©ºæˆ–ç±»å‹é”™è¯¯ï¼Œè¯·æ£€æŸ¥&apos;,</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    // extraInfo</span><br><span class="line">                    if (props.handleMoreValidate) &#123;</span><br><span class="line">                        csvInfo.extraErrorInfo = props.handleMoreValidate(json);</span><br><span class="line">                    &#125;</span><br><span class="line">                    // æ¥å§ï¼Œå±•ç¤º</span><br><span class="line">                    let errorInfo = &apos;&apos;;</span><br><span class="line">                    if (csvInfo.isEmptyCsv) &#123;</span><br><span class="line">                        errorInfo += &apos;ä¸Šä¼ ä¸ºç©ºè¡¨ï¼Œè¯·æ£€æŸ¥&apos;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (csvInfo.titleError.length) &#123;</span><br><span class="line">                        errorInfo += `\nåˆ—æ ‡é¢˜é”™è¯¯ï¼Œè¯·æ£€æŸ¥$&#123;csvInfo.titleError&#125;`;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (csvInfo.bodyErrorInfo.length) &#123;</span><br><span class="line">                        errorInfo += `\nå†…å®¹é”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š\n$&#123;csvInfo.bodyErrorInfo.map((i: any) =&gt; (`$&#123;i.cellIndex&#125;:$&#123;i.errorMessage&#125;\n`)).join(&apos;&apos;)&#125;`;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (csvInfo.extraErrorInfo) &#123;</span><br><span class="line">                        errorInfo += `\n$&#123;csvInfo.extraErrorInfo&#125;`;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (errorInfo) &#123;</span><br><span class="line">                        setModal(&#123;</span><br><span class="line">                            visible: true,</span><br><span class="line">                            resultContent: errorInfo,</span><br><span class="line">                        &#125;);</span><br><span class="line">                        reject(false);</span><br><span class="line">                    &#125;</span><br><span class="line">                    resolve(true);</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                // ä»¥ä¸‹æ˜¯å¯¹excelçš„å¤„ç†</span><br><span class="line">                const buffer = file.arrayBuffer();</span><br><span class="line">                const workbook = new ExcelJS.Workbook();</span><br><span class="line">                await workbook.xlsx.load(buffer);</span><br><span class="line">                let sheetInfo = &#123;&#125; as any;</span><br><span class="line">                workbook.eachSheet(async function(worksheet: any, sheetId: any) &#123;</span><br><span class="line">                    // å…ˆè·å–å½“å‰sheetä¸­çš„æœ‰æ•ˆæ•°æ®</span><br><span class="line">                    // æ ¡éªŒåˆ—æ ‡é¢˜å’Œåˆ—å·æ˜¯ä¸æ˜¯æ­£ç¡®çš„</span><br><span class="line">                    // éå†bodyæ¯ä¸€è¡Œæ•°æ®ï¼Œæ ¡éªŒæ¯ä¸ªcell</span><br><span class="line">                    sheetInfo[sheetId] = &#123;</span><br><span class="line">                        name: worksheet.name,</span><br><span class="line">                    &#125;;</span><br><span class="line">                    // let breakRowNumber = null as any;</span><br><span class="line">                    let errorTitleIndex = [] as any;</span><br><span class="line">                    let isEmptySheet = false;</span><br><span class="line">                    // æ£€æŸ¥ä¸»è§„åˆ™</span><br><span class="line">                    let bodyErrorInfo: ICellErrorInfo[] = [];</span><br><span class="line">                    worksheet.eachRow(&#123; includeEmpty: true &#125;, function(row: any, rowNumber: any) &#123;</span><br><span class="line">                        // æ£€æŸ¥å¤´éƒ¨</span><br><span class="line">                        if (rowNumber === 1) &#123;</span><br><span class="line">                            row.values.forEach((title: string, index: number) =&gt; &#123;</span><br><span class="line">                                if (index &amp;&amp; sheetProps[A2Zarray[index]] &amp;&amp; sheetProps[A2Zarray[index]].colTitle !== title) &#123;</span><br><span class="line">                                    errorTitleIndex.push(A2Zarray[index]);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        // æ£€æŸ¥æ˜¯å¦æ˜¯ç©ºè¡¨</span><br><span class="line">                        if (rowNumber === 1 &amp;&amp; !row.values.length) &#123;</span><br><span class="line">                            isEmptySheet = true;</span><br><span class="line">                        &#125;</span><br><span class="line">                        // æˆªå–æœ‰æ•ˆæ•°æ®éƒ¨åˆ†</span><br><span class="line">                        if (rowNumber &gt; 1) &#123;</span><br><span class="line">                            row.values.forEach((value: any, index: number) =&gt; &#123;</span><br><span class="line">                                const colIndex = A2Zarray[index];</span><br><span class="line">                                const cellIndex = `$&#123;rowNumber&#125;è¡Œ $&#123;colIndex&#125;åˆ—`;</span><br><span class="line">                                if (!dataValidation(value, sheetProps[colIndex])) &#123;</span><br><span class="line">                                    bodyErrorInfo.push(&#123;</span><br><span class="line">                                        cellIndex,</span><br><span class="line">                                        errorMessage: sheetProps[colIndex].valueErrorMessage || &apos;å€¼ä¸ºç©ºæˆ–ç±»å‹é”™è¯¯ï¼Œè¯·æ£€æŸ¥&apos;,</span><br><span class="line">                                    &#125;);</span><br><span class="line">                                &#125;;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    // æ£€æŸ¥å”¯ä¸€æ€§</span><br><span class="line">                    /////////////// ......</span><br><span class="line">                    // æ£€æŸ¥é¢å¤–é€»è¾‘çš„å¤„ç†</span><br><span class="line">                    let extraErrorInfo: string = &apos;&apos;;</span><br><span class="line">                    if (props.handleMoreValidate) &#123;</span><br><span class="line">                        const rows = worksheet._rows.map((e: any) =&gt; Array.isArray(e.values) &amp;&amp; e.values.slice(1));</span><br><span class="line">                        extraErrorInfo = props.handleMoreValidate(rows, worksheet);</span><br><span class="line">                    &#125;</span><br><span class="line">                    sheetInfo[sheetId] = &#123;</span><br><span class="line">                        ...sheetInfo[sheetId],</span><br><span class="line">                        isEmptySheet,</span><br><span class="line">                        // breakRowNumber,</span><br><span class="line">                        errorTitleIndex,</span><br><span class="line">                        bodyErrorInfo,</span><br><span class="line">                        extraErrorInfo,</span><br><span class="line">                    &#125;;</span><br><span class="line">                &#125;);</span><br><span class="line">                let errorInfo = &apos;&apos;;</span><br><span class="line">                // å¯¹ç»“æœè¿›è¡Œæç¤º</span><br><span class="line">                Object.keys(sheetInfo).forEach((key: string | number) =&gt; &#123;</span><br><span class="line">                    if (sheetInfo[key].isEmptySheet) &#123;</span><br><span class="line">                        errorInfo +=  `$&#123;sheetInfo[key].name&#125;ä¸ºç©ºè¡¨`;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (sheetInfo[key].errorTitleIndex.length) &#123;</span><br><span class="line">                        errorInfo +=  `\n$&#123;sheetInfo[key].name&#125;è¡¨æ ‡é¢˜é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼Œåˆ—å¦‚ä¸‹ï¼š\n$&#123;sheetInfo[key].errorTitleIndex&#125;`;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (sheetInfo[key].bodyErrorInfo.length) &#123;</span><br><span class="line">                        errorInfo +=  `\n$&#123;sheetInfo[key].name&#125;è¡¨å†…å®¹é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼Œå•å…ƒæ ¼å¦‚ä¸‹ï¼š\n$&#123;sheetInfo[key].bodyErrorInfo.map((i: any) =&gt; (`$&#123;i.cellIndex&#125;:$&#123;i.errorMessage&#125;\n`)).join(&apos;&apos;)&#125;`;</span><br><span class="line">                    &#125;</span><br><span class="line">                    if (sheetInfo[key].extraErrorInfo) &#123;</span><br><span class="line">                        errorInfo +=  `\n$&#123;sheetInfo[key].extraErrorInfo&#125;`;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                if (errorInfo) &#123;</span><br><span class="line">                    setModal(&#123;</span><br><span class="line">                        visible: true,</span><br><span class="line">                        resultContent: errorInfo,</span><br><span class="line">                    &#125;);</span><br><span class="line">                    reject(false);</span><br><span class="line">                &#125;</span><br><span class="line">                resolve(true);</span><br><span class="line">                return;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        onChange(info: any) &#123;</span><br><span class="line">          const &#123; status &#125; = info.file;</span><br><span class="line">          if (status !== &apos;uploading&apos;) &#123;</span><br><span class="line">            // console.log(info.file, info.fileList);</span><br><span class="line">          &#125;</span><br><span class="line">          if (status === &apos;done&apos;) &#123;</span><br><span class="line">            // message.success(`$&#123;info.file.name&#125; file uploaded successfully.`);</span><br><span class="line">          &#125; else if (status === &apos;error&apos;) &#123;</span><br><span class="line">            // message.error(`$&#123;info.file.name&#125; file upload failed.`);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        ...props.dragProps || &#123;&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const handleCancelModal = () =&gt; &#123;</span><br><span class="line">        setModal(&#123;</span><br><span class="line">            visible: false,</span><br><span class="line">            resultContent: &apos;&apos;,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return (</span><br><span class="line">        &lt;div style=&#123;props.style || &#123;&#125;&#125;&gt;</span><br><span class="line">            &#123; props.children || null &#125;</span><br><span class="line">            &lt;Modal</span><br><span class="line">              style=&#123;&#123; whiteSpace: &apos;pre-line&apos; &#125;&#125;</span><br><span class="line">              visible=&#123;modal.visible&#125; title=&#123;props.resultTitle || &apos;æ ¡éªŒç»“æœ&apos;&#125;</span><br><span class="line">              footer = &#123; &lt;Button  type = &quot;primary&quot; onClick = &#123; handleCancelModal &#125;&gt;ç¡®å®š&lt;/Button&gt; &#125;</span><br><span class="line">            &gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    modal.resultContent</span><br><span class="line">                &#125;</span><br><span class="line">            &lt;/Modal&gt;</span><br><span class="line">            &lt;Dragger &#123;...dragProps&#125;&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &#123; props.uploadToolTip || &apos;Support CSV and EXCEL file for analysis&apos; &#125;</span><br><span class="line">                &lt;/p&gt;</span><br><span class="line">            &lt;/Dragger&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Demo;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h2><pre><code>aæ ‡ç­¾çš„downloadå±æ€§ï¼Œæƒ³å¿…å¤§å®¶éƒ½çŸ¥é“å®ƒçš„æ„ä¹‰æ˜¯æ”¹å˜æ–‡ä»¶ä¸‹è½½çš„åç§°ã€‚ä½†æ˜¯å½“è·¨åŸŸä¸‹è½½è¿œç¨‹æ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§ä¼šå­˜åœ¨å¤±æ•ˆé—®é¢˜ã€‚æˆ‘ä»¬ä»Šå¤©å°±æ¥çœ‹çœ‹ï¼Œåœ¨ä¸ç”¨æœåŠ¡å™¨åè°ƒçš„æƒ…å†µä¸‹ï¼Œå‰ç«¯å¦‚ä½•è‡ªè¡Œå¤„ç†è¿™ä¸ªé—®é¢˜ã€‚

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const handleDownLoad = () =&gt; &#123;</span><br><span class="line">const template = &apos;https://festatic-1254389369.cos.ap-guangzhou.myqcloud.com/science/otms/importTemplatestationCreate.csv&apos;;</span><br><span class="line">const download = &apos;æ¨¡æ¿.csv&apos;;</span><br><span class="line"></span><br><span class="line">const x = new XMLHttpRequest();</span><br><span class="line">x.open(&apos;GET&apos;, template, true);</span><br><span class="line">x.responseType = &apos;blob&apos;;</span><br><span class="line">x.onload = () =&gt; &#123;</span><br><span class="line">  const url = window.URL.createObjectURL(x.response);</span><br><span class="line">  const a = document.createElement(&apos;a&apos;);</span><br><span class="line">  a.href = url;</span><br><span class="line">  a.download = download;</span><br><span class="line">  a.click();</span><br><span class="line">&#125;;</span><br><span class="line">x.send();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const handleDownLoad = async () =&gt; &#123;</span><br><span class="line">const template = &apos;https://festatic-1254389369.cos.ap-guangzhou.myqcloud.com/science/otms/importTemplatestationCreate.csv&apos;;</span><br><span class="line">const download = &apos;æ¨¡æ¿.csv&apos;;</span><br><span class="line"></span><br><span class="line">const response = await fetch(template);</span><br><span class="line">const blob = await response.blob();</span><br><span class="line">const objectUrl = window.URL.createObjectURL(blob);</span><br><span class="line">const a = document.createElement(&apos;a&apos;);</span><br><span class="line">a.href = objectUrl;</span><br><span class="line">a.download = download;</span><br><span class="line">document.body.appendChild(a);</span><br><span class="line">a.click();</span><br><span class="line">setTimeout(() =&gt; document.body.removeChild(a), 1000);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

&lt;div class=&apos;post-warning&apos;&gt;æ³¨æ„ï¼šä»£ç ä¸­å¯¹åˆ›å»ºçš„&lt;a\&gt; è¿›è¡Œçš„ appendChild å’Œ remove æ“ä½œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ FireFox æµè§ˆå™¨ï¼Œåœ¨ FireFox æµè§ˆå™¨ä¸‹è°ƒç”¨è¯¥æ–¹æ³•å¦‚æœä¸å°†åˆ›å»ºçš„&lt;a\&gt;æ ‡ç­¾æ·»åŠ åˆ° body é‡Œï¼Œç‚¹å‡»é“¾æ¥ä¸ä¼šæœ‰ä»»ä½•ååº”ï¼Œæ— æ³•è§¦å‘ä¸‹è½½ï¼Œè€Œåœ¨ Chrome æµè§ˆå™¨ä¸­åˆ™ä¸å—æ­¤å½±å“ã€‚&lt;/div&gt;
</code></pre><h1 id="æµè§ˆå™¨"><a href="#æµè§ˆå™¨" class="headerlink" title="æµè§ˆå™¨"></a>æµè§ˆå™¨</h1><p>  ä¹¦ç­¾æ -å¤åˆ¶cookiesï¼š<br>  1ï¼‰åœ¨chromeä¸­æ‰“å¼€ä¸‹é¢çš„çš„htmlï¼Œä¹‹åæŠŠé¡µé¢ä¸­çš„â€˜å¤åˆ¶cookiesâ€™æ‹‰åˆ°ä¹¦ç­¾æ å³å¯ã€‚<br>  2ï¼‰ä¹¦ç­¾æ ç©ºç™½å¤„é‚®ä»¶-æ·»åŠ ç½‘é¡µ-å°†javascriptéƒ¨åˆ†ç²˜è´´åˆ°åœ°å€éƒ¨åˆ†å³å¯ã€‚<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;a href=&quot;javascript:void(function() &#123;</span><br><span class="line">        var cookies = document.cookie;</span><br><span class="line">        var cookieArr = cookies.split(&apos;;&apos;);</span><br><span class="line">            cookieArr = cookieArr.map((item,index) =&gt; &#123;</span><br><span class="line">              var cookiePair = item.split(&apos;=&apos;);</span><br><span class="line">              cookiePair = cookiePair.map(member=&gt;member.trim());</span><br><span class="line">              return &#123;</span><br><span class="line">                domain:&apos;localhost&apos;,</span><br><span class="line">                expirationDate: 2629505262.602054,</span><br><span class="line">                hostOnly: true,</span><br><span class="line">                httpOnly: false,</span><br><span class="line">                name: cookiePair[0],</span><br><span class="line">                path: &apos;/&apos;,</span><br><span class="line">                sameSite: &apos;unspecified&apos;,</span><br><span class="line">                secure: false,</span><br><span class="line">                session: false,</span><br><span class="line">                storeId: &apos;0&apos;,</span><br><span class="line">                value: cookiePair[1],</span><br><span class="line">                id: index</span><br><span class="line">              &#125;;</span><br><span class="line">            &#125;);</span><br><span class="line">        var tag = document.createElement(&apos;input&apos;);</span><br><span class="line">        tag.style.opacity = &apos;0&apos;;</span><br><span class="line">        tag.setAttribute(&apos;id&apos;, &apos;cp_hgz_input&apos;);</span><br><span class="line">        tag.value = JSON.stringify(cookieArr);</span><br><span class="line">        document.getElementsByTagName(&apos;body&apos;)[0].appendChild(tag);</span><br><span class="line">        document.getElementById(&apos;cp_hgz_input&apos;).select();</span><br><span class="line">        document.execCommand(&apos;copy&apos;);</span><br><span class="line">        document.getElementById(&apos;cp_hgz_input&apos;).remove();</span><br><span class="line">      &#125;)()&quot;&gt;å¤åˆ¶cookies&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/06/qiankun/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/06/qiankun/" itemprop="url">qiankun</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-04-06T17:52:30+08:00">
                2021-04-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ä¸“é¢˜/" itemprop="url" rel="index">
                    <span itemprop="name">ä¸“é¢˜</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>  å¾®å‰ç«¯æ˜¯ç°åœ¨å‰ç«¯å¾ˆç«çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¼ä¸šçº§ä¸­åå°ç³»ç»Ÿè¿‡å¤§æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ç›®å‰ï¼Œç¨æˆç†Ÿçš„æ–¹æ¡ˆä¸»è¦æœ‰single-spaå’Œqiankunï¼Œqiankunæ˜¯åŸºäºsingle-spaï¼Œæˆ‘ä»¬é€‰æ‹©qiankun + reactï¼ŒLetâ€™s  start ~</p>
  <canvas id="qiankun" width="500" height="500"></canvas>

<h1 id="ä¸€ã€å¿«é€Ÿä¸Šæ‰‹"><a href="#ä¸€ã€å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="ä¸€ã€å¿«é€Ÿä¸Šæ‰‹"></a>ä¸€ã€å¿«é€Ÿä¸Šæ‰‹</h1><p>  ä¸»åº”ç”¨</p>
<ol>
<li><p>å®‰è£… qiankun<br>$ yarn add qiankun # æˆ–è€… npm i qiankun -S</p>
</li>
<li><p>åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œå¾®åº”ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import &#123; registerMicroApps, start &#125; from &apos;qiankun&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// qiankun æ³¨å†Œå¾®åº”ç”¨</span><br><span class="line">registerMicroApps([</span><br><span class="line">  &#123;</span><br><span class="line">    name: &apos;service_activity_app&apos;, // app name registered</span><br><span class="line">    entry: process.env.NODE_ENV === &apos;production&apos; ? &apos;&apos; : &apos;http://localhost:8080&apos;,</span><br><span class="line">    container: &apos;#subContainer&apos;,</span><br><span class="line">    activeRule: (location) =&gt; location.href.includes(&apos;/microApp/serviceActivityApp&apos;),</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line">start();</span><br><span class="line"></span><br><span class="line">&lt;div id=&apos;subContainer&apos;&gt;å¾®å‰ç«¯&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>nameï¼šå¿…é€‰ï¼Œå¾®åº”ç”¨çš„åç§°ï¼Œä¸å¾®åº”ç”¨package.jsonä¸­nameå±æ€§å€¼ä¸€è‡´ï¼Œå¾®åº”ç”¨ä¹‹é—´å¿…é¡»ç¡®ä¿å”¯ä¸€ï¼›<br>entryï¼šå¿…é€‰ï¼Œå¾®åº”ç”¨çš„å…¥å£è®¿é—®åœ°å€ï¼Œéœ€è¦åŒºåˆ†æœ¬åœ°è°ƒè¯•ç¯å¢ƒè¿˜æ˜¯çº¿ä¸Šç¯å¢ƒï¼›<br>containerï¼šå¿…é€‰ï¼Œå¾®åº”ç”¨çš„å®¹å™¨èŠ‚ç‚¹çš„é€‰æ‹©å™¨æˆ–è€… Element å®ä¾‹ï¼Œä¸€èˆ¬æ˜¯ä¸»åº”ç”¨æä¾›çš„ç”¨äºæ‰¿è½½å¾®åº”ç”¨çš„å®¹å™¨èŠ‚ç‚¹ã€‚</p>
<pre><code>å¦‚&apos;#subContainer&apos; æˆ– document.querySelector(&apos;#subContainer&apos;)ã€‚
</code></pre><p>activeRuleï¼šstring | (location: Location) =&gt; boolean | Array<string | (location: location)> boolean - å¿…é€‰ï¼Œå¾®åº”ç”¨çš„æ¿€æ´»è§„åˆ™ã€‚<br>æ”¯æŒç›´æ¥é…ç½®å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼Œå¦‚ _activeRule: â€˜/app1â€™ _æˆ– activeRule: activeRule: [â€˜/app1â€™, â€˜/app2â€™]å½“é…ç½®ä¸ºå­—ç¬¦ä¸²æ—¶ä¼šç›´æ¥è·Ÿ url ä¸­çš„è·¯å¾„éƒ¨åˆ†åšå‰ç¼€åŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¡¨æ˜å½“å‰åº”ç”¨ä¼šè¢«æ¿€æ´»<br>æ”¯æŒé…ç½®ä¸€ä¸ª active function å‡½æ•°æˆ–ä¸€ç»„ active functionã€‚å‡½æ•°ä¼šä¼ å…¥å½“å‰ location ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°è¿”å› true æ—¶è¡¨æ˜å½“å‰å¾®åº”ç”¨ä¼šè¢«æ¿€æ´»ã€‚å¦‚ location =&gt; location.pathname.startsWith(â€˜/app1â€™)</string></p>
<p>å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä¸»åº”ç”¨è®°å¾—é…ç½®å¾®åº”ç”¨çš„ä»£ç†ã€‚</p>
</li>
</ol>
<ol start="3">
<li><p>å­åº”ç”¨ä¸­çš„é…ç½®</p>
<ol>
<li><p>å¯¼å‡ºç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸé’©å­<br>å¾®åº”ç”¨éœ€è¦åœ¨è‡ªå·±çš„å…¥å£ js (é€šå¸¸å°±æ˜¯ä½ é…ç½®çš„ webpack çš„ entry js) å¯¼å‡º bootstrapã€mountã€unmount ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä»¥ä¾›ä¸»åº”ç”¨åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* bootstrap åªä¼šåœ¨å¾®åº”ç”¨åˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œä¸‹æ¬¡å¾®åº”ç”¨é‡æ–°è¿›å…¥æ—¶ä¼šç›´æ¥è°ƒç”¨ mount é’©å­ï¼Œä¸ä¼šå†é‡å¤è§¦å‘ bootstrapã€‚</span><br><span class="line">* é€šå¸¸æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›å…¨å±€å˜é‡çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚ä¸ä¼šåœ¨ unmount é˜¶æ®µè¢«é”€æ¯çš„åº”ç”¨çº§åˆ«çš„ç¼“å­˜ç­‰ã€‚</span><br><span class="line">export async function bootstrap() &#123;</span><br><span class="line">  console.log(&apos;react app bootstraped&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* åº”ç”¨æ¯æ¬¡è¿›å…¥éƒ½ä¼šè°ƒç”¨ mount æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨è¿™é‡Œè§¦å‘åº”ç”¨çš„æ¸²æŸ“æ–¹æ³•</span><br><span class="line">export async function mount(props) &#123;</span><br><span class="line">  ReactDOM.render(&lt;App /&gt;, props.container ? props.container.querySelector(&apos;#root&apos;) : document.getElementById(&apos;root&apos;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* åº”ç”¨æ¯æ¬¡ åˆ‡å‡º/å¸è½½ ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼Œé€šå¸¸åœ¨è¿™é‡Œæˆ‘ä»¬ä¼šå¸è½½å¾®åº”ç”¨çš„åº”ç”¨å®ä¾‹</span><br><span class="line">export async function unmount(props) &#123;</span><br><span class="line">  ReactDOM.unmountComponentAtNode(</span><br><span class="line">    props.container ? props.container.querySelector(&apos;#root&apos;) : document.getElementById(&apos;root&apos;),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* å¯é€‰ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä»…ä½¿ç”¨ loadMicroApp æ–¹å¼åŠ è½½å¾®åº”ç”¨æ—¶ç”Ÿæ•ˆ</span><br><span class="line">export async function update(props) &#123;</span><br><span class="line">  console.log(&apos;update props&apos;, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>qiankun åŸºäº single-spaï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨<a href="https://single-spa.js.org/docs/building-applications/#registered-application-lifecycle" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°æ›´å¤šå…³äºå¾®åº”ç”¨ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–‡æ¡£è¯´æ˜ã€‚</p>
</li>
</ol>
</li>
</ol>
<pre><code>2. é…ç½®å¾®åº”ç”¨çš„æ‰“åŒ…å·¥å…·
  é™¤äº†ä»£ç ä¸­æš´éœ²å‡ºç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸé’©å­ä¹‹å¤–ï¼Œä¸ºäº†è®©ä¸»åº”ç”¨èƒ½æ­£ç¡®è¯†åˆ«å¾®åº”ç”¨æš´éœ²å‡ºæ¥çš„ä¸€äº›ä¿¡æ¯ï¼Œå¾®åº”ç”¨çš„æ‰“åŒ…å·¥å…·éœ€è¦å¢åŠ å¦‚ä¸‹é…ç½®ï¼š

  webpack:
  const packageName = require(&apos;./package.json&apos;).name;

  module.exports = {
    output: {
      ...
      publicPath: &apos;http://localhost:8080/&apos;
      library: `${packageName}-[name]`,
      libraryTarget: &apos;umd&apos;,
      jsonpFunction: `webpackJsonp_${packageName}`,
    },
  };

3. package.json
  name ä¿æŒä¸€è‡´ä¸”å”¯ä¸€
</code></pre><h1 id="äºŒã€çˆ¶å­åº”ç”¨é€šä¿¡"><a href="#äºŒã€çˆ¶å­åº”ç”¨é€šä¿¡" class="headerlink" title="äºŒã€çˆ¶å­åº”ç”¨é€šä¿¡"></a>äºŒã€çˆ¶å­åº”ç”¨é€šä¿¡</h1><h2 id="qiankun-Actions"><a href="#qiankun-Actions" class="headerlink" title="qiankun - Actions"></a>qiankun - Actions</h2><pre><code>qiankunå®˜æ–¹æä¾›äº†çˆ¶å­åº”ç”¨é€šä¿¡çš„æ–¹æ³•ï¼Œä½¿ç”¨ç®€å•ï¼Œé€‚ç”¨äºä¸šåŠ¡åˆ’åˆ†æ¸…æ™°ï¼Œçˆ¶å­åº”ç”¨é€šä¿¡å°‘çš„åœºæ™¯ã€‚
initGlobalStateæ–¹æ³•ï¼šåˆå§‹åŒ–globalStateçš„å€¼ã€‚
setGlobalStateæ–¹æ³•ï¼šè®¾ç½®globalStateçš„å€¼ï¼Œå†…éƒ¨è¿›è¡Œæµ…æ£€æŸ¥ï¼Œå¦‚æœæ£€æŸ¥åˆ°globalStateå‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…å‡½æ•°ã€‚
onGlobalStateChangeäº‹ä»¶ï¼šè§‚å¯Ÿè€…å‡½æ•°ã€‚åœ¨globalStateå‘ç”Ÿæ”¹å˜æ—¶è§¦å‘è¯¥å‡½æ•°ã€‚
offGlobalStateChangeï¼šå–æ¶ˆè§‚å¯Ÿè€…å‡½æ•°ã€‚
</code></pre>  <canvas id="pic" width="500" height="400"></canvas>

<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ä¸»åº”ç”¨ï¼š</span><br><span class="line">const actions: MicroAppStateActions = initGlobalState(&#123;&#125;);</span><br><span class="line">actions.setGlobalState(&#123;</span><br><span class="line">  publicInfo: &#123;</span><br><span class="line">    name: &apos;origin&apos;,</span><br><span class="line">    authCode: [999],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">actions.onGlobalStateChange((state: any) =&gt; &#123;</span><br><span class="line">  console.log(&apos;ä¸»åº”ç”¨&apos;, state);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">å­åº”ç”¨ï¼š</span><br><span class="line">export async function mount(props) &#123;</span><br><span class="line">  props.setGlobalState(&#123; publicInfo: &apos;123&apos; &#125;);</span><br><span class="line">  props.onGlobalStateChange((state, pre) =&gt; &#123;</span><br><span class="line">    console.log(&apos;å­åº”ç”¨-onGlobalStateChange&apos;, state, pre);</span><br><span class="line">  &#125;);</span><br><span class="line">  Â·Â·Â·Â·Â·Â·</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="redux-Shared"><a href="#redux-Shared" class="headerlink" title="redux - Shared"></a>redux - Shared</h2><h1 id="ä¸‰ã€å…¬å…±èµ„æºå¼•å…¥"><a href="#ä¸‰ã€å…¬å…±èµ„æºå¼•å…¥" class="headerlink" title="ä¸‰ã€å…¬å…±èµ„æºå¼•å…¥"></a>ä¸‰ã€å…¬å…±èµ„æºå¼•å…¥</h1><p>  å¾®å‰ç«¯å¯ä»¥è®©å­åº”ç”¨æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„ä¾èµ–ï¼Œäº’ä¸æ‰“æ‰°ã€‚ä¹¾å¤å®˜æ–¹ä¹Ÿæœ‰æåˆ°ï¼š</p>
<p>  <div class="post-warning">ä¸è¦å…±äº«è¿è¡Œæ—¶ï¼Œå³ä¾¿æ‰€æœ‰å›¢é˜Ÿéƒ½æ˜¯ç”¨åŒä¸€æ¡†æ¶</div><br>  è™½ç„¶å…±äº«ä¾èµ–å¹¶ä¸å»ºè®®ï¼Œä½†å¦‚æœä½ çœŸçš„æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œä½ å¯ä»¥åœ¨å¾®åº”ç”¨ä¸­å°†å…¬å…±ä¾èµ–é…ç½®æˆ externalï¼Œç„¶ååœ¨ä¸»åº”ç”¨ä¸­å¯¼å…¥è¿™äº›å…¬å…±ä¾èµ–ã€‚</p>
<h2 id="å…¬å…±ä¾èµ–"><a href="#å…¬å…±ä¾èµ–" class="headerlink" title="å…¬å…±ä¾èµ–"></a>å…¬å…±ä¾èµ–</h2><p>  å¦‚æœä¸åŒçš„é¡¹ç›®æœ‰ç”¨åˆ°ç›¸åŒçš„åŒ…çš„ç›¸åŒç‰ˆæœ¬ï¼Œé‡å¤åŠ è½½å°±ä¼šå­˜åœ¨æµªè´¹å†…å­˜å’Œé™ä½æ€§èƒ½çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘å¤ç”¨å…¬å…±ä¾èµ–ã€‚</p>
<p>  æˆ‘ä»¬å¯¹äºå…¬å…±ä¾èµ–çš„å¤ç”¨ï¼Œæœ‰ä¸¤ç‚¹æœŸæœ›ï¼šä¸€æ˜¯é›†åˆæ—¶ï¼Œä¸»åº”ç”¨å¯ä»¥åŠ è½½ï¼Œå­åº”ç”¨ä¸å†é‡å¤åŠ è½½ï¼ŒäºŒæ˜¯å­åº”ç”¨ç‹¬ç«‹è¿è¡Œæ—¶å¯ä»¥æ­£å¸¸åŠ è½½è¿è¡Œã€‚</p>
<h3 id="1ï¼‰é›†åˆæ—¶ï¼Œä¸»åº”ç”¨åŠ è½½å…¬å…±ä¾èµ–ï¼Œå­ç”¨ä¸»"><a href="#1ï¼‰é›†åˆæ—¶ï¼Œä¸»åº”ç”¨åŠ è½½å…¬å…±ä¾èµ–ï¼Œå­ç”¨ä¸»" class="headerlink" title="1ï¼‰é›†åˆæ—¶ï¼Œä¸»åº”ç”¨åŠ è½½å…¬å…±ä¾èµ–ï¼Œå­ç”¨ä¸»"></a>1ï¼‰é›†åˆæ—¶ï¼Œä¸»åº”ç”¨åŠ è½½å…¬å…±ä¾èµ–ï¼Œå­ç”¨ä¸»</h3><p>  å­é¡¹ç›®åŸæœ¬éœ€è¦åŠ è½½çš„å…¬å…±éƒ¨åˆ†ï¼Œå…¨éƒ¨ç”±ä¸»é¡¹ç›®è°ƒåº¦ï¼Œé…åˆwebpackçš„externalsåŠŸèƒ½é€šè¿‡å¤–é“¾çš„æ–¹å¼æŒ‰éœ€åŠ è½½ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªå­é¡¹ç›®åŠ è½½è¿‡ï¼Œä¸‹ä¸€ä¸ªå­é¡¹ç›®å°±ä¸éœ€è¦å†åŠ è½½ï¼Œè¿™æ ·ä¸€æ¥æ¯ä¸ªå­é¡¹ç›®çš„distæ–‡ä»¶é‡Œå°±åªæœ‰å­é¡¹ç›®è‡ªå·±çš„ä¸šåŠ¡ä»£ç ï¼›</p>
<p>  ä¸»å­é¡¹ç›®çš„index.html ä¸­å…¬å…±ä¾èµ–çš„ script å’Œ link æ ‡ç­¾åŠ ä¸Š ignore å±æ€§ï¼Œæœ‰äº†è¿™ä¸ªå±æ€§ï¼Œqiankun ä¾¿ä¸ä¼šå†å»åŠ è½½è¿™ä¸ª js/cssã€‚å­é¡¹ç›®ç‹¬ç«‹è¿è¡Œæ—¶ï¼ŒåŠ è½½è‡ªå·±çš„å…¬å…±ä¾èµ–çš„ script å’Œ linkèµ„æºå³å¯ã€‚</p>
  <canvas id="dependencies" width="600" height="300"></canvas>

<p>  ä¸ºäº†å®ç°ä¸»åº”ç”¨åŠ è½½å…¬å…±èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå­åº”ç”¨æ‰€éœ€å…¬å…±ä¾èµ–çš„é›†åˆï¼Œåœ¨å…¨å±€å¾®åº”ç”¨çš„beforeUploadä¸­ï¼Œé€šè¿‡æ’å…¥scriptæ ‡ç­¾çš„æ–¹å¼ï¼ŒåŠ è½½å¯¹äºå­åº”ç”¨æ‰€éœ€çš„jsèµ„æºã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<p>  ä¸»åº”ç”¨ï¼šprimary-app<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  1. å®šä¹‰å­åº”ç”¨çš„å…¬å…±ä¾èµ–</span></span><br><span class="line"><span class="keyword">const</span> dependencies: any = &#123;</span><br><span class="line">  summer: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>], <span class="comment">// å­åº”ç”¨summerï¼Œè¿™é‡Œä»¥reactå’Œreact-domä¸¤ä¸ªåŸºç¡€ä¾èµ–ä¸ºä¾‹</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> getDependencies = <span class="function">(<span class="params">appName: string</span>) =&gt;</span> dependencies[appName];</span><br><span class="line"><span class="comment">// æ„å»ºscriptæ ‡ç­¾</span></span><br><span class="line"><span class="keyword">const</span> loadScript = <span class="function">(<span class="params">url: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">  script.type = <span class="string">'text/javascript'</span>;</span><br><span class="line">  script.src = url;</span><br><span class="line">  script.setAttribute(<span class="string">'ignore'</span>, <span class="string">'true'</span>); <span class="comment">// é¿å…é‡å¤åŠ è½½</span></span><br><span class="line">  script.onerror = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`åŠ è½½å¤±è´¥<span class="subst">$&#123;url&#125;</span>ï¼Œè¯·åˆ·æ–°é‡è¯•`</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">document</span>.head.appendChild(script);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ï¼šæ³¨å†Œå­åº”ç”¨</span></span><br><span class="line">registerMicroApps([</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'summer'</span>, <span class="comment">// app name registered</span></span><br><span class="line">    entry: process.env.NODE_ENV === <span class="string">'production'</span> ? <span class="string">''</span> : <span class="string">'http://localhost:8083/'</span>,</span><br><span class="line">    container: <span class="string">'#router-view'</span>,</span><br><span class="line">    activeRule: [<span class="string">'/systemManage'</span>, <span class="string">'/orderManage'</span>],</span><br><span class="line">  &#125;], &#123;</span><br><span class="line">  beforeLoad: [</span><br><span class="line">    app =&gt; <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolved: any</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[LifeCycle] before load %c%s'</span>, <span class="string">'color: green;'</span>, app.name);</span><br><span class="line">      getDependencies(app.name).forEach(<span class="function">(<span class="params">dependency: string</span>) =&gt;</span> &#123;</span><br><span class="line">        loadScript(<span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.location.origin&#125;</span>/<span class="subst">$&#123;dependency&#125;</span>.js`</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      resolved(<span class="literal">true</span>);</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br><span class="line">);</span><br><span class="line">start();</span><br></pre></td></tr></table></figure></p>
<p>  è¿™é‡Œè¿˜è¦æ³¨æ„é€šè¿‡ webpack æ¥ç”Ÿäº§å¥½ç›¸åº”çš„ä¾èµ–èµ„æºï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ copy-webpack-plugin æ’ä»¶å°† node_modules ä¸‹çš„ release èµ„æºè½¬æ¢æˆåŒ…æˆå¯ä»¥é€šè¿‡ç‹¬ç«‹ URL è®¿é—®çš„èµ„æºã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackExternalsPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-externals-plugin'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackExternalsPlugin(&#123;</span><br><span class="line">      externals: [&#123;</span><br><span class="line">        <span class="built_in">module</span>: <span class="string">'react'</span>,</span><br><span class="line">        entry: &#123;</span><br><span class="line">          path: <span class="string">'umd/react.development.js'</span>,</span><br><span class="line">          attributes: &#123; <span class="attr">ignore</span>: <span class="string">'true'</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        global: <span class="string">'React'</span>,</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        <span class="built_in">module</span>: <span class="string">'react-dom'</span>,</span><br><span class="line">        entry: &#123;</span><br><span class="line">          path: <span class="string">'umd/react-dom.development.js'</span>,</span><br><span class="line">          attributes: &#123; <span class="attr">ignore</span>: <span class="string">'true'</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        global: <span class="string">'ReactDOM'</span>,</span><br><span class="line">      &#125;],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2ï¼‰å­åº”ç”¨åœ¨ç‹¬ç«‹è¿è¡Œæ—¶åˆå¯åŠ è½½æ­£å¸¸è¿è¡Œ"><a href="#2ï¼‰å­åº”ç”¨åœ¨ç‹¬ç«‹è¿è¡Œæ—¶åˆå¯åŠ è½½æ­£å¸¸è¿è¡Œ" class="headerlink" title="2ï¼‰å­åº”ç”¨åœ¨ç‹¬ç«‹è¿è¡Œæ—¶åˆå¯åŠ è½½æ­£å¸¸è¿è¡Œ"></a>2ï¼‰å­åº”ç”¨åœ¨ç‹¬ç«‹è¿è¡Œæ—¶åˆå¯åŠ è½½æ­£å¸¸è¿è¡Œ</h3><p>  å­åº”ç”¨å°†ä¸»åº”ç”¨å·²ç»å®šä¹‰çš„å…¬å…±ä¾èµ–é€šè¿‡ html-webpack-externals-plugin è¿™ä¸ªæ’ä»¶ä½¿ç”¨ external çš„æ–¹å¼ç‹¬ç«‹å‡ºæ¥ï¼Œä¸æ‰“åŒ…åˆ° Webpack bundle ä¸­ï¼ŒåŒæ—¶é€šè¿‡æ’ä»¶çš„é…ç½®ï¼Œç»™ &lt; script &gt; æ ‡ç­¾åŠ ä¸Š ignore å±æ€§ï¼Œé‚£ä¹ˆåœ¨ qiankun åŠ è½½è¿™ä¸ªå­åº”ç”¨æ—¶ä½¿ç”¨ï¼Œqiankun ä¾èµ–çš„ import-html-entry æ’ä»¶åˆ†æåˆ° &lt; script &gt; æ ‡ç­¾æ—¶ï¼Œä¼šå¿½ç•¥åŠ è½½æœ‰ ignore å±æ€§çš„ &lt; script &gt; æ ‡ç­¾ï¼Œè€Œç‹¬ç«‹è®¿é—®æ—¶å­åº”ç”¨æœ¬èº«å¯ä»¥æ­£å¸¸åŠ è½½è¿™ä¸ª Javascript èµ„æºã€‚<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackExternalsPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-externals-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">   plugins: [</span><br><span class="line">     ...</span><br><span class="line">     <span class="keyword">new</span> HtmlWebpackExternalsPlugin(&#123;</span><br><span class="line">       externals: [&#123;</span><br><span class="line">         <span class="built_in">module</span>: <span class="string">'react'</span>,</span><br><span class="line">         entry: &#123;</span><br><span class="line">           path: <span class="string">'umd/react.development.js'</span>,</span><br><span class="line">           attributes: &#123; <span class="attr">ignore</span>: <span class="string">'true'</span> &#125;,</span><br><span class="line">         &#125;,</span><br><span class="line">         global: <span class="string">'React'</span>,</span><br><span class="line">       &#125;, &#123;</span><br><span class="line">         <span class="built_in">module</span>: <span class="string">'react-dom'</span>,</span><br><span class="line">         entry: &#123;</span><br><span class="line">           path: <span class="string">'umd/react-dom.development.js'</span>,</span><br><span class="line">           attributes: &#123; <span class="attr">ignore</span>: <span class="string">'true'</span> &#125;,</span><br><span class="line">         &#125;,</span><br><span class="line">         global: <span class="string">'ReactDOM'</span>,</span><br><span class="line">       &#125;],</span><br><span class="line">     &#125;),</span><br><span class="line">   ],</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></p>
<p>  <strong>è¸©å‘è®°å½•</strong>ï¼š<br>  1ï¼‰å®‰è£…copy-webpack-pluginæ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ç‰ˆæœ¬å…¼å®¹é—®é¢˜ï¼Œè¿™æ—¶å€™å®‰è£…åˆé€‚çš„ç‰ˆæœ¬å¯ä»¥è§£å†³ã€‚<br>  2ï¼‰å®‰è£…html-webpack-externals-pluginæ—¶ï¼Œé‡åˆ°äº†ï¼šSuper expression must either be null or a function, not undefinedæŠ¥é”™ã€‚<br>     è§£å†³ï¼šè¯•äº†åˆ‡æ¢ç‰ˆæœ¬åè¿˜æ˜¯ä¸è¡Œï¼Œæœ‰è¯´æ˜¯React.Componentçš„å¤§å°å†™å†™é”™äº†ï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰ç”¨åˆ°React.Componentã€‚æœ€åå‘ç°æ˜¯HtmlWebpackExternalsPlugin.externalsé…ç½®é¡¹çš„moduleå’Œglobalé…ç½®å‡ºç°é—®é¢˜ã€‚å¤§å®¶é‡åˆ°äº†ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ä¹Ÿå¯ä»¥æ£€æŸ¥æ­¤é…ç½®é¡¹ã€‚</p>
<p>  copy-webpack-plugin åœ¨æ„å»ºè¿‡ç¨‹ä¸­å¤åˆ¶æºæ ‘ä¸­å·²ç»å­˜åœ¨çš„æ–‡ä»¶ã€‚<br>  HtmlWebpackExternalsPlugin : åŸºç¡€åº“ä¸æ‰“åŒ…ï¼Œç›´æ¥URLï¼ˆCDNï¼‰å¼•å…¥ã€‚</p>
<p>  è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<a href="https://github.com/mmiller42/html-webpack-externals-plugin" target="_blank" rel="noopener">HtmlWebpackExternalsPlugin</a>æ’ä»¶ç›®å‰å·²ç»è¢«å¼ƒç”¨ï¼Œä¸å†ç»´æŠ¤ï¼š<br>  <div class="post-warning">Sorry, this module is no longer maintained, and its functionality is baked into wonderful plugins by jharris4, html-webpack-tags-plugin and html-webpack-deploy-plugin.</div><br>  ä½†æ˜¯å¾ˆé—æ†¾ <a href="https://github.com/jharris4/html-webpack-deploy-plugin" target="_blank" rel="noopener">html-webpack-tags-plugin</a>å’Œ<a href="https://github.com/jharris4/html-webpack-deploy-plugin" target="_blank" rel="noopener">html-webpack-deploy-plugin</a>çš„3.xç‰ˆæœ¬éƒ½è¦æ±‚ä½¿ç”¨webpack5.0æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚æˆ‘ä»¬çš„åŸºåº§åº”ç”¨primary-appçš„webpackç‰ˆæœ¬æ˜¯4.xç‰ˆæœ¬ï¼Œä¸”è¢«äºŒæ¬¡å°è£…è¿‡ï¼Œæš‚æ— æ³•ä½“éªŒè¿™ä¸¤ä¸ªæ’ä»¶ã€‚</p>
<p>  ä¸è¿‡è¿™ä¸ªæ’ä»¶ä¸å†ç»´æŠ¤ï¼Œä¸”æˆ‘ä»¬ç”¨ç›®å‰çš„ç‰ˆæœ¬é‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬æ‹†å¼€æ¥é…ä¹Ÿè¡Œï¼š<br>  è¿™ä¸ªæ’ä»¶éå¸¸ç®€å•ï¼Œåªæ˜¯å°è£…äº†å¦å¤–ä¸¤ä¸ª Webpack æ’ä»¶æ¥å®Œæˆç¹é‡çš„å·¥ä½œã€‚å®ƒï¼š<br>    åœ¨è¿è¡Œæ—¶ä¿®æ”¹æ‚¨çš„ Webpack é…ç½®ä»¥å°†æ‚¨çš„ä¾›åº”å•†æ¨¡å—æ·»åŠ åˆ°externalså±æ€§ä¸­ã€‚<br>    è¿è¡Œcopy-webpack-pluginå°†æ‚¨çš„ä¾›åº”å•†æ¨¡å—èµ„äº§å¤åˆ¶åˆ°è¾“å‡ºè·¯å¾„ä¸­ã€‚<br>    è¿è¡Œhtml-webpack-include-assets-pluginå°†æ‚¨çš„ä¾›åº”å•†æ¨¡å—åŒ…æ·»åŠ åˆ° HTML è¾“å‡ºã€‚</p>
<p>  ModuleFederationPlugin</p>
<h2 id="å…¬å…±ç»„ä»¶"><a href="#å…¬å…±ç»„ä»¶" class="headerlink" title="å…¬å…±ç»„ä»¶"></a>å…¬å…±ç»„ä»¶</h2><pre><code>1) npmåŒ…çš„æ–¹å¼
  NPM æˆ–è€… Git Tagã€Git Submodule æ¥ç®¡ç†

2ï¼‰çˆ¶å­é¡¹ç›®é—´çš„ç»„ä»¶å…±äº«
</code></pre><h1 id="å››ã€å¸¸è§é—®é¢˜"><a href="#å››ã€å¸¸è§é—®é¢˜" class="headerlink" title="å››ã€å¸¸è§é—®é¢˜"></a>å››ã€å¸¸è§é—®é¢˜</h1><h2 id="è·¨åŸŸ"><a href="#è·¨åŸŸ" class="headerlink" title="è·¨åŸŸ"></a>è·¨åŸŸ</h2><p>  é—®é¢˜ï¼š Access to fetch at â€˜<a href="http://localhost:8083/&#39;" target="_blank" rel="noopener">http://localhost:8083/&#39;</a> from origin â€˜<a href="http://localhost:3032&#39;" target="_blank" rel="noopener">http://localhost:3032&#39;</a> has been blocked by CORS policy: No â€˜Access-Control-Allow-Originâ€™ header is present on the requested resource. If an opaque response serves your needs, set the requestâ€™s mode to â€˜no-corsâ€™ to fetch the resource with CORS disabled.</p>
<p>  è§£å†³ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.all(&apos;*&apos;, (_req, res, next) =&gt; &#123;</span><br><span class="line">  res.header(&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;);</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="ä¸»åº”ç”¨å’Œå­åº”ç”¨å†²çª"><a href="#ä¸»åº”ç”¨å’Œå­åº”ç”¨å†²çª" class="headerlink" title="ä¸»åº”ç”¨å’Œå­åº”ç”¨å†²çª"></a>ä¸»åº”ç”¨å’Œå­åº”ç”¨å†²çª</h2><p>  é—®é¢˜ï¼š cjs å’Œ esm ç­‰å…¼å®¹æ€§é—®é¢˜<br>        You are loading the CommonJS build of React Router on a page that is already running the ES modules build, so things wonâ€™t work right. </p>
<p>  è§£å†³ï¼š<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">  mainFields: [&apos;browser&apos;, &apos;jsnext:main&apos;, &apos;main&apos;],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="åŠ è½½å­åº”ç”¨å¤±è´¥"><a href="#åŠ è½½å­åº”ç”¨å¤±è´¥" class="headerlink" title="åŠ è½½å­åº”ç”¨å¤±è´¥"></a>åŠ è½½å­åº”ç”¨å¤±è´¥</h2><p>  é—®é¢˜ï¼šApplication died in status LOADING_SOURCE_CODE: You need to export the functional lifecycles in xxx entry<br>  è§£å†³ï¼š <a href="https://qiankun.umijs.org/zh/faq" target="_blank" rel="noopener">å¸¸è§é—®é¢˜</a></p>
<h2 id="å­åº”ç”¨æ¸²æŸ“é—®é¢˜"><a href="#å­åº”ç”¨æ¸²æŸ“é—®é¢˜" class="headerlink" title="å­åº”ç”¨æ¸²æŸ“é—®é¢˜"></a>å­åº”ç”¨æ¸²æŸ“é—®é¢˜</h2><p>  é—®é¢˜ï¼šå­åº”ç”¨é¦–æ¬¡æ¸²æŸ“ï¼Œåˆ‡æ¢å›ä¸»åº”ç”¨æˆ–å…¶ä»–å­åº”ç”¨åå†åˆ‡å›æ¥ï¼Œå°±åªåŠ è½½åˆ°å­åº”ç”¨æ ¹èŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹é‡Œé¢çš„å†…å®¹å°±ä¸æ’å…¥åˆ°æ ¹èŠ‚ç‚¹ä¸­äº†ï¼Ÿï¼Ÿï¼Ÿ<br>  è§£å†³ï¼šåœ¨ç”Ÿå‘½å‘¨æœŸçš„mountå‡½æ•°ä¸­æŒ‚åœ¨æ—¶ï¼Œä¹Ÿè¦åˆ¤æ–­æ˜¯å¦æœ‰containerï¼Œæœ‰çš„è¯æŒ‚åœ¨åœ¨containerèŠ‚ç‚¹ä¸Šã€‚<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const &#123; container &#125; = props;</span><br><span class="line">if (container) &#123;</span><br><span class="line">  Render(container.querySelector(&apos;#root&apos;));</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  Render(document.getElementById(&apos;root&apos;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="çˆ¶å­åº”ç”¨åˆ‡æ¢"><a href="#çˆ¶å­åº”ç”¨åˆ‡æ¢" class="headerlink" title="çˆ¶å­åº”ç”¨åˆ‡æ¢"></a>çˆ¶å­åº”ç”¨åˆ‡æ¢</h2><p>  é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªåº”ç”¨åœ¨çˆ¶åº”ç”¨ä¸­æœ‰ä¸¤ä¸ªè·¯ç”±é¡µé¢ã€‚ä»å­åº”ç”¨çš„é¡µé¢1ï¼Œé€šè¿‡çˆ¶åº”ç”¨èœå•åˆ‡æ¢åˆ°çˆ¶åº”ç”¨ï¼Œå†é€šè¿‡çˆ¶åº”ç”¨èœå•åˆ‡æ¢åˆ°å­åº”ç”¨çš„é¡µé¢2ï¼Œæ­¤æ—¶é¡µé¢åŠ è½½çš„æ˜¯å­åº”ç”¨çš„é¡µé¢1ã€‚<br>  è§£å†³ï¼šåœ¨èœå•Menuçš„clickæ–¹æ³•ä¸­ï¼ŒåŠ ä¸Škey<br>       <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import &#123; useHistory &#125; from &apos;react-router-dom&apos;;</span><br><span class="line"></span><br><span class="line">const CustomMenu = memo((props: InjectedIntlProps) =&gt; &#123;</span><br><span class="line">  const history = useHistory();</span><br><span class="line"></span><br><span class="line">  const onClick = (menuItem: any) =&gt; &#123;</span><br><span class="line">    Â·Â·Â·</span><br><span class="line">    history.push(key, &#123;&#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (&lt;Menu onClick=&#123;onClick&#125;&gt; Â·Â·Â· &lt;/Menu&gt;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default CustomMenu;</span><br></pre></td></tr></table></figure></p>
<h2 id="output-jsonpFunctionn"><a href="#output-jsonpFunctionn" class="headerlink" title="output.jsonpFunctionn"></a>output.jsonpFunctionn</h2><p>  webpack5åˆ é™¤äº†è¯¥å±æ€§ï¼Œæ›¿æ¢ä¸ºoutput.chunkLoadingGlobalã€‚</p>
<p>  èµ„æ–™ï¼š<br>  <a href="https://www.zhihu.com/column/c_1250900868893462528" target="_blank" rel="noopener">å¾®å‰ç«¯-çŸ¥ä¹</a></p>
  <script>
    const oCanvas = document.getElementById("pic");
    const oPen = oCanvas.getContext('2d');
    oPen.textAlign = "left";
    oPen.textBaseLine = "hanging";
    oPen.fillStyle = "deeppink";
    oPen.font = '18px sans-serif';
    oPen.fillText("ä¸»åº”ç”¨", 30,50);
    oPen.fillText("Â·Â·Â·", 160,50);
    oPen.fillText("å­åº”ç”¨1", 240,50);
    oPen.fillText("å­åº”ç”¨2", 390,50);
    oPen.fillStyle = "green";
    oPen.fillText("çˆ¶å­åº”ç”¨æ›´æ–°globalState", 160,200);
    oPen.fillStyle = "blue";
    oPen.fillText("çˆ¶åº”ç”¨åˆå§‹åŒ–globalState", 160,320);
    oPen.fillStyle = "deeppink";
    oPen.font = '12px sans-serif';
    oPen.fillText("onGlobalStateChange", 0, 65);
    oPen.fillText("onGlobalStateChange", 210,65);
    oPen.fillText("onGlobalStateChange", 360,65);
    oPen.fillStyle = "green";
    oPen.fillText("setGlobalState", 220,215);
    oPen.fillText("â†‘", 260,160);
    oPen.fillText("æ›´æ–°", 280,160);
    oPen.fillStyle = "blue";
    oPen.fillText("initGlobalState", 220,335);
    oPen.fillText("â†‘", 260,295);
    oPen.fillText("åˆå§‹åŒ–", 280,295);
    oPen.closePath();


    // oPen.fillText("Hello World!" , 70 ,50);
    // oPen.strokeText("Hello World!" , 320 ,50);

    const oQiankun = document.getElementById("qiankun");
    const oContext = oQiankun.getContext('2d');
    oContext.textAlign = "left";
    oContext.textBaseLine = "hanging";
    oContext.fillStyle = "orange";
    oContext.font = '30px sans-serif';
    oContext.fillText("å¾®å‰ç«¯", 200, 230);
    oContext.fillStyle = "black";
    oContext.font = '20px sans-serif';
    oContext.fillText("jsæ²™ç®±", 218, 40);
    oContext.fillText("æ ·å¼éš”ç¦»", 360, 100);
    oContext.fillText("HTML Entry", 380, 200);
    oContext.fillText("Config Entry", 350, 300);
    oContext.fillText("æŒ‰éœ€åŠ è½½", 340, 390);
    oContext.fillText("å…¬å…±ä¾èµ–åŠ è½½", 190, 450);
    oContext.fillText("é¢„åŠ è½½", 100, 390);
    oContext.fillText("çˆ¶å­åº”ç”¨é€šè®¯", 30, 300);
    oContext.fillText("å­åº”ç”¨åµŒå¥—", 10, 200);
    oContext.fillText("å­åº”ç”¨å¹¶è¡Œ", 40, 100);


    const oDependencies = document.getElementById("dependencies");
    const oPen1 = oDependencies.getContext('2d');
    oPen1.textAlign = "left";
    oPen1.textBaseLine = "hanging";
    oContext.fillStyle = "orange";
    oPen1.font = '16px sans-serif';
    oPen1.fillText("ä¸»é¡¹ç›®", 80, 20);
    oPen1.fillText("node_modules", 50, 45);
    oPen1.fillText("â†“", 100, 100);
    oPen1.fillText("js", 130, 100);
    oPen1.fillText("ä¸»é¡¹ç›®", 200, 20);
    oPen1.fillText("<script src='xxx.js' ignore>", 10, 150);
    oPen1.fillText("å­é¡¹ç›®", 380, 20);
    oPen1.fillText("node_modules", 350, 45);
    oPen1.fillText("â†“", 400, 100);
    oPen1.fillText("js", 430, 100);
    oPen1.fillText("<script src='xxx.js' ignore>", 310, 150);
    oPen1.fillText("â†˜", 120, 200);
    oPen1.fillText("â†™", 380, 200);
    oPen1.fillText("ä¸» å­å…±åŒè¿è¡Œæ—¶ï¼Œå–ä¸»ã€‚å­ç‹¬ç«‹è¿è¡Œæ—¶ï¼Œå–å­ã€‚", 100, 250);
  </script>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/30/summer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/30/summer/" itemprop="url">summer</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-30T17:05:30+08:00">
                2021-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/æ¡†æ¶/" itemprop="url" rel="index">
                    <span itemprop="name">æ¡†æ¶</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ä¸€ã€-æ­å»ºè¿‡ç¨‹"><a href="#ä¸€ã€-æ­å»ºè¿‡ç¨‹" class="headerlink" title="ä¸€ã€ æ­å»ºè¿‡ç¨‹"></a>ä¸€ã€ æ­å»ºè¿‡ç¨‹</h1><h2 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1. åˆå§‹åŒ–"></a>1. åˆå§‹åŒ–</h2><ul>
<li><p>package.json<br>npm initåˆå§‹åŒ–æˆ–è€…æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªpackage.jsonã€‚<br>å› ä¸ºæš‚æ—¶githubæ€»æ˜¯æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥æš‚æ—¶ä¸git initæˆ–è€…åˆ›å»ºè¿œç¨‹gitä»“åº“äº†ã€‚ä¹Ÿä¸é…ç½®.gitignoreæ–‡ä»¶äº†</p>
</li>
<li><p>README.md<br>touch åˆå§‹åŒ–æˆ–è€…æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªREADME.mdã€‚</p>
</li>
<li><p>å»ºç«‹æ–‡ä»¶ç›®å½•</p>
</li>
<li><p>é…ç½®webpack<br>webpack-cli initåˆå§‹åŒ–æˆ–è€…æ‰‹åŠ¨åˆ›å»ºwebpacké…ç½®æ–‡ä»¶ã€‚<br>webpack â€“config â€˜webpacké…ç½®æ–‡ä»¶â€™ã€‚<br><br></p>
</li>
</ul>
<h2 id="2-å¯åŠ¨-server"><a href="#2-å¯åŠ¨-server" class="headerlink" title="2. å¯åŠ¨ server"></a>2. å¯åŠ¨ server</h2><p>  å¯ä»¥ç›´æ¥ä½¿ç”¨å†…ç½®çš„webpack-dev-serverå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥é€šè¿‡expressæ­å»ºæœåŠ¡å™¨ã€‚</p>
<h3 id="express"><a href="#express" class="headerlink" title="express"></a>express</h3><pre><code>npm install express --save-dev

start.js
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&quot;express&quot;);</span><br><span class="line">const app = express();</span><br><span class="line"></span><br><span class="line">app.get(&apos;/&apos;, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(&apos;nodeJSæœåŠ¡å™¨æ­å»ºæˆåŠŸï¼&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(8083, () =&gt; &#123;</span><br><span class="line">  console.log(&apos;Server is running at http://localhost:8083&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

æ‰§è¡Œnode start.jsï¼Œå³å¯å¯åŠ¨æœåŠ¡å™¨ã€‚é¡µé¢æ˜¾ç¤ºï¼š&apos;nodeJSæœåŠ¡å™¨æ­å»ºæˆåŠŸï¼&apos;ã€‚
</code></pre><h3 id="express-htmlæ¨¡æ¿-çƒ­é‡è½½çƒ­æ›´æ–°"><a href="#express-htmlæ¨¡æ¿-çƒ­é‡è½½çƒ­æ›´æ–°" class="headerlink" title="express+htmlæ¨¡æ¿+çƒ­é‡è½½çƒ­æ›´æ–°"></a>express+htmlæ¨¡æ¿+çƒ­é‡è½½çƒ­æ›´æ–°</h3><pre><code>npm install --save webpack
npm install --save-dev webpack-dev-middleware webpack-hot-middleware
npm install --save html-webpack-plugin

- webpack-dev-middleware æ’ä»¶ï¼Œè¯¥æ’ä»¶å¯¹æ›´æ”¹çš„æ–‡ä»¶è¿›è¡Œç›‘æ§ï¼Œç¼–è¯‘ã€‚
- ä¸€èˆ¬å’Œ webpack-hot-middleware[https://github.com/webpack-contrib/webpack-hot-middleware] é…åˆä½¿ç”¨ï¼Œå®ç°çƒ­åŠ è½½åŠŸèƒ½
- HtmlWebpackPlugin
HtmlWebpackPlugin ç®€åŒ–äº† HTML æ–‡ä»¶çš„åˆ›å»ºï¼Œä»¥ä¾¿ä¸ºä½ çš„ webpack åŒ…æä¾›æœåŠ¡ã€‚è¿™å¯¹äºé‚£äº›æ–‡ä»¶åä¸­åŒ…å«å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”å“ˆå¸Œå€¼ä¼šéšç€æ¯æ¬¡ç¼–è¯‘è€Œæ”¹å˜çš„ webpack åŒ…ç‰¹åˆ«æœ‰ç”¨ã€‚ä½ å¯ä»¥è®©è¯¥æ’ä»¶ä¸ºä½ ç”Ÿæˆä¸€ä¸ª HTML æ–‡ä»¶ï¼Œä½¿ç”¨ lodash æ¨¡æ¿æä¾›æ¨¡æ¿ï¼Œæˆ–è€…ä½¿ç”¨ä½ è‡ªå·±çš„ loaderã€‚


webpacké…ç½®ï¼š
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const webpack = require(&apos;webpack&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">  entry: [&apos;webpack-hot-middleware/client?path=/__webpack_hmr&amp;timeout=20000&apos;, path.resolve(__dirname, &apos;../src/index.js&apos;)],</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: &apos;bundle.js&apos;,</span><br><span class="line">    path: path.resolve(__dirname, &apos;../dist&apos;),</span><br><span class="line">    publicPath: &apos;/&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  mode: &apos;development&apos;,</span><br><span class="line">  plugins: [</span><br><span class="line">    new HtmlWebpackPlugin(&#123;</span><br><span class="line">      inject: true,</span><br><span class="line">      filename: &apos;index.html&apos;,</span><br><span class="line">      template: path.resolve(process.cwd(), &apos;public&apos;, &apos;index.html&apos;),</span><br><span class="line">    &#125;),</span><br><span class="line">    new webpack.HotModuleReplacementPlugin(),</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

start.js é…ç½®
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const express = require(&quot;express&quot;);</span><br><span class="line">const path = require(&quot;path&quot;);</span><br><span class="line">const webpack = require(&quot;webpack&quot;);</span><br><span class="line">const webpackConfig = require(&quot;../config/webpack.base.config&quot;);</span><br><span class="line">const webpackHotMiddleware = require(&quot;webpack-hot-middleware&quot;);</span><br><span class="line">const webpackDevMiddleware = require(&quot;webpack-dev-middleware&quot;);</span><br><span class="line"></span><br><span class="line">const compiler = webpack(webpackConfig);</span><br><span class="line">const middleware = webpackDevMiddleware(compiler, &#123;</span><br><span class="line">  //ç»‘å®šä¸­é—´ä»¶çš„å…¬å…±è·¯å¾„,ä¸webpacké…ç½®çš„è·¯å¾„ç›¸åŒ</span><br><span class="line">  publicPath: webpackConfig.output.publicPath,</span><br><span class="line">&#125;);</span><br><span class="line">const app = express();</span><br><span class="line">const fs = middleware.context.outputFileSystem;</span><br><span class="line"></span><br><span class="line">app.use(middleware);</span><br><span class="line">app.use(webpackHotMiddleware(compiler));</span><br><span class="line">app.get(&apos;*&apos;, (req, res) =&gt; &#123;</span><br><span class="line">  fs.readFile(path.join(compiler.outputPath, &apos;index.html&apos;), (err, file) =&gt; &#123;</span><br><span class="line">    if (err) &#123;</span><br><span class="line">      res.sendStatus(404);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      res.send(file.toString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.listen(8083, () =&gt; &#123;</span><br><span class="line">  console.log(&apos;Server is running at http://localhost:8083&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

index.js
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import a from &apos;./containers/Demo/index.js&apos;;</span><br><span class="line"></span><br><span class="line">const handleTest = () =&gt; &#123;</span><br><span class="line">  console.log(&apos;a:&apos;, a);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// å¼€å‘æ¨¡å¼ä¸‹çƒ­åŠ è½½</span><br><span class="line">if (module.hot) &#123;</span><br><span class="line">  module.hot.accept([&apos;./containers/Demo/index.js&apos;], function () &#123; </span><br><span class="line">    handleTest();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handleTest();</span><br></pre></td></tr></table></figure>

node start.jsæˆ–åœ¨package.jsonä¸­é…ç½®scriptè„šæ­¥å‘½ä»¤ï¼ˆ&quot;start&quot;: &quot;node scripts/start.js &quot;ï¼‰ã€‚
</code></pre><p>  <br></p>
<h2 id="3-react-ts-antd"><a href="#3-react-ts-antd" class="headerlink" title="3.react + ts + antd"></a>3.react + ts + antd</h2><p>  npm install  -S  babel-loader thread-loader cache-loader<br>                  ts-loader css-loader style-loader url-loader<br>                  less less-loader typescript<br>                  @babel/preset-react  @babel/core</p>
<h3 id="react"><a href="#react" class="headerlink" title="react"></a>react</h3><h4 id="é…ç½®webpack"><a href="#é…ç½®webpack" class="headerlink" title="é…ç½®webpack"></a>é…ç½®webpack</h4><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.js$/,</span><br><span class="line">      exclude: /node_moduÃ¥les/,</span><br><span class="line">      use: [</span><br><span class="line">        &apos;cache-loader&apos;,</span><br><span class="line">        &apos;thread-loader&apos;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: &apos;babel-loader&apos;,</span><br><span class="line">          options: &#123;</span><br><span class="line">            cacheDirectory: true</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.(ts|tsx)$/,</span><br><span class="line">      exclude: /node_modules/,</span><br><span class="line">      use: [</span><br><span class="line">        &apos;cache-loader&apos;,</span><br><span class="line">        &apos;thread-loader&apos;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: &apos;ts-loader&apos;,</span><br><span class="line">          options: &#123; transpileOnly: true, happyPackMode: true &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.less$/,</span><br><span class="line">      exclude: /node_modules/,</span><br><span class="line">      use: [</span><br><span class="line">        &apos;style-loader&apos;,</span><br><span class="line">        &apos;css-loader&apos;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: &apos;less-loader&apos;,</span><br><span class="line">          options: &#123;</span><br><span class="line">            lessOptions: &#123;</span><br><span class="line">              javascriptEnabled: true,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.css$/,</span><br><span class="line">      exclude: /node_modules/,</span><br><span class="line">      use: [</span><br><span class="line">        &apos;style-loader&apos;,</span><br><span class="line">        &apos;css-loader&apos;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.(jpg|jpeg|png|gif|webp)$/,</span><br><span class="line">      exclude: /node_modules/,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: &apos;url-loader&apos;,</span><br><span class="line">          options: &#123;</span><br><span class="line">            // Inline files smaller than 10 kB</span><br><span class="line">            limit: 10 * 1024,</span><br><span class="line">            name: &apos;static/assets/[name].[ext]&apos;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="å¼•å…¥react"><a href="#å¼•å…¥react" class="headerlink" title="å¼•å…¥react"></a>å¼•å…¥react</h4><pre><code>index.js
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import * as ReactDOM from &apos;react-dom&apos;;</span><br><span class="line"></span><br><span class="line">import Main from &apos;./containers/Main&apos;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const Render = ()  =&gt; &#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;Main /&gt;,</span><br><span class="line">    document.getElementById(&apos;root&apos;),</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// å¼€å‘æ¨¡å¼ä¸‹çƒ­åŠ è½½</span><br><span class="line">if (module.hot) &#123;</span><br><span class="line">  module.hot.accept([&apos;./containers/Main&apos;], function () &#123; </span><br><span class="line">    Render();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Render();</span><br></pre></td></tr></table></figure>

src/containers/Main/index.js
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line"></span><br><span class="line">const Main = () =&gt; &#123;</span><br><span class="line">  return (&lt;div&gt;Main&lt;/div&gt;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default Main;</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="typescript"><a href="#typescript" class="headerlink" title="typescript"></a>typescript</h3><p>  ä»¥ä¸Šï¼Œæˆ‘ä»¬å·²ç»å¼•å…¥äº†reactï¼Œå¯ä»¥ä½¿ç”¨jsxè¯­æ³•ã€‚ç°åœ¨æˆ‘ä»¬æ¥å°è¯•å¼•å…¥tsã€‚</p>
<h4 id="1-webapcké…ç½®"><a href="#1-webapcké…ç½®" class="headerlink" title="1. webapcké…ç½®"></a>1. webapcké…ç½®</h4><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: /\.(ts|tsx)$/,</span><br><span class="line">    exclude: /node_modules/,</span><br><span class="line">    use: [</span><br><span class="line">      &apos;cache-loader&apos;,</span><br><span class="line">      &apos;thread-loader&apos;,</span><br><span class="line">      &#123;</span><br><span class="line">        loader: &quot;ts-loader&quot;,</span><br><span class="line">        options: &#123; transpileOnly: true, happyPackMode: true &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

é—®é¢˜1ï¼šCould not find a declaration file for module &apos;react&apos;ã€‚
      Could not find a declaration file for module &apos;react-dom&apos;.
è§£å†³ï¼šnpm install @types/react @types/react-dom --save-dev

é—®é¢˜2ï¼šField &apos;browser&apos; doesn&apos;t contain a valid alias configurationã€‚
webapcké…ç½®:å°è¯•æŒ‰é¡ºåºè§£æè¿™äº›åç¼€åã€‚å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶æœ‰ç›¸åŒçš„åå­—ï¼Œä½†åç¼€åä¸åŒï¼Œwebpack ä¼šè§£æåˆ—åœ¨æ•°ç»„é¦–ä½çš„åç¼€çš„æ–‡ä»¶ å¹¶è·³è¿‡å…¶ä½™çš„åç¼€ã€‚
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">  extensions: [&quot;.tsx&quot;, &quot;.js&quot;, &quot;.jsx&quot;, &quot;.react.js&quot;, &quot;.ts&quot;, &quot;.json&quot;],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="2-tsconfig-json"><a href="#2-tsconfig-json" class="headerlink" title="2. tsconfig.json"></a>2. tsconfig.json</h4><pre><code>é¦–å…ˆæˆ‘ä»¬å¾—è£…ä¸€ä¸ªtypescriptï¼Œè¿™å°±è·Ÿæˆ‘ä»¬åœ¨ç”¨babelå‰éœ€è¦å…ˆè£…ä¸€ä¸ªbabel-coreæ˜¯ä¸€ä¸ªé“ç†ã€‚
npx tsc --initç”Ÿæˆtsconfig.jsonæˆ–æ‰‹åŠ¨åˆ›å»ºã€‚

æŠ¥é”™ï¼šCannot use JSX unless the &apos;--jsx&apos; flag is prodided.æç¤ºä¸èƒ½ä½¿ç”¨jsxçš„è¯­æ³•
è§£å†³ï¼šå»tsconfigé…ç½®ä¸€ä¸‹å³å¯ã€‚
    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;:&#123;</span><br><span class="line">    &quot;jsx&quot;: &quot;react&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

jsxè¿™ä¸ªé…ç½®é¡¹æœ‰ä¸‰ä¸ªå€¼å¯é€‰æ‹©ï¼Œåˆ†åˆ«æ˜¯&quot;preserve&quot;,&quot;react-native&quot;å’Œ&quot;react&quot;ã€‚åœ¨preserveå’Œreact-nativeæ¨¡å¼ä¸‹ç”Ÿæˆä»£ç ä¸­ä¼šä¿ç•™JSXä»¥ä¾›åç»­çš„è½¬æ¢æ“ä½œä½¿ç”¨ï¼ˆæ¯”å¦‚ï¼šBabelï¼‰ã€‚å¦å¤–ï¼Œpreserveè¾“å‡ºæ–‡ä»¶ä¼šå¸¦æœ‰.jsxæ‰©å±•åï¼Œè€Œreact-nativeæ˜¯.jsæ‹“å±•åã€‚reactæ¨¡å¼ä¼šç”ŸæˆReact.createElementï¼Œåœ¨ä½¿ç”¨å‰ä¸éœ€è¦å†è¿›è¡Œè½¬æ¢æ“ä½œäº†ï¼Œè¾“å‡ºæ–‡ä»¶çš„æ‰©å±•åä¸º.jsã€‚
</code></pre><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>è¾“å…¥</th>
<th>è¾“å‡º</th>
<th>è¾“å‡ºæ–‡ä»¶æ‰©å±•å</th>
</tr>
</thead>
<tbody>
<tr>
<td>preserve</td>
<td>&lt; div /&gt;</td>
<td>&lt; div /&gt;</td>
<td>.jsx</td>
</tr>
<tr>
<td>react</td>
<td>&lt; div /&gt;</td>
<td>React.createElement(â€œdivâ€)</td>
<td>.js</td>
</tr>
<tr>
<td>react-native</td>
<td>&lt; div /&gt;</td>
<td>&lt; div /&gt;</td>
<td>.js</td>
</tr>
</tbody>
</table>
<h3 id="antd-style-componets-æ ·å¼ç®¡ç†"><a href="#antd-style-componets-æ ·å¼ç®¡ç†" class="headerlink" title="antd + style-componets æ ·å¼ç®¡ç†"></a>antd + style-componets æ ·å¼ç®¡ç†</h3><h4 id="antd"><a href="#antd" class="headerlink" title="antd"></a>antd</h4><p>   npm install antd â€“save</p>
<p>   ä¹‹åè¦å¼•å…¥antdçš„æ ·å¼<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &apos;antd/dist/antd.css&apos;; // or &apos;antd/dist/antd.less&apos;</span><br><span class="line"></span><br><span class="line">æ­¤æ—¶é‡åˆ°æŠ¥é”™ï¼š</span><br><span class="line">å¼•å…¥çš„æ˜¯cssæ—¶: ERROR in ./node_modules/antd/dist/antd.css 13:6</span><br><span class="line">              Module parse failed: Unexpected token (13:6)</span><br><span class="line">å¼•å…¥çš„æ˜¯lessæ—¶: ERROR in ./node_modules/antd/dist/antd.less 1:0</span><br><span class="line">              Module parse failed: Unexpected character &apos;@&apos; (1:0)</span><br><span class="line"></span><br><span class="line">è§£å†³åŠæ³•ï¼šåœ¨webpackä¸­çš„cssæˆ–lessé…ç½®ä¸€ä¸ª include: /node_modules/å³å¯ã€‚</span><br></pre></td></tr></table></figure></p>
<h4 id="style-componets"><a href="#style-componets" class="headerlink" title="style-componets"></a>style-componets</h4><p>   npm install -S styled-components</p>
<p><br></p>
<h2 id="4-çŠ¶æ€ç®¡ç†"><a href="#4-çŠ¶æ€ç®¡ç†" class="headerlink" title="4. çŠ¶æ€ç®¡ç†"></a>4. çŠ¶æ€ç®¡ç†</h2><h3 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h3><p>  redux-toolkit  + redux-saga<br>  Redux &amp; Mobx =&gt; Redux; ä½†æ˜¯ç”±äºä½¿ç”¨Reduxæ ·æ¿ä»£ç è¿‡å¤šï¼Œå› æ­¤æœ€ç»ˆé€‰ç”¨çš„æ˜¯redux-toolkitï¼Œredux-toolkitåªæ˜¯å¯¹reduxä»¥åŠéƒ¨åˆ†ä¸­é—´ä»¶è¿›è¡Œè¿›ä¸€æ­¥å°è£…ï¼Œå¹¶ä¸æ˜¯ä¸­é—´ä»¶ä¹Ÿä¸æ˜¯æ–°çš„è§£å†³æ–¹æ¡ˆï¼›</p>
<p>  npm i -S react-redux @reduxjs/toolkit redux-saga redux-injectors<br>  npm i -S whatwg-fetch qs</p>
<h3 id="å…¬å…±çŠ¶æ€"><a href="#å…¬å…±çŠ¶æ€" class="headerlink" title="å…¬å…±çŠ¶æ€"></a>å…¬å…±çŠ¶æ€</h3><pre><code>1. å…¬å…±çŠ¶æ€æŒ‡æ•´ä¸ªåº”ç”¨æ‰€å…±ç”¨çš„ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹æ•°æ®ï¼š
2. å…¨å±€çŠ¶æ€æ ‡è¯†ï¼šloading, Error, åˆå§‹åŒ–ç­‰çŠ¶æ€ï¼›
3. å…¬å…±LayoutçŠ¶æ€ï¼›
4. ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼šåŸºç¡€ä¿¡æ¯ç­‰ï¼›
5. è·¯ç”±æ•°æ®ï¼›
6. é€šç”¨åŸºç¡€æ•°æ®ï¼›
</code></pre><h3 id="æ•°æ®å–ç”¨"><a href="#æ•°æ®å–ç”¨" class="headerlink" title="æ•°æ®å–ç”¨"></a>æ•°æ®å–ç”¨</h3><p>  å–æ•°æ®ä½¿ç”¨çš„æ˜¯<strong>reselect</strong>ï¼Œæ•°æ®çš„æ‰€æœ‰å¤åˆã€è®¡ç®—ä¹Ÿæ˜¯åœ¨è¿™ä¸€å±‚è¿›è¡Œï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨storeä¸­å­˜å‚¨æœ€åŸå­ã€æœ€ç®€æ´çš„æ•°æ®ï¼Œä¸”reselectä¼šè¿›è¡Œæ•°æ®ç¼“å­˜ï¼Œå¦‚è‹¥å…³è”æ•°æ®æ²¡æœ‰å˜åŒ–ä¸ä¼šå†è¡Œè®¡ç®—ã€‚</p>
<p>  redux-toolkitä¹Ÿé›†æˆäº†reselectï¼Œé¸¡è´¼çš„ç›´æ¥å¯¼å‡ºäº†reselectçš„createSelectorï¼›</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// selectors.ts</span></span><br><span class="line"><span class="keyword">import</span> selectorsFactory <span class="keyword">from</span> <span class="string">'utils/selectorsFactory'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">'@reduxjs/toolkit'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; NAMESPACE &#125; <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; initialState &#125; <span class="keyword">from</span> <span class="string">'./slice'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IPageState &#125; <span class="keyword">from</span> <span class="string">'./types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨ç”Ÿæˆä¸€çº§æ•°æ®çš„selectorï¼Œä½¿ç”¨selectors.nameè°ƒç”¨ï¼Œå¦‚éœ€è¦æ›´è¿›ä¸€æ­¥çš„è®¡ç®—å†è‡ªè¡Œæ·»åŠ selector</span></span><br><span class="line"><span class="keyword">const</span> selectors = selectorsFactory&lt;IPageState&gt;(NAMESPACE, initialState);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¾‹å¦‚ï¼Œéœ€è¦å•ç‹¬Select modalçš„dataï¼Œæˆ–è€…æ›´è¿›ä¸€æ­¥çš„è®¡ç®—æŸäº›æ•°æ®</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> selectModalData = createSelector(</span><br><span class="line">  selectors.mainModal,</span><br><span class="line">  mainModal =&gt; mainModal.data,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> selectors;</span><br></pre></td></tr></table></figure>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Modal.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch, useSelector &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> selectors <span class="keyword">from</span> <span class="string">'../selectors'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MainModal</span>(<span class="params">props: InjectedIntlProps</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> modalData = useSelector(selectors.mainModal);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  ä»ç¤ºä¾‹ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸ºäº†å‡å°‘æ ·æ¿ä»£ç ï¼Œæˆ‘ä»¬å¼€å‘äº†selectorsFactoryæ–¹æ³•ï¼Œç”¨ä»¥è‡ªåŠ¨ç”Ÿæˆä¸€çº§selectorï¼Œå¯ä»¥é€šè¿‡selectors.mainModalå®ç°æ•°æ®çš„å–ç”¨ï¼Œå…¶å®è¿™ä¹Ÿè¡¨ç¤ºï¼Œæˆ‘ä»¬æœŸå¾…æ›´æ‰å¹³çš„Storeç»“æ„è®¾è®¡ï¼Œå¹¶ä¸æå€¡åµŒå¥—å±‚æ¬¡è¿‡å¤šï¼›</p>
<h2 id="5-è·¯ç”±-èœå•-é¢åŒ…å±‘"><a href="#5-è·¯ç”±-èœå•-é¢åŒ…å±‘" class="headerlink" title="5. è·¯ç”±+èœå•+é¢åŒ…å±‘"></a>5. è·¯ç”±+èœå•+é¢åŒ…å±‘</h2><p>  é€šè¿‡è·¯ç”±é…ç½®ï¼Œè‡ªåŠ¨å¯»æ‰¾å¯¹åº”æ–‡ä»¶ï¼ŒåŠ¨æ€åŠ è½½ã€‚å¹¶ä¸”å®Œæˆè·¯ç”±ã€èœå•å’Œé¢åŒ…å±‘ä¸‰é¡¹çš„åŒæ­¥ã€‚</p>
<p>  æˆ‘ä»¬çš„é¡µé¢æ–‡ä»¶ç»“æ„é€‰æ‹©çš„æ˜¯å¹³é“ºçš„æ–¹å¼ï¼Œè¿™å®Œå…¨æœ‰åˆ©äºä¸Šè¿°æ–¹æ¡ˆçš„å®æ–½ã€‚åµŒå¥—çš„æ–‡ä»¶ç»“æ„ä¸åˆ©äºæ‰©å±•å’Œæ›´æ”¹ï¼Œçµæ´»æ€§ä¸å¤Ÿï¼Œæ‰€ä»¥æ¨èå¹³é“ºã€‚<br>  ä¹Ÿå°±æ˜¯é¡µé¢é—´çš„çˆ¶å­ã€å…„å¼Ÿå…³ç³»ä»…é è·¯ç”±é…ç½®ç»´æŠ¤ï¼Œè€Œåœ¨æ–‡ä»¶å±‚çº§ä¸Šå‡ä¸ºå…„å¼Ÿå…³ç³»ã€‚</p>
<h3 id="è·¯ç”±-Loading-NotFoundPage"><a href="#è·¯ç”±-Loading-NotFoundPage" class="headerlink" title="è·¯ç”± + Loading + NotFoundPage"></a>è·¯ç”± + Loading + NotFoundPage</h3><p>  connected-react-routeræ˜¯ä¸€ä¸ªç»‘å®šreact-routeråˆ°reduxçš„ç»„ä»¶ï¼Œæ¥å®ç°åŒå‘ç»‘å®šrouterçš„æ•°æ®åˆ°redux storeä¸­ï¼Œè¿™ä¹ˆåšçš„å¥½å¤„å°±æ˜¯è®©åº”ç”¨æ›´ReduxåŒ–ï¼Œå¯ä»¥åœ¨actionä¸­å®ç°å¯¹è·¯ç”±çš„æ“ä½œã€‚</p>
<p>  npm i -S react-router react-router-dom  react-redux connected-react-router history react-router-cache-route</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">import * as React from &apos;react&apos;;</span><br><span class="line">import &#123; Router &#125; from &apos;react-router&apos;;</span><br><span class="line">import &#123; CacheRoute, CacheSwitch &#125; from &apos;react-router-cache-route&apos;;</span><br><span class="line">import &#123; createBrowserHistory &#125; from &apos;history&apos;;</span><br><span class="line"></span><br><span class="line">import menuData from &apos;configs/router.conf&apos;;    </span><br><span class="line"> </span><br><span class="line">const history = createBrowserHistory();</span><br><span class="line"></span><br><span class="line">function traversMenu(arr: IMenuDataItem[], keyPath: string[] = []) &#123;</span><br><span class="line">  let leafsArray: IMenuItem[] = [];</span><br><span class="line"></span><br><span class="line">  arr.forEach(item =&gt; &#123;</span><br><span class="line">    const newKeyPath = keyPath.concat([item.path]);</span><br><span class="line">    if (item.children) &#123;</span><br><span class="line">      if (item.exist) &#123;</span><br><span class="line">        leafsArray.push(&#123;</span><br><span class="line">          path: item.route,</span><br><span class="line">          componentName: item.componentName || `$&#123;item.path.substring(0, 1).toUpperCase()&#125;$&#123;item.path.substring(1)&#125;`,</span><br><span class="line">          isDetail: !!item.isDetail,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      leafsArray = leafsArray.concat(traversMenu(item.children, [...newKeyPath]));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      leafsArray.push(&#123;</span><br><span class="line">        path: item.route,</span><br><span class="line">        componentName: item.componentName || `$&#123;item.path.substring(0, 1).toUpperCase()&#125;$&#123;item.path.substring(1)&#125;`,</span><br><span class="line">        isDetail: !!item.isDetail,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  return leafsArray;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">function getLazyComponent(item: IMenuItem) &#123;</span><br><span class="line">  const comp = React.lazy(() =&gt; import(`../../containers/$&#123;item.componentName&#125;/index.tsx`).catch(err =&gt; &#123;</span><br><span class="line">    // å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™é™çº§ä¸ºé¦–é¡µï¼›</span><br><span class="line">    return import(&apos;../../containers/HomePage/index&apos;);</span><br><span class="line">  &#125;));</span><br><span class="line">  return comp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const pathToComponentArr = traversMenu(menuData, []);</span><br><span class="line">&lt;Router history=&#123;history&#125;&gt;</span><br><span class="line">  &lt;React.Suspense fallback=&#123;&lt;LoadingIndicator /&gt;&#125;&gt;</span><br><span class="line">    &lt;CacheSwitch&gt;</span><br><span class="line">      &lt;CacheRoute</span><br><span class="line">        exact</span><br><span class="line">        path=&quot;/&quot;</span><br><span class="line">        key=&quot;default&quot;</span><br><span class="line">        component=&#123;getLazyComponent(&#123;</span><br><span class="line">          path: &apos;../../containers/HomePage/index&apos;,</span><br><span class="line">          componentName: &apos;HomePage&apos;</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        pathToComponentArr.map((item: IMenuItem) =&gt; (</span><br><span class="line">          &lt;CacheRoute</span><br><span class="line">            exact</span><br><span class="line">            cacheKey=&#123;() =&gt; item.isDetail ? window.location.pathname + window.location.search : item.path&#125;</span><br><span class="line">            multiple=&#123;item.isDetail&#125;</span><br><span class="line">            key=&#123;item.path&#125;</span><br><span class="line">            className=&apos;main-content-wrap&apos;</span><br><span class="line">            path=&#123;item.isDetail ? `$&#123;item.path&#125;/:id` : item.path&#125;</span><br><span class="line">            component=&#123;getLazyComponent(item)&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))</span><br><span class="line">      &#125;</span><br><span class="line">      &lt;CacheRoute path=&quot;*&quot; component=&#123;NotFoundPage&#125; /&gt;</span><br><span class="line">    &lt;/CacheSwitch&gt;</span><br><span class="line">  &lt;/React.Suspense&gt;</span><br><span class="line">&lt;/Router&gt;</span><br></pre></td></tr></table></figure>
<h3 id="èœå•"><a href="#èœå•" class="headerlink" title="èœå•"></a>èœå•</h3><h3 id="é¢åŒ…å±‘"><a href="#é¢åŒ…å±‘" class="headerlink" title="é¢åŒ…å±‘"></a>é¢åŒ…å±‘</h3><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h3><h3 id="tabs"><a href="#tabs" class="headerlink" title="tabs"></a>tabs</h3><h3 id="ErrorBoundary"><a href="#ErrorBoundary" class="headerlink" title="ErrorBoundary"></a>ErrorBoundary</h3><h3 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h3><p>  <a href="https://eslint.org/docs/user-guide/getting-started" target="_blank" rel="noopener">eslint</a><br>  npm install eslint â€“save-dev<br>  npm eslint â€“init</p>
<p>  airbnb<br>  eslint-plugin-jsx-a11y<br>  eslint-plugin-import</p>
<h3 id="éª¨æ¶å±"><a href="#éª¨æ¶å±" class="headerlink" title="éª¨æ¶å±"></a>éª¨æ¶å±</h3><h3 id="react-dev-inspector"><a href="#react-dev-inspector" class="headerlink" title="react-dev-inspector"></a>react-dev-inspector</h3><h2 id="æ‰“åŒ…éƒ¨ç½²"><a href="#æ‰“åŒ…éƒ¨ç½²" class="headerlink" title="æ‰“åŒ…éƒ¨ç½²"></a>æ‰“åŒ…éƒ¨ç½²</h2><p>  1ï¼‰ æ‰§è¡Œwebpackå‘½ä»¤<br>  2ï¼‰ webpack â€“config â€˜webpacké…ç½®æ–‡ä»¶â€™ã€‚<br>  3ï¼‰ é…ç½®scriptå‘½ä»¤ï¼ˆâ€startâ€: â€œwebpack â€“config ./config/webpack.base.config.jsâ€ï¼‰ï¼Œåæ‰§è¡Œ</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/17/fq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/17/fq/" itemprop="url">ç¿»å¢™</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-17T20:19:55+08:00">
                2021-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ä¸“é¢˜/" itemprop="url" rel="index">
                    <span itemprop="name">ä¸“é¢˜</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ShadowscoksX + banwagong Server ç¿»å¢™ï¼š</p>
<ol>
<li>Shadowscokså¯ä»¥åœ¨githubä¸­æœåˆ°ï¼Œwindowsä¸‹è½½-winç‰ˆï¼Œmacä¸‹è½½-Xç‰ˆã€‚<br>ï¼ˆ<a href="https://github.com/yangfeicheung/Shadowsocks-X/releases/ï¼‰" target="_blank" rel="noopener">https://github.com/yangfeicheung/Shadowsocks-X/releases/ï¼‰</a></li>
<li>è´­ä¹°æœåŠ¡å™¨ï¼šå¯ä»¥åœ¨æ¬ç“¦å·¥ä¸Šè´­ä¹°<a href="https://bwh88.net/ï¼Œæ ¹æ®éœ€æ±‚è´­ä¹°ã€‚" target="_blank" rel="noopener">https://bwh88.net/ï¼Œæ ¹æ®éœ€æ±‚è´­ä¹°ã€‚</a></li>
<li>è´­ä¹°æˆåŠŸä¹‹åï¼ŒæŸ¥çœ‹Services-&gt;Login to KiwiVM Control Oanel -&gt;Root password modificationè·å–å¯†ç ã€‚ä¹‹åè¿›è¡ŒShadowsocksé…ç½®å³å¯ã€‚</li>
<li>114.34.187.46 29309 PeD593bsZMSM</li>
<li>144.34.191.186 28890 WPQbfuTpny5X</li>
<li>ç”±äºæ¬ç“¦å·¥åå°çš„shadowsocksçš„æœåŠ¡å™¨é…ç½®è¢«å¢™äº†ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡è½¯ä»¶è¿›è¡Œé…ç½®äº†ï¼Œä¸‹è½½puttyï¼Œï¼ˆ<a href="https://www.ttrar.com/mac/soft/1295.htmlï¼‰" target="_blank" rel="noopener">https://www.ttrar.com/mac/soft/1295.htmlï¼‰</a></li>
</ol>
<p>ä¸‹è½½puttyï¼š<a href="http://pan.baidu.com/s/1jI0T5Fwæˆ–è€…ç›´æ¥åœ¨ç™¾åº¦æœputtyä¸‹è½½è§£å‹è¿è¡Œputty.exeï¼Œ" target="_blank" rel="noopener">http://pan.baidu.com/s/1jI0T5Fwæˆ–è€…ç›´æ¥åœ¨ç™¾åº¦æœputtyä¸‹è½½è§£å‹è¿è¡Œputty.exeï¼Œ</a></p>
<ol start="7">
<li><p>å¡«å…¥åˆšæ‰æŸ¥åˆ°çš„ä¸»æœºåœ°å€å’Œç«¯å£å·ï¼Œå‰é¢å›¾ä¸­æœ‰ä»‹ç»ã€‚<br>å¦‚æœè¿™é‡Œæœ‰å¯¹è¯æ¡†å¼¹å‡ºï¼Œé€‰æ‹©æ˜¯ï¼Œç„¶ååœ¨å…¨é»‘çš„å±å¹•ä¸Šè¾“å…¥ root ï¼Œå›è½¦ã€‚ç­‰äº”ç§’ï¼ŒæŒ‰æç¤ºè¾“å…¥rootçš„å¯†ç ï¼Œå¯†ç å°±æ˜¯å‰é¢åˆšåˆšé‡ç½®çš„rootå¯†ç ã€‚<br>copyä½ çš„å¯†ç ï¼Œç²˜è´´è‡³puttyï¼ˆç²˜è´´æ–¹å¼ä¸ºå•å‡»é¼ æ ‡å³é”®ï¼Œåªéœ€è¦å³é”®å•å‡»ä¸€æ¬¡ï¼Œè¿™é‡Œä¸ä¼šæ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œå…¶å®æ˜¯å·²ç»è¾“å…¥äº†ï¼‰ï¼Œå›è½¦ã€‚<br>SSRè„šæœ¬å®‰è£…æ­£å¼å¼€å§‹ï¼Œç­‰åˆ°å‡ºç°root@host~å­—æ ·ï¼Œå¤åˆ¶ä¸‹é¢è„šæœ¬ç¬¬1æ¡å‘½ä»¤ï¼Œå›è½¦ï¼š<br>è„šæœ¬å‘½ä»¤1ï¼šwget â€“no-check-certificate -O shadowsocks-all.sh <a href="https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh</a><br>ï¼ˆå¤‡æ³¨ï¼šå›½å¤–æœåŠ¡å™¨è¿è¡Œè„šæœ¬æ—¶å®¹æ˜“å‡ºé”™ï¼Œå¦‚å‡ºç°é”™è¯¯æç¤º bash: wget: command not foundï¼Œå¯ä»¥è¯·å…ˆæ‰§è¡Œ yum -y install wget å‘½ä»¤ã€‚æˆåŠŸåï¼Œå†æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚å¦‚æœæ²¡æç¤ºé”™è¯¯ï¼Œè¯·ç•¥è¿‡ï¼‰</p>
</li>
<li><p>ç­‰å‡ºç°äº†ä¸Šå›¾æ˜¾ç¤ºåï¼Œè¾“å…¥ç¬¬2æ¡è„šæœ¬å‘½ä»¤ï¼Œå›è½¦ï¼š<br>è„šæœ¬å‘½ä»¤2ï¼šchmod +x shadowsocks-all.sh</p>
</li>
<li><p>ç­‰å‡ºç°äº†ä¸Šå›¾æ˜¾ç¤ºåï¼Œè¾“å…¥ç¬¬3æ¡è„šæœ¬å‘½ä»¤ï¼Œå›è½¦ï¼š<br>è„šæœ¬å‘½ä»¤3ï¼š./shadowsocks-all.sh 2&gt;&amp;1 | tee shadowsocks-all.log</p>
<p>å‡ºç°ä»¥ä¸Šç”»é¢ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©ï¼Œä¸æ‡‚çš„è¯ç›´æ¥é€‰1ï¼Œæˆ–è€…é»˜è®¤å›è½¦</p>
</li>
<li><p>ä¸‹é¢ä¼šæç¤ºä½ è¾“å…¥ä½ çš„SS SERVERçš„å¯†ç ï¼Œå’Œç«¯å£ã€‚ä¸è¾“å…¥å°±æ˜¯é»˜è®¤ã€‚è·‘å®Œå‘½ä»¤åä¼šå‡ºæ¥ä½ çš„SSå®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚</p>
<p>è¾“å…¥åï¼Œå›è½¦ï¼</p>
<p>ç‰¹åˆ«æ³¨æ„ï¼Œç”±äºiphoneç«¯çš„çš„wingyç›®å‰åªæ”¯æŒåˆ°cfbï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©aes-256-cfbï¼Œå³7 ï¼Œå›è½¦</p>
<p>è¿™ä¸€æ­¥æŒ‰å›è½¦ç»§ç»­ï¼Œç„¶åéœ€è¦å‡ åˆ†é’Ÿçš„å®‰è£…è¿‡ç¨‹ï¼Œè¯·è€å¿ƒç­‰å¾…å‡ºç°ä¸‹é¢çš„ç”»é¢ï¼</p>
</li>
<li><p>è¯·ç«‹å³copyä¸‹æ¥åŠ ä»¥ä¿å­˜ã€‚ä¸Šé¢çš„å‘½ä»¤å…¨éƒ¨å›è½¦æ‰§è¡Œåï¼Œå¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œå³ä¸ºæ‰§è¡ŒæˆåŠŸï¼Œå‡ºç°ç¡®è®¤æç¤ºçš„æ—¶å€™ï¼Œè¾“å…¥ y åï¼Œå›è½¦å³å¯ã€‚å®‰è£…å®Œæˆåï¼Œè„šæœ¬æç¤ºå¦‚ä¸‹ï¼š<br>Congratulations, Shadowsocks-Python server install completed!<br>Your Server IP : IPåœ°å€<br>Your Server Port : ç«¯å£<br>Your Password : å¯†ç <br>Your Encryption Method: aes-256-gcm<br>Your QR Code: (For Shadowsocks Windows, OSX, Android and iOS clients)<br>ss://YWVzLTsadsa206YnVkZHkyMDA4QDEwNC4yMjQuMTM1Ldfghdfgk=<br>Your QR Code has been saved as a PNG file path:<br>/root/shadowsocks_python_qr.png<br>Welcome to visit: <a href="https://teddysun.com/486.html" target="_blank" rel="noopener">https://teddysun.com/486.html</a><br>Enjoy it!</p>
<p>Starting Shadowsocks success</p>
<p>è®°å½•ä¿å­˜å¥½ä½ çš„ä¸Šè¿°ä¿¡æ¯ï¼šServer IPã€Server Portã€Passwordã€Encryption Method<br>è¿™æ—¶ä½ çš„ä¸“å±sså·²ç»æ­å¥½äº†ï¼Œå¼€å§‹ä½¿ç”¨å§ã€‚</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/03/03/webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lemon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/background22.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å°å¯’">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/03/webpack/" itemprop="url">webpack</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-03-03T16:12:35+08:00">
                2021-03-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/åŸºç¡€/" itemprop="url" rel="index">
                    <span itemprop="name">åŸºç¡€</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="æ–‡æ¡£å­¦ä¹ "><a href="#æ–‡æ¡£å­¦ä¹ " class="headerlink" title="æ–‡æ¡£å­¦ä¹ "></a><font color="#b300b2">æ–‡æ¡£å­¦ä¹ </font></h1><p>æ‰“åŒ…å·¥å…·ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œä¼šåœ¨å†…éƒ¨æ„å»ºä¸€ä¸ªä¾èµ–å›¾ï¼Œæ­¤ä¾èµ–å›¾å¯¹åº”æ˜ å°„åˆ°é¡¹ç›®æ‰€éœ€çš„æ¯ä¸ªæ¨¡å—ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªbundleã€‚<br>æ ¸å¿ƒæ¦‚å¿µï¼šentryã€outputã€loaderã€pluginã€modeã€æµè§ˆå™¨å…¼å®¹æ€§(browser compatibility)ã€environmentã€‚</p>
<h2 id="å…¥å£èµ·ç‚¹ï¼ˆentry-pointsï¼‰"><a href="#å…¥å£èµ·ç‚¹ï¼ˆentry-pointsï¼‰" class="headerlink" title="å…¥å£èµ·ç‚¹ï¼ˆentry pointsï¼‰"></a>å…¥å£èµ·ç‚¹ï¼ˆentry pointsï¼‰</h2><p>  å…¥å£æ˜¯é…ç½®webpackæ„å»ºå†…éƒ¨ä¾èµ–å›¾çš„èµ·ç‚¹æ¨¡å—ã€‚</p>
<p>  ç”¨æ³•ï¼šentry: string | [string] | å¯¹è±¡è¯­æ³•</p>
<p>  åŠ¨æ€åŠ è½½çš„æ¨¡å— ä¸æ˜¯ å…¥å£èµ·ç‚¹ã€‚<br>  ç®€å•è§„åˆ™ï¼šæ¯ä¸ª HTML é¡µé¢éƒ½æœ‰ä¸€ä¸ªå…¥å£èµ·ç‚¹ã€‚å•é¡µåº”ç”¨(SPA)ï¼šä¸€ä¸ªå…¥å£èµ·ç‚¹ï¼Œå¤šé¡µåº”ç”¨(MPA)ï¼šå¤šä¸ªå…¥å£èµ·ç‚¹ã€‚</p>
<p>  <strong>Naming</strong><br>  å¦‚æœä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ï¼Œchunk ä¼šè¢«å‘½åä¸º mainã€‚å¦‚æœä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™æ¯ä¸ªå±æ€§çš„é”®(key)ä¼šæ˜¯ chunk çš„åç§°ï¼Œè¯¥å±æ€§çš„å€¼æè¿°äº† chunk çš„å…¥å£ç‚¹ã€‚</p>
<h2 id="è¾“å‡ºï¼ˆoutputï¼‰"><a href="#è¾“å‡ºï¼ˆoutputï¼‰" class="headerlink" title="è¾“å‡ºï¼ˆoutputï¼‰"></a>è¾“å‡ºï¼ˆoutputï¼‰</h2><p>  outputå±æ€§æ˜¯é…ç½®webpackæ‰“åŒ…åçš„æ–‡ä»¶åç§°åŠå­˜æ”¾ä½ç½®ã€‚</p>
<h2 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h2><p>  webpackæœ¬èº«åªèƒ½è§£æjså’Œjsonæ–‡ä»¶ã€‚<br>  loaderå¯ä»¥è®©webpackèƒ½å¤Ÿè§£æå…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ‰æ•ˆçš„æ¨¡å—ï¼Œä»¥ä¾›ç¨‹åºå‘˜ä½¿ç”¨ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ä¾èµ–å›¾ä¸­ã€‚<br>  testå®šä¹‰è¯†åˆ«å“ªç§ç±»å‹çš„æ–‡ä»¶ï¼Œuseå®šä¹‰ä½¿ç”¨å“ªäº›loaderå»è§£æè¿™ç§ç±»å‹çš„æ–‡ä»¶ã€‚</p>
<p>  <strong>ä¸‰ç§ä½¿ç”¨ loader çš„æ–¹å¼ï¼š</strong><br>  é…ç½®æ–¹å¼ï¼ˆæ¨èï¼‰ï¼šåœ¨ webpack.config.js æ–‡ä»¶ä¸­æŒ‡å®š loaderã€‚<br>  å†…è”æ–¹å¼ï¼šåœ¨æ¯ä¸ª import è¯­å¥ä¸­æ˜¾å¼æŒ‡å®š loaderã€‚<br>  CLI æ–¹å¼ï¼šåœ¨ shell å‘½ä»¤ä¸­æŒ‡å®šå®ƒä»¬ã€‚</p>
<p>  <strong>loader ç‰¹æ€§ï¼š</strong><br>  loader æ”¯æŒé“¾å¼è°ƒç”¨ã€‚é“¾ä¸­çš„æ¯ä¸ª loader ä¼šå°†è½¬æ¢åº”ç”¨åœ¨å·²å¤„ç†è¿‡çš„èµ„æºä¸Šã€‚ä¸€ç»„é“¾å¼çš„ loader å°†æŒ‰ç…§ç›¸åçš„é¡ºåºæ‰§è¡Œã€‚é“¾ä¸­çš„ç¬¬ä¸€ä¸ª loader å°†å…¶ç»“æœï¼ˆä¹Ÿå°±æ˜¯åº”ç”¨è¿‡è½¬æ¢åçš„èµ„æºï¼‰ä¼ é€’ç»™ä¸‹ä¸€ä¸ª loaderï¼Œä¾æ­¤ç±»æ¨ã€‚æœ€åï¼Œé“¾ä¸­çš„æœ€åä¸€ä¸ª loaderï¼Œè¿”å› webpack æ‰€æœŸæœ›çš„ JavaScriptã€‚<br>  loader å¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚<br>  loader è¿è¡Œåœ¨ Node.js ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œä»»ä½•æ“ä½œã€‚<br>  loader å¯ä»¥é€šè¿‡ options å¯¹è±¡é…ç½®ï¼ˆä»ç„¶æ”¯æŒä½¿ç”¨ query å‚æ•°æ¥è®¾ç½®é€‰é¡¹ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å·²è¢«åºŸå¼ƒï¼‰ã€‚<br>  é™¤äº†å¸¸è§çš„é€šè¿‡ package.json çš„ main æ¥å°†ä¸€ä¸ª npm æ¨¡å—å¯¼å‡ºä¸º loaderï¼Œè¿˜å¯ä»¥åœ¨ module.rules ä¸­ä½¿ç”¨ loader å­—æ®µç›´æ¥å¼•ç”¨ä¸€ä¸ªæ¨¡å—ã€‚<br>  æ’ä»¶(plugin)å¯ä»¥ä¸º loader å¸¦æ¥æ›´å¤šç‰¹æ€§ã€‚<br>  loader èƒ½å¤Ÿäº§ç”Ÿé¢å¤–çš„ä»»æ„æ–‡ä»¶ã€‚</p>
<h2 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h2><p>  loaderç”¨äºè½¬æ¢æŸç§ç±»å‹çš„æ–‡ä»¶ï¼Œpluginåˆ™ç”¨æ¥æ‰§è¡Œæ›´å¹¿æ³›çš„ä»»åŠ¡ï¼Œå¦‚ï¼šæ³¨å…¥ç¯å¢ƒå˜é‡ã€èµ„æºç®¡ç†ã€æ‰“åŒ…ä¼˜åŒ–ç­‰ã€‚</p>
<p>  æ’ä»¶ç›®çš„åœ¨äºè§£å†³ loader æ— æ³•å®ç°çš„å…¶ä»–äº‹ã€‚</p>
<p>  ç”¨æ³•ï¼š</p>
<ul>
<li>é…ç½®æ–¹å¼ï¼ˆwebpack.config.jsï¼‰</li>
<li>Node API æ–¹å¼</li>
</ul>
<h2 id="é…ç½®ï¼ˆConfigurationï¼‰"><a href="#é…ç½®ï¼ˆConfigurationï¼‰" class="headerlink" title="é…ç½®ï¼ˆConfigurationï¼‰"></a>é…ç½®ï¼ˆConfigurationï¼‰</h2><h2 id="æ¨¡å—ï¼ˆModulesï¼‰"><a href="#æ¨¡å—ï¼ˆModulesï¼‰" class="headerlink" title="æ¨¡å—ï¼ˆModulesï¼‰"></a>æ¨¡å—ï¼ˆModulesï¼‰</h2><p>  webpack æä¾›äº†å¯å®šåˆ¶ï¼Œå¼ºå¤§ä¸”ä¸°å¯Œçš„ APIï¼Œå…è®¸åœ¨ ä»»ä½•æŠ€æœ¯æ ˆ ä¸­ä½¿ç”¨ï¼ŒåŒæ—¶æ”¯æŒåœ¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒçš„å·¥ä½œæµä¸­åšåˆ° æ— ä¾µå…¥æ€§ã€‚</p>
<p>  ä¸ Node.js æ¨¡å—ç›¸æ¯”ï¼Œwebpack _æ¨¡å—_èƒ½ä»¥å„ç§æ–¹å¼è¡¨è¾¾å®ƒä»¬çš„ä¾èµ–å…³ç³»ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p>
<ul>
<li>ES2015 import è¯­å¥</li>
<li>CommonJS require() è¯­å¥</li>
<li>AMD define å’Œ require è¯­å¥</li>
<li>css/sass/less æ–‡ä»¶ä¸­çš„ @import è¯­å¥ã€‚</li>
<li>stylesheet url(â€¦) æˆ–è€… HTML &lt; img src=â€¦&gt; æ–‡ä»¶ä¸­çš„å›¾ç‰‡é“¾æ¥ã€‚</li>
</ul>
<p>  webpack å¤©ç”Ÿæ”¯æŒå¦‚ä¸‹æ¨¡å—ç±»å‹ï¼š</p>
<ul>
<li>ECMAScript æ¨¡å—</li>
<li>CommonJS æ¨¡å—</li>
<li>AMD æ¨¡å—</li>
<li>Assets</li>
<li>WebAssembly æ¨¡å—</li>
</ul>
<p>  é€šè¿‡ loader å¯ä»¥ä½¿ webpack æ”¯æŒå¤šç§è¯­è¨€å’Œé¢„å¤„ç†å™¨è¯­æ³•ç¼–å†™çš„æ¨¡å—ã€‚loader å‘ webpack æè¿°äº†å¦‚ä½•å¤„ç†éåŸç”Ÿæ¨¡å—ï¼Œå¹¶å°†ç›¸å…³ä¾èµ–å¼•å…¥åˆ°ä½ çš„ bundlesä¸­ã€‚ webpack ç¤¾åŒºå·²ç»ä¸ºå„ç§æµè¡Œçš„è¯­è¨€å’Œé¢„å¤„ç†å™¨åˆ›å»ºäº† loaderï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>
<ul>
<li>CoffeeScript</li>
<li>TypeScript</li>
<li>ESNext (Babel)</li>
<li>Sass</li>
<li>Less</li>
<li>Stylus</li>
<li>Elm</li>
</ul>
<h2 id="æ¨¡å—è§£æï¼ˆModule-Resolutionï¼‰"><a href="#æ¨¡å—è§£æï¼ˆModule-Resolutionï¼‰" class="headerlink" title="æ¨¡å—è§£æï¼ˆModule Resolutionï¼‰"></a>æ¨¡å—è§£æï¼ˆModule Resolutionï¼‰</h2><p>  resolver æ˜¯ä¸€ä¸ªå¸®åŠ©å¯»æ‰¾æ¨¡å—ç»å¯¹è·¯å¾„çš„åº“ã€‚</p>
<p>  ä½¿ç”¨ enhanced-resolveï¼Œwebpack èƒ½è§£æä¸‰ç§æ–‡ä»¶è·¯å¾„ï¼š</p>
<ul>
<li>ç»å¯¹è·¯å¾„ </li>
<li>ç›¸å¯¹è·¯å¾„ </li>
<li><p>æ¨¡å—è·¯å¾„<br>åœ¨ resolve.modules ä¸­æŒ‡å®šçš„æ‰€æœ‰ç›®å½•æ£€ç´¢æ¨¡å—ã€‚<br>åœ¨ resolve.alias ç½®åˆ«å</p>
<p>ä¸€æ—¦æ ¹æ®ä¸Šè¿°è§„åˆ™è§£æè·¯å¾„åï¼Œresolver å°†ä¼šæ£€æŸ¥è·¯å¾„æ˜¯æŒ‡å‘æ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶å¤¹ã€‚<br>å¦‚æœè·¯å¾„æŒ‡å‘æ–‡ä»¶ï¼š</p>
<ul>
<li>å¦‚æœæ–‡ä»¶å…·æœ‰æ‰©å±•åï¼Œåˆ™ç›´æ¥å°†æ–‡ä»¶æ‰“åŒ…ã€‚</li>
<li>å¦åˆ™ï¼Œå°†ä½¿ç”¨ resolve.extensions é€‰é¡¹ä½œä¸ºæ–‡ä»¶æ‰©å±•åæ¥è§£æï¼Œæ­¤é€‰é¡¹ä¼šå‘Šè¯‰è§£æå™¨åœ¨è§£æä¸­èƒ½å¤Ÿæ¥å—å“ªäº›æ‰©å±•åï¼ˆä¾‹å¦‚ .jsï¼Œ.jsxï¼‰ã€‚</li>
</ul>
<p>å¦‚æœè·¯å¾„æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåˆ™è¿›è¡Œå¦‚ä¸‹æ­¥éª¤å¯»æ‰¾å…·æœ‰æ­£ç¡®æ‰©å±•åçš„æ–‡ä»¶ï¼š</p>
<ul>
<li>å¦‚æœæ–‡ä»¶å¤¹ä¸­åŒ…å« package.json æ–‡ä»¶ï¼Œåˆ™ä¼šæ ¹æ® resolve.mainFields é…ç½®ä¸­çš„å­—æ®µé¡ºåºæŸ¥æ‰¾ï¼Œå¹¶æ ¹æ® package.json ä¸­çš„ç¬¦åˆé…ç½®è¦æ±‚çš„ç¬¬ä¸€ä¸ªå­—æ®µæ¥ç¡®å®šæ–‡ä»¶è·¯å¾„ã€‚<br>å¦‚æœä¸å­˜åœ¨ package.json æ–‡ä»¶æˆ– resolve.mainFields æ²¡æœ‰è¿”å›æœ‰æ•ˆè·¯å¾„ï¼Œåˆ™ä¼šæ ¹æ® resolve.mainFiles é…ç½®é€‰é¡¹ä¸­æŒ‡å®šçš„æ–‡ä»¶åé¡ºåºæŸ¥æ‰¾ï¼Œçœ‹æ˜¯å¦èƒ½åœ¨ import/require çš„ç›®å½•ä¸‹åŒ¹é…åˆ°ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶åã€‚<br>ç„¶åä½¿ç”¨ resolve.extensions é€‰é¡¹ï¼Œä»¥ç±»ä¼¼çš„æ–¹å¼è§£ææ–‡ä»¶æ‰©å±•åã€‚</li>
</ul>
</li>
</ul>
<h2 id="Module-Federation"><a href="#Module-Federation" class="headerlink" title="Module Federation"></a>Module Federation</h2><h2 id="ä¾èµ–å›¾-dependency-graph"><a href="#ä¾èµ–å›¾-dependency-graph" class="headerlink" title="ä¾èµ–å›¾(dependency graph)"></a>ä¾èµ–å›¾(dependency graph)</h2><h2 id="target"><a href="#target" class="headerlink" title="target"></a>target</h2><h2 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h2><h2 id="æ¨¡å—çƒ­æ›¿æ¢ï¼ˆModule-Hot-Replacementï¼‰"><a href="#æ¨¡å—çƒ­æ›¿æ¢ï¼ˆModule-Hot-Replacementï¼‰" class="headerlink" title="æ¨¡å—çƒ­æ›¿æ¢ï¼ˆModule Hot Replacementï¼‰"></a>æ¨¡å—çƒ­æ›¿æ¢ï¼ˆModule Hot Replacementï¼‰</h2><h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©webpack"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©webpack" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©webpack"></a>ä¸ºä»€ä¹ˆé€‰æ‹©webpack</h2><p>  æƒ³è¦ç†è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ webpackï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸‹å†å²ï¼Œåœ¨æ‰“åŒ…å·¥å…·å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•åœ¨ web ä¸­ä½¿ç”¨ JavaScript çš„ã€‚<br>  åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ JavaScript æœ‰ä¸¤ç§æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¼•ç”¨ä¸€äº›è„šæœ¬æ¥å­˜æ”¾æ¯ä¸ªåŠŸèƒ½ï¼›æ­¤è§£å†³æ–¹æ¡ˆå¾ˆéš¾æ‰©å±•ï¼Œå› ä¸ºåŠ è½½å¤ªå¤šè„šæœ¬ä¼šå¯¼è‡´ç½‘ç»œç“¶é¢ˆã€‚ç¬¬äºŒç§æ–¹å¼ï¼Œä½¿ç”¨ä¸€ä¸ªåŒ…å«æ‰€æœ‰é¡¹ç›®ä»£ç çš„å¤§å‹ .js æ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´ä½œç”¨åŸŸã€æ–‡ä»¶å¤§å°ã€å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p>  <font color="#ff4d4d"><strong>ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼(IIFE) - Immediately invoked function expressions</strong></font><br>  IIFE è§£å†³å¤§å‹é¡¹ç›®çš„ä½œç”¨åŸŸé—®é¢˜ï¼›å½“è„šæœ¬æ–‡ä»¶è¢«å°è£…åœ¨ IIFE å†…éƒ¨æ—¶ï¼Œä½ å¯ä»¥å®‰å…¨åœ°æ‹¼æ¥æˆ–å®‰å…¨åœ°ç»„åˆæ‰€æœ‰æ–‡ä»¶ï¼Œè€Œä¸å¿…æ‹…å¿ƒä½œç”¨åŸŸå†²çªã€‚<br>  IIFE ä½¿ç”¨æ–¹å¼äº§ç”Ÿå‡º Make, Gulp, Grunt, Broccoli æˆ– Brunch ç­‰å·¥å…·ã€‚è¿™äº›å·¥å…·ç§°ä¸ºä»»åŠ¡æ‰§è¡Œå™¨ï¼Œå®ƒä»¬å°†æ‰€æœ‰é¡¹ç›®æ–‡ä»¶æ‹¼æ¥åœ¨ä¸€èµ·ã€‚<br>  ä½†æ˜¯ï¼Œä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æ„å‘³ç€å¿…é¡»é‡æ–°æ„å»ºæ•´ä¸ªæ–‡ä»¶ã€‚æ‹¼æ¥å¯ä»¥åšåˆ°å¾ˆå®¹æ˜“åœ°è·¨æ–‡ä»¶é‡ç”¨è„šæœ¬ï¼Œä½†æ˜¯å´ä½¿æ„å»ºç»“æœçš„ä¼˜åŒ–å˜å¾—æ›´åŠ å›°éš¾ã€‚å¦‚ä½•åˆ¤æ–­ä»£ç æ˜¯å¦å®é™…è¢«ä½¿ç”¨ï¼Ÿ<br>  å³ä½¿ä½ åªç”¨åˆ° lodash ä¸­çš„æŸä¸ªå‡½æ•°ï¼Œä¹Ÿå¿…é¡»åœ¨æ„å»ºç»“æœä¸­åŠ å…¥æ•´ä¸ªåº“ï¼Œç„¶åå°†å®ƒä»¬å‹ç¼©åœ¨ä¸€èµ·ã€‚å¦‚ä½• treeshake ä»£ç ä¾èµ–ï¼Ÿéš¾ä»¥å¤§è§„æ¨¡åœ°å®ç°å»¶è¿ŸåŠ è½½ä»£ç å—ï¼Œè¿™éœ€è¦å¼€å‘äººå‘˜æ‰‹åŠ¨åœ°è¿›è¡Œå¤§é‡å·¥ä½œã€‚</p>
<p>  <font color="#ff4d4d"><strong>æ„Ÿè°¢ Node.jsï¼ŒJavaScript æ¨¡å—è¯ç”Ÿäº†</strong></font><br>  Node.js æ˜¯ä¸€ä¸ª JavaScript è¿è¡Œæ—¶ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ç¯å¢ƒä¹‹å¤–çš„è®¡ç®—æœºå’ŒæœåŠ¡å™¨ä¸­ä½¿ç”¨ã€‚webpack è¿è¡Œåœ¨ Node.js ä¸­ã€‚<br>  å½“ Node.js å‘å¸ƒæ—¶ï¼Œä¸€ä¸ªæ–°çš„æ—¶ä»£å¼€å§‹äº†ï¼Œå®ƒå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ã€‚æ—¢ç„¶ä¸æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ JavaScriptï¼Œç°åœ¨å·²ç»æ²¡æœ‰äº†å¯ä»¥æ·»åŠ åˆ°æµè§ˆå™¨ä¸­çš„ html æ–‡ä»¶å’Œ script æ ‡ç­¾ã€‚é‚£ä¹ˆ Node.js åº”ç”¨ç¨‹åºè¦å¦‚ä½•åŠ è½½æ–°çš„ä»£ç  chunk å‘¢ï¼Ÿ<br>  CommonJS é—®ä¸–å¹¶å¼•å…¥äº† require æœºåˆ¶ï¼Œå®ƒå…è®¸ä½ åœ¨å½“å‰æ–‡ä»¶ä¸­åŠ è½½å’Œä½¿ç”¨æŸä¸ªæ¨¡å—ã€‚å¯¼å…¥éœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œè¿™ä¸€å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œå¸®åŠ©æˆ‘ä»¬è§£å†³äº†ä½œç”¨åŸŸé—®é¢˜ã€‚</p>
<p>  <font color="#ff4d4d"><strong>npm + Node.js + modules - å¤§è§„æ¨¡åˆ†å‘æ¨¡å— </strong></font><br>  JavaScript å·²ç»æˆä¸ºä¸€ç§è¯­è¨€ã€ä¸€ä¸ªå¹³å°å’Œä¸€ç§å¿«é€Ÿå¼€å‘å’Œåˆ›å»ºå¿«é€Ÿåº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œæ¥ç®¡äº†æ•´ä¸ª JavaScript ä¸–ç•Œã€‚<br>  ä½† CommonJS æ²¡æœ‰æµè§ˆå™¨æ”¯æŒã€‚æ²¡æœ‰ live binding(å®æ—¶ç»‘å®š)ã€‚å¾ªç¯å¼•ç”¨å­˜åœ¨é—®é¢˜ã€‚åŒæ­¥æ‰§è¡Œçš„æ¨¡å—è§£æåŠ è½½å™¨é€Ÿåº¦å¾ˆæ…¢ã€‚è™½ç„¶ CommonJS æ˜¯ Node.js é¡¹ç›®çš„ç»ä½³è§£å†³æ–¹æ¡ˆï¼Œä½†æµè§ˆå™¨ä¸æ”¯æŒæ¨¡å—ï¼Œå› è€Œäº§ç”Ÿäº† Browserify, RequireJS å’Œ SystemJS ç­‰æ‰“åŒ…å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬ç¼–å†™èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ CommonJS æ¨¡å—ã€‚</p>
<p>  <font color="#ff4d4d"><strong>ESM - ECMAScript æ¨¡å—</strong></font><br>  æ¥è‡ª Web é¡¹ç›®çš„å¥½æ¶ˆæ¯æ˜¯ï¼Œæ¨¡å—æ­£åœ¨æˆä¸º ECMAScript æ ‡å‡†çš„å®˜æ–¹åŠŸèƒ½ã€‚ç„¶è€Œï¼Œæµè§ˆå™¨æ”¯æŒä¸å®Œæ•´ï¼Œç‰ˆæœ¬è¿­ä»£é€Ÿåº¦ä¹Ÿä¸å¤Ÿå¿«ï¼Œç›®å‰è¿˜æ˜¯æ¨èä¸Šé¢é‚£äº›æ—©æœŸæ¨¡å—å®ç°ã€‚</p>
<p>  <font color="#ff4d4d"><strong>ä¾èµ–è‡ªåŠ¨æ”¶</strong></font><br>  ä¼ ç»Ÿçš„ä»»åŠ¡æ„å»ºå·¥å…·åŸºäº Google çš„ Closure ç¼–è¯‘å™¨éƒ½è¦æ±‚ä½ æ‰‹åŠ¨åœ¨é¡¶éƒ¨å£°æ˜æ‰€æœ‰çš„ä¾èµ–ã€‚ç„¶è€Œåƒ webpack ä¸€ç±»çš„æ‰“åŒ…å·¥å…·è‡ªåŠ¨æ„å»ºå¹¶åŸºäºä½ æ‰€å¼•ç”¨æˆ–å¯¼å‡ºçš„å†…å®¹æ¨æ–­å‡ºä¾èµ–çš„å›¾è°±ã€‚è¿™ä¸ªç‰¹æ€§ä¸å…¶å®ƒçš„å¦‚æ’ä»¶ and åŠ è½½å™¨ä¸€é“è®©å¼€å‘è€…çš„ä½“éªŒæ›´å¥½ã€‚</p>
<p>  <font color="#ff4d4d"><strong>çœ‹èµ·æ¥éƒ½ä¸æ˜¯å¾ˆå¥½â€¦â€¦</strong> </font><br>  æ˜¯å¦å¯ä»¥æœ‰ä¸€ç§æ–¹å¼ï¼Œä¸ä»…å¯ä»¥è®©æˆ‘ä»¬ç¼–å†™æ¨¡å—ï¼Œè€Œä¸”è¿˜æ”¯æŒä»»ä½•æ¨¡å—æ ¼å¼ï¼ˆè‡³å°‘åœ¨æˆ‘ä»¬åˆ°è¾¾ ESM ä¹‹å‰ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥åŒæ—¶å¤„ç†èµ„æºå’Œèµ„äº§ï¼Ÿ</p>
<p>  è¿™å°±æ˜¯ webpack å­˜åœ¨çš„åŸå› ã€‚å®ƒæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥æ‰“åŒ…ä½ çš„ JavaScript åº”ç”¨ç¨‹åºï¼ˆæ”¯æŒ ESM å’Œ CommonJSï¼‰ï¼Œå¯ä»¥æ‰©å±•ä¸ºæ”¯æŒè®¸å¤šä¸åŒçš„èµ„äº§ï¼Œä¾‹å¦‚ï¼šimages, fonts å’Œ stylesheetsã€‚</p>
<p>  webpack å…³å¿ƒæ€§èƒ½å’ŒåŠ è½½æ—¶é—´ï¼›å®ƒå§‹ç»ˆåœ¨æ”¹è¿›æˆ–æ·»åŠ æ–°åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå¼‚æ­¥åœ°åŠ è½½ chunk å’Œé¢„å–ï¼Œä»¥ä¾¿ä¸ºä½ çš„é¡¹ç›®å’Œç”¨æˆ·æä¾›æœ€ä½³ä½“éªŒã€‚</p>
<h2 id="æ­ç¤ºå†…éƒ¨åŸç†"><a href="#æ­ç¤ºå†…éƒ¨åŸç†" class="headerlink" title="æ­ç¤ºå†…éƒ¨åŸç†"></a>æ­ç¤ºå†…éƒ¨åŸç†</h2><p>  æ‰“åŒ…ï¼Œæ˜¯æŒ‡å¤„ç†æŸäº›æ–‡ä»¶å¹¶å°†å…¶è¾“å‡ºä¸ºæŸäº›æ–‡ä»¶çš„èƒ½åŠ›ã€‚<br>  ä½†æ˜¯åœ¨è¾“å…¥å’Œè¾“å‡ºä¹‹é—´ï¼Œè¿˜å­˜åœ¨ç€æ¨¡å—ã€å…¥å£èµ·ç‚¹ã€chunkã€chunkç»„å’Œè®¸å¤šå…¶ä»–ä¸­é—´éƒ¨åˆ†ã€‚</p>
<p>  <strong>ä¸»è¦éƒ¨åˆ†</strong><br>  é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚</p>
<p>  é€šè¿‡ç›¸äº’å¼•ç”¨ï¼Œè¿™äº›æ¨¡å—ä¼šå½¢æˆä¸€ä¸ªå›¾ï¼ˆModuleGraphï¼‰æ•°æ®ç»“æ„ã€‚<br>  åœ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œæ–‡ä»¶ä¼šè¢«åˆå¹¶æˆchunkã€‚chunkåˆå¹¶æˆchunkç»„ï¼Œå¹¶å½¢æˆä¸€ä¸ªé€šè¿‡æ¨¡å—è¿æ¥çš„å›¾ï¼ˆModuleGraphï¼‰ã€‚</p>
<h1 id="API"><a href="#API" class="headerlink" title="API"></a><font color="#b300b2">API</font></h1><h2 id="å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰"><a href="#å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰" class="headerlink" title="å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰"></a>å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰</h2><p>   CLIä¸­ä¼ å…¥çš„ä»»ä½•å‚æ•°ä¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ˜ å°„ä¸ºå¯¹åº”çš„å‚æ•°ã€‚</p>
<h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a><font color="#b300b2">é…ç½®</font></h1><h2 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h2><p>  development    ä¼šå°† DefinePlugin ä¸­ process.env.NODE_ENV çš„å€¼è®¾ç½®ä¸º developmentã€‚<br>  production    ä¼šå°† DefinePlugin ä¸­ process.env.NODE_ENV çš„å€¼è®¾ç½®ä¸º productionã€‚<br>  none    ä¸ä½¿ç”¨ä»»ä½•é»˜è®¤ä¼˜åŒ–é€‰é¡¹</p>
<h1 id="question"><a href="#question" class="headerlink" title="question"></a><font color="#b300b2">question</font></h1><h2 id="loaderå’Œpluginçš„åŒºåˆ«"><a href="#loaderå’Œpluginçš„åŒºåˆ«" class="headerlink" title="loaderå’Œpluginçš„åŒºåˆ«"></a>loaderå’Œpluginçš„åŒºåˆ«</h2><pre><code>loader æ¨¡å—è½¬æ¢å™¨ ï¼ˆless-&gt;cssï¼‰
plugin æ˜¯æ‰©å±•æ’ä»¶ï¼Œå¦‚HtmlWebpackPlugin

å¸¸è§çš„loaderå’Œpluginæœ‰å“ªäº›ï¼Ÿ
Loader:
babel-loaderï¼šæŠŠ ES6 è½¬æ¢æˆ ES5
css-loaderï¼šåŠ è½½ CSSï¼Œæ”¯æŒæ¨¡å—åŒ–ã€å‹ç¼©ã€æ–‡ä»¶å¯¼å…¥ç­‰ç‰¹æ€§
style-loaderï¼šæŠŠ CSS ä»£ç æ³¨å…¥åˆ° JavaScript ä¸­ï¼Œé€šè¿‡ DOM æ“ä½œå»åŠ è½½ CSSã€‚
file-loader (png|jpg|jpeg|gif) å¼€å‘
url-loader, ç”Ÿäº§
vue-loader

Plugin:
IgnorePlugin é¿å…å¼•å…¥æ— ç”¨æ¨¡å—
HotModuleReplacementPlugin çƒ­æ›´æ–°
define-pluginï¼šå®šä¹‰ç¯å¢ƒå˜é‡
commons-chunk-pluginï¼šæå–å…¬å…±ä»£ç 
uglifyjs-webpack-pluginï¼šé€šè¿‡UglifyESå‹ç¼©ES6ä»£ç 
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/background22.jpg" alt="Lemon">
            
              <p class="site-author-name" itemprop="name">Lemon</p>
              <p class="site-description motion-element" itemprop="description">ä¹˜é£ç ´æµª</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lemon</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
